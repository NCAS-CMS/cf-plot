<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cfplot &#8212; cf-plot 3.3.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/classic.css?v=97decc96" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=eafc0fe6" />
    
    <script src="../_static/documentation_options.js?v=3eb8911e"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">cf-plot 3.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">cfplot</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for cfplot</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Climate contour/vector plots using cf-python, matplotlib and cartopy.</span>
<span class="sd">Andy Heaps NCAS-CMS November 2023</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plot</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PolyCollection</span>
<span class="kn">from</span> <span class="nn">distutils.version</span> <span class="kn">import</span> <span class="n">StrictVersion</span>
<span class="kn">import</span> <span class="nn">cartopy</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.util</span> <span class="k">as</span> <span class="nn">cartopy_util</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="k">as</span> <span class="nn">sgeom</span>
<span class="kn">import</span> <span class="nn">shapely</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PatchCollection</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
            
<span class="c1"># Check for the minimum cf-python version</span>
<span class="n">cf_version_min</span> <span class="o">=</span> <span class="s1">&#39;3.0.0b2&#39;</span>
<span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> cf-python &gt; &#39;</span> <span class="o">+</span> <span class="n">cf_version_min</span>
<span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> needs to be installed to use cf-plot </span><span class="se">\n\n</span><span class="s1">&#39;</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cf</span>
    <span class="k">if</span> <span class="n">StrictVersion</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">StrictVersion</span><span class="p">(</span><span class="n">cf_version_min</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>


<span class="c1"># Initiate the pvars class</span>
<span class="c1"># This is used for storing plotting variables in cfp.plotvars</span>
<span class="k">class</span> <span class="nc">pvars</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;Initialize a new Pvars instance&#39;&#39;&#39;</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;x.__str__() &lt;==&gt; str(x)&#39;&#39;&#39;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> = </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">))]</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">return</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>


<span class="c1"># Check for a display and use the Agg backing store if none is present</span>
<span class="c1"># This is for batch mode processing</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">disp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DISPLAY&quot;</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s1">&#39;Agg&#39;</span><span class="p">)</span>


<span class="c1"># Check for user setting of pre_existing_data_dir pointing to central cartopy setup</span>
<span class="c1"># This is used in the cfview simple setup process</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">pre_existing_data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;pre_existing_data_dir&quot;</span><span class="p">]</span>
    <span class="n">cartopy</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;pre_existing_data_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre_existing_data_dir</span>
<span class="k">except</span><span class="p">:</span>
    <span class="k">pass</span>



<span class="c1"># Code to check if the ImageMagick display command is available</span>
<span class="k">def</span> <span class="nf">which</span><span class="p">(</span><span class="n">program</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">is_exe</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ext_candidates</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">fpath</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PATHEXT&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">fpath</span> <span class="o">+</span> <span class="n">ext</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
        <span class="n">exe_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">program</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">ext_candidates</span><span class="p">(</span><span class="n">exe_file</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_exe</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">candidate</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="c1"># Default colour scales</span>
<span class="c1"># cscale1 is a differential data scale - blue to red</span>
<span class="n">cscale1</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#0a3278&#39;</span><span class="p">,</span> <span class="s1">&#39;#0f4ba5&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e6ec8&#39;</span><span class="p">,</span> <span class="s1">&#39;#3ca0f0&#39;</span><span class="p">,</span> <span class="s1">&#39;#50b4fa&#39;</span><span class="p">,</span> <span class="s1">&#39;#82d2ff&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#a0f0ff&#39;</span><span class="p">,</span> <span class="s1">&#39;#c8faff&#39;</span><span class="p">,</span> <span class="s1">&#39;#e6ffff&#39;</span><span class="p">,</span> <span class="s1">&#39;#fffadc&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffe878&#39;</span><span class="p">,</span> <span class="s1">&#39;#ffc03c&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#ffa000&#39;</span><span class="p">,</span> <span class="s1">&#39;#ff6000&#39;</span><span class="p">,</span> <span class="s1">&#39;#ff3200&#39;</span><span class="p">,</span> <span class="s1">&#39;#e11400&#39;</span><span class="p">,</span> <span class="s1">&#39;#c00000&#39;</span><span class="p">,</span> <span class="s1">&#39;#a50000&#39;</span><span class="p">]</span>

<span class="c1"># viridis is a continuous data scale - blue, green, yellow</span>
<span class="n">viridis</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#440154&#39;</span><span class="p">,</span> <span class="s1">&#39;#440255&#39;</span><span class="p">,</span> <span class="s1">&#39;#440357&#39;</span><span class="p">,</span> <span class="s1">&#39;#450558&#39;</span><span class="p">,</span> <span class="s1">&#39;#45065a&#39;</span><span class="p">,</span> <span class="s1">&#39;#45085b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#46095c&#39;</span><span class="p">,</span> <span class="s1">&#39;#460b5e&#39;</span><span class="p">,</span> <span class="s1">&#39;#460c5f&#39;</span><span class="p">,</span> <span class="s1">&#39;#460e61&#39;</span><span class="p">,</span> <span class="s1">&#39;#470f62&#39;</span><span class="p">,</span> <span class="s1">&#39;#471163&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#471265&#39;</span><span class="p">,</span> <span class="s1">&#39;#471466&#39;</span><span class="p">,</span> <span class="s1">&#39;#471567&#39;</span><span class="p">,</span> <span class="s1">&#39;#471669&#39;</span><span class="p">,</span> <span class="s1">&#39;#47186a&#39;</span><span class="p">,</span> <span class="s1">&#39;#48196b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#481a6c&#39;</span><span class="p">,</span> <span class="s1">&#39;#481c6e&#39;</span><span class="p">,</span> <span class="s1">&#39;#481d6f&#39;</span><span class="p">,</span> <span class="s1">&#39;#481e70&#39;</span><span class="p">,</span> <span class="s1">&#39;#482071&#39;</span><span class="p">,</span> <span class="s1">&#39;#482172&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#482273&#39;</span><span class="p">,</span> <span class="s1">&#39;#482374&#39;</span><span class="p">,</span> <span class="s1">&#39;#472575&#39;</span><span class="p">,</span> <span class="s1">&#39;#472676&#39;</span><span class="p">,</span> <span class="s1">&#39;#472777&#39;</span><span class="p">,</span> <span class="s1">&#39;#472878&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#472a79&#39;</span><span class="p">,</span> <span class="s1">&#39;#472b7a&#39;</span><span class="p">,</span> <span class="s1">&#39;#472c7b&#39;</span><span class="p">,</span> <span class="s1">&#39;#462d7c&#39;</span><span class="p">,</span> <span class="s1">&#39;#462f7c&#39;</span><span class="p">,</span> <span class="s1">&#39;#46307d&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#46317e&#39;</span><span class="p">,</span> <span class="s1">&#39;#45327f&#39;</span><span class="p">,</span> <span class="s1">&#39;#45347f&#39;</span><span class="p">,</span> <span class="s1">&#39;#453580&#39;</span><span class="p">,</span> <span class="s1">&#39;#453681&#39;</span><span class="p">,</span> <span class="s1">&#39;#443781&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#443982&#39;</span><span class="p">,</span> <span class="s1">&#39;#433a83&#39;</span><span class="p">,</span> <span class="s1">&#39;#433b83&#39;</span><span class="p">,</span> <span class="s1">&#39;#433c84&#39;</span><span class="p">,</span> <span class="s1">&#39;#423d84&#39;</span><span class="p">,</span> <span class="s1">&#39;#423e85&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#424085&#39;</span><span class="p">,</span> <span class="s1">&#39;#414186&#39;</span><span class="p">,</span> <span class="s1">&#39;#414286&#39;</span><span class="p">,</span> <span class="s1">&#39;#404387&#39;</span><span class="p">,</span> <span class="s1">&#39;#404487&#39;</span><span class="p">,</span> <span class="s1">&#39;#3f4587&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#3f4788&#39;</span><span class="p">,</span> <span class="s1">&#39;#3e4888&#39;</span><span class="p">,</span> <span class="s1">&#39;#3e4989&#39;</span><span class="p">,</span> <span class="s1">&#39;#3d4a89&#39;</span><span class="p">,</span> <span class="s1">&#39;#3d4b89&#39;</span><span class="p">,</span> <span class="s1">&#39;#3d4c89&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#3c4d8a&#39;</span><span class="p">,</span> <span class="s1">&#39;#3c4e8a&#39;</span><span class="p">,</span> <span class="s1">&#39;#3b508a&#39;</span><span class="p">,</span> <span class="s1">&#39;#3b518a&#39;</span><span class="p">,</span> <span class="s1">&#39;#3a528b&#39;</span><span class="p">,</span> <span class="s1">&#39;#3a538b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#39548b&#39;</span><span class="p">,</span> <span class="s1">&#39;#39558b&#39;</span><span class="p">,</span> <span class="s1">&#39;#38568b&#39;</span><span class="p">,</span> <span class="s1">&#39;#38578c&#39;</span><span class="p">,</span> <span class="s1">&#39;#37588c&#39;</span><span class="p">,</span> <span class="s1">&#39;#37598c&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#365a8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#365b8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#355c8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#355d8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#345e8d&#39;</span><span class="p">,</span> <span class="s1">&#39;#345f8d&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#33608d&#39;</span><span class="p">,</span> <span class="s1">&#39;#33618d&#39;</span><span class="p">,</span> <span class="s1">&#39;#32628d&#39;</span><span class="p">,</span> <span class="s1">&#39;#32638d&#39;</span><span class="p">,</span> <span class="s1">&#39;#31648d&#39;</span><span class="p">,</span> <span class="s1">&#39;#31658d&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#31668d&#39;</span><span class="p">,</span> <span class="s1">&#39;#30678d&#39;</span><span class="p">,</span> <span class="s1">&#39;#30688d&#39;</span><span class="p">,</span> <span class="s1">&#39;#2f698d&#39;</span><span class="p">,</span> <span class="s1">&#39;#2f6a8d&#39;</span><span class="p">,</span> <span class="s1">&#39;#2e6b8e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#2e6c8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2e6d8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2d6e8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2d6f8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2c708e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2c718e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#2c728e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2b738e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2b748e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2a758e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2a768e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2a778e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#29788e&#39;</span><span class="p">,</span> <span class="s1">&#39;#29798e&#39;</span><span class="p">,</span> <span class="s1">&#39;#287a8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#287a8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#287b8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#277c8e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#277d8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#277e8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#267f8e&#39;</span><span class="p">,</span> <span class="s1">&#39;#26808e&#39;</span><span class="p">,</span> <span class="s1">&#39;#26818e&#39;</span><span class="p">,</span> <span class="s1">&#39;#25828e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#25838d&#39;</span><span class="p">,</span> <span class="s1">&#39;#24848d&#39;</span><span class="p">,</span> <span class="s1">&#39;#24858d&#39;</span><span class="p">,</span> <span class="s1">&#39;#24868d&#39;</span><span class="p">,</span> <span class="s1">&#39;#23878d&#39;</span><span class="p">,</span> <span class="s1">&#39;#23888d&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#23898d&#39;</span><span class="p">,</span> <span class="s1">&#39;#22898d&#39;</span><span class="p">,</span> <span class="s1">&#39;#228a8d&#39;</span><span class="p">,</span> <span class="s1">&#39;#228b8d&#39;</span><span class="p">,</span> <span class="s1">&#39;#218c8d&#39;</span><span class="p">,</span> <span class="s1">&#39;#218d8c&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#218e8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#208f8c&#39;</span><span class="p">,</span> <span class="s1">&#39;#20908c&#39;</span><span class="p">,</span> <span class="s1">&#39;#20918c&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f928c&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f938b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#1f948b&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f958b&#39;</span><span class="p">,</span> <span class="s1">&#39;#1f968b&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e978a&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e988a&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e998a&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#1e998a&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e9a89&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e9b89&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e9c89&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e9d88&#39;</span><span class="p">,</span> <span class="s1">&#39;#1e9e88&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#1e9f88&#39;</span><span class="p">,</span> <span class="s1">&#39;#1ea087&#39;</span><span class="p">,</span> <span class="s1">&#39;#1fa187&#39;</span><span class="p">,</span> <span class="s1">&#39;#1fa286&#39;</span><span class="p">,</span> <span class="s1">&#39;#1fa386&#39;</span><span class="p">,</span> <span class="s1">&#39;#20a485&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#20a585&#39;</span><span class="p">,</span> <span class="s1">&#39;#21a685&#39;</span><span class="p">,</span> <span class="s1">&#39;#21a784&#39;</span><span class="p">,</span> <span class="s1">&#39;#22a784&#39;</span><span class="p">,</span> <span class="s1">&#39;#23a883&#39;</span><span class="p">,</span> <span class="s1">&#39;#23a982&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#24aa82&#39;</span><span class="p">,</span> <span class="s1">&#39;#25ab81&#39;</span><span class="p">,</span> <span class="s1">&#39;#26ac81&#39;</span><span class="p">,</span> <span class="s1">&#39;#27ad80&#39;</span><span class="p">,</span> <span class="s1">&#39;#28ae7f&#39;</span><span class="p">,</span> <span class="s1">&#39;#29af7f&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#2ab07e&#39;</span><span class="p">,</span> <span class="s1">&#39;#2bb17d&#39;</span><span class="p">,</span> <span class="s1">&#39;#2cb17d&#39;</span><span class="p">,</span> <span class="s1">&#39;#2eb27c&#39;</span><span class="p">,</span> <span class="s1">&#39;#2fb37b&#39;</span><span class="p">,</span> <span class="s1">&#39;#30b47a&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#32b57a&#39;</span><span class="p">,</span> <span class="s1">&#39;#33b679&#39;</span><span class="p">,</span> <span class="s1">&#39;#35b778&#39;</span><span class="p">,</span> <span class="s1">&#39;#36b877&#39;</span><span class="p">,</span> <span class="s1">&#39;#38b976&#39;</span><span class="p">,</span> <span class="s1">&#39;#39b976&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#3bba75&#39;</span><span class="p">,</span> <span class="s1">&#39;#3dbb74&#39;</span><span class="p">,</span> <span class="s1">&#39;#3ebc73&#39;</span><span class="p">,</span> <span class="s1">&#39;#40bd72&#39;</span><span class="p">,</span> <span class="s1">&#39;#42be71&#39;</span><span class="p">,</span> <span class="s1">&#39;#44be70&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#45bf6f&#39;</span><span class="p">,</span> <span class="s1">&#39;#47c06e&#39;</span><span class="p">,</span> <span class="s1">&#39;#49c16d&#39;</span><span class="p">,</span> <span class="s1">&#39;#4bc26c&#39;</span><span class="p">,</span> <span class="s1">&#39;#4dc26b&#39;</span><span class="p">,</span> <span class="s1">&#39;#4fc369&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#51c468&#39;</span><span class="p">,</span> <span class="s1">&#39;#53c567&#39;</span><span class="p">,</span> <span class="s1">&#39;#55c666&#39;</span><span class="p">,</span> <span class="s1">&#39;#57c665&#39;</span><span class="p">,</span> <span class="s1">&#39;#59c764&#39;</span><span class="p">,</span> <span class="s1">&#39;#5bc862&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#5ec961&#39;</span><span class="p">,</span> <span class="s1">&#39;#60c960&#39;</span><span class="p">,</span> <span class="s1">&#39;#62ca5f&#39;</span><span class="p">,</span> <span class="s1">&#39;#64cb5d&#39;</span><span class="p">,</span> <span class="s1">&#39;#67cc5c&#39;</span><span class="p">,</span> <span class="s1">&#39;#69cc5b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#6bcd59&#39;</span><span class="p">,</span> <span class="s1">&#39;#6dce58&#39;</span><span class="p">,</span> <span class="s1">&#39;#70ce56&#39;</span><span class="p">,</span> <span class="s1">&#39;#72cf55&#39;</span><span class="p">,</span> <span class="s1">&#39;#74d054&#39;</span><span class="p">,</span> <span class="s1">&#39;#77d052&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#79d151&#39;</span><span class="p">,</span> <span class="s1">&#39;#7cd24f&#39;</span><span class="p">,</span> <span class="s1">&#39;#7ed24e&#39;</span><span class="p">,</span> <span class="s1">&#39;#81d34c&#39;</span><span class="p">,</span> <span class="s1">&#39;#83d34b&#39;</span><span class="p">,</span> <span class="s1">&#39;#86d449&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#88d547&#39;</span><span class="p">,</span> <span class="s1">&#39;#8bd546&#39;</span><span class="p">,</span> <span class="s1">&#39;#8dd644&#39;</span><span class="p">,</span> <span class="s1">&#39;#90d643&#39;</span><span class="p">,</span> <span class="s1">&#39;#92d741&#39;</span><span class="p">,</span> <span class="s1">&#39;#95d73f&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#97d83e&#39;</span><span class="p">,</span> <span class="s1">&#39;#9ad83c&#39;</span><span class="p">,</span> <span class="s1">&#39;#9dd93a&#39;</span><span class="p">,</span> <span class="s1">&#39;#9fd938&#39;</span><span class="p">,</span> <span class="s1">&#39;#a2da37&#39;</span><span class="p">,</span> <span class="s1">&#39;#a5da35&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#a7db33&#39;</span><span class="p">,</span> <span class="s1">&#39;#aadb32&#39;</span><span class="p">,</span> <span class="s1">&#39;#addc30&#39;</span><span class="p">,</span> <span class="s1">&#39;#afdc2e&#39;</span><span class="p">,</span> <span class="s1">&#39;#b2dd2c&#39;</span><span class="p">,</span> <span class="s1">&#39;#b5dd2b&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#b7dd29&#39;</span><span class="p">,</span> <span class="s1">&#39;#bade27&#39;</span><span class="p">,</span> <span class="s1">&#39;#bdde26&#39;</span><span class="p">,</span> <span class="s1">&#39;#bfdf24&#39;</span><span class="p">,</span> <span class="s1">&#39;#c2df22&#39;</span><span class="p">,</span> <span class="s1">&#39;#c5df21&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#c7e01f&#39;</span><span class="p">,</span> <span class="s1">&#39;#cae01e&#39;</span><span class="p">,</span> <span class="s1">&#39;#cde01d&#39;</span><span class="p">,</span> <span class="s1">&#39;#cfe11c&#39;</span><span class="p">,</span> <span class="s1">&#39;#d2e11b&#39;</span><span class="p">,</span> <span class="s1">&#39;#d4e11a&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#d7e219&#39;</span><span class="p">,</span> <span class="s1">&#39;#dae218&#39;</span><span class="p">,</span> <span class="s1">&#39;#dce218&#39;</span><span class="p">,</span> <span class="s1">&#39;#dfe318&#39;</span><span class="p">,</span> <span class="s1">&#39;#e1e318&#39;</span><span class="p">,</span> <span class="s1">&#39;#e4e318&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#e7e419&#39;</span><span class="p">,</span> <span class="s1">&#39;#e9e419&#39;</span><span class="p">,</span> <span class="s1">&#39;#ece41a&#39;</span><span class="p">,</span> <span class="s1">&#39;#eee51b&#39;</span><span class="p">,</span> <span class="s1">&#39;#f1e51c&#39;</span><span class="p">,</span> <span class="s1">&#39;#f3e51e&#39;</span><span class="p">,</span>
           <span class="s1">&#39;#f6e61f&#39;</span><span class="p">,</span> <span class="s1">&#39;#f8e621&#39;</span><span class="p">,</span> <span class="s1">&#39;#fae622&#39;</span><span class="p">,</span> <span class="s1">&#39;#fde724&#39;</span><span class="p">]</span>

<span class="c1"># Read in defaults if they exist and overlay</span>
<span class="c1"># for contour options of fill, blockfill and lines</span>
<span class="n">global_fill</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">global_lines</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">global_blockfill</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">global_degsym</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">global_viewer</span> <span class="o">=</span> <span class="s1">&#39;display&#39;</span>
<span class="n">defaults_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;/.cfplot_defaults&#39;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">defaults_file</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">defaults_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
            <span class="n">com</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">vals</span>
            <span class="n">v</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">com</span> <span class="o">==</span> <span class="s1">&#39;blockfill&#39;</span><span class="p">:</span>
                <span class="n">global_blockfill</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">com</span> <span class="o">==</span> <span class="s1">&#39;lines&#39;</span><span class="p">:</span>
                <span class="n">global_lines</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">com</span> <span class="o">==</span> <span class="s1">&#39;fill&#39;</span><span class="p">:</span>
                <span class="n">global_fill</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">com</span> <span class="o">==</span> <span class="s1">&#39;degsym&#39;</span><span class="p">:</span>
                <span class="n">global_degsym</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">com</span> <span class="o">==</span> <span class="s1">&#39;viewer&#39;</span><span class="p">:</span>
                <span class="n">global_viewer</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="c1"># plotvars - global plotting variables</span>
<span class="n">plotvars</span> <span class="o">=</span> <span class="n">pvars</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span> <span class="n">lonmax</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span>
                 <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;110m&#39;</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">levels_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">levels_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">levels_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">levels_extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;landscape&#39;</span><span class="p">,</span>
                 <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cscale_flag</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">user_levs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">master_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cs</span><span class="o">=</span><span class="n">cscale1</span><span class="p">,</span>
                 <span class="n">cs_user</span><span class="o">=</span><span class="s1">&#39;cscale1&#39;</span><span class="p">,</span> <span class="n">mymap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xstep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ystep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                 <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">text_fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                 <span class="n">text_fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">axis_label_fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                 <span class="n">colorbar_fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">colorbar_fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                 <span class="n">title_fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">continent_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">continent_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">continent_linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">viewer</span><span class="o">=</span><span class="n">global_viewer</span><span class="p">,</span> <span class="n">global_viewer</span><span class="o">=</span><span class="n">global_viewer</span><span class="p">,</span>
                 <span class="n">tspace_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tspace_month</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tspace_day</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">tspace_hour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xtick_label_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">xtick_label_align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">ytick_label_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                 <span class="n">ytick_label_align</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="n">legend_text_size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
                 <span class="n">legend_text_weight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span>
                 <span class="n">cs_uniform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">master_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">master_title_location</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span> <span class="n">master_title_fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                 <span class="n">master_title_fontweight</span><span class="o">=</span><span class="s1">&#39;normal&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">plot_xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">plot_ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">land_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ocean_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">lake_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_zorder</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span> <span class="n">twinx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">twiny</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">rotated_grid_thickness</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">rotated_grid_spacing</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
                 <span class="n">rotated_deg_spacing</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">rotated_continents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">rotated_grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">rotated_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">legend_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend_frame_edge_color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                 <span class="n">legend_frame_face_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">degsym</span><span class="o">=</span><span class="n">global_degsym</span><span class="p">,</span>
                 <span class="n">axis_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_x_spacing</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">grid_y_spacing</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
                 <span class="n">grid_colour</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">grid_linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">grid_zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                 <span class="n">grid_thickness</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;equal&#39;</span><span class="p">,</span>
                 <span class="n">graph_xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">graph_xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">graph_ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">graph_ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">level_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">gpos_called</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">titles_con_called</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Check for iPython notebook inline</span>
<span class="c1"># and set the viewer to None if found</span>
<span class="n">is_inline</span> <span class="o">=</span> <span class="s1">&#39;inline&#39;</span> <span class="ow">in</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
<span class="k">if</span> <span class="n">is_inline</span><span class="p">:</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Check for OSX and if so use matplotlib for for the viewer</span>
<span class="c1"># Not all users will have ImageMagick installed / XQuartz running</span>
<span class="c1"># Users can still select this with cfp.setvars(viewer=&#39;display&#39;)</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s1">&#39;darwin&#39;</span><span class="p">:</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">global_viewer</span> <span class="o">=</span> <span class="s1">&#39;matplotlib&#39;</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="s1">&#39;matplotlib&#39;</span>


<div class="viewcode-block" id="con">
<a class="viewcode-back" href="../con.html#cfplot.con">[docs]</a>
<span class="k">def</span> <span class="nf">con</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">global_fill</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="n">global_lines</span><span class="p">,</span> <span class="n">line_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">colorbar_label_skip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">negative_linestyle</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span>
        <span class="n">blockfill</span><span class="o">=</span><span class="n">global_blockfill</span><span class="p">,</span> <span class="n">zero_thick</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">colorbar_orientation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">ylog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">swap_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linewidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">colorbar_text_up_down</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">colorbar_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">colorbar_text_down_up</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colorbar_drawedges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">colorbar_fraction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_thick</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">colorbar_anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">linestyles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">level_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">irregular</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">face_lons</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">face_lats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">face_connectivity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="n">titles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">mytest</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">transform_first</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">blockfill_fast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">nlevs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">orca</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">orca_skip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | con is the interface to contouring in cf-plot. The minimum use is con(f)</span>
<span class="sd">     | where f is a 2 dimensional array. If a cf field is passed then an</span>
<span class="sd">     | appropriate plot will be produced i.e. a longitude-latitude or</span>
<span class="sd">     | latitude-height plot for example. If a 2d numeric array is passed then</span>
<span class="sd">     | the optional arrays x and y can be used to describe the x and y data</span>
<span class="sd">     | point locations.</span>
<span class="sd">     |</span>
<span class="sd">     | f - array to contour</span>
<span class="sd">     | x - x locations of data in f (optional)</span>
<span class="sd">     | y - y locations of data in f (optional)</span>
<span class="sd">     | fill=True - colour fill contours</span>
<span class="sd">     | lines=True - draw contour lines and labels</span>
<span class="sd">     | line_labels=True - label contour lines</span>
<span class="sd">     | title=title - title for the plot</span>
<span class="sd">     | ptype=0 - plot type - not needed for cf fields.</span>
<span class="sd">     |                       0 = no specific plot type,</span>
<span class="sd">     |                       1 = longitude-latitude,</span>
<span class="sd">     |                       2 = latitude - height,</span>
<span class="sd">     |                       3 = longitude - height,</span>
<span class="sd">     |                       4 = latitude - time,</span>
<span class="sd">     |                       5 = longitude - time</span>
<span class="sd">     |                       6 = rotated pole</span>
<span class="sd">     | negative_linestyle=&#39;solid&#39; - set to one of &#39;solid&#39;, &#39;dashed&#39;</span>
<span class="sd">     | zero_thick=False - add a thick zero contour line. Set to 3 for example.</span>
<span class="sd">     | blockfill=False - set to True for a blockfill plot</span>
<span class="sd">     | colorbar_title=colbar_title - title for the colour bar</span>
<span class="sd">     | colorbar=True - add a colour bar if a filled contour plot</span>
<span class="sd">     | colorbar_label_skip=None - skip colour bar labels. Set to 2 to skip</span>
<span class="sd">     |                            every other label.</span>
<span class="sd">     | colorbar_orientation=None - options are &#39;horizontal&#39; and &#39;vertical&#39;</span>
<span class="sd">     |                      The default for most plots is horizontal but</span>
<span class="sd">     |                      for polar stereographic plots this is vertical.</span>
<span class="sd">     | colorbar_shrink=None - value to shrink the colorbar by.  If the colorbar</span>
<span class="sd">     |                        exceeds the plot area then values of 1.0, 0.55</span>
<span class="sd">     |                        or 0.5m may help it better fit the plot area.</span>
<span class="sd">     | colorbar_position=None - position of colorbar</span>
<span class="sd">     |                          [xmin, ymin, x_extent,y_extent] in normalised</span>
<span class="sd">     |                          coordinates. Use when a common colorbar</span>
<span class="sd">     |                          is required for a set of plots. A typical set</span>
<span class="sd">     |                          of values would be [0.1, 0.05, 0.8, 0.02]</span>
<span class="sd">     | colorbar_fontsize=None - text size for colorbar labels and title</span>
<span class="sd">     | colorbar_fontweight=None - font weight for colorbar labels and title</span>
<span class="sd">     | colorbar_text_up_down=False - if True horizontal colour bar labels alternate</span>
<span class="sd">     |                             above (start) and below the colour bar</span>
<span class="sd">     | colorbar_text_down_up=False - if True horizontal colour bar labels alternate</span>
<span class="sd">     |                             below (start) and above the colour bar</span>
<span class="sd">     | colorbar_drawedges=True - draw internal divisions in the colorbar</span>
<span class="sd">     | colorbar_fraction=None - space for the colorbar - default = 0.21, in normalised</span>
<span class="sd">     |                       coordinates</span>
<span class="sd">     | colorbar_thick=None - thickness of the colorbar - default = 0.015, in normalised</span>
<span class="sd">     |                       coordinates</span>
<span class="sd">     | colorbar_anchor=None - default=0.5 - anchor point of colorbar within the fraction space.</span>
<span class="sd">     |                        0.0 = close to plot, 1.0 = further away</span>
<span class="sd">     | colorbar_labels=None - labels to use for colorbar.  The default is to use the contour</span>
<span class="sd">     |                        levels as labels</span>
<span class="sd">     | colorbar_text_up_down=False - on a horizontal colorbar alternate the</span>
<span class="sd">     |                               labels top and bottom starting in the up position</span>
<span class="sd">     | colorbar_text_down_up=False - on a horizontal colorbar alternate the</span>
<span class="sd">     |                               labels bottom and top starting in the bottom position</span>
<span class="sd">     | colorbar_drawedges=True - draw internal delimeter lines in the colorbar</span>
<span class="sd">     | colors=&#39;k&#39; - contour line colors - takes one or many values.</span>
<span class="sd">     | xlog=False - logarithmic x axis</span>
<span class="sd">     | ylog=False - logarithmic y axis</span>
<span class="sd">     | axes=True - plot x and y axes</span>
<span class="sd">     | xaxis=True - plot xaxis</span>
<span class="sd">     | yaxis=True - plot y axis</span>
<span class="sd">     | xticks=None - xtick positions</span>
<span class="sd">     | xticklabels=None - xtick labels</span>
<span class="sd">     | yticks=None - y tick positions</span>
<span class="sd">     | yticklabels=None - ytick labels</span>
<span class="sd">     | xlabel=None - label for x axis</span>
<span class="sd">     | ylabel=None - label for y axis</span>
<span class="sd">     | swap_axes=False - swap plotted axes - only valid for X, Y, Z vs T plots</span>
<span class="sd">     | verbose=None - change to 1 to get a verbose listing of what con</span>
<span class="sd">     |                is doing</span>
<span class="sd">     | linewidths=None - contour linewidths.  Either a single number for all</span>
<span class="sd">     |                   lines or array of widths</span>
<span class="sd">     | linestyles=None - takes &#39;solid&#39;, &#39;dashed&#39;, &#39;dashdot&#39; or &#39;dotted&#39;</span>
<span class="sd">     | alpha=1.0 - transparency setting.  The default is no transparency.</span>
<span class="sd">     | zorder=1 - order of drawing</span>
<span class="sd">     | level_spacing=None - Default of &#39;linear&#39; level spacing.  Also takes &#39;log&#39;, &#39;loglike&#39;,</span>
<span class="sd">     |                      &#39;outlier&#39; and &#39;inspect&#39;</span>
<span class="sd">     | irregular=None - flag for contouring irregular data</span>
<span class="sd">     | face_lons=None - longitude points for face vertices</span>
<span class="sd">     | face_lats=None - latitude points for face verticies</span>
<span class="sd">     | face_connectivity=None - connectivity for face verticies</span>
<span class="sd">     | titles=False - set to True to have a dimensions title</span>
<span class="sd">     | transform_first=None - Cartopy should transform the points before calling the contouring algorithm, </span>
<span class="sd">     |                         which can have a significant impact on speed (it is much faster to transform</span>
<span class="sd">     |                         points than it is to transform patches) If this is unset and the number of points</span>
<span class="sd">     |                         in the x direction is &gt; 400 then it is set to True.</span>
<span class="sd">     | blockfill_fast=None - Use pcolormesh blockfill.  This is possibly less reliable that the usual code but is </span>
<span class="sd">     |                       faster for higher resolution datasets</span>
<span class="sd">     | nlevs=False - Let Matplotlib work out the levels for the contour plot</span>
<span class="sd">     | orca=None - User specifies this is an orca tripolar grid.  Internally cf-plot tries to detect this by looking</span>
<span class="sd">     |             for a single discontinuity in the logitude 2D array. If found a fix it make to the longitudes so</span>
<span class="sd">     |             that they are no longer discontinuous.</span>
<span class="sd">     | orca_skip=None - Only plot every nth grid point in the 2D longitude and latitude arrays.  This is useful for when </span>
<span class="sd">     |                  plotting his resolution data over the whole globe which would otherwise be very slow to visualize.</span>
<span class="sd">     | grid=False - Draw a grid on the map using the parameters set by cfp.setvars.  Defaults are grid_x_spacing=60, </span>
<span class="sd">     |              grid_y_spacing=30, grid_colour=&#39;k&#39;, grid_linestyle = &#39;--&#39;, grid_thickness=1.0</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Turn off divide warning in contour routine which is a numpy issue</span>
    <span class="n">old_settings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>

    <span class="c1"># Set potential user axis labels</span>
    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>

    <span class="c1"># Set blockfill to True if blockfill_fast is not None</span>
    <span class="k">if</span> <span class="n">blockfill_fast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">blockfill</span><span class="o">=</span><span class="kc">True</span>

            
    <span class="c1"># Check if the field is a CF ugrid field with cell faces</span>
    <span class="n">blockfill_ugrid</span> <span class="o">=</span> <span class="kc">False</span>    
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">)</span> <span class="ow">and</span> <span class="n">blockfill</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">domain_topologies</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">domain_topology</span><span class="p">(</span><span class="s1">&#39;cell:face&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">face_lons_array</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">aux</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span>
                <span class="n">face_lats_array</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">aux</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span>         
                <span class="n">face_connectivity_array</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">domain_topology</span><span class="p">(</span><span class="s1">&#39;cell:face&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
                <span class="n">blockfill_ugrid</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">irregular</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">Error - field does not contain the UGRID face information to plot a blockfill plot</span><span class="se">\n\n\n</span><span class="s1">&#39;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>


    <span class="c1"># Set blockfill_2d if blockfill and x and y are 2D</span>
    <span class="n">blockfill_2d</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">blockfill</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">blockfill_2d</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Call gpos(1) if not already called</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Extract required data for contouring</span>
    <span class="c1"># If a cf-python field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
    
        <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndims</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.con error need a 1 or 2 dimensional field to contour</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;received &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="c1"># Extract data</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - calling cf_data_assign&#39;</span><span class="p">)</span>
            
        
        <span class="c1"># Subset the data if a user map is set</span>
        <span class="c1"># This is use to speed up the plotting</span>
        <span class="c1"># myfield is used for calculating the contour levels</span>
        <span class="c1"># myfield_extended is used to make the contour plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span><span class="p">:</span>            
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Y</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">))</span>
                
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Y</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">))</span>
                          
               
        
        <span class="c1"># Extract the data</span>
        <span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span> <span class="o">=</span>\
            <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            
        
        <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
        <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.con - cannot contour a field list</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - using user assigned data&#39;</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>  <span class="c1"># field data passed in as f</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">check_data</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>



    <span class="c1"># Assign irregular and orca keywords unless already set</span>
    <span class="k">if</span> <span class="n">irregular</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">irregular</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">irregular</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">orca</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">orca</span> <span class="o">=</span> <span class="n">orca_check</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">orca</span><span class="p">:</span>
                
                    <span class="c1"># Apply orca_skip if set</span>
                    <span class="k">if</span> <span class="n">orca_skip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;applying orca_skip value of &#39;</span><span class="p">,</span> <span class="n">orca_skip</span><span class="p">)</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="n">orca_skip</span><span class="p">,</span> <span class="p">::</span><span class="n">orca_skip</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="n">orca_skip</span><span class="p">,</span> <span class="p">::</span><span class="n">orca_skip</span><span class="p">]</span>
                        <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[::</span><span class="n">orca_skip</span><span class="p">,</span> <span class="p">::</span><span class="n">orca_skip</span><span class="p">]</span>
                
                
                    <span class="c1"># orca grids have a discontinuity in the longitude grid</span>
                    <span class="c1"># use the method at https://gist.github.com/pelson/79cf31ef324774c97ae7</span>
                    <span class="c1"># to remove the discontinuity</span>

                    <span class="n">fixed_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)):</span>
                        <span class="n">fixed_x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">start</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+=</span> <span class="mi">360</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">fixed_x</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">irregular</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Set contour line styles</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;contour.negative_linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">negative_linestyle</span>


    <span class="c1"># Set contour lines off on block plots</span>
    <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
        <span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">field_orig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="n">x_orig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y_orig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># Check number of colours and levels match if user has modified the</span>
        <span class="c1"># number of colours</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
            <span class="n">nintervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
                <span class="n">nintervals</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                <span class="n">nintervals</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
                <span class="n">nintervals</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">ncols</span> <span class="o">!=</span> <span class="n">nintervals</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.con - blockfill error </span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;need to match number of colours and contour intervals</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;Don&#39;t forget to take account of the colorbar &quot;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;extensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Turn off colorbar if fill is turned off</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fill</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span><span class="p">:</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Revert to default colour scale if cscale_flag flag is set</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">cscale1</span>

    <span class="c1"># Set the orientation of the colorbar</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">colorbar_orientation</span> <span class="o">=</span> <span class="s1">&#39;vertical&#39;</span>
    <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_orientation</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span>

    <span class="c1"># Store original map resolution</span>
    <span class="n">resolution_orig</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span>

    <span class="c1"># Set size of color bar if not specified</span>
    <span class="k">if</span> <span class="n">colorbar_shrink</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
            <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">0.8</span>


    <span class="c1"># Set plot type if user specified</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">ptype</span>

    <span class="c1"># Get contour levels if none are defined</span>
    <span class="n">spacing</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">level_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">spacing</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">level_spacing</span>
    <span class="k">if</span> <span class="n">level_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span> 
        <span class="n">spacing</span> <span class="o">=</span> <span class="n">level_spacing</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
            <span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span> <span class="o">=</span>\
                <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">clevs</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">fmult</span> <span class="o">=</span> <span class="n">calculate_levels</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span>
                                              <span class="n">level_spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span>
                                              <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                                              
    <span class="k">else</span><span class="p">:</span>
        <span class="n">clevs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fmult</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Set the colour scale if nothing is defined</span>
    <span class="n">includes_zero</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">col_zero</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">cval</span> <span class="ow">in</span> <span class="n">clevs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">includes_zero</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">col_zero</span> <span class="o">=</span> <span class="n">col_zero</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">cval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">includes_zero</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">includes_zero</span><span class="p">:</span>
            <span class="n">cs_below</span> <span class="o">=</span> <span class="n">col_zero</span>
            <span class="n">cs_above</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">-</span> <span class="n">col_zero</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;neither&#39;</span><span class="p">:</span>
                <span class="n">cs_below</span> <span class="o">=</span> <span class="n">cs_below</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;neither&#39;</span><span class="p">:</span>
                <span class="n">cs_above</span> <span class="o">=</span> <span class="n">cs_above</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">uniform</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_uniform</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">uniform</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;scale1&#39;</span><span class="p">,</span> <span class="n">below</span><span class="o">=</span><span class="n">cs_below</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="n">cs_above</span><span class="p">,</span> <span class="n">uniform</span><span class="o">=</span><span class="n">uniform</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
                <span class="n">ncols</span> <span class="o">=</span> <span class="n">ncols</span><span class="o">-</span><span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;neither&#39;</span><span class="p">:</span>
                <span class="n">ncols</span> <span class="o">=</span> <span class="n">ncols</span><span class="o">-</span><span class="mi">2</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">)</span>

        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># User selected colour map but no mods so fit to levels</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="n">ncols</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;neither&#39;</span><span class="p">:</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="n">ncols</span><span class="o">-</span><span class="mi">2</span>
        <span class="n">cscale</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs_user</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">)</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Set colorbar labels</span>
    <span class="c1"># Set a sensible label spacing if the user hasn&#39;t already done so</span>
    <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="n">nchars</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">lev</span> <span class="ow">in</span> <span class="n">clevs</span><span class="p">:</span>
                <span class="n">nchars</span> <span class="o">=</span> <span class="n">nchars</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lev</span><span class="p">))</span>
            <span class="n">colorbar_label_skip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nchars</span> <span class="o">/</span> <span class="mi">80</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">colorbar_label_skip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nchars</span> <span class="o">*</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colorbar_label_skip</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">includes_zero</span><span class="p">:</span>
            <span class="c1"># include zero in the colorbar labels</span>
            <span class="n">zero_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mylev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="k">if</span> <span class="n">mylev</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">clevs</span><span class="p">[</span><span class="n">zero_pos</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">zero_pos</span> <span class="o">+</span> <span class="n">colorbar_label_skip</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cbar_labels</span><span class="p">,</span> <span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">colorbar_label_skip</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">zero_pos</span> <span class="o">-</span> <span class="n">colorbar_label_skip</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cbar_labels</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">colorbar_label_skip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">clevs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">colorbar_label_skip</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cbar_labels</span><span class="p">,</span> <span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">colorbar_label_skip</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">clevs</span>

    <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_label_skip</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Make a list of strings of the colorbar levels for later labelling</span>
    <span class="n">clabels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cbar_labels</span><span class="p">:</span>
        <span class="n">clabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">skip</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">colorbar_label_skip</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">clabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">colorbar_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">colorbar_labels</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">clabels</span>

    <span class="c1"># Turn off line_labels if the field is all the same</span>
    <span class="c1"># Matplotlib 3.2.2 throws an error if there are no line labels</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
        <span class="n">line_labels</span> <span class="o">=</span> <span class="kc">False</span>

    
    <span class="c1"># Add mult to colorbar_title if used</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">colorbar_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">mult</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">colorbar_title</span> <span class="o">+</span> <span class="s1">&#39; *10$^{&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mult</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;}$&#39;</span>

    <span class="c1"># Catch null title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span>

    <span class="c1"># Set plot variables</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
    <span class="k">if</span> <span class="n">colorbar_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontsize</span>
    <span class="k">if</span> <span class="n">colorbar_fontweight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontweight</span>
    <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
    <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
    <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span>
    <span class="n">land_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">land_color</span>
    <span class="n">ocean_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ocean_color</span>
    <span class="n">lake_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lake_color</span>
    <span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span>
    <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="k">if</span> <span class="n">continent_linestyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="s1">&#39;solid&#39;</span>
    <span class="n">cb_orient</span> <span class="o">=</span> <span class="n">colorbar_orientation</span>

    <span class="c1"># Retrieve any user defined axis labels</span>
    <span class="k">if</span> <span class="n">xlabel</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">xticks</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">yticks</span><span class="p">))</span>

    <span class="c1"># Calculate a set of dimension titles if requested</span>
    <span class="k">if</span> <span class="n">titles</span><span class="p">:</span> 
        <span class="n">plotvars</span><span class="o">.</span><span class="n">titles_con_called</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">title_dims</span> <span class="o">=</span> <span class="n">generate_titles</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">title_dims</span> <span class="o">=</span> <span class="n">colorbar_title</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">title_dims</span>


    <span class="c1"># Check if data is well formed</span>
    <span class="c1"># i.e. dimensions have only recognizable X, Y, Z, T or a subset</span>
    <span class="n">well_formed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">well_formed</span> <span class="o">=</span> <span class="n">check_well_formed</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        
        
    <span class="k">if</span> <span class="n">nlevs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">clevs</span> <span class="o">=</span> <span class="n">nlevs</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">=</span> <span class="s1">&#39;neither&#39;</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;scale1&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">nlevs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">nlevs</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cscale</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs_user</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">nlevs</span><span class="p">)</span>
  

    <span class="c1">##################</span>
    <span class="c1"># Map contour plot</span>
    <span class="c1">##################</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - making a map plot&#39;</span><span class="p">)</span>


        <span class="c1"># Open a new plot if necessary</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Reset the stored mapping</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="mi">180</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>

        <span class="c1"># Set up mapping</span>
        <span class="n">mylonmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">mylonmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">mylatmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">mylatmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">mylonmax</span> <span class="o">-</span> <span class="n">mylonmin</span>
        <span class="n">latrange</span> <span class="o">=</span> <span class="n">mylatmax</span> <span class="o">-</span> <span class="n">mylatmin</span>
        
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mf">360.0</span><span class="p">:</span>
            <span class="n">mylonmax</span> <span class="o">=</span> <span class="n">mylonmin</span> <span class="o">+</span> <span class="mf">360.0</span>
            <span class="n">lonrange</span> <span class="o">=</span> <span class="mf">360.0</span>
        

        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">and</span> <span class="n">latrange</span> <span class="o">&gt;</span> <span class="mi">160</span><span class="p">)</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">set_map</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="n">mylonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="o">=</span><span class="n">mylonmax</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=</span><span class="n">mylatmin</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="n">mylatmax</span><span class="p">,</span>
                   <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">)</span>

            <span class="n">set_map</span><span class="p">()</span>


        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="n">user_mapset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span>

        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        


        <span class="k">if</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_2d</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">irregular</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Add cyclic information if missing.</span>
                    <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
                        <span class="c1"># field, x = cartopy_util.add_cyclic_point(field, x)</span>
                        <span class="c1"># Call add_cyclic_point it spacing is regular</span>
                        <span class="n">x_regular</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">xspacing</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">!=</span> <span class="n">xspacing</span><span class="p">:</span>
                                <span class="n">x_regular</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="n">x_regular</span><span class="p">:</span>
                            <span class="n">field</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
                            
                        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

                        <span class="c1"># cartopy line drawing fix</span>
                        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">360.0</span><span class="p">:</span>
                            <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.001</span>

                    <span class="c1"># Shift grid if needed</span>
                    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                        <span class="c1"># Cartopy feature at version 0.20.0 </span>
                        <span class="c1"># -360 to 0 creates strange contours</span>
                        <span class="n">vers</span> <span class="o">=</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span><span class="n">vers</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">360</span>
                    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">360</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">orca</span><span class="p">:</span>
                <span class="c1"># Get the irregular data within the map coordinates</span>
                <span class="c1"># Matplotlib tricontour cannot plot missing data so we need to split </span>
                <span class="c1"># the missing data into a separate field to deal with this</span>

                <span class="n">field_modified</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="n">pts_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">field_modified</span><span class="p">))</span>
                <span class="n">field_modified</span><span class="p">[</span><span class="n">pts_nan</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e30</span>

                <span class="n">field_irregular</span><span class="p">,</span> <span class="n">lons_irregular</span><span class="p">,</span> <span class="n">lats_irregular</span> <span class="o">=</span> <span class="n">irregular_window</span><span class="p">(</span><span class="n">field_modified</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="c1">#pts_real  = np.where(np.isfinite(field_irregular))</span>
                <span class="n">pts_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field_irregular</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1e29</span><span class="p">)</span>
                <span class="n">pts_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field_irregular</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1e29</span><span class="p">)</span>


                <span class="n">field_irregular_nan</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">lons_irregular_nan</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">lats_irregular_nan</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts_nan</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">field_irregular_nan</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field_irregular</span><span class="p">)</span>
                    <span class="n">lons_irregular_nan</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lons_irregular</span><span class="p">)</span>
                    <span class="n">lats_irregular_nan</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lats_irregular</span><span class="p">)</span>
                    <span class="n">field_irregular_nan</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">field_irregular_nan</span><span class="p">[</span><span class="n">pts_nan</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>


                <span class="n">field_irregular_real</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field_irregular</span><span class="p">[</span><span class="n">pts_real</span><span class="p">])</span>
                <span class="n">lons_irregular_real</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lons_irregular</span><span class="p">[</span><span class="n">pts_real</span><span class="p">])</span>
                <span class="n">lats_irregular_real</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lats_irregular</span><span class="p">[</span><span class="n">pts_real</span><span class="p">])</span>


        <span class="k">if</span> <span class="ow">not</span> <span class="n">irregular</span><span class="p">:</span>
            <span class="c1"># Flip latitudes and field if latitudes are in descending order</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

        <span class="c1"># Plotting a sub-area of the grid produces stray contour labels</span>
        <span class="c1"># in polar plots. Subsample the latitudes to remove this problem</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_2d</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">irregular</span><span class="p">:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats_irregular</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                    <span class="n">lons_irregular_real</span> <span class="o">=</span> <span class="n">lons_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                    <span class="n">lats_irregular_real</span> <span class="o">=</span> <span class="n">lats_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                    <span class="n">field_irregular_real</span> <span class="o">=</span> <span class="n">field_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">myypos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">myypos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">myypos</span><span class="p">:]</span>
                        <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">myypos</span><span class="p">:,</span> <span class="p">:]</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_2d</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">irregular</span><span class="p">:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats_irregular_real</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>
                    <span class="n">lons_irregular_real</span> <span class="o">=</span> <span class="n">lons_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                    <span class="n">lats_irregular_real</span> <span class="o">=</span> <span class="n">lats_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                    <span class="n">field_irregular_real</span> <span class="o">=</span> <span class="n">field_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">myypos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">myypos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">myypos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">myypos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>


        <span class="c1"># Set the longitudes and latitudes</span>
        <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

        <span class="c1"># Set the plot limits</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span>
                <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span>
                <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span>
                <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span>
                <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span>
                     <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span>
                     <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span>
                     <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span>
                     <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span>
                     <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span>
                     <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span>
                     <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span>
                     <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>




        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - adding filled contours&#39;</span><span class="p">)</span>
            <span class="c1"># Get colour scale for use in contouring</span>
            <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
            <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions</span>
            <span class="c1"># are then changed on the colorbar and plot after the plot is made</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>

            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># For fast map contours add transform_first=True to contourf command</span>
            <span class="c1"># and make lons and lats 2D</span>
            <span class="k">if</span> <span class="n">transform_first</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                    <span class="n">transform_first</span> <span class="o">=</span> <span class="kc">True</span>
                    
            <span class="c1"># Fast map contours are also needed when clevs is a integer</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
                <span class="n">transform_first</span><span class="o">=</span><span class="kc">True</span>
            
            
            
            <span class="k">if</span> <span class="n">transform_first</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                    
            
            <span class="c1"># Filled colour contours</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">irregular</span> <span class="ow">or</span> <span class="n">orca</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>               
                <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span>
                               <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                               <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                               <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                               <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="n">transform_first</span><span class="o">=</span><span class="n">transform_first</span><span class="p">)</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field_irregular_real</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> 
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">lons_irregular_real</span><span class="p">,</span> <span class="n">lats_irregular_real</span><span class="p">,</span> <span class="n">field_irregular_real</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                                      <span class="n">clevs</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                                      <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                                      <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                      <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - adding blockfill&#39;</span><span class="p">)</span>
                
            <span class="n">two_d</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>    
                <span class="n">two_d</span> <span class="o">=</span> <span class="kc">True</span>
                
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:transverse_mercator&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
                    <span class="c1"># Special case for transverse mercator</span>
                    <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
                    
                <span class="c1">#elif orca:</span>
                <span class="k">elif</span> <span class="n">two_d</span><span class="p">:</span>
                    <span class="c1">#bfill(f=f, clevs=clevs, lonlat=False, alpha=alpha, fast=blockfill_fast,zorder=zorder)</span>
                    <span class="c1">#bfill(x=x, y=y, f=field * fmult, clevs=clevs, lonlat=False, alpha=alpha,\</span>
                    <span class="c1">#      fast=blockfill_fast, zorder=zorder, orca=True)                </span>
                    <span class="n">bfill</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>\
                          <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>                 
                
                <span class="k">else</span><span class="p">:</span>



                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">()</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">():</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
                        <span class="c1"># Add last longitude point</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="c1"># Add last latitude point</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

                        <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                              <span class="n">lonlat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                              <span class="n">lonlat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                      <span class="n">lonlat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Block fill for irregular</span>
        <span class="k">if</span> <span class="n">blockfill_ugrid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_2d</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - adding blockfill for irregular&#39;</span><span class="p">)</span>
            <span class="n">bfill_ugrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">face_lons</span><span class="o">=</span><span class="n">face_lons_array</span><span class="p">,</span> 
                       <span class="n">face_lats</span><span class="o">=</span><span class="n">face_lats_array</span><span class="p">,</span> 
                       <span class="n">face_connectivity</span><span class="o">=</span><span class="n">face_connectivity_array</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                       <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - adding contour lines and labels&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">irregular</span> <span class="ow">or</span> <span class="n">blockfill_2d</span> <span class="ow">or</span> <span class="n">orca</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                   <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                   <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span><span class="n">lons_irregular_real</span><span class="p">,</span> <span class="n">lats_irregular_real</span><span class="p">,</span> <span class="n">field_irregular_real</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                                      <span class="n">clevs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                      <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                      <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>



            <span class="k">if</span> <span class="n">line_labels</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%1.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                     <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>


            <span class="c1"># Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                   <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span>
                                   <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                   <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>



        <span class="c1"># Add a irregular mask if there is one</span>
        <span class="k">if</span> <span class="n">irregular</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">orca</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_2d</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field_irregular_nan</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cmap_white</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
                <span class="n">mymap</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span><span class="n">lons_irregular_nan</span><span class="p">,</span> <span class="n">lats_irregular_nan</span><span class="p">,</span> <span class="n">field_irregular_nan</span> <span class="p">,</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span>
                                  <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;neither&#39;</span><span class="p">,</span>
                                  <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_white</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                                  <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                  <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Axes</span>
        <span class="n">plot_map_axes</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                      <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                      <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                      <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span> <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
                      <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Coastlines and features</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;land&#39;</span><span class="p">,</span>
                                               <span class="n">category</span><span class="o">=</span><span class="s1">&#39;physical&#39;</span><span class="p">,</span>
                                               <span class="n">scale</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                                               <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span>
                          <span class="n">edgecolor</span><span class="o">=</span><span class="n">continent_color</span><span class="p">,</span>
                          <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
                          <span class="n">linestyle</span><span class="o">=</span><span class="n">continent_linestyle</span><span class="p">,</span>
                          <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ocean_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;face&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">ocean_color</span><span class="p">,</span>
                              <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">land_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;face&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">land_color</span><span class="p">,</span>
                              <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lake_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAKES</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;face&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">lake_color</span><span class="p">,</span>
                              <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
            <span class="n">map_grid</span><span class="p">()</span>

        <span class="c1"># Title</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="n">dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>

        <span class="c1"># Color bar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">cbar</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">cbar_labels</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
                 <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">colorbar_fontsize</span><span class="p">,</span>
                 <span class="n">fontweight</span><span class="o">=</span><span class="n">colorbar_fontweight</span><span class="p">,</span> <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
                 <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span> <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
                 <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span> <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
                 <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span> <span class="n">levs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>


        <span class="c1"># Reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">################################################</span>
    <span class="c1"># Latitude, longitude or time vs Z contour plots</span>
    <span class="c1">################################################</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - making a latitude-pressure plot&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - making a longitude-pressure plot&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - making a time-pressure plot&#39;</span><span class="p">)</span>

        <span class="c1"># Work out which way is up</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">myz</span> <span class="o">=</span> <span class="n">find_z</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        
        
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">)</span> <span class="ow">and</span> <span class="n">well_formed</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">myz</span><span class="p">),</span> <span class="s1">&#39;positive&#39;</span><span class="p">):</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">myz</span><span class="p">)</span><span class="o">.</span><span class="n">positive</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">cf-plot - data error </span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;data needs a vertical coordinate direction&quot;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; as required in CF data conventions&quot;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Making a contour plot assuming positive is down</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;If this is incorrect the data needs to be modified to </span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;include a correct value for the direction attribute</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;such as in f.coord(</span><span class="se">\&#39;</span><span class="s2">Z</span><span class="se">\&#39;</span><span class="s2">).positive=</span><span class="se">\&#39;</span><span class="s2">down</span><span class="se">\&#39;</span><span class="s2">&quot;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="s1">&#39;down&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">positive</span> <span class="o">=</span> <span class="s1">&#39;down&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;theta&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>
            <span class="k">if</span> <span class="s1">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="s1">&#39;up&#39;</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Use gset parameter of ylog if user has set this</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ylog</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Set plot limits</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Program selected data plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">80</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
                <span class="n">xmax</span> <span class="o">=</span> <span class="mi">90</span>

            <span class="k">if</span> <span class="n">positive</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ymax</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">ymax</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use user specified plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

        <span class="n">ystep</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">myrange</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">myrange</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="mf">10.</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">15000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">5000</span>

        <span class="c1"># Work out ticks and tick labels</span>
        <span class="k">if</span> <span class="n">ylog</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">ylog</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">heightticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span>
                                <span class="n">dmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span>
                                <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">myrange</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">myrange</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
                <span class="n">heightticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tick</span> <span class="o">&gt;=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tick</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">):</span>
                    <span class="n">heightticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span>
        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">heightticks</span>

        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">heightticks</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
            <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">heightticks</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yticks</span> <span class="o">=</span> <span class="n">heightticks</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">heightlabels</span>

        <span class="c1"># Time - height contour plot</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmin</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtarray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">tmax</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dtarray</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Use user set values if present</span>
                    <span class="n">tmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
                    <span class="n">tmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>

                    <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
                    <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
                    <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">xmin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">xmax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>

        <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xaxis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># lat-pressure</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># lon-pressure</span>

            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="c1"># time-pressure</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

                    <span class="c1"># Change plotvars.xmin and plotvars.xmax from a date string</span>
                    <span class="c1"># to a number</span>
                    <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
                    <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
                    <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>

                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">xmin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">xmax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>

                    <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmin</span><span class="p">),</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmax</span><span class="p">)],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">time_ticks</span><span class="p">,</span> <span class="n">time_labels</span><span class="p">,</span> <span class="n">tlabel</span> <span class="o">=</span> <span class="n">timeaxis</span><span class="p">(</span><span class="n">taxis</span><span class="p">)</span>

                    <span class="c1"># Use user supplied labels if present</span>
                    <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">tlabel</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xticks</span> <span class="o">=</span> <span class="n">time_ticks</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">time_labels</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Not a CF field</span><span class="se">\n</span><span class="s1">Please use ptype=0 and &#39;</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;specify axis labels manually</span><span class="se">\n</span><span class="s1">&#39;</span>
                    <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="n">ylog</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">ylog</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                 <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ymax</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Avoid zero in a log plot</span>
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                 <span class="n">ylog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

        <span class="c1"># Label axes</span>
        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="n">heightticks</span><span class="p">,</span>
                  <span class="n">yticklabels</span><span class="o">=</span><span class="n">heightlabels</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions are</span>
        <span class="c1"># then changed on the colorbar and plot after the plot is made</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span>
                                   <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                                   <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                                   <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                   <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

                <span class="n">hasbounds</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">()</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">():</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hasbounds</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">()</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">():</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeAllTrop_UpStrat_Eq_Total_AllWN_Timeseries_2ze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hasbounds</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">()</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">():</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hasbounds</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">hasbounds</span><span class="p">:</span>
                    <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                          <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                          <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                      <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%1.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span><span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                                     <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>

                <span class="c1"># Thick zero contour line</span>
                <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                    <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                                               <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                               <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span>
                                               <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                               <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="n">dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>
        
        <span class="c1"># Color bar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">cbar</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">cbar_labels</span><span class="p">,</span>
                 <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                 <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
                 <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span>
                 <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
                 <span class="n">fontsize</span><span class="o">=</span><span class="n">colorbar_fontsize</span><span class="p">,</span>
                 <span class="n">fontweight</span><span class="o">=</span><span class="n">colorbar_fontweight</span><span class="p">,</span>
                 <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
                 <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span>
                 <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
                 <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span>
                 <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
                 <span class="n">levs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                 <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
                                <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

        <span class="c1"># Reset plot limits to those supplied by the user</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                 <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">########################</span>
    <span class="c1"># Hovmuller contour plot</span>
    <span class="c1">########################</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - making a Hovmuller plot&#39;</span><span class="p">)</span>
        <span class="n">yplotlabel</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="s1">&#39;Longitude&#39;</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="s1">&#39;Latitude&#39;</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>

        <span class="c1"># Time strings set to None initially</span>
        <span class="n">tmin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmax</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
               <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">]):</span>
            <span class="c1"># Store time strings for later use</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

            <span class="c1"># Check data has CF attributes needed</span>
            <span class="n">check_units</span> <span class="o">=</span> <span class="n">check_units</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">check_calendar</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">check_Units_reftime</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">),</span> <span class="s1">&#39;units&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">check_units</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">),</span> <span class="s1">&#39;calendar&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">check_calendar</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Units</span><span class="p">,</span> <span class="s1">&#39;reftime&#39;</span><span class="p">):</span>
                    <span class="n">check_Units_reftime</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">check_Units_reftime</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="p">[</span><span class="n">check_units</span><span class="p">,</span> <span class="n">check_calendar</span><span class="p">,</span> <span class="n">check_Units_reftime</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">The required CF time information to make the plot&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;is not available please fix the following before&#39;</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;trying to plot again&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">check_units</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time axis missing: units&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">check_calendar</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time axis missing: calendar&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">check_Units_reftime</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Time axis missing: Units.reftime&#39;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Change from date string in ymin and ymax to date as a float</span>

            <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
            <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>

            <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># Extract axis labels</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">constructs</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Time axis error - only one time axis allowed</span><span class="se">\n</span><span class="s2"> &quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;Please list time axes with print(f.constructs())</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;and remove the ones not needed for a hovmuller plot </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;with f.del_construct(&#39;unwanted_time_axis&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;before trying to plot again</span><span class="se">\n\n\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="n">time_ticks</span><span class="p">,</span> <span class="n">time_labels</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">timeaxis</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">lonlatticks</span><span class="p">,</span> <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">lonlatticks</span><span class="p">,</span> <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">lonlatticks</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lonlatticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">timeticks</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="n">timelabels</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">timelabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timeticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">timeticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
        <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>

        <span class="c1"># Use the automatically generated labels if none are supplied</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="s1">&#39;time&#39;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time_ticks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">timeticks</span> <span class="o">=</span> <span class="n">time_ticks</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time_labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">timelabels</span> <span class="o">=</span> <span class="n">time_labels</span>

        <span class="c1"># Swap axes if requested</span>
        <span class="k">if</span> <span class="n">swap_axes</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmin</span>
            <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">xmax</span>
            <span class="n">xplotlabel</span><span class="p">,</span> <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">yplotlabel</span><span class="p">,</span> <span class="n">xplotlabel</span>
            <span class="n">lonlatticks</span><span class="p">,</span> <span class="n">timeticks</span> <span class="o">=</span> <span class="n">timeticks</span><span class="p">,</span> <span class="n">lonlatticks</span>
            <span class="n">lonlatlabels</span><span class="p">,</span> <span class="n">timelabels</span> <span class="o">=</span> <span class="n">timelabels</span><span class="p">,</span> <span class="n">lonlatlabels</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

        <span class="c1"># Revert to time strings if set</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">]):</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">tmin</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">tmax</span>

        <span class="c1"># Set and label axes</span>
        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">lonlatticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlatlabels</span><span class="p">,</span>
                  <span class="n">yticks</span><span class="o">=</span><span class="n">timeticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">timelabels</span><span class="p">,</span>
                  <span class="n">xlabel</span><span class="o">=</span><span class="n">xplotlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">yplotlabel</span><span class="p">)</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions are</span>
        <span class="c1"># then changed on the colorbar and plot after the plot is made</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span>
                                   <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                                   <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                                   <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                   <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">swap_axes</span><span class="p">:</span>
                        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">xpts</span>
                        <span class="n">field_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field_orig</span><span class="p">))</span>

                    <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                          <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">swap_axes</span><span class="p">:</span>
                        <span class="n">x_orig</span><span class="p">,</span> <span class="n">y_orig</span> <span class="o">=</span> <span class="n">y_orig</span><span class="p">,</span> <span class="n">x_orig</span>
                        <span class="n">field_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field_orig</span><span class="p">))</span>
                    <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                          <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">swap_axes</span><span class="p">:</span>
                    <span class="n">x_orig</span><span class="p">,</span> <span class="n">y_orig</span> <span class="o">=</span> <span class="n">y_orig</span><span class="p">,</span> <span class="n">x_orig</span>
                    <span class="n">field_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field_orig</span><span class="p">))</span>
                <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                      <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                       <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%1.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                                     <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>

                <span class="c1"># Thick zero contour line</span>
                <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                    <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                                               <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                               <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span>
                                               <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                               <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="n">dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>

        <span class="c1"># Color bar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">cbar</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">cbar_labels</span><span class="p">,</span>
                 <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                 <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
                 <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span>
                 <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
                 <span class="n">fontsize</span><span class="o">=</span><span class="n">colorbar_fontsize</span><span class="p">,</span>
                 <span class="n">fontweight</span><span class="o">=</span><span class="n">colorbar_fontweight</span><span class="p">,</span>
                 <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
                 <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span>
                 <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
                 <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span>
                 <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
                 <span class="n">levs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                 <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">###########################</span>
    <span class="c1"># Rotated pole contour plot</span>
    <span class="c1">###########################</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>

        <span class="c1"># Extract x and y grid points</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - making a rotated pole plot&#39;</span><span class="p">)</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;rotated&#39;</span><span class="p">:</span>
            <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                 <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;UKCP&#39;</span><span class="p">:</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>
            <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
            <span class="n">rotated_pole</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:rotated_latitude_longitude&#39;</span><span class="p">)</span>
            <span class="n">xpole</span> <span class="o">=</span> <span class="n">rotated_pole</span><span class="p">[</span><span class="s1">&#39;grid_north_pole_longitude&#39;</span><span class="p">]</span>
            <span class="n">ypole</span> <span class="o">=</span> <span class="n">rotated_pole</span><span class="p">[</span><span class="s1">&#39;grid_north_pole_latitude&#39;</span><span class="p">]</span>

            <span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">RotatedPole</span><span class="p">(</span><span class="n">pole_latitude</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span>
                                         <span class="n">pole_longitude</span><span class="o">=</span><span class="n">xpole</span><span class="p">)</span>
            <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">transform</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">set_map</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">lonpts</span><span class="p">,</span> <span class="n">latpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lonpts</span> <span class="o">=</span> <span class="n">xpts</span>
                    <span class="n">latpts</span> <span class="o">=</span> <span class="n">ypts</span>

                <span class="n">points</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">lonpts</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
                                                             <span class="n">latpts</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

                <span class="n">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span>
                       <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span>
                       <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">)</span>
                <span class="n">set_map</span><span class="p">()</span>

            <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">transform</span><span class="p">}</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions are</span>
        <span class="c1"># then changed on the colorbar and plot after the plot is made</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span>
                          <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                          <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                          <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                          <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                  <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span>
                  <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span>
                  <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                  <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                  <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                  <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                  <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                              <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                              <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%1.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
                <span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>

            <span class="c1"># Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                                  <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                  <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span>
                                  <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                  <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>

        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="n">dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>

        <span class="c1"># Color bar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">cbar</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">cbar_labels</span><span class="p">,</span>
                 <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                 <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
                 <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span>
                 <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
                 <span class="n">fontsize</span><span class="o">=</span><span class="n">colorbar_fontsize</span><span class="p">,</span>
                 <span class="n">fontweight</span><span class="o">=</span><span class="n">colorbar_fontweight</span><span class="p">,</span>
                 <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
                 <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span>
                 <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
                 <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span>
                 <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
                 <span class="n">levs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                 <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Rotated grid axes</span>
        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
                <span class="n">plot_map_axes</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                              <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                              <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                              <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span> <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
                              <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rgaxes</span><span class="p">(</span><span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                       <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                       <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                       <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                       <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
                

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;rotated&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;UKCP&#39;</span><span class="p">:</span>
            <span class="c1"># Remove Matplotlib default axis labels</span>
            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="mi">100000000</span><span class="p">],</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
                      <span class="n">yticks</span><span class="o">=</span><span class="p">[</span><span class="mi">100000000</span><span class="p">],</span> <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">],</span>
                      <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

        <span class="c1"># Add title and coastlines for cylindrical projection</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
            <span class="c1"># Coastlines</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
                          <span class="n">name</span><span class="o">=</span><span class="s1">&#39;land&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;physical&#39;</span><span class="p">,</span>
                          <span class="n">scale</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                          <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">continent_color</span><span class="p">,</span>
                                       <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
                                       <span class="n">linestyle</span><span class="o">=</span><span class="n">continent_linestyle</span><span class="p">,</span>
                                       <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

            <span class="c1"># Title</span>
            <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># Add title for native grid</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;rotated&#39;</span><span class="p">:</span>
            <span class="c1"># Title</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
                                    <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
                                    <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">#############</span>
    <span class="c1"># Other plots</span>
    <span class="c1">#############</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - making an other plot&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>

        <span class="c1"># Set axis labels to None</span>
        <span class="n">xplotlabel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">yplotlabel</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">cf_field</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="n">cf_field</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

        <span class="c1"># Work out axes if none are supplied</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
               <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">]):</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
            
            
        <span class="c1"># Change from date string to a number if strings are passed</span>
        <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">ymin</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">xaxisticks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">yaxisticks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">xtimeaxis</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ytimeaxis</span> <span class="o">=</span> <span class="kc">False</span>


        <span class="k">if</span> <span class="n">cf_field</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                <span class="n">taxis</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

                <span class="n">data_axes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_data_axes</span><span class="p">()</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_axes</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">constructs</span><span class="o">.</span><span class="n">domain_axis_identity</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">coordinate</span><span class="p">([</span><span class="n">i</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">test_for_time_axis</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">sn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">,</span> <span class="s1">&#39;NoName&#39;</span><span class="p">)</span>
                            <span class="n">an</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">,</span> <span class="s1">&#39;NoName&#39;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">sn</span> <span class="o">==</span> <span class="s1">&#39;time&#39;</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">==</span> <span class="s1">&#39;T&#39;</span><span class="p">):</span>
                                <span class="n">test_for_time_axis</span> <span class="o">=</span> <span class="kc">True</span>

                            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">test_for_time_axis</span><span class="p">:</span>
                                    <span class="n">ytimeaxis</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">elif</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">test_for_time_axis</span><span class="p">:</span>
                                    <span class="n">xtimeaxis</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no sensible coordinates for this axis&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">time_xstr</span> <span class="ow">or</span> <span class="n">time_ystr</span><span class="p">:</span>
                    <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
                    <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
                    <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">time_xstr</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">xmin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">xmax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">xmax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                        <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">taxis</span><span class="o">.</span><span class="n">calendar</span> <span class="o">=</span> <span class="n">ref_calendar</span>

                    <span class="k">if</span> <span class="n">time_ystr</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">ymin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">ymin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">ymax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">ymax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                        <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">taxis</span><span class="o">.</span><span class="n">calendar</span> <span class="o">=</span> <span class="n">ref_calendar</span>

                <span class="k">if</span> <span class="n">xtimeaxis</span><span class="p">:</span>
                    <span class="n">xaxisticks</span><span class="p">,</span> <span class="n">xaxislabels</span><span class="p">,</span> <span class="n">xplotlabel</span> <span class="o">=</span> <span class="n">timeaxis</span><span class="p">(</span><span class="n">taxis</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ytimeaxis</span><span class="p">:</span>
                    <span class="n">yaxisticks</span><span class="p">,</span> <span class="n">yaxislabels</span><span class="p">,</span> <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">timeaxis</span><span class="p">(</span><span class="n">taxis</span><span class="p">)</span>
                
        
        <span class="k">if</span> <span class="n">cf_field</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coords</span><span class="p">())</span>
            <span class="n">mycoords</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">mycoords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
            <span class="n">mycoords</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
            
            <span class="k">for</span> <span class="n">icoord</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mycoords</span><span class="p">)):</span>
            
                <span class="n">myaxisticks</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">myaxislabels</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">mylabel</span> <span class="o">=</span> <span class="kc">None</span>
               
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoords</span><span class="p">[</span><span class="n">icoord</span><span class="p">])</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                    <span class="n">myaxisticks</span><span class="p">,</span> <span class="n">myaxislabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="n">mylabel</span> <span class="o">=</span> <span class="s1">&#39;longitude&#39;</span>
                
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoords</span><span class="p">[</span><span class="n">icoord</span><span class="p">])</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                    <span class="n">myaxisticks</span><span class="p">,</span> <span class="n">myaxislabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">),</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
                    <span class="n">mylabel</span> <span class="o">=</span> <span class="s1">&#39;latitude&#39;</span>
                    
                <span class="k">if</span> <span class="n">myaxisticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">icoord</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">xaxisticks</span><span class="p">,</span> <span class="n">xaxislabels</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="n">myaxisticks</span><span class="p">,</span> <span class="n">myaxislabels</span><span class="p">,</span> <span class="n">mylabel</span>
                    <span class="k">if</span> <span class="n">icoord</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">yaxisticks</span><span class="p">,</span> <span class="n">yaxislabels</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">myaxisticks</span><span class="p">,</span> <span class="n">myaxislabels</span><span class="p">,</span> <span class="n">mylabel</span>                   
                    
                    

                
                
                
        <span class="k">if</span> <span class="n">xaxisticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xaxisticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">xaxislabels</span> <span class="o">=</span> <span class="n">xaxisticks</span>

        <span class="k">if</span> <span class="n">yaxisticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yaxisticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">yaxislabels</span> <span class="o">=</span> <span class="n">yaxisticks</span>

        <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xplotlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xplotlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
        <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">yplotlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">ylabel</span>

        <span class="c1"># Draw axes</span>
        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">xaxisticks</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="n">xaxislabels</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xaxislabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xaxisticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">yaxisticks</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="n">yaxislabels</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">yaxislabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yaxisticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">xaxisticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">yaxisticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="c1"># Swap axes if requested</span>
        <span class="k">if</span> <span class="n">swap_axes</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmin</span>
            <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">xmax</span>
            <span class="n">xplotlabel</span><span class="p">,</span> <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">yplotlabel</span><span class="p">,</span> <span class="n">xplotlabel</span>
            <span class="n">xaxisticks</span><span class="p">,</span> <span class="n">yaxisticks</span> <span class="o">=</span> <span class="n">yaxisticks</span><span class="p">,</span> <span class="n">xaxisticks</span>
            <span class="n">xaxislabels</span><span class="p">,</span> <span class="n">yaxislabels</span> <span class="o">=</span> <span class="n">yaxislabels</span><span class="p">,</span> <span class="n">xaxislabels</span>

        <span class="c1"># Set plot limits and set default plot labels</span>
        <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

        <span class="c1"># Draw axes</span>
        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xaxisticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xaxislabels</span><span class="p">,</span>
                  <span class="n">yticks</span><span class="o">=</span><span class="n">yaxisticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yaxislabels</span><span class="p">,</span>
                  <span class="n">xlabel</span><span class="o">=</span><span class="n">xplotlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">yplotlabel</span><span class="p">)</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># then from 1 to ncols-2.  The colours for the colour bar extensions</span>
        <span class="c1"># are changed on the colorbar and plot after the plot is made</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span>
                    <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span>
                                   <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                                   <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                                   <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                   <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                  <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="n">clevs</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                       <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span> <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                                       <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">%d</span><span class="s1">&#39;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s1">&#39;%1.&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;f&#39;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                                     <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">)</span>

            <span class="c1"># Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                                           <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                                           <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span>
                                           <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                           <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="n">dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>

        <span class="c1"># Color bar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">cbar</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="n">cbar_labels</span><span class="p">,</span>
                 <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                 <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
                 <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span>
                 <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
                 <span class="n">fontsize</span><span class="o">=</span><span class="n">colorbar_fontsize</span><span class="p">,</span>
                 <span class="n">fontweight</span><span class="o">=</span><span class="n">colorbar_fontweight</span><span class="p">,</span>
                 <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
                 <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span>
                 <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
                 <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span>
                 <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
                 <span class="n">levs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                 <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">############################</span>
    <span class="c1"># Set axis width if required</span>
    <span class="c1">############################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span><span class="p">)</span>

    <span class="c1">################################</span>
    <span class="c1"># Add a master title if reqested</span>
    <span class="c1">################################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_location</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                  <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title</span><span class="p">,</span>
                                  <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                  <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontweight</span><span class="p">,</span>
                                  <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontsize</span><span class="p">)</span>

    <span class="c1"># Reset map resolution</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mapset</span><span class="p">()</span>
        <span class="n">mapset</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">)</span>

    <span class="c1">##################</span>
    <span class="c1"># Save or view plot</span>
    <span class="c1">##################</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - saving or viewing plot&#39;</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="o">**</span><span class="n">old_settings</span><span class="p">)</span>  <span class="c1"># reset to default numpy error settings</span>

        <span class="n">gclose</span><span class="p">()</span></div>



<div class="viewcode-block" id="mapset">
<a class="viewcode-back" href="../mapset.html#cfplot.mapset">[docs]</a>
<span class="k">def</span> <span class="nf">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lonmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span>
           <span class="n">boundinglat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s1">&#39;110m&#39;</span><span class="p">,</span> <span class="n">user_mapset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
           <span class="n">aspect</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | mapset sets the mapping parameters.</span>
<span class="sd">     |</span>
<span class="sd">     | lonmin=lonmin - minimum longitude</span>
<span class="sd">     | lonmax=lonmax - maximum longitude</span>
<span class="sd">     | latmin=latmin - minimum latitude</span>
<span class="sd">     | latmax=latmax - maximum latitude</span>
<span class="sd">     | proj=proj - &#39;cyl&#39; for cylindrical projection. &#39;npstere&#39; or &#39;spstere&#39;</span>
<span class="sd">     |      for northern hemisphere or southern hemisphere polar stereographic.</span>
<span class="sd">     |      ortho, merc, moll, robin and lcc are abreviations for orthographic,</span>
<span class="sd">     |      mercator, mollweide, robinson and lambert conformal projections</span>
<span class="sd">     |      &#39;rotated&#39; for contour plots on the native rotated grid.</span>
<span class="sd">     |</span>
<span class="sd">     | boundinglat=boundinglat - edge of the viewable latitudes in a</span>
<span class="sd">     |      stereographic plot</span>
<span class="sd">     | lon_0=0 - longitude centre of desired map domain in polar</span>
<span class="sd">     |           stereographic and orthogrphic plots</span>
<span class="sd">     | lat_0=40 - latitude centre of desired map domain in orthogrphic plots</span>
<span class="sd">     | resolution=&#39;110m&#39; - the map resolution - can be one of &#39;110m&#39;,</span>
<span class="sd">     | &#39;50m&#39; or &#39;10m&#39;.  &#39;50m&#39; means 1:50,000,000 and not 50 metre.</span>
<span class="sd">     | user_mapset=user_mapset - variable to indicate whether a user call</span>
<span class="sd">     |      to mapset has been made.</span>
<span class="sd">     |</span>
<span class="sd">     | The default map plotting projection is the cyclindrical equidistant</span>
<span class="sd">     | projection from -180 to 180 in longitude and -90 to 90 in latitude.</span>
<span class="sd">     | To change the map view in this projection to over the United Kingdom,</span>
<span class="sd">     | for example, you would use</span>
<span class="sd">     | mapset(lonmin=-6, lonmax=3, latmin=50, latmax=60)</span>
<span class="sd">     | or</span>
<span class="sd">     | mapset(-6, 3, 50, 60)</span>
<span class="sd">     |</span>
<span class="sd">     | The limits are -360 to 720 in longitude so to look at the equatorial</span>
<span class="sd">     | Pacific you could use</span>
<span class="sd">     | mapset(lonmin=90, lonmax=300, latmin=-30, latmax=30)</span>
<span class="sd">     | or</span>
<span class="sd">     | mapset(lonmin=-270, lonmax=-60, latmin=-30, latmax=30)</span>
<span class="sd">     |</span>
<span class="sd">     | The default setting for the cylindrical projection is for 1 degree of</span>
<span class="sd">     | longitude to have the same size as one degree of latitude.  When plotting</span>
<span class="sd">     | a smaller map setting aspect=&#39;auto&#39; turns this off and the map fills the</span>
<span class="sd">     | plot area. Setting aspect to a number a circle will be stretched such that</span>
<span class="sd">     | the height is num times the width. aspect=1 is the same as aspect=&#39;equal&#39;.</span>
<span class="sd">     |</span>
<span class="sd">     | The proj parameter accepts &#39;npstere&#39; and &#39;spstere&#39; for northern</span>
<span class="sd">     | hemisphere or southern hemisphere polar stereographic projections.</span>
<span class="sd">     | In addition to these the boundinglat parameter sets the edge of the</span>
<span class="sd">     | viewable latitudes and lon_0 sets the centre of desired map domain.</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     | Map settings are persistent until a new call to mapset is made. To</span>
<span class="sd">     | reset to the default map settings use mapset().</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set the continent resolution</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
           <span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">latmin</span><span class="p">,</span> <span class="n">latmax</span><span class="p">,</span> <span class="n">aspect</span><span class="p">])</span> <span class="ow">and</span> <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="mi">180</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="s1">&#39;cyl&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="s1">&#39;equal&#39;</span>

        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span>

    <span class="c1"># Set the aspect ratio</span>
    <span class="k">if</span> <span class="n">aspect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">aspect</span> <span class="o">=</span> <span class="s1">&#39;equal&#39;</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="n">aspect</span>

    <span class="k">if</span> <span class="n">lonmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
    <span class="k">if</span> <span class="n">lonmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="mi">180</span>
    <span class="k">if</span> <span class="n">latmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;merc&#39;</span><span class="p">:</span>
            <span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">80</span>
    <span class="k">if</span> <span class="n">latmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;merc&#39;</span><span class="p">:</span>
            <span class="n">latmax</span> <span class="o">=</span> <span class="mi">80</span>

    <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;moll&#39;</span><span class="p">:</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mi">180</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="n">lonmin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="n">lonmax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="n">latmin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="n">latmax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="n">proj</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span> <span class="o">=</span> <span class="n">boundinglat</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">=</span> <span class="n">lon_0</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lat_0</span> <span class="o">=</span> <span class="n">lat_0</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">=</span> <span class="n">user_mapset</span></div>



<div class="viewcode-block" id="levs">
<a class="viewcode-back" href="../levs.html#cfplot.levs">[docs]</a>
<span class="k">def</span> <span class="nf">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">manual</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | The levs command manually sets the contour levels.</span>

<span class="sd">     | min=min - minimum level</span>
<span class="sd">     | max=max - maximum level</span>
<span class="sd">     | step=step - step between levels</span>
<span class="sd">     | manual= manual - set levels manually</span>
<span class="sd">     | extend=&#39;neither&#39;, &#39;both&#39;, &#39;min&#39;, or &#39;max&#39; - colour bar limit extensions</span>

<span class="sd">     | Use the levs command when a predefined set of levels is required. The</span>
<span class="sd">     | min, max and step parameters can be used to define a set of levels.</span>
<span class="sd">     | These can take integer or floating point numbers. If the min and max are specified</span>
<span class="sd">     | then a step also needs to be specified.</span>
<span class="sd">     </span>
<span class="sd">     | If just the step is specified then cf-plot will internally try to define a reasonable set</span>
<span class="sd">     | of levels.</span>


<span class="sd">     | If colour filled contours are plotted then the default is to extend</span>
<span class="sd">     | the minimum and maximum contours coloured for out of range values</span>
<span class="sd">     | - extend=&#39;both&#39;.</span>

<span class="sd">     | Once a user call is made to levs the levels are persistent.</span>
<span class="sd">     | i.e. the next plot will use the same set of levels.</span>
<span class="sd">     | Use levs() to reset to undefined levels.</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">])</span> <span class="ow">and</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">cfp.levs error: when the min and max are specified a step also needs to be specified</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">manual</span><span class="p">]):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">=</span> <span class="s1">&#39;both&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">manual</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">manual</span><span class="p">)</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Set the normalization object as we are using potentially unevenly</span>
        <span class="c1"># spaced levels</span>
        <span class="n">ncolors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
            <span class="n">ncolors</span> <span class="o">=</span> <span class="n">ncolors</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span>
            <span class="n">boundaries</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="n">ncolors</span><span class="p">)</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">]):</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span> <span class="o">=</span> <span class="nb">min</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span> <span class="o">=</span> <span class="nb">max</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="o">=</span> <span class="n">step</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">]):</span>
                <span class="n">lstep</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="mf">1e-10</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">+</span> <span class="n">lstep</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">))</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="p">((</span><span class="n">levs</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="p">(</span><span class="n">levs</span> <span class="o">/</span> <span class="mf">1e10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lstep</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="mf">1e-10</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">+</span> <span class="n">lstep</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="p">(</span><span class="n">levs</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="n">levs</span> <span class="o">/</span> <span class="mf">1e10</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levs</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Check for spurious decimal places due to numeric representation</span>
            <span class="c1"># and fix if found</span>
            <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">)):</span>
                <span class="n">ndecs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">pt</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ndecs</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>

    <span class="c1"># If step only is set then reset user_levs to zero</span>
    <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">]):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="o">=</span> <span class="n">step</span>

    <span class="c1"># Check extend has a proper value</span>
    <span class="k">if</span> <span class="n">extend</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;neither&#39;</span><span class="p">,</span> <span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">]:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> extend must be one of &#39;neither&#39;, &#39;min&#39;, &#39;max&#39;, &#39;both&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">=</span> <span class="n">extend</span></div>



<div class="viewcode-block" id="mapaxis">
<a class="viewcode-back" href="../mapaxis.html#cfplot.mapaxis">[docs]</a>
<span class="k">def</span> <span class="nf">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | mapaxis is used to work out a sensible set of longitude and latitude</span>
<span class="sd">     | tick marks and labels.  This is an internal routine and is not used</span>
<span class="sd">     | by the user.</span>

<span class="sd">     | min=None - minimum axis value</span>
<span class="sd">     | max=None - maximum axis value</span>
<span class="sd">     | type=None - 1 = longitude, 2 = latitude</span>

<span class="sd">     :Returns:</span>
<span class="sd">      longtitude/latitude ticks and longitude/latitude tick labels</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">degsym</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">degsym</span><span class="p">:</span>
        <span class="n">degsym</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$\degree$&#39;</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span>
        <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">720</span><span class="p">,</span> <span class="mi">720</span> <span class="o">+</span> <span class="n">lonstep</span><span class="p">,</span> <span class="n">lonstep</span><span class="p">)</span>
        <span class="n">lonticks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;=</span> <span class="n">lonmin</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&lt;=</span> <span class="n">lonmax</span><span class="p">:</span>
                <span class="n">lonticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>

        <span class="n">lonlabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lonticks</span><span class="p">:</span>
            <span class="n">lon2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
            <span class="k">if</span> <span class="n">lon2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lon2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lon</span> <span class="o">!=</span> <span class="mi">180</span><span class="p">:</span>
                    <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lon2</span><span class="p">))</span> <span class="o">+</span> <span class="n">degsym</span> <span class="o">+</span> <span class="s1">&#39;W&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lon2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lon2</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
                <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span> <span class="o">+</span> <span class="n">degsym</span> <span class="o">+</span> <span class="s1">&#39;E&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lon2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">degsym</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lon</span> <span class="o">==</span> <span class="mi">180</span> <span class="ow">or</span> <span class="n">lon</span> <span class="o">==</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span>
                <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;180&#39;</span> <span class="o">+</span> <span class="n">degsym</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">lonlabels</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="n">latrange</span> <span class="o">=</span> <span class="n">latmax</span> <span class="o">-</span> <span class="n">latmin</span>
        <span class="n">latstep</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span> <span class="o">+</span> <span class="n">latstep</span><span class="p">,</span> <span class="n">latstep</span><span class="p">)</span>
        <span class="n">latticks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;=</span> <span class="n">latmin</span> <span class="ow">and</span> <span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">latmax</span><span class="p">:</span>
                <span class="n">latticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

        <span class="n">latlabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">latticks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span> <span class="o">+</span> <span class="n">degsym</span> <span class="o">+</span> <span class="s1">&#39;S&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">+</span> <span class="n">degsym</span> <span class="o">+</span> <span class="s1">&#39;N&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;0&#39;</span> <span class="o">+</span> <span class="n">degsym</span><span class="p">)</span>

        <span class="k">return</span><span class="p">(</span><span class="n">latticks</span><span class="p">,</span> <span class="n">latlabels</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">timeaxis</span><span class="p">(</span><span class="n">dtimes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | timeaxis is used to work out a sensible set of time labels and tick</span>
<span class="sd">     | marks given a time span  This is an internal routine and is not used</span>
<span class="sd">     | by the user.</span>

<span class="sd">     | dtimes=None - data times as a CF variable</span>

<span class="sd">     :Returns:</span>
<span class="sd">      time ticks and labels</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time_units</span> <span class="o">=</span> <span class="n">dtimes</span><span class="o">.</span><span class="n">Units</span>
    <span class="n">time_ticks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span>

    <span class="n">yearmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
    <span class="n">yearmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
    <span class="n">tmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">dtarray</span><span class="p">)</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">dtarray</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dtimes</span><span class="p">,</span> <span class="s1">&#39;calendar&#39;</span><span class="p">):</span>
        <span class="n">calendar</span> <span class="o">=</span> <span class="n">dtimes</span><span class="o">.</span><span class="n">calendar</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">calendar</span> <span class="o">=</span> <span class="s1">&#39;standard&#39;</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
            <span class="n">yearmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
            <span class="n">yearmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
            <span class="n">yearmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
            <span class="n">yearmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>

    <span class="c1"># Years</span>
    <span class="n">span</span> <span class="o">=</span> <span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span>
    <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">span</span> <span class="o">&lt;</span> <span class="mi">3000</span><span class="p">:</span>
        <span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Time (year)&#39;</span>
        <span class="n">tvals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">160</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">600</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">1300</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">200</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span>

        <span class="n">years</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yearmax</span> <span class="o">/</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span>
        <span class="n">tvals</span> <span class="o">=</span> <span class="n">years</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">years</span> <span class="o">&gt;=</span> <span class="n">yearmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">years</span> <span class="o">&lt;=</span> <span class="n">yearmax</span><span class="p">))]</span>

        <span class="c1"># Catch tvals if not properly defined and use gvals to generate some</span>
        <span class="c1"># year tick marks</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">tvals</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">tvals</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">yearmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">yearmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">tvals</span><span class="p">:</span>
            <span class="n">time_ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
                <span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;-01-01 00:00:00&#39;</span><span class="p">),</span>
                 <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)))</span>
            <span class="n">time_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span>

    <span class="c1"># Months</span>
    <span class="k">if</span> <span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>

        <span class="n">months</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Feb&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;Apr&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jun&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Aug&#39;</span><span class="p">,</span>  <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Oct&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">,</span> <span class="s1">&#39;Dec&#39;</span><span class="p">]</span>

        <span class="c1"># Check number of labels with 1 month steps</span>
        <span class="n">tsteps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">yearmin</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
                <span class="n">mytime</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>
                               <span class="nb">str</span><span class="p">(</span><span class="n">month</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-01 00:00:00&#39;</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mytime</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mytime</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                    <span class="n">tsteps</span> <span class="o">=</span> <span class="n">tsteps</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">tsteps</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">:</span>
            <span class="n">mvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tsteps</span> <span class="o">&gt;=</span> <span class="mi">17</span><span class="p">:</span>
            <span class="n">mvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>

        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">yearmin</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">mvals</span><span class="p">:</span>
                <span class="n">mytime</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span>
                               <span class="nb">str</span><span class="p">(</span><span class="n">month</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-01 00:00:00&#39;</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">mytime</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mytime</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                    <span class="n">time_ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">((</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">mytime</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)))</span>
                    <span class="n">time_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">months</span><span class="p">[</span><span class="n">month</span><span class="p">])</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span>

    <span class="c1"># Days and hours</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time_ticks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">myday</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">tmin</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmin</span><span class="o">.</span><span class="n">month</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmin</span><span class="o">.</span><span class="n">day</span><span class="p">),</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
        <span class="n">not_found</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">hour_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">span</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">not_found</span> <span class="o">&lt;=</span> <span class="mi">48</span><span class="p">:</span>
            <span class="n">mydate</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">myday</span><span class="p">,</span> <span class="n">dtimes</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">+</span> \
                <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">hour_counter</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mydate</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mydate</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                <span class="n">span</span> <span class="o">=</span> <span class="n">span</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">not_found</span> <span class="o">=</span> <span class="n">not_found</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">hour_counter</span> <span class="o">=</span> <span class="n">hour_counter</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">13</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">13</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">24</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">400</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">48</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">96</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="o">*</span> <span class="mi">24</span>

        <span class="n">not_found</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">hour_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Time (hour)&#39;</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;=</span> <span class="mi">24</span><span class="p">:</span>
            <span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Time&#39;</span>
        <span class="n">time_ticks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">time_labels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="n">not_found</span> <span class="o">&lt;=</span> <span class="mi">48</span><span class="p">:</span>
            <span class="n">mytime</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">myday</span><span class="p">,</span> <span class="n">dtimes</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">+</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">hour_counter</span><span class="p">,</span> <span class="s1">&#39;hour&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">mytime</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mytime</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                <span class="n">time_ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mytime</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
                <span class="n">label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">mytime</span><span class="o">.</span><span class="n">year</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mytime</span><span class="o">.</span><span class="n">month</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mytime</span><span class="o">.</span><span class="n">day</span><span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">hour_counter</span><span class="o">/</span><span class="mi">24</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour_counter</span><span class="o">/</span><span class="mi">24</span><span class="p">)):</span>
                    <span class="n">label</span> <span class="o">+=</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mytime</span><span class="o">.</span><span class="n">hour</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;:00:00&#39;</span>
                <span class="n">time_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">not_found</span> <span class="o">=</span> <span class="n">not_found</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">hour_counter</span> <span class="o">=</span> <span class="n">hour_counter</span> <span class="o">+</span> <span class="n">step</span>

    <span class="k">return</span><span class="p">(</span><span class="n">time_ticks</span><span class="p">,</span> <span class="n">time_labels</span><span class="p">,</span> <span class="n">axis_label</span><span class="p">)</span>


<div class="viewcode-block" id="ndecs">
<a class="viewcode-back" href="../ndecs.html#cfplot.ndecs">[docs]</a>
<span class="k">def</span> <span class="nf">ndecs</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | ndecs finds the number of decimal places in an array.  Needed to make the</span>
<span class="sd">    | colour bar match the contour line labelling.</span>

<span class="sd">    | data=data - input array of values</span>

<span class="sd">    :Returns:</span>
<span class="sd">    |  maximum number of necimal places</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">maxdecs</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">number_decs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">number_decs</span> <span class="o">&gt;</span> <span class="n">maxdecs</span><span class="p">:</span>
                <span class="n">maxdecs</span> <span class="o">=</span> <span class="n">number_decs</span>

    <span class="k">return</span> <span class="n">maxdecs</span></div>



<div class="viewcode-block" id="axes">
<a class="viewcode-back" href="../axes.html#cfplot.axes">[docs]</a>
<span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">xstep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ystep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | axes is a function to set axes plotting parameters. The xstep and ystep</span>
<span class="sd">     | parameters are used to label the axes starting at the left hand side and</span>
<span class="sd">     | bottom of the plot respectively. For tighter control over labelling use</span>
<span class="sd">     | xticks, yticks to specify the tick positions and xticklabels,</span>
<span class="sd">     | yticklabels to specify the associated labels.</span>

<span class="sd">     | xstep=xstep - x axis step</span>
<span class="sd">     | ystep=ystep - y axis step</span>
<span class="sd">     | xlabel=xlabel - label for the x-axis</span>
<span class="sd">     | ylabel=ylabel - label for the y-axis</span>
<span class="sd">     | xticks=xticks - values for x ticks</span>
<span class="sd">     | xticklabels=xticklabels - labels for x tick marks</span>
<span class="sd">     | yticks=yticks - values for y ticks</span>
<span class="sd">     | yticklabels=yticklabels - labels for y tick marks</span>
<span class="sd">     | title=None - set title</span>
<span class="sd">     |</span>
<span class="sd">     | Use axes() to reset all the axes plotting attributes to the default.</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
           <span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="p">,</span> <span class="n">yticklabels</span><span class="p">,</span> <span class="n">xstep</span><span class="p">,</span> <span class="n">ystep</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span>
           <span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="p">]):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="o">=</span> <span class="n">xticks</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="o">=</span> <span class="n">yticks</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span> <span class="o">=</span> <span class="n">xstep</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span> <span class="o">=</span> <span class="n">ystep</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span></div>



<div class="viewcode-block" id="axes_plot">
<a class="viewcode-back" href="../axes_plot.html#cfplot.axes_plot">[docs]</a>
<span class="k">def</span> <span class="nf">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | axes_plot is a system function to specify axes plotting parameters.</span>
<span class="sd">     | Use xticks, yticks to specify the tick positions and xticklabels,</span>
<span class="sd">     | yticklabels to specify the associated labels.</span>
<span class="sd">     |</span>
<span class="sd">     | xticks=xticks - values for x ticks</span>
<span class="sd">     | xticklabels=xticklabels - labels for x tick marks</span>
<span class="sd">     | yticks=yticks - values for y ticks</span>
<span class="sd">     | yticklabels=yticklabels - labels for y tick marks</span>
<span class="sd">     | xlabel=xlabel - label for the x-axis</span>
<span class="sd">     | ylabel=ylabel - label for the y-axis</span>
<span class="sd">     | title=None - set title</span>
<span class="sd">     |</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
    <span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>
    <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title_fontsize</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="k">if</span> <span class="n">axis_label_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span>
    <span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="n">lon_mid</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;crs&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>
        <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                                 <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                                 <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">)</span>

    <span class="n">xticklen</span> <span class="o">=</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span><span class="o">*</span><span class="mf">0.007</span>
    <span class="n">yticklen</span> <span class="o">=</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="o">-</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">)</span><span class="o">*</span><span class="mf">0.014</span>

    <span class="c1"># set the plot</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">):</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;rotated&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;UKCP&#39;</span><span class="p">):</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

    <span class="c1"># get the plot bounds</span>
    <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>

    <span class="n">lonrange</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
    <span class="n">lon_mid</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

    <span class="c1"># Set the ticks and tick labels</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># fudge min and max longitude tick positions or the labels wrap</span>
        <span class="n">xticks_new</span> <span class="o">=</span> <span class="n">xticks</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">xticks_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xticks_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.01</span>
            <span class="n">xticks_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xticks_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.01</span>

        <span class="n">plot</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks_new</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xticklabels</span><span class="p">,</span>
                             <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span><span class="p">,</span>
                             <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span><span class="p">)</span>

        <span class="c1"># Plot a corresponding tick on the top of the plot - cartopy feature?</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">xval</span> <span class="ow">in</span> <span class="n">xticks_new</span><span class="p">:</span>
                <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">xval</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
                <span class="n">ypt2</span> <span class="o">=</span> <span class="n">ypt</span> <span class="o">+</span> <span class="n">yticklen</span>
                <span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xpt</span><span class="p">,</span> <span class="n">xpt</span><span class="p">],</span> <span class="p">[</span><span class="n">ypt</span><span class="p">,</span> <span class="n">ypt2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yticklabels</span><span class="p">,</span>
                             <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span><span class="p">,</span>
                             <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span><span class="p">)</span>

        <span class="c1"># Plot a corresponding tick on the right of the plot - cartopy feature?</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ytick</span> <span class="ow">in</span> <span class="n">yticks</span><span class="p">:</span>
                <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">ytick</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
                <span class="n">xpt2</span> <span class="o">=</span> <span class="n">xpt</span> <span class="o">+</span> <span class="n">xticklen</span>
                <span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xpt</span><span class="p">,</span> <span class="n">xpt2</span><span class="p">],</span> <span class="p">[</span><span class="n">ypt</span><span class="p">,</span> <span class="n">ypt</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Set font size and weight</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">():</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">axis_label_fontsize</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">axis_label_fontweight</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">():</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">axis_label_fontsize</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">axis_label_fontweight</span><span class="p">)</span>

    <span class="c1"># Title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span></div>



<div class="viewcode-block" id="gset">
<a class="viewcode-back" href="../gset.html#cfplot.gset">[docs]</a>
<span class="k">def</span> <span class="nf">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">xlog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">twinx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">twiny</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | Set plot limits for all non longitude-latitide plots.</span>
<span class="sd">     | xmin, xmax, ymin, ymax are all needed to set the plot limits.</span>
<span class="sd">     | Set xlog/ylog to True or 1 to get a log axis.</span>
<span class="sd">     |</span>
<span class="sd">     | xmin=None - x minimum</span>
<span class="sd">     | xmax=None - x maximum</span>
<span class="sd">     | ymin=None - y minimum</span>
<span class="sd">     | ymax=None - y maximum</span>
<span class="sd">     | xlog=False - log x</span>
<span class="sd">     | ylog=False - log y</span>
<span class="sd">     | twinx=None - set to True to make a twin y axis plot</span>
<span class="sd">     | twiny=None - set to True to make a twin x axis plot</span>
<span class="sd">     |</span>
<span class="sd">     | Once a user call is made to gset the plot limits are persistent.</span>
<span class="sd">     | i.e. the next plot will use the same set of plot limits.</span>
<span class="sd">     | Use gset() to reset to undefined plot limits i.e. the full range</span>
<span class="sd">     | of the data.</span>
<span class="sd">     |</span>
<span class="sd">     | To set date axes use date strings i.e.</span>
<span class="sd">     | cfp.gset(xmin = &#39;1970-1-1&#39;, xmax = &#39;1999-12-31&#39;, ymin = 285,</span>
<span class="sd">     |          ymax = 295)</span>
<span class="sd">     |</span>
<span class="sd">     | Note the correct date format is &#39;YYYY-MM-DD&#39; or &#39;YYYY-MM-DD HH:MM:SS&#39;</span>
<span class="sd">     | anything else will give unexpected results.</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">=</span> <span class="n">user_gset</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">twinx</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">twiny</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>

    <span class="n">bcount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bcount</span> <span class="o">=</span> <span class="n">bcount</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">bcount</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">bcount</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;gset error</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;xmin, xmax, ymin, ymax all need to be passed to gset</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;to set the plot limits</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span> <span class="o">=</span> <span class="n">xlog</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="o">=</span> <span class="n">ylog</span>

    <span class="c1"># Check if any axes are time strings</span>
    <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">ymin</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Set plot limits</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">twinx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">twiny</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">time_xstr</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">time_ystr</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span>
                <span class="p">[</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="c1"># Set twinx or twiny if requested</span>
    <span class="k">if</span> <span class="n">twinx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">twinx</span> <span class="o">=</span> <span class="n">twinx</span>
    <span class="k">if</span> <span class="n">twiny</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">twiny</span> <span class="o">=</span> <span class="n">twiny</span></div>



<div class="viewcode-block" id="gopen">
<a class="viewcode-back" href="../gopen.html#cfplot.gopen">[docs]</a>
<span class="k">def</span> <span class="nf">gopen</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_plot</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="s1">&#39;cfplot.png&#39;</span><span class="p">,</span>
          <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;landscape&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">11.7</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">],</span>
          <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
          <span class="n">hspace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_position</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | gopen is used to open a graphic file.</span>
<span class="sd">     |</span>
<span class="sd">     | rows=1 - number of plot rows on the page</span>
<span class="sd">     | columns=1 - number of plot columns on the page</span>
<span class="sd">     | user_plot=1 - internal plot variable - do not use.</span>
<span class="sd">     | file=&#39;cfplot.png&#39; - default file name</span>
<span class="sd">     | orientation=&#39;landscape&#39; - orientation - also takes &#39;portrait&#39;</span>
<span class="sd">     | figsize=[11.7, 8.3]  - figure size in inches</span>
<span class="sd">     | left=None - left margin in normalised coordinates - default=0.12</span>
<span class="sd">     | right=None - right margin in normalised coordinates - default=0.92</span>
<span class="sd">     | top=None - top margin in normalised coordinates - default=0.08</span>
<span class="sd">     | bottom=None - bottom margin in normalised coordinates - default=0.08</span>
<span class="sd">     | wspace=None - width reserved for blank space between subplots - default=0.2</span>
<span class="sd">     | hspace=None - height reserved for white space between subplots - default=0.2</span>
<span class="sd">     | dpi=None - resolution in dots per inch</span>
<span class="sd">     | user_position=False - set to True to supply plot position via gpos</span>
<span class="sd">     |               xmin, xmax, ymin, ymax values</span>


<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set values in globals</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
    <span class="k">if</span> <span class="n">file</span> <span class="o">!=</span> <span class="s1">&#39;cfplot.png&#39;</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">orientation</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">=</span> <span class="n">user_plot</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Set user defined plot area to None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="mf">0.12</span>
    <span class="k">if</span> <span class="n">right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">right</span> <span class="o">=</span> <span class="mf">0.92</span>
    <span class="k">if</span> <span class="n">top</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">top</span> <span class="o">=</span> <span class="mf">0.95</span>
    <span class="k">if</span> <span class="n">bottom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.08</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">if</span> <span class="n">wspace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="k">if</span> <span class="n">hspace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">if</span> <span class="n">orientation</span> <span class="o">!=</span> <span class="s1">&#39;landscape&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">orientation</span> <span class="o">!=</span> <span class="s1">&#39;portrait&#39;</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;gopen error</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;orientation incorrectly set</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;input value was &#39;</span> <span class="o">+</span> <span class="n">orientation</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;Valid options are portrait or landscape</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Set master plot size</span>
    <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;landscape&#39;</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="c1"># Set margins</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
        <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
        <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
        <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span>
        <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span><span class="p">,</span>
        <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span>
        <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">)</span>

    <span class="c1"># Set initial subplot</span>
    <span class="k">if</span> <span class="n">user_position</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">rows</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">columns</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Change tick length for plots &gt; 2x2</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;xtick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;ytick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># Set image resolution</span>
    <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span></div>



<div class="viewcode-block" id="gclose">
<a class="viewcode-back" href="../gclose.html#cfplot.gclose">[docs]</a>
<span class="k">def</span> <span class="nf">gclose</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | gclose saves a graphics file.  The default is to view the file as well</span>
<span class="sd">     | - use view = False to turn this off.</span>

<span class="sd">     | view = True - view graphics file</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Reset the user_plot variable to off</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Test for python or ipython</span>
    <span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">__IPYTHON__</span>
        <span class="n">interactive</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">is_interactive</span><span class="p">():</span>
        <span class="n">interactive</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Remove whitespace if requested</span>
    <span class="n">saveargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tight</span><span class="p">:</span>
        <span class="n">saveargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bbox_inches&#39;</span><span class="p">:</span> <span class="s1">&#39;tight&#39;</span><span class="p">}</span>

    <span class="n">file</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span>
    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Save a file</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.ps&#39;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.eps&#39;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.png&#39;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s1">&#39;.pdf&#39;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">file</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
            <span class="n">file</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="o">**</span><span class="n">saveargs</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">==</span> <span class="s1">&#39;display&#39;</span> <span class="ow">and</span> <span class="n">interactive</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># Use Imagemagick display command if this exists</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">disp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tfile</span> <span class="o">=</span> <span class="s1">&#39;cfplot.png&#39;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                    <span class="n">tfile</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span> <span class="o">**</span><span class="n">saveargs</span><span class="p">)</span>
                <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">disp</span><span class="p">,</span> <span class="n">tfile</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="s1">&#39;matplotlib&#39;</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">==</span> <span class="s1">&#39;matplotlib&#39;</span> <span class="ow">or</span> <span class="n">interactive</span><span class="p">:</span>
            <span class="c1"># Use Matplotlib viewer</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Reset plotting</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">twinx</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">twiny</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">titles_con_called</span> <span class="o">=</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="gpos">
<a class="viewcode-back" href="../gpos.html#cfplot.gpos">[docs]</a>
<span class="k">def</span> <span class="nf">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | Set plot position. Plots start at top left and increase by one each plot</span>
<span class="sd">     | to the right. When the end of the row has been reached then the next</span>
<span class="sd">     | plot will be the leftmost plot on the next row down.</span>

<span class="sd">     | pos=pos - plot position</span>
<span class="sd">     |</span>
<span class="sd">     | The following four parameters are used to get full user control</span>
<span class="sd">     | over the plot position.  In addition to these cfp.gopen</span>
<span class="sd">     | must have the user_position=True parameter set.</span>
<span class="sd">     | xmin=None xmin in normalised coordinates</span>
<span class="sd">     | xmax=None xmax in normalised coordinates</span>
<span class="sd">     | ymin=None ymin in normalised coordinates</span>
<span class="sd">     | ymax=None ymax in normalised coordinates</span>
<span class="sd">     |</span>
<span class="sd">     |</span>

<span class="sd">     :Returns:</span>
<span class="sd">      None</span>

<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Reset mymap</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Check inputs are okay</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;pos error - pos out of range:</span><span class="se">\n</span><span class="s1"> range = 1 - &#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> input pos was &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>


    <span class="n">user_pos</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]):</span>
        <span class="n">user_pos</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span> <span class="o">=</span> <span class="n">xmin</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">=</span> <span class="n">xmax</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span> <span class="o">=</span> <span class="n">ymin</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">=</span> <span class="n">ymax</span>

    <span class="c1"># Reset any accumulated muliple graph limits</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Set gpos_called</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Reset titles_con_called</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">titles_con_called</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">user_pos</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">delta_x</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span>
        <span class="n">delta_y</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span>

        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span><span class="p">,</span>
                                                       <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span><span class="p">,</span>
                                                       <span class="n">delta_x</span><span class="p">,</span> <span class="n">delta_y</span><span class="p">])</span>


    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Set position in global variables</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>

    <span class="c1"># Reset contour levels if they are not defined by the user</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">levs</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">levs</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span><span class="p">)</span></div>



<div class="viewcode-block" id="pcon">
<a class="viewcode-back" href="../pcon.html#cfplot.pcon">[docs]</a>
<span class="k">def</span> <span class="nf">pcon</span><span class="p">(</span><span class="n">mb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">km</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | pcon is a function for converting pressure to height in kilometers and</span>
<span class="sd">     | vice-versa. This function uses the equation P=P0exp(-z/H) to translate</span>
<span class="sd">     | between pressure and height. In pcon the surface pressure P0 is set to</span>
<span class="sd">     | 1000.0mb and the scale height H is set to 7.0. The value of H can vary</span>
<span class="sd">     | from 6.0 in the polar regions to 8.5 in the tropics as well as</span>
<span class="sd">     | seasonally. The value of P0 could also be said to be 1013.25mb rather</span>
<span class="sd">     | than 1000.0mb.</span>

<span class="sd">     | As this relationship is approximate:</span>
<span class="sd">     | (i) Only use this for making the axis labels on y axis pressure plots</span>
<span class="sd">     | (ii) Put the converted axis on the right hand side to indicate that</span>
<span class="sd">     |      this isn&#39;t the primary unit of measure</span>

<span class="sd">     | print cfp.pcon(mb=[1000, 300, 100, 30, 10, 3, 1, 0.3])</span>
<span class="sd">     | [0. 8.42780963 16.11809565 24.54590528 32.2361913</span>
<span class="sd">     |  40.66400093 48.35428695, 56.78209658]</span>

<span class="sd">     | mb=None - input pressure</span>
<span class="sd">     | km=None - input height</span>
<span class="sd">     | h=7.0 - default value for h</span>
<span class="sd">     | p0=1000 - default value for p0</span>

<span class="sd">     :Returns:</span>
<span class="sd">      | pressure(mb) if height(km) input,</span>
<span class="sd">      | height(km) if pressure(mb) input</span>
<span class="sd">     &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mb</span><span class="p">,</span> <span class="n">km</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;pcon error - pcon must have mb or km input</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mb</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">km</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">km</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p0</span><span class="p">)))</span></div>



<div class="viewcode-block" id="supscr">
<a class="viewcode-back" href="../supscr.html#cfplot.supscr">[docs]</a>
<span class="k">def</span> <span class="nf">supscr</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | supscr - add superscript text formatting for ** and ^</span>
<span class="sd">     | This is an internal routine used in titles and colour bars</span>
<span class="sd">     | and not used by the user.</span>
<span class="sd">     | text=None - input text</span>

<span class="sd">     :Returns:</span>
<span class="sd">      Formatted text</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> supscr error - supscr must have text input</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">tform</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="n">sup</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;^&#39;</span><span class="p">):</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="n">sup</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="n">i</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s1">&#39;*&#39;</span><span class="p">):</span>
                <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">sup</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="s1">&#39;-0123456789&#39;</span><span class="p">:</span>
                <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="n">i</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s1">&#39;}$&#39;</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">sup</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s1">&#39;$^{&#39;</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
        <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s1">&#39;}$&#39;</span>

    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;m2&#39;</span><span class="p">,</span> <span class="s1">&#39;m$^</span><span class="si">{2}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;m3&#39;</span><span class="p">,</span> <span class="s1">&#39;m$^</span><span class="si">{3}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;m-2&#39;</span><span class="p">,</span> <span class="s1">&#39;m$^{-2}$&#39;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;m-3&#39;</span><span class="p">,</span> <span class="s1">&#39;m$^{-3}$&#39;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;s-1&#39;</span><span class="p">,</span> <span class="s1">&#39;s$^{-1}$&#39;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;s-2&#39;</span><span class="p">,</span> <span class="s1">&#39;s$^{-2}$&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tform</span></div>



<div class="viewcode-block" id="gvals">
<a class="viewcode-back" href="../gvals.html#cfplot.gvals">[docs]</a>
<span class="k">def</span> <span class="nf">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | gvals - work out a sensible set of values between two limits</span>
<span class="sd">     | This is an internal routine used for contour levels and axis</span>
<span class="sd">     | labelling and is not generally used by the user.</span>

<span class="sd">     | dmin = None - minimum</span>
<span class="sd">     | dmax = None - maximum</span>
<span class="sd">     | mystep = None - use this step</span>
<span class="sd">     | mod = True - modify data to make use of a multipler</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Copies of inputs as these might be changed</span>
    <span class="n">dmin1</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">dmin</span><span class="p">)</span>
    <span class="n">dmax1</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">dmax</span><span class="p">)</span>

    <span class="c1"># Swap values if dmin1 &gt; dmax1 </span>
    <span class="k">if</span> <span class="n">dmax1</span> <span class="o">&lt;</span> <span class="n">dmin1</span><span class="p">:</span>
        <span class="n">dmin1</span><span class="p">,</span> <span class="n">dmax1</span> <span class="o">=</span> <span class="n">dmax1</span><span class="p">,</span> <span class="n">dmin1</span>

    <span class="c1"># Data range</span>
    <span class="n">data_range</span> <span class="o">=</span> <span class="n">dmax1</span> <span class="o">-</span> <span class="n">dmin1</span>

    <span class="c1"># field multiplier</span>
    <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Return some values if dmin1 = dmax1</span>
    <span class="k">if</span> <span class="n">dmin1</span> <span class="o">==</span> <span class="n">dmax1</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dmin1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dmin1</span><span class="p">,</span> <span class="n">dmin1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mult</span>

    <span class="c1"># Modify if requested or if out of range 0.001 to 2000000</span>
    <span class="k">if</span> <span class="n">data_range</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">dmax1</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">dmin1</span> <span class="o">=</span> <span class="n">dmin1</span> <span class="o">*</span> <span class="mf">10.0</span>
            <span class="n">dmax1</span> <span class="o">=</span> <span class="n">dmax1</span> <span class="o">*</span> <span class="mf">10.0</span>
            <span class="n">data_range</span> <span class="o">=</span> <span class="n">dmax1</span> <span class="o">-</span> <span class="n">dmin1</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="n">mult</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">data_range</span> <span class="o">&gt;</span> <span class="mi">2000000</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">dmax1</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">dmin1</span> <span class="o">=</span> <span class="n">dmin1</span> <span class="o">/</span> <span class="mf">10.0</span>
            <span class="n">dmax1</span> <span class="o">=</span> <span class="n">dmax1</span> <span class="o">/</span> <span class="mf">10.0</span>
            <span class="n">data_range</span> <span class="o">=</span> <span class="n">dmax1</span> <span class="o">-</span> <span class="n">dmin1</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="n">mult</span> <span class="o">+</span> <span class="mi">1</span>


    <span class="k">if</span> <span class="n">data_range</span> <span class="o">&gt;=</span> <span class="mf">0.001</span> <span class="ow">and</span> <span class="n">data_range</span> <span class="o">&lt;=</span> <span class="mi">2000000</span><span class="p">:</span>
        
        <span class="c1"># Calculate an appropriate step</span>
        <span class="n">step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">test_steps</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0001</span><span class="p">,</span> <span class="mf">0.0002</span><span class="p">,</span> <span class="mf">0.0005</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span>
                      <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">2000</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">,</span>
                      <span class="mi">20000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">mystep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">mystep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">test_steps</span><span class="p">:</span>
                <span class="n">nvals</span> <span class="o">=</span> <span class="n">data_range</span> <span class="o">/</span> <span class="n">val</span>

                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nvals</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="n">step</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nvals</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">:</span>
                        <span class="n">step</span> <span class="o">=</span> <span class="n">val</span>

        <span class="c1"># Return an error if no step found</span>
        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1"> cfp.gvals - no valid step values found </span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;cfp.gvals(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dmin1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dmax1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)</span><span class="se">\n\n</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="c1"># values  &lt; 0.0</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">vals1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dmin1</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">vals1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">dmin1</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="n">step</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">step</span>

        <span class="c1"># values  &gt;= 0.0</span>
        <span class="n">vals2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dmax1</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">vals2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dmax1</span> <span class="o">/</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span>

        <span class="k">if</span> <span class="n">vals1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vals2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals1</span>
        <span class="k">if</span> <span class="n">vals2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vals1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals2</span>
        <span class="k">if</span> <span class="n">vals1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vals2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">vals1</span><span class="p">,</span> <span class="n">vals2</span><span class="p">))</span>

        <span class="c1"># Round off decimal numbers so that</span>
        <span class="c1"># (np.arange(4) * -0.1)[3] = -0.30000000000000004 gives -0.3 as expected</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

        <span class="c1"># Change values to integers for values &gt;= 1</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">vals</span> <span class="o">&gt;=</span> <span class="n">dmin1</span><span class="p">,</span> <span class="n">vals</span> <span class="o">&lt;=</span> <span class="n">dmax1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">mult</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
            
    <span class="c1"># Catch if no values have been defined    </span>
    <span class="k">if</span> <span class="n">vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">])</span>


    <span class="k">return</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">mult</span><span class="p">)</span></div>



<div class="viewcode-block" id="cf_data_assign">
<a class="viewcode-back" href="../cf_data_assign.html#cfplot.cf_data_assign">[docs]</a>
<span class="k">def</span> <span class="nf">cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotated_vect</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | Check cf input data is okay and return data for contour plot.</span>
<span class="sd">     | This is an internal routine not used by the user.</span>
<span class="sd">     | f=None - input cf field</span>
<span class="sd">     | colorbar_title=None - input colour bar title</span>
<span class="sd">     | rotated vect=False - return 1D x and y for rotated plot vectors</span>
<span class="sd">     | verbose=None - set to 1 to get a verbose idea of what the</span>
<span class="sd">     |          cf_data_assign is doing</span>

<span class="sd">     :Returns:</span>
<span class="sd">      | f - data for contouring</span>
<span class="sd">      | x - x coordinates of data (optional)</span>
<span class="sd">      | y - y coordinates of data (optional)</span>
<span class="sd">      | ptype - plot type</span>
<span class="sd">      | colorbar_title - colour bar title</span>
<span class="sd">      | xlabel - x label for plot</span>
<span class="sd">      | ylabel - y label for plot</span>
<span class="sd">      |</span>
<span class="sd">      |</span>
<span class="sd">      |</span>
<span class="sd">      |</span>
<span class="sd">      |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check input data has the correct number of dimensions</span>
    <span class="c1"># Take into account rotated pole fields having extra dimensions</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">domain_axes</span><span class="p">()</span><span class="o">.</span><span class="n">filter_by_size</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:rotated_latitude_longitude&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;cf_data_assign error - data has too many dimensions&#39;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;cf_data_assign error - data has too few dimensions&#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> cf-plot requires one or two dimensional data</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dimension_coordinates</span><span class="p">()):</span>
                <span class="n">sn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">ln</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sn</span><span class="p">:</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ln</span><span class="p">:</span>
                        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> \
                            <span class="nb">str</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> \
                            <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Set up data arrays and variables</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">height</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">has_height</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">has_time</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">xpole</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ypole</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ptype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">field</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>
    
    
    <span class="c1"># Check for multiple Z coordinates</span>
    <span class="n">myz</span> <span class="o">=</span> <span class="n">find_z</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># Extract coordinate data if a matching CF standard_name or axis is found</span>
    <span class="k">for</span> <span class="n">mycoord</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">coords</span><span class="p">():</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lons -&#39;</span><span class="p">,</span> <span class="n">mydim</span><span class="p">)</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lats -&#39;</span><span class="p">,</span> <span class="n">mydim</span><span class="p">)</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;height -&#39;</span><span class="p">,</span> <span class="n">mydim</span><span class="p">)</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">has_height</span> <span class="o">=</span> <span class="kc">True</span>
            
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;time -&#39;</span><span class="p">,</span> <span class="n">mydim</span><span class="p">)</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">has_time</span> <span class="o">=</span> <span class="kc">True</span>
                    

    <span class="c1"># assign field data</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

    <span class="c1"># Change Boolean data to integer</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;bool&#39;</span><span class="p">:</span>
        <span class="n">warnstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n\n</span><span class="s1"> Warning - boolean data found - converting to integers</span><span class="se">\n\n\n</span><span class="s1">&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

    <span class="c1"># Check what plot type is required.</span>
    <span class="c1"># 0=simple contour plot, 1=map plot, 2=latitude-height plot,</span>
    <span class="c1"># 3=longitude-time plot, 4=latitude-time plot.</span>
    <span class="k">if</span> <span class="n">has_lons</span> <span class="ow">and</span> <span class="n">has_lats</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">lats</span>

    <span class="k">if</span> <span class="n">has_lats</span> <span class="ow">and</span> <span class="n">has_height</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">height</span>
        
        <span class="n">xname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">==</span> <span class="s1">&#39;degrees_north&#39;</span><span class="p">:</span>
            <span class="n">xunits</span> <span class="o">=</span> <span class="s1">&#39;degrees&#39;</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">xunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span>
            
        <span class="n">yname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">myz</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">myz</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">yunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span> 
                         
    <span class="k">if</span> <span class="n">has_lons</span> <span class="ow">and</span> <span class="n">has_height</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">height</span>
        
        <span class="n">xname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">==</span> <span class="s1">&#39;degrees_east&#39;</span><span class="p">:</span>
            <span class="n">xunits</span> <span class="o">=</span> <span class="s1">&#39;degrees&#39;</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">xunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span>
            
        <span class="n">yname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">myz</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">myz</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">yunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span> 
        
    <span class="k">if</span> <span class="n">has_lons</span> <span class="ow">and</span> <span class="n">has_time</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">time</span>
        
        <span class="n">xname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">==</span> <span class="s1">&#39;degrees_east&#39;</span><span class="p">:</span>
            <span class="n">xunits</span> <span class="o">=</span> <span class="s1">&#39;degrees&#39;</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">xunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span>
            
        <span class="n">yname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">yunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span> 

    <span class="k">if</span> <span class="n">has_lats</span> <span class="ow">and</span> <span class="n">has_time</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">time</span>
        
        <span class="n">xname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">==</span> <span class="s1">&#39;degrees_north&#39;</span><span class="p">:</span>
            <span class="n">xunits</span> <span class="o">=</span> <span class="s1">&#39;degrees&#39;</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">xunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span>
            
        <span class="n">yname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">yunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span> 

    <span class="c1"># time height plot</span>
    <span class="k">if</span> <span class="n">has_height</span> <span class="ow">and</span> <span class="n">has_time</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">time</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">height</span>
        
        <span class="n">xname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">xunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span>
            
        <span class="n">yname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">yunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span> 

        <span class="c1"># Rotate array to get it as time vs height</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="c1"># Rotated pole</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:rotated_latitude_longitude&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">6</span>

        <span class="n">rotated_pole</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:rotated_latitude_longitude&#39;</span><span class="p">)</span>
        <span class="n">xpole</span> <span class="o">=</span> <span class="n">rotated_pole</span><span class="p">[</span><span class="s1">&#39;grid_north_pole_longitude&#39;</span><span class="p">]</span>
        <span class="n">ypole</span> <span class="o">=</span> <span class="n">rotated_pole</span><span class="p">[</span><span class="s1">&#39;grid_north_pole_latitude&#39;</span><span class="p">]</span>

        <span class="c1"># Extract grid x and y coordinates</span>
        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dimension_coordinates</span><span class="p">()):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;grid_longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">]:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;grid_latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">]:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                <span class="c1"># Flip y and data if reversed</span>
                <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="n">yunits</span>


    <span class="c1"># Extract auxiliary lons and lats if they exist</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s1">&#39;rotated&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rotated_vect</span><span class="p">:</span>
            <span class="n">aux_lons</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">aux_lats</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">auxiliary_coordinates</span><span class="p">()):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]:</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                    <span class="n">aux_lons</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]:</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                    <span class="n">aux_lats</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">aux_lons</span> <span class="ow">and</span> <span class="n">aux_lats</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">xpts</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">ypts</span>
                <span class="n">ptype</span> <span class="o">=</span> <span class="mi">1</span>


    <span class="c1"># UKCP grid</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:transverse_mercator&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

        <span class="c1"># Find the auxiliary lons and lats if provided</span>
        <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">auxiliary_coordinates</span><span class="p">()):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Calculate lons and lats if no auxiliary data for these</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_lons</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_lats</span><span class="p">:</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

            <span class="n">ref</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:transverse_mercator&#39;</span><span class="p">)</span>
            <span class="n">false_easting</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;false_easting&#39;</span><span class="p">]</span>
            <span class="n">false_northing</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;false_northing&#39;</span><span class="p">]</span>
            <span class="n">central_longitude</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;longitude_of_central_meridian&#39;</span><span class="p">]</span>
            <span class="n">central_latitude</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;latitude_of_projection_origin&#39;</span><span class="p">]</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;scale_factor_at_central_meridian&#39;</span><span class="p">]</span>

            <span class="c1"># Set the transform</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">TransverseMercator</span><span class="p">(</span><span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
                                                <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
                                                <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                                                <span class="n">central_latitude</span><span class="o">=</span><span class="n">central_latitude</span><span class="p">,</span>
                                                <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">)</span>

            <span class="c1"># Calculate the longitude and latitude points</span>
            <span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">transform</span><span class="p">,</span> <span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>


    <span class="c1"># None of the above</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">data_axes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_data_axes</span><span class="p">()</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_axes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="n">filter_by_axis</span>  <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        
                        <span class="n">y</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="n">mycoord</span> <span class="o">=</span> <span class="s1">&#39;dimensioncoordinate&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                            <span class="n">yunits</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">yunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mycoord</span><span class="p">)</span> <span class="o">+</span> <span class="n">yunits</span>                         
                    <span class="k">elif</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="n">mycoord</span> <span class="o">=</span> <span class="s1">&#39;dimensioncoordinate&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">),</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                            <span class="n">xunits</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">xunits</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mycoord</span><span class="p">)</span> <span class="o">+</span> <span class="n">xunits</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cf_data_assign - cannot find data to return</span><span class="se">\n\n</span><span class="s2">&quot;</span> 
                <span class="n">errstr</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">constructs</span><span class="o">.</span><span class="n">domain_axis_identity</span><span class="p">(</span><span class="n">d</span><span class="p">))</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>



    <span class="c1"># Assign colorbar_title</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">colorbar_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;No Name&#39;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nc</span><span class="p">:</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;short_name&#39;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">short_name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">long_name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">standard_name</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;Units&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">colorbar_title</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">colorbar_title</span> <span class="o">+</span> \
                    <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">supscr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

        
    <span class="c1"># Return data</span>
    <span class="k">return</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="p">)</span></div>



<div class="viewcode-block" id="check_data">
<a class="viewcode-back" href="../check_data.html#cfplot.check_data">[docs]</a>
<span class="k">def</span> <span class="nf">check_data</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | check_data - check user input contour data is correct.</span>
<span class="sd">     | This is an internal routine and is not used by the user.</span>
<span class="sd">     |</span>
<span class="sd">     | field=None - field</span>
<span class="sd">     | x=None - x points for field</span>
<span class="sd">     | y=None - y points for field</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Input error trapping</span>
    <span class="n">args</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;con error - a field for contouring must be &#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;passed with the f= flag</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Check input dimensions look okay.</span>
    <span class="c1"># All inputs 2D</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xpts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">xpts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">ypts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ypts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="c1"># Field x and y all 1D</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="c1"># Field 2D, x and y 1D</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;Input arguments incorrectly shaped:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;x has shape:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;y has shape:&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;field has shape&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;Expected x=xpts, y=ypts, field=(ypts,xpts)</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;x=npts, y=npts, field=npts</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> \
            <span class="s1">&#39;or x=[ypts, xpts], y=[ypts, xpts], field=[ypts, xpts]</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span></div>



<div class="viewcode-block" id="cscale">
<a class="viewcode-back" href="../cscale.html#cfplot.cscale">[docs]</a>
<span class="k">def</span> <span class="nf">cscale</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">white</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">below</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">above</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">uniform</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | cscale - choose and manipulate colour maps.  Around 200 colour scales are</span>
<span class="sd">    |          available - see the gallery section for more details.</span>
<span class="sd">    |</span>
<span class="sd">    | scale=None - name of colour map</span>
<span class="sd">    | ncols=None - number of colours for colour map</span>
<span class="sd">    | white=None - change these colours to be white</span>
<span class="sd">    | below=None - change the number of colours below the mid point of</span>
<span class="sd">    |               the colour scale to be this</span>
<span class="sd">    | above=None - change the number of colours above the mid point of</span>
<span class="sd">    |               the colour scale to be this</span>
<span class="sd">    | reverse=False - reverse the colour scale</span>
<span class="sd">    | uniform=False - produce a uniform colour scale.</span>
<span class="sd">    |                 For example: if below=3 and above=10 are specified</span>
<span class="sd">    |                 then initially below=10 and above=10 are used.  The</span>
<span class="sd">    |                 colour scale is then cropped to use scale colours</span>
<span class="sd">    |                 6 to 19.  This produces a more uniform intensity colour</span>
<span class="sd">    |                 scale than one where all the blues are compressed into</span>
<span class="sd">    |                 3 colours.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    | Personal colour maps are available by saving the map as red green blue</span>
<span class="sd">    | to a file with a set of values on each line.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    | Use cscale() To reset to the default settings.</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">        None</span>

<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If no map requested reset to default</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="s1">&#39;scale1&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_user</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">ncols</span><span class="p">,</span> <span class="n">white</span><span class="p">,</span> <span class="n">below</span><span class="p">,</span> <span class="n">above</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">):</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">reverse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">uniform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;scale1&#39;</span> <span class="ow">or</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;scale1&#39;</span><span class="p">:</span>
            <span class="n">myscale</span> <span class="o">=</span> <span class="n">cscale1</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s1">&#39;viridis&#39;</span><span class="p">:</span>
            <span class="n">myscale</span> <span class="o">=</span> <span class="n">viridis</span>
        <span class="c1"># convert cscale1 or viridis from hex to rgb</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">myhex</span> <span class="ow">in</span> <span class="n">myscale</span><span class="p">:</span>
            <span class="n">myhex</span> <span class="o">=</span> <span class="n">myhex</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">)</span>
            <span class="n">mylen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">myhex</span><span class="p">)</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">myhex</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">mylen</span> <span class="o">//</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mylen</span><span class="p">,</span> <span class="n">mylen</span> <span class="o">//</span> <span class="mi">3</span><span class="p">))</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">package_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_path</span><span class="p">,</span> <span class="s1">&#39;colourmaps/&#39;</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">+</span> <span class="s1">&#39;.rgb&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">cscale error - colour scale not found:</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;File &#39;</span> <span class="o">+</span> <span class="n">file</span> <span class="o">+</span> <span class="s1">&#39; not found</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;File &#39;</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">+</span> <span class="s1">&#39; not found</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">scale</span>

        <span class="c1"># Read in rgb values and convert to hex</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="c1"># Reverse the colour scale if requested</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Interpolate to a new number of colours if requested</span>
    <span class="k">if</span> <span class="n">ncols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">f_red</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">f_green</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">f_blue</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">f_red</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">f_green</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">f_blue</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>

    <span class="c1"># Change the number of colours below and above the mid-point if requested</span>
    <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">above</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1"># Mid-point of colour scale</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># Below mid point x locations</span>
        <span class="n">x_below</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">below</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x_below</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">below</span>
        <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">npoints</span>
        <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uniform</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">above</span><span class="p">,</span> <span class="n">below</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lower</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">x_below</span> <span class="o">=</span> <span class="p">((</span><span class="n">npoints</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">lower</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>

        <span class="c1"># Above mid point x locations</span>
        <span class="n">x_above</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">above</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x_above</span> <span class="o">=</span> <span class="n">npoints</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">above</span>
        <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">npoints</span>
        <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uniform</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">above</span><span class="p">,</span> <span class="n">below</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">upper</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">x_above</span> <span class="o">=</span> <span class="p">((</span><span class="n">npoints</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> \
                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span> <span class="o">+</span> <span class="n">npoints</span>

        <span class="c1"># Append new colour positions</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_below</span><span class="p">,</span> <span class="n">x_above</span><span class="p">)</span>

        <span class="c1"># Interpolate to new colour scale</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="n">f_red</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">f_green</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">f_blue</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">f_red</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">f_green</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">f_blue</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>

        <span class="c1"># Reset colours if uniform is set</span>
        <span class="k">if</span> <span class="n">uniform</span><span class="p">:</span>
            <span class="n">mid_pt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">below</span><span class="p">,</span> <span class="n">above</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">mid_pt</span> <span class="o">-</span> <span class="n">below</span><span class="p">:</span><span class="n">mid_pt</span> <span class="o">+</span> <span class="n">above</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">mid_pt</span> <span class="o">-</span> <span class="n">below</span><span class="p">:</span><span class="n">mid_pt</span> <span class="o">+</span> <span class="n">above</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">mid_pt</span> <span class="o">-</span> <span class="n">below</span><span class="p">:</span><span class="n">mid_pt</span> <span class="o">+</span> <span class="n">above</span><span class="p">]</span>

    <span class="c1"># Convert to hex</span>
    <span class="n">hexarr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
        <span class="n">hexarr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;#</span><span class="si">%02x%02x%02x</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">col</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">col</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">col</span><span class="p">])))</span>

    <span class="c1"># White requested colour positions</span>
    <span class="k">if</span> <span class="n">white</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">white</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">hexarr</span><span class="p">[</span><span class="n">white</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">white</span><span class="p">:</span>
                <span class="n">hexarr</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span>

    <span class="c1"># Set colour scale</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">hexarr</span></div>



<div class="viewcode-block" id="cscale_get_map">
<a class="viewcode-back" href="../cscale_get_map.html#cfplot.cscale_get_map">[docs]</a>
<span class="k">def</span> <span class="nf">cscale_get_map</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | cscale_get_map - return colour map for use in contour plots.</span>
<span class="sd">    |                   This depends on the colour bar extensions</span>
<span class="sd">    | This is an internal routine and is not used by the user.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">         colour map</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cscale_ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">cscale_ncols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">):</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">):</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[:</span><span class="n">cscale_ncols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;neither&#39;</span><span class="p">):</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">colmap</span><span class="p">)</span></div>



<div class="viewcode-block" id="bfill">
<a class="viewcode-back" href="../bfill.html#cfplot.bfill">[docs]</a>
<span class="k">def</span> <span class="nf">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
          <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">single_fill_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">white</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
          <span class="n">orca</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | bfill - block fill a field with colour rectangles</span>
<span class="sd">     | This is an internal routine and is not generally used by the user.</span>
<span class="sd">     |</span>
<span class="sd">     | f=None - field</span>
<span class="sd">     | x=None - x points for field</span>
<span class="sd">     | y=None - y points for field</span>
<span class="sd">     | clevs=None - levels for filling</span>
<span class="sd">     | lonlat=None - longitude and latitude data</span>
<span class="sd">     | bound=False - x and y are cf data boundaries</span>
<span class="sd">     | alpha=alpha - transparency setting 0 to 1</span>
<span class="sd">     | white=True - colour unplotted areas white</span>
<span class="sd">     | single_fill_color=None - colour for a blockfill between two levels</span>
<span class="sd">     |                        - makes maplotlib named colours or</span>
<span class="sd">     |                        - hexadecimal notation - &#39;#d3d3d3&#39; for grey</span>
<span class="sd">     | zorder=4 - plotting order</span>
<span class="sd">     | fast=None - use fast plotting with pcolormesh which is useful for larger datasets</span>
<span class="sd">     | transform=False - map transform supplied by calling routine</span>
<span class="sd">     | orca=False - data is orca data</span>
<span class="sd">     |</span>
<span class="sd">      :Returns:</span>
<span class="sd">        None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    

    <span class="c1"># Set lonlat if not specified</span>
    <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># If single_fill_color is defined then turn off whiting out the background.</span>
    <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">white</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="c1"># Set 2D lon lat if data is that format</span>
    <span class="n">two_d</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">two_d</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Set the default map coordinates for the data to be PlateCarree</span>
    <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
        <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()}</span>


    <span class="c1"># Set the field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">array</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>
        
        
    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">clevs</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>        
        
    <span class="c1"># Generate a Matplotlib colour map</span>
    <span class="c1">#if single_fill_color is None:</span>
    <span class="c1">#    cols = plotvars.cs</span>
    <span class="c1">#else:</span>
    <span class="c1">#    cols = single_fill_color</span>

    <span class="c1">#cmap = matplotlib.colors.ListedColormap(cols)</span>

    <span class="c1">#levels_orig = deepcopy(levels)</span>


    <span class="c1">#if single_fill_color is None:</span>
    <span class="c1">#    if plotvars.levels_extend == &#39;both&#39; or plotvars.levels_extend == &#39;min&#39;:</span>
    <span class="c1">#        levels = np.insert(levels, 0, -1e30)</span>
    <span class="c1">#    if plotvars.levels_extend == &#39;both&#39; or plotvars.levels_extend == &#39;max&#39;:</span>
    <span class="c1">#        levels = np.append(levels, 1e30)</span>

    <span class="c1">#    if plotvars.levels_extend == &#39;both&#39; or plotvars.levels_extend == &#39;min&#39;:</span>
    <span class="c1">#        cmap.set_under(plotvars.cs[0])</span>
    <span class="c1">#        cols = cols[1:]</span>
    <span class="c1">#    if plotvars.levels_extend == &#39;both&#39; or plotvars.levels_extend == &#39;max&#39;:</span>
    <span class="c1">#        cmap.set_over(plotvars.cs[-1])</span>
    <span class="c1">#        cols = cols[:-1]</span>
    
    
    <span class="c1"># Get colour scale for use in contouring</span>
    <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
    <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions</span>
    <span class="c1"># are then changed on the colorbar and plot after the plot is made</span>

    <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;min&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">]:</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;max&#39;</span><span class="p">,</span> <span class="s1">&#39;both&#39;</span><span class="p">]:</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">single_fill_color</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>



    <span class="c1"># Colour array for storing the cell colour.  Start with -1 as the default</span>
    <span class="c1"># as the colours run from 0 to np.size(levels)-1</span>
    <span class="n">colarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">lev</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">field</span> <span class="o">&gt;=</span> <span class="n">lev</span><span class="p">,</span> <span class="n">field</span> <span class="o">&lt;</span> <span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">colarr</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># Change points that are masked back to -1</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">colarr</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        
        
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:transverse_mercator&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Case of transverse mercator of which UKCP is an example</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:transverse_mercator&#39;</span><span class="p">)</span>
            <span class="n">false_easting</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;false_easting&#39;</span><span class="p">]</span>
            <span class="n">false_northing</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;false_northing&#39;</span><span class="p">]</span>
            <span class="n">central_longitude</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;longitude_of_central_meridian&#39;</span><span class="p">]</span>
            <span class="n">central_latitude</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;latitude_of_projection_origin&#39;</span><span class="p">]</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;scale_factor_at_central_meridian&#39;</span><span class="p">]</span>

            <span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">TransverseMercator</span><span class="p">(</span><span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
                                                <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
                                                <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                                                <span class="n">central_latitude</span><span class="o">=</span><span class="n">central_latitude</span><span class="p">,</span>
                                                <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">)</span>

            <span class="c1"># Extract the axes and data</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">transform</span><span class="p">}</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">two_d</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bound</span><span class="p">:</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Find x box boundaries</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

                <span class="c1"># Find y box boundaries</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
    
            <span class="c1"># Shift lon grid if needed</span>
            <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                <span class="c1"># Extract upper bound and original rhs of box longitude bounding points</span>
                <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Reduce xpts and ypts by 1 or shifting of grid fails</span>
                <span class="c1"># The last points are the right / upper bounds for the last data box</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span> <span class="o">-</span> <span class="mi">360</span>
                <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span> <span class="o">+</span> <span class="mi">360</span>

                <span class="c1"># Add cyclic information if missing.</span>
                <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span> <span class="ow">and</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span><span class="p">:</span>
                    <span class="c1"># field, xpts = cartopy_util.add_cyclic_point(field, xpts)</span>
                    <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

                <span class="n">right_bound</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

                <span class="c1"># Add end x and y end points</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">right_bound</span><span class="p">)</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">two_d</span><span class="p">:</span>
            <span class="c1"># 2D lons and lats code</span>
            <span class="k">if</span> <span class="n">fast</span><span class="p">:</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
    
                        <span class="c1"># Calculate the local size difference and set the square points</span>
                        <span class="k">if</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="n">nx</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                            <span class="n">xdiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">xdiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                            
                        <span class="k">if</span> <span class="n">iy</span> <span class="o">&lt;</span> <span class="n">ny</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">ydiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ydiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                            
                        <span class="n">xpts</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">xdiff</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">+</span><span class="n">xdiff</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">+</span><span class="n">xdiff</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">xdiff</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">xdiff</span><span class="p">]</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">ydiff</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">ydiff</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">+</span><span class="n">ydiff</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">+</span><span class="n">ydiff</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">ydiff</span><span class="p">]</span>
        
        
                        <span class="c1"># Plot the square</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>\
                                                 <span class="p">[[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ypts</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>\
                                                 <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">ypts</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">4</span><span class="p">]]],</span>\
                                                 <span class="n">facecolor</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">colarr</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">])],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>\
                                                 <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()))</span>       
                                                     
                <span class="k">return</span>
               
                
   
            
    <span class="c1"># Polar stereographic</span>
    <span class="c1"># Set points past plotting limb to be plotvars.boundinglat</span>
    <span class="c1"># Also set any lats past the pole to be the pole</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&gt;</span> <span class="mf">90.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="mf">90.0</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">90.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.0</span>



    <span class="c1"># Set the transform if not supplied to bfill</span>
    <span class="k">if</span> <span class="n">transform</span><span class="p">:</span>
        <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>


    <span class="k">if</span> <span class="n">fast</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="kc">False</span>
                 
         
        <span class="k">if</span> <span class="n">two_d</span><span class="p">:</span>
             <span class="c1"># Plot using pcolormesh if a 2D grid </span>
             <span class="c1">#field = f</span>
             <span class="n">fixed_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
             <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)):</span>
                 <span class="n">fixed_x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">start</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+=</span> <span class="mi">360</span>
             <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">fixed_x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

            
        <span class="k">else</span><span class="p">:</span>         
            <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xpts</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xpts</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>     

                        
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>        
    
    <span class="k">else</span><span class="p">:</span>
    
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">allverts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">xy_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">colarr</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xy_stack</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">ix</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">iy</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">]]</span>
                    <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]]</span>

                    <span class="n">txpts</span><span class="p">,</span> <span class="n">typts</span> <span class="o">=</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span>
                    <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                        <span class="p">]</span>

                    <span class="n">allverts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

                <span class="c1"># Make the collection and add it to the plot.</span>
                <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">single_fill_color</span>
                <span class="n">coll</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span><span class="n">allverts</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                      <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>

                <span class="n">allverts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">xy_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">colarr</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xy_stack</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">ix</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">iy</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                        <span class="p">]</span>

                    <span class="n">allverts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

                <span class="c1"># Make the collection and add it to the plot.</span>
                <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">single_fill_color</span>

                <span class="n">coll</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span><span class="n">allverts</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                      <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>




                <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>

        <span class="c1"># Add white for undefined areas</span>
        <span class="k">if</span> <span class="n">white</span><span class="p">:</span>
            <span class="n">allverts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xy_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">colarr</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xy_stack</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">ix</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">iy</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                    <span class="p">]</span>

                <span class="n">allverts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

            <span class="c1"># Make the collection and add it to the plot.</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">coll</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span><span class="n">allverts</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span>
                                  <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">bfill_orig</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
          <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">single_fill_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">white</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">fast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
          <span class="n">orca</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | bfill - block fill a field with colour rectangles</span>
<span class="sd">     | This is an internal routine and is not generally used by the user.</span>
<span class="sd">     |</span>
<span class="sd">     | f=None - field</span>
<span class="sd">     | x=None - x points for field</span>
<span class="sd">     | y=None - y points for field</span>
<span class="sd">     | clevs=None - levels for filling</span>
<span class="sd">     | lonlat=None - longitude and latitude data</span>
<span class="sd">     | bound=False - x and y are cf data boundaries</span>
<span class="sd">     | alpha=alpha - transparency setting 0 to 1</span>
<span class="sd">     | white=True - colour unplotted areas white</span>
<span class="sd">     | single_fill_color=None - colour for a blockfill between two levels</span>
<span class="sd">     |                        - makes maplotlib named colours or</span>
<span class="sd">     |                        - hexadecimal notation - &#39;#d3d3d3&#39; for grey</span>
<span class="sd">     | zorder=4 - plotting order</span>
<span class="sd">     | fast=None - use fast plotting with pcolormesh which is useful for larger datasets</span>
<span class="sd">     | transform=False - map transform supplied by calling routine</span>
<span class="sd">     | orca=False - data is orca data</span>
<span class="sd">     |</span>
<span class="sd">      :Returns:</span>
<span class="sd">        None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    

    <span class="c1"># Set lonlat if not specified</span>
    <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># If single_fill_color is defined then turn off whiting out the background.</span>
    <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">white</span> <span class="o">=</span> <span class="kc">False</span>
        
    <span class="c1"># Set 2D lon lat if data is that format</span>
    <span class="n">two_d</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">two_d</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Set the default map coordinates for the data to be PlateCarree</span>
    <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
        <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()}</span>


    <span class="c1"># Set the field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">array</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>
        
        
    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">clevs</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>        
        
    <span class="c1"># Generate a Matplotlib colour map</span>
    <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">single_fill_color</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>


    <span class="n">levels_orig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">levels</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1e30</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
            <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">levels</span><span class="p">,</span> <span class="mf">1e30</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">cols</span> <span class="o">=</span> <span class="n">cols</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>



    <span class="c1"># Colour array for storing the cell colour.  Start with -1 as the default</span>
    <span class="c1"># as the colours run from 0 to np.size(levels)-1</span>
    <span class="n">colarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span><span class="o">-</span><span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">lev</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">field</span> <span class="o">&gt;=</span> <span class="n">lev</span><span class="p">,</span> <span class="n">field</span> <span class="o">&lt;</span> <span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">colarr</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># Change points that are masked back to -1</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">colarr</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>
        
        
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:transverse_mercator&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Case of transverse mercator of which UKCP is an example</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:transverse_mercator&#39;</span><span class="p">)</span>
            <span class="n">false_easting</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;false_easting&#39;</span><span class="p">]</span>
            <span class="n">false_northing</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;false_northing&#39;</span><span class="p">]</span>
            <span class="n">central_longitude</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;longitude_of_central_meridian&#39;</span><span class="p">]</span>
            <span class="n">central_latitude</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;latitude_of_projection_origin&#39;</span><span class="p">]</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s1">&#39;scale_factor_at_central_meridian&#39;</span><span class="p">]</span>

            <span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">TransverseMercator</span><span class="p">(</span><span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
                                                <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
                                                <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                                                <span class="n">central_latitude</span><span class="o">=</span><span class="n">central_latitude</span><span class="p">,</span>
                                                <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">)</span>

            <span class="c1"># Extract the axes and data</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">transform</span><span class="p">}</span>

    <span class="k">else</span><span class="p">:</span>
    
        <span class="k">if</span> <span class="n">orca</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        
        
            <span class="c1"># Assign f to field as this may be modified in lat-lon plots</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>

            <span class="k">if</span> <span class="n">two_d</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">bound</span><span class="p">:</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Find x box boundaries</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
                    <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

                    <span class="c1"># Find y box boundaries</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
                    <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
    
                <span class="c1"># Shift lon grid if needed</span>
                <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                    <span class="c1"># Extract upper bound and original rhs of box longitude bounding points</span>
                    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                    <span class="c1"># Reduce xpts and ypts by 1 or shifting of grid fails</span>
                    <span class="c1"># The last points are the right / upper bounds for the last data box</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span> <span class="o">-</span> <span class="mi">360</span>
                    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span> <span class="o">+</span> <span class="mi">360</span>

                    <span class="c1"># Add cyclic information if missing.</span>
                    <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span> <span class="ow">and</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span><span class="p">:</span>
                        <span class="c1"># field, xpts = cartopy_util.add_cyclic_point(field, xpts)</span>
                        <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

                    <span class="n">right_bound</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

                    <span class="c1"># Add end x and y end points</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">right_bound</span><span class="p">)</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># 2D lons and lats code</span>
                <span class="n">nx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ny</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
    
                        <span class="c1"># Calculate the local size difference and set the square points</span>
                        <span class="k">if</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="n">nx</span> <span class="o">-</span><span class="mi">2</span><span class="p">:</span>
                            <span class="n">xdiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">xdiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                            
                        <span class="k">if</span> <span class="n">iy</span> <span class="o">&lt;</span> <span class="n">ny</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">ydiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ydiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                            
                        <span class="n">xpts</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">xdiff</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">+</span><span class="n">xdiff</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">+</span><span class="n">xdiff</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">xdiff</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">xdiff</span><span class="p">]</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">ydiff</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">ydiff</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">+</span><span class="n">ydiff</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">+</span><span class="n">ydiff</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">ydiff</span><span class="p">]</span>
        
        
                        <span class="c1"># Plot the square</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">mpatches</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>\
                                                 <span class="p">[[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">ypts</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>\
                                                 <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span><span class="n">ypts</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span> <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">4</span><span class="p">]]],</span>\
                                                 <span class="n">facecolor</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">colarr</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span><span class="n">ix</span><span class="p">])],</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>\
                                                 <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()))</span>       
                                                     
                <span class="k">return</span>
               
                
   
            
    <span class="c1"># Polar stereographic</span>
    <span class="c1"># Set points past plotting limb to be plotvars.boundinglat</span>
    <span class="c1"># Also set any lats past the pole to be the pole</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">orca</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&gt;</span> <span class="mf">90.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="mf">90.0</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">orca</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">90.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.0</span>



    <span class="c1"># Set the transform if not supplied to bfill</span>
    <span class="k">if</span> <span class="n">transform</span><span class="p">:</span>
        <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>


    <span class="k">if</span> <span class="n">fast</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="kc">False</span>
                 
         
        <span class="k">if</span> <span class="n">orca</span><span class="p">:</span>
             <span class="c1"># Plot using pcolormesh if an orca grid </span>
             <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>
             <span class="n">fixed_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
             <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)):</span>
                 <span class="n">fixed_x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">start</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+=</span> <span class="mi">360</span>
                   
             <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">fixed_x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">)</span>

            
        <span class="k">else</span><span class="p">:</span>         
            <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xpts</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xpts</span><span class="o">+</span><span class="n">offset</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>     

                        
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>        
    
    <span class="k">else</span><span class="p">:</span>
    
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">allverts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">xy_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">colarr</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xy_stack</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">ix</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">iy</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">]]</span>
                    <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span><span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]]</span>

                    <span class="n">txpts</span><span class="p">,</span> <span class="n">typts</span> <span class="o">=</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span>
                    <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                        <span class="p">]</span>

                    <span class="n">allverts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

                <span class="c1"># Make the collection and add it to the plot.</span>
                <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">single_fill_color</span>
                <span class="n">coll</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span><span class="n">allverts</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                                      <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>

                <span class="n">allverts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">xy_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">colarr</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xy_stack</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">ix</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">iy</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                        <span class="p">]</span>

                    <span class="n">allverts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

                <span class="c1"># Make the collection and add it to the plot.</span>
                <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">single_fill_color</span>

                <span class="n">coll</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span><span class="n">allverts</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                      <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>




                <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>

        <span class="c1"># Add white for undefined areas</span>
        <span class="k">if</span> <span class="n">white</span><span class="p">:</span>
            <span class="n">allverts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xy_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">colarr</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xy_stack</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">ix</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">iy</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                    <span class="p">]</span>

                <span class="n">allverts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

            <span class="c1"># Make the collection and add it to the plot.</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">coll</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span><span class="n">allverts</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;#ffffff&#39;</span><span class="p">,</span>
                                  <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
                
                
                
                
<div class="viewcode-block" id="regrid">
<a class="viewcode-back" href="../regrid.html#cfplot.regrid">[docs]</a>
<span class="k">def</span> <span class="nf">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | regrid - bilinear interpolation of a grid to new grid locations</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |     f=None - original field</span>
<span class="sd">     |     x=None - original field x values</span>
<span class="sd">     |     y=None - original field y values</span>
<span class="sd">     |     xnew=None - new x points</span>
<span class="sd">     |     ynew=None - new y points</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">        field values at requested locations</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Copy input arrays</span>
    <span class="n">regrid_f</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">regrid_x</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">regrid_y</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">fieldout</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Reverse xpts and field if necessary</span>
    <span class="k">if</span> <span class="n">regrid_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">regrid_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">regrid_x</span> <span class="o">=</span> <span class="n">regrid_x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">regrid_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">regrid_f</span><span class="p">)</span>

    <span class="c1"># Reverse ypts and field if necessary</span>
    <span class="k">if</span> <span class="n">regrid_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">regrid_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">regrid_y</span> <span class="o">=</span> <span class="n">regrid_y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">regrid_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">regrid_f</span><span class="p">)</span>

    <span class="c1"># Iterate over the new grid to get the new grid values.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xnew</span><span class="p">)):</span>

        <span class="n">xval</span> <span class="o">=</span> <span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">yval</span> <span class="o">=</span> <span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Find position of new grid point in the x and y arrays</span>
        <span class="n">myxpos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">regrid_x</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">xval</span><span class="p">)</span>
        <span class="n">myypos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">regrid_y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">yval</span><span class="p">)</span>

        <span class="n">myxpos2</span> <span class="o">=</span> <span class="n">myxpos</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">myypos2</span> <span class="o">=</span> <span class="n">myypos</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">myxpos2</span> <span class="o">!=</span> <span class="n">myxpos</span><span class="p">):</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">])</span> <span class="o">/</span> \
                <span class="p">(</span><span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos2</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1E-30</span>

        <span class="n">newval1</span> <span class="o">=</span> <span class="p">(</span><span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span> <span class="n">myxpos2</span><span class="p">])</span>
        <span class="n">newval1</span> <span class="o">=</span> <span class="n">newval1</span> <span class="o">*</span> <span class="n">alpha</span>
        <span class="n">newval1</span> <span class="o">=</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">newval1</span>

        <span class="n">newval2</span> <span class="o">=</span> <span class="p">(</span><span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span> <span class="n">myxpos2</span><span class="p">])</span>
        <span class="n">newval2</span> <span class="o">=</span> <span class="n">newval2</span> <span class="o">*</span> <span class="n">alpha</span>
        <span class="n">newval2</span> <span class="o">=</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">newval2</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">myypos2</span> <span class="o">!=</span> <span class="n">myypos</span><span class="p">):</span>
            <span class="n">alpha2</span> <span class="o">=</span> <span class="p">(</span><span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">])</span>
            <span class="n">alpha2</span> <span class="o">=</span> <span class="n">alpha2</span> <span class="o">/</span> <span class="p">(</span><span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos2</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha2</span> <span class="o">=</span> <span class="p">(</span><span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1E-30</span>

        <span class="n">newval3</span> <span class="o">=</span> <span class="n">newval1</span> <span class="o">-</span> <span class="p">(</span><span class="n">newval1</span> <span class="o">-</span> <span class="n">newval2</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha2</span>

        <span class="n">fieldout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fieldout</span><span class="p">,</span> <span class="n">newval3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fieldout</span></div>



<div class="viewcode-block" id="stipple">
<a class="viewcode-back" href="../stipple.html#cfplot.stipple">[docs]</a>
<span class="k">def</span> <span class="nf">stipple</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | stipple - put markers on a plot to indicate value of interest</span>
<span class="sd">     |</span>
<span class="sd">     | f=None - cf field or field</span>
<span class="sd">     | x=None - x points for field</span>
<span class="sd">     | y=None - y points for field</span>
<span class="sd">     | min=None - minimum threshold for stipple</span>
<span class="sd">     | max=None - maximum threshold for stipple</span>
<span class="sd">     | size=80 - default size for stipples</span>
<span class="sd">     | color=&#39;k&#39; - default colour for stipples</span>
<span class="sd">     | pts=50 - number of points in the x direction</span>
<span class="sd">     | marker=&#39;.&#39; - default marker for stipples</span>
<span class="sd">     | edegecolors=&#39;k&#39; - outline colour</span>
<span class="sd">     | alpha=1.0 - transparency setting - default is off</span>
<span class="sd">     | ylog=False - set to True if a log pressure stipple plot</span>
<span class="sd">     |              is required</span>
<span class="sd">     | zorder=2 - plotting order</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">        None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> stipple error - only X-Y, X-Z and Y-Z </span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;stipple supported at the present time</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;Please raise a feature request if you see this error.</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Extract required data for contouring</span>
    <span class="c1"># If a cf-python field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> \
            <span class="n">ypole</span> <span class="o">=</span> <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t plot a field list&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>  <span class="c1"># field data passed in as f</span>
        <span class="n">check_data</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Cylindrical projection</span>
        <span class="c1"># Add cyclic information if missing.</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
            <span class="c1"># field, xpts = cartopy_util.add_cyclic_point(field, xpts)</span>
            <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

        <span class="c1">#if plotvars.proj == &#39;cyl&#39;:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span> <span class="s1">&#39;robin&#39;</span><span class="p">,</span> <span class="s1">&#39;merc&#39;</span><span class="p">,</span> <span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="s1">&#39;moll&#39;</span><span class="p">]:</span>        
            <span class="c1"># Calculate interpolation points</span>
            <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
                                        <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
                                        <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span>
                                        <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span>
                                        <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="c1"># Calculate points in map space</span>
            <span class="n">xnew_map</span> <span class="o">=</span> <span class="n">xnew</span>
            <span class="n">ynew_map</span> <span class="o">=</span> <span class="n">ynew</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
            <span class="c1"># Calculate interpolation points</span>
            <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">xnew_map</span><span class="p">,</span> <span class="n">ynew_map</span> <span class="o">=</span> <span class="n">polar_regular_grid</span><span class="p">()</span>
            <span class="c1"># Convert longitudes to be 0 to 360</span>
            <span class="c1"># negative longitudes are incorrectly regridded in polar stereographic projection</span>
            <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xnew</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>

        <span class="c1"># Flip data if a lat-height plot and lats start at the north pole</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xpts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

        <span class="c1"># Calculate interpolation points</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylog</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ymin</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ymax</span><span class="p">)</span>

        <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
                                    <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
                                    <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                                    <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                                    <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ylog</span><span class="p">:</span>
            <span class="n">ynew</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">ynew</span>

    <span class="c1"># Get values at the new points</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>

    <span class="c1"># Work out which of the points are valid</span>
    <span class="n">valid_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">min</span> <span class="ow">and</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">:</span>
            <span class="n">valid_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_points</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">valid_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span> <span class="n">ynew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span>
                                   <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                                   <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">,</span>
                                   <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span> <span class="n">ynew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span>
                              <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                              <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">,</span>
                              <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span></div>



<div class="viewcode-block" id="stipple_points">
<a class="viewcode-back" href="../stipple_points.html#cfplot.stipple_points">[docs]</a>
<span class="k">def</span> <span class="nf">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | stipple_points - calculate interpolation points</span>
<span class="sd">     |</span>
<span class="sd">     | xmin=None - plot x minimum</span>
<span class="sd">     | ymax=None - plot x maximum</span>
<span class="sd">     | ymin=None - plot y minimum</span>
<span class="sd">     | ymax=None - plot x maximum</span>
<span class="sd">     | pts=None -  number of points in the x and y directions</span>
<span class="sd">     |             one number gives the same in both directions</span>
<span class="sd">     |</span>
<span class="sd">     | stype=None - type of grid.  1=regular, 2=offset</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">        stipple locations in x and y</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Work out number of points in x and y directions</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pts_x</span> <span class="o">=</span> <span class="n">pts</span>
        <span class="n">pts_y</span> <span class="o">=</span> <span class="n">pts</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">pts_x</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pts_y</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Create regularly spaced points</span>
    <span class="n">xstep</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">pts_x</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span> <span class="o">+</span> <span class="n">xstep</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xstep</span> <span class="o">/</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span>

    <span class="n">x2</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span> <span class="o">+</span> <span class="n">xstep</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xstep</span> <span class="o">/</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span>

    <span class="n">ystep</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">pts_y</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">ymin</span> <span class="o">+</span> <span class="n">ystep</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ystep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ymax</span> <span class="o">-</span> <span class="n">ystep</span> <span class="o">/</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ystep</span><span class="p">)</span>

    <span class="c1"># Create interpolation points</span>
    <span class="n">xnew</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ynew</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">iy</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">y1</span><span class="p">:</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>
            <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ynew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">iy</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>
                <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ynew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iy</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x2</span><span class="p">))</span>
                <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ynew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span></div>



<div class="viewcode-block" id="find_pos_in_array">
<a class="viewcode-back" href="../find_pos_in_array.html#cfplot.find_pos_in_array">[docs]</a>
<span class="k">def</span> <span class="nf">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | find_pos_in_array - find the position of a point in an array</span>
<span class="sd">     |</span>
<span class="sd">     | vals - array values</span>
<span class="sd">     | val - value to find position of</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">       position in array</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">myval</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">myval</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">above</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">myval</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">myval</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">pos</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">pos</span></div>



<div class="viewcode-block" id="vect">
<a class="viewcode-back" href="../vect.html#cfplot.vect">[docs]</a>
<span class="k">def</span> <span class="nf">vect</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">key_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">key_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">magmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">headlength</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">headaxislength</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
         <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;middle&#39;</span><span class="p">,</span> <span class="n">key_location</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06</span><span class="p">],</span> <span class="n">key_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
         <span class="n">xaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
         <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | vect - plot vectors</span>
<span class="sd">     |</span>
<span class="sd">     | u=None - u wind</span>
<span class="sd">     | v=None - v wind</span>
<span class="sd">     | x=None - x locations of u and v</span>
<span class="sd">     | y=None - y locations of u and v</span>
<span class="sd">     | scale=None - data units per arrow length unit.  A smaller values gives</span>
<span class="sd">     |              a larger vector. Generally takes one value but in the case</span>
<span class="sd">     |              of two supplied values the second vector scaling applies to</span>
<span class="sd">     |              the v field.</span>
<span class="sd">     | stride=None - plot vector every stride points. Can take two values one</span>
<span class="sd">     |               for x and one for y.</span>
<span class="sd">     | pts=None - use bilinear interpolation to interpolate vectors onto a new</span>
<span class="sd">     |            grid - takes one or two values.</span>
<span class="sd">     |            If one value is passed then this is used for both the x and</span>
<span class="sd">     |            y axes.</span>
<span class="sd">     | magmin=None - don&#39;t plot any vects with less than this magnitude.</span>
<span class="sd">     | key_length=None - length of the key.  Generally takes one value but in</span>
<span class="sd">     |                   the case of two supplied values the second vector</span>
<span class="sd">     |                   scaling applies to the v field.</span>
<span class="sd">     | key_label=None - label for the key. Generally takes one value but in the</span>
<span class="sd">     |                  case of two supplied values the second vector scaling</span>
<span class="sd">     |                  applies to the v field.</span>
<span class="sd">     | key_location=[0.9, -0.06] - location of the vector key relative to the</span>
<span class="sd">     |                             plot in normalised coordinates.</span>
<span class="sd">     | key_show=True - draw the key.  Set to False if not required.</span>
<span class="sd">     | ptype=0 - plot type - not needed for cf fields.</span>
<span class="sd">     |                       0 = no specific plot type,</span>
<span class="sd">     |                       1 = longitude-latitude,</span>
<span class="sd">     |                       2 = latitude - height,</span>
<span class="sd">     |                       3 = longitude - height,</span>
<span class="sd">     |                       4 = latitude - time,</span>
<span class="sd">     |                       5 = longitude - time</span>
<span class="sd">     |                       6 = rotated pole</span>
<span class="sd">     |</span>
<span class="sd">     | title=None - plot title</span>
<span class="sd">     | width=0.005 - shaft width in arrow units; default is 0.005 times the</span>
<span class="sd">     |               width of the plot</span>
<span class="sd">     | headwidth=3 - head width as multiple of shaft width, default is 3</span>
<span class="sd">     | headlength=5 - head length as multiple of shaft width, default is 5</span>
<span class="sd">     | headaxislength=4.5 - head length at shaft intersection, default is 4.5</span>
<span class="sd">     | pivot=&#39;middle&#39; - the part of the arrow that is at the grid point; the</span>
<span class="sd">     |                  arrow rotates about this point</span>
<span class="sd">                        takes &#39;tail&#39;, &#39;middle&#39;, &#39;tip&#39;</span>
<span class="sd">     | axes=True - plot x and y axes</span>
<span class="sd">     | xaxis=True - plot xaxis</span>
<span class="sd">     | yaxis=True - plot y axis</span>
<span class="sd">     | xticks=None - xtick positions</span>
<span class="sd">     | xticklabels=None - xtick labels</span>
<span class="sd">     | yticks=None - y tick positions</span>
<span class="sd">     | yticklabels=None - ytick labels</span>
<span class="sd">     | xlabel=None - label for x axis</span>
<span class="sd">     | ylabel=None - label for y axis</span>
<span class="sd">     | ylog=False - log y axis</span>
<span class="sd">     | color=&#39;k&#39; - colour for the vectors - default is black.</span>
<span class="sd">     | zorder=3 - plotting order</span>
<span class="sd">     | titles=None - generate dimension and cell_methods titles for plot</span>
<span class="sd">     | alpha=1.0 - transparency setting.  The default is no transparency.</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If the vector color is white set the quicker key colour to black</span>
    <span class="c1"># so that it can be seen</span>
    <span class="n">qkey_color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">if</span> <span class="n">qkey_color</span> <span class="o">==</span> <span class="s1">&#39;w&#39;</span> <span class="ow">or</span> <span class="n">qkey_color</span> <span class="o">==</span> <span class="s1">&#39;white&#39;</span><span class="p">:</span>
        <span class="n">qkey_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>

    <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
    <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
    <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
    <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="c1"># ylog=plotvars.ylog</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
    <span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span>
    <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title_fontsize</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">resolution_orig</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span>

    <span class="c1"># Set potential user axis labels</span>
    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>

    <span class="n">rotated_vect</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:rotated_latitude_longitude&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">rotated_vect</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Extract required data</span>
    <span class="c1"># If a cf-python field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

        <span class="c1"># Check data is 2D</span>
        <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndims</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.vect error need a 2 dimensonal u field to make vectors</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;received &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ndims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimension</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> \
            <span class="n">ypole</span> <span class="o">=</span> <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">rotated_vect</span><span class="o">=</span><span class="n">rotated_vect</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t plot a field list&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># field=f #field data passed in as f</span>
        <span class="n">check_data</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">u_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">u_x</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">u_y</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

        <span class="c1"># Check data is 2D</span>
        <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndims</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.vect error need a 2 dimensonal v field to make vectors</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;received &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ndims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimension</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> \
            <span class="n">ypole</span> <span class="o">=</span> <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">rotated_vect</span><span class="o">=</span><span class="n">rotated_vect</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t plot a field list&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># field=f #field data passed in as f</span>
        <span class="n">check_data</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">v_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">v_x</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># If a minimum magnitude is specified mask these data points</span>
    <span class="k">if</span> <span class="n">magmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_data</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v_data</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mag</span> <span class="o">&lt;=</span> <span class="n">magmin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">u_data</span><span class="p">[</span><span class="n">invalid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">v_data</span><span class="p">[</span><span class="n">invalid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Reset xlabel and ylabel values with user defined labels in specified</span>
    <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
    <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>

    <span class="c1"># Retrieve any user defined axis labels</span>
    <span class="k">if</span> <span class="n">xlabel</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">xticks</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">yticks</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_data</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span>

    <span class="k">if</span> <span class="n">key_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">key_length</span> <span class="o">=</span> <span class="n">scale</span>

    <span class="c1"># Calculate a set of dimension titles if requested</span>
    <span class="k">if</span> <span class="n">titles</span><span class="p">:</span> 
        <span class="n">title_dims</span> <span class="o">=</span> <span class="n">generate_titles</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">title_dims</span> <span class="o">=</span> <span class="s1">&#39;u</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">title_dims</span>
        <span class="n">title_dims2</span> <span class="o">=</span> <span class="n">generate_titles</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">title_dims2</span> <span class="o">=</span> <span class="s1">&#39;v</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">title_dims2</span>


    <span class="c1"># Open a new plot if necessary</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Call gpos(1) if not already called</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Set plot type if user specified</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">ptype</span>

    <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
    <span class="n">latrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Set up mapping</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">and</span> <span class="n">latrange</span> <span class="o">&gt;</span> <span class="mi">170</span><span class="p">)</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">set_map</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span> <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                   <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span> <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                   <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">)</span>
            <span class="n">set_map</span><span class="p">()</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>

        <span class="c1"># u_data, u_x = cartopy_util.add_cyclic_point(u_data, u_x)</span>
        <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span><span class="p">)</span>
        <span class="c1"># v_data, v_x = cartopy_util.add_cyclic_point(v_data, v_x)</span>
        <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span><span class="p">)</span>

    <span class="c1"># stride data points to reduce vector density</span>
    <span class="k">if</span> <span class="n">stride</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xstride</span> <span class="o">=</span> <span class="n">stride</span>
            <span class="n">ystride</span> <span class="o">=</span> <span class="n">stride</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">xstride</span> <span class="o">=</span> <span class="n">stride</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ystride</span> <span class="o">=</span> <span class="n">stride</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">u_x</span> <span class="o">=</span> <span class="n">u_x</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">xstride</span><span class="p">]</span>
        <span class="n">u_y</span> <span class="o">=</span> <span class="n">u_y</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">ystride</span><span class="p">]</span>
        <span class="n">u_data</span> <span class="o">=</span> <span class="n">u_data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">ystride</span><span class="p">,</span> <span class="mi">0</span><span class="p">::</span><span class="n">xstride</span><span class="p">]</span>
        <span class="n">v_data</span> <span class="o">=</span> <span class="n">v_data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">ystride</span><span class="p">,</span> <span class="mi">0</span><span class="p">::</span><span class="n">xstride</span><span class="p">]</span>

    <span class="c1"># Map vectors</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

        <span class="c1"># Fix for high latitude vectors as described at https://github.com/SciTools/cartopy/issues/1179</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
            <span class="n">u_src_crs</span> <span class="o">=</span> <span class="n">u_data</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u_y</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">v_src_crs</span> <span class="o">=</span> <span class="n">v_data</span>
            <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_data</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v_data</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">magn_src_crs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_src_crs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v_src_crs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">u_data</span> <span class="o">=</span> <span class="n">u_src_crs</span> <span class="o">*</span> <span class="n">magnitude</span> <span class="o">/</span> <span class="n">magn_src_crs</span>
            <span class="n">v_data</span> <span class="o">=</span> <span class="n">v_src_crs</span> <span class="o">*</span> <span class="n">magnitude</span> <span class="o">/</span> <span class="n">magn_src_crs</span>



        <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_data</span><span class="p">,</span> <span class="n">v_data</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                                         <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span>
                                         <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                         <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                         <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
                                         <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
                <span class="c1"># **cartopy 0.16 fix for longitide points in cylindrical projection</span>
                <span class="c1"># when regridding to a number of points</span>
                <span class="c1"># Make points within the plotting region</span>
                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u_x</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">u_x</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lonmax</span><span class="p">:</span>
                        <span class="n">u_x</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_x</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span><span class="o">-</span><span class="mi">360</span>

            <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_data</span><span class="p">,</span> <span class="n">v_data</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                                         <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span>
                                         <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                         <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                         <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                         <span class="n">regrid_shape</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
                                         <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Make key_label if none exists</span>
        <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">key_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
            <span class="n">key_label</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">quiv</span><span class="p">,</span> <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">key_length</span><span class="p">,</span>
                                     <span class="n">key_label</span><span class="p">,</span> <span class="n">labelpos</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="n">qkey_color</span><span class="p">,</span>
                                     <span class="n">fontproperties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">)},</span>
                                     <span class="n">coordinates</span><span class="o">=</span><span class="s1">&#39;axes&#39;</span><span class="p">)</span>

        <span class="c1"># axes</span>
        <span class="n">plot_map_axes</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                      <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                      <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                      <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span> <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
                      <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Coastlines</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
        <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span>
        <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
        <span class="k">if</span> <span class="n">continent_linestyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="s1">&#39;solid&#39;</span>

        <span class="n">feature</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;land&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;physical&#39;</span><span class="p">,</span>
                                               <span class="n">scale</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                                               <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">continent_color</span><span class="p">,</span>
                          <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
                          <span class="n">linestyle</span><span class="o">=</span><span class="n">continent_linestyle</span><span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">titles_con_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">,</span> <span class="n">title2</span><span class="o">=</span><span class="n">title_dims2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dim_titles</span><span class="p">(</span><span class="n">title2</span><span class="o">=</span><span class="n">title_dims</span><span class="p">,</span> <span class="n">title3</span><span class="o">=</span><span class="n">title_dims2</span><span class="p">)</span>


    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s1">&#39;grid_mapping_name:rotated_latitude_longitude&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

            <span class="c1"># Set up mapping</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">and</span> <span class="n">latrange</span> <span class="o">&gt;</span> <span class="mi">170</span><span class="p">)</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">set_map</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span> <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                       <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span> <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                       <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">)</span>
                <span class="n">set_map</span><span class="p">()</span>

            <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_data</span><span class="p">,</span> <span class="n">v_data</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
                                         <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span>
                                         <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                         <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                         <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

            <span class="c1"># Make key_label if none exists</span>
            <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">key_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="n">key_label</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">quiv</span><span class="p">,</span> <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                         <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                         <span class="n">key_length</span><span class="p">,</span>
                                         <span class="n">key_label</span><span class="p">,</span> <span class="n">labelpos</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span>
                                         <span class="n">color</span><span class="o">=</span><span class="n">qkey_color</span><span class="p">,</span>
                                         <span class="n">fontproperties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">)},</span>
                                         <span class="n">coordinates</span><span class="o">=</span><span class="s1">&#39;axes&#39;</span><span class="p">)</span>

            <span class="c1"># Axes on the native grid</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;rotated&#39;</span><span class="p">:</span>
                <span class="n">rgaxes</span><span class="p">(</span><span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                       <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                       <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                       <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                       <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
                <span class="n">plot_map_axes</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                              <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                              <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                              <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span> <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
                              <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

            <span class="c1"># Title</span>
            <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>


            <span class="c1"># Titles for dimensions</span>
            <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
                <span class="n">dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">,</span> <span class="n">titles2</span><span class="o">=</span><span class="n">dim_titles2</span><span class="p">)</span>



    <span class="c1">######################################</span>
    <span class="c1"># Latitude or longitude vs height plot</span>
    <span class="c1">######################################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Program selected data plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">80</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
                    <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
                <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
                    <span class="n">xmax</span> <span class="o">=</span> <span class="mi">90</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ymin</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># User specified plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>

        <span class="n">ystep</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">):</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">==</span> <span class="mi">100000</span><span class="p">):</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">10000</span>

        <span class="n">ytype</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># pressure or similar y axis</span>
        <span class="k">if</span> <span class="s1">&#39;theta&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
            <span class="n">ytype</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s1">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">):</span>
            <span class="n">ytype</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span>
                <span class="n">ystep</span> <span class="o">=</span> <span class="mf">500.0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
                <span class="n">ystep</span> <span class="o">=</span> <span class="mf">1000.0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50000</span><span class="p">:</span>
                <span class="n">ystep</span> <span class="o">=</span> <span class="mf">10000.0</span>

        <span class="c1"># Set plot limits and draw axes</span>
        <span class="k">if</span> <span class="n">ylog</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ytype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span>
                    <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                    <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                    <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                    <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                    <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span>
                    <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                    <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                    <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                    <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                    <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

            <span class="c1"># Set default x-axis labels</span>
            <span class="n">lltype</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">lltype</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">llticks</span><span class="p">,</span> <span class="n">lllabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">lltype</span><span class="p">)</span>

            <span class="n">heightticks</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span>
                <span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span>
                <span class="n">mod</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">heightticks</span>

            <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">llticks</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="n">lllabels</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">lllabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">llticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">heightticks</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">llticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">llticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lllabels</span><span class="p">,</span>
                      <span class="n">yticks</span><span class="o">=</span><span class="n">heightticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">heightlabels</span><span class="p">,</span>
                      <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1"># Log y axis</span>
        <span class="k">if</span> <span class="n">ylog</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ymin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># reset zero mb/height input to a small value</span>
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                 <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                 <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                 <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                 <span class="n">ylog</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                 <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
            <span class="n">llticks</span><span class="p">,</span> <span class="n">lllabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                                        <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                                        <span class="nb">type</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">llticks</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="n">lllabels</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">lllabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">llticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">heightticks</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">axes_plot</span><span class="p">(</span>
                        <span class="n">xticks</span><span class="o">=</span><span class="n">llticks</span><span class="p">,</span>
                        <span class="n">xticklabels</span><span class="o">=</span><span class="n">lllabels</span><span class="p">,</span>
                        <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
                        <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">llticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lllabels</span><span class="p">,</span>
                              <span class="n">yticks</span><span class="o">=</span><span class="n">heightticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">heightlabels</span><span class="p">,</span>
                              <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

        <span class="c1"># Regrid the data if requested</span>
        <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span> <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                                        <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                                        <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ytype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Make y interpolation in log space as we have a pressure coordinate</span>
                <span class="n">u_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">u_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ynew</span><span class="p">))</span>
                <span class="n">v_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">v_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ynew</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">u_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>
                <span class="n">v_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">v_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>

            <span class="n">u_x</span> <span class="o">=</span> <span class="n">xnew</span>
            <span class="n">u_y</span> <span class="o">=</span> <span class="n">ynew</span>
            <span class="n">u_data</span> <span class="o">=</span> <span class="n">u_vals</span>
            <span class="n">v_data</span> <span class="o">=</span> <span class="n">v_vals</span>

        <span class="c1"># set scale and key lengths</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scale_u</span> <span class="o">=</span> <span class="n">scale</span>
            <span class="n">scale_v</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale_u</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">scale_v</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">key_length</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">key_length_u</span> <span class="o">=</span> <span class="n">key_length</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">key_length_v</span> <span class="o">=</span> <span class="n">key_length</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># scale v data</span>
            <span class="n">v_data</span> <span class="o">=</span> <span class="n">v_data</span> <span class="o">*</span> <span class="n">scale_u</span> <span class="o">/</span> <span class="n">scale_v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key_length_u</span> <span class="o">=</span> <span class="n">key_length</span>

        <span class="c1"># Plot the vectors</span>
        <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_data</span><span class="p">,</span> <span class="n">v_data</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span>
                                    <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale_u</span><span class="p">,</span>
                                    <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                    <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                    <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                                    <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

        <span class="c1"># Plot single key</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Single scale vector</span>
            <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length_u</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                    <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label_u</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">key_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">quiv</span><span class="p">,</span> <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                        <span class="n">key_length_u</span><span class="p">,</span> <span class="n">key_label_u</span><span class="p">,</span>
                                        <span class="n">labelpos</span><span class="o">=</span><span class="s1">&#39;W&#39;</span><span class="p">,</span>
                                        <span class="n">color</span><span class="o">=</span><span class="n">qkey_color</span><span class="p">,</span>
                                        <span class="n">fontproperties</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">)})</span>

        <span class="c1"># Plot two keys</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># translate from normalised units to plot units</span>
            <span class="n">xpos</span> <span class="o">=</span> <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">+</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">ypos</span> <span class="o">=</span> <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span> <span class="o">+</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>

            <span class="c1"># horizontal and vertical spacings for offsetting vector reference</span>
            <span class="c1"># text</span>
            <span class="n">xoffset</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
            <span class="n">yoffset</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>

            <span class="c1"># Assign key labels if necessary</span>
            <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length_u</span><span class="p">)</span>
                <span class="n">key_label_v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length_v</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                    <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label_u</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                    <span class="n">key_label_v</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label_v</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">v</span><span class="o">.</span><span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">key_label_v</span> <span class="o">=</span> <span class="n">supscr</span><span class="p">(</span><span class="n">key_label</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Plot reference vectors and keys</span>
            <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="n">key_length</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span>
                                     <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;tail&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span>
                                     <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                     <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                                     <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                     <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                     <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="n">qkey_color</span><span class="p">)</span>

                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span> <span class="n">ypos</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">key_length</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">pivot</span><span class="o">=</span><span class="s1">&#39;tail&#39;</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="s1">&#39;inches&#39;</span><span class="p">,</span>
                                     <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                                     <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                                     <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                                     <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                                     <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                     <span class="n">color</span><span class="o">=</span><span class="n">qkey_color</span><span class="p">)</span>

                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xpos</span><span class="p">,</span>
                                   <span class="n">ypos</span> <span class="o">+</span> <span class="n">yoffset</span><span class="p">,</span>
                                   <span class="n">key_label_u</span><span class="p">,</span>
                                   <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                                   <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xpos</span> <span class="o">-</span> <span class="n">xoffset</span><span class="p">,</span>
                                   <span class="n">ypos</span><span class="p">,</span>
                                   <span class="n">key_label_v</span><span class="p">,</span>
                                   <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                                   <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span>
                                    <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
                                    <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span><span class="p">,</span>
                                    <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>

            <span class="c1"># Titles for dimensions</span>
            <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
                <span class="n">dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">,</span> <span class="n">titles2</span><span class="o">=</span><span class="n">dim_titles2</span><span class="p">)</span>


    <span class="c1">##########</span>
    <span class="c1"># Save plot</span>
    <span class="c1">##########</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gset</span><span class="p">()</span>
        <span class="n">cscale</span><span class="p">()</span>
        <span class="n">gclose</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mapset</span><span class="p">()</span>
        <span class="n">mapset</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">)</span></div>



<div class="viewcode-block" id="set_map">
<a class="viewcode-back" href="../set_map.html#cfplot.set_map">[docs]</a>
<span class="k">def</span> <span class="nf">set_map</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | set_map - set map and write into plotvars.mymap</span>
<span class="sd">     |</span>
<span class="sd">     | No inputs</span>
<span class="sd">     | This is an internal routine and not used by the user</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    
    <span class="c1"># Return if mymap is already set</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>



    <span class="c1"># Set up mapping</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">lon_mid</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
    <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
    <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
    <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">)</span>

        <span class="c1"># Cartopy line plotting and identical left == right fix</span>

        <span class="k">if</span> <span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span> <span class="o">==</span> <span class="mf">360.0</span><span class="p">:</span>
            <span class="n">lonmax</span> <span class="o">=</span> <span class="n">lonmax</span> <span class="o">+</span> <span class="mf">0.01</span>


    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;merc&#39;</span><span class="p">:</span>
        <span class="n">min_latitude</span> <span class="o">=</span> <span class="o">-</span><span class="mf">80.0</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">min_latitude</span><span class="p">:</span>
            <span class="n">min_latitude</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
        <span class="n">max_latitude</span> <span class="o">=</span> <span class="mf">84.0</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">&lt;</span> <span class="n">max_latitude</span><span class="p">:</span>
            <span class="n">max_latitude</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span>
                             <span class="n">min_latitude</span><span class="o">=</span><span class="n">min_latitude</span><span class="p">,</span>
                             <span class="n">max_latitude</span><span class="o">=</span><span class="n">max_latitude</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">)</span>
        <span class="c1"># **cartopy 0.16 fix</span>
        <span class="c1"># Here we add in 0.01 to the longitude extent as this helps with plotting</span>
        <span class="c1"># lines and line labels</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="o">-</span><span class="mi">180</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">180.01</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">)</span>
        <span class="c1"># **cartopy 0.16 fix</span>
        <span class="c1"># Here we add in 0.01 to the longitude extent as this helps with plotting</span>
        <span class="c1"># lines and line labels</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="o">-</span><span class="mi">180</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="o">+</span><span class="mf">180.01</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;ortho&#39;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span>
                                 <span class="n">central_latitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lat_0</span><span class="p">)</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">180.0</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">180.01</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;moll&#39;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">)</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">180.0</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">180.01</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;robin&#39;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;lcc&#39;</span><span class="p">:</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">lon_0</span> <span class="o">=</span> <span class="n">lonmin</span><span class="o">+</span><span class="p">(</span><span class="n">lonmax</span><span class="o">-</span><span class="n">lonmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">lat_0</span> <span class="o">=</span> <span class="n">latmin</span><span class="o">+</span><span class="p">(</span><span class="n">latmax</span><span class="o">-</span><span class="n">latmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="o">-</span><span class="mi">40</span>
        <span class="k">if</span> <span class="n">lat_0</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cutoff</span> <span class="o">=</span> <span class="mi">40</span>

        <span class="n">standard_parallels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">latmin</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">latmax</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">standard_parallels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="o">-</span><span class="mi">33</span><span class="p">]</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">,</span>
                                     <span class="n">central_latitude</span><span class="o">=</span><span class="n">lat_0</span><span class="p">,</span>
                                     <span class="n">cutoff</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span> <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;rotated&#39;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;OSGB&#39;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">OSGB</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;EuroPP&#39;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">EuroPP</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;UKCP&#39;</span><span class="p">:</span>
        <span class="c1"># Special case of TransverseMercator for UKCP</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">TransverseMercator</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;TransverseMercator&#39;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">TransverseMercator</span><span class="p">()</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="o">-</span><span class="mf">180.0</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="o">+</span><span class="mf">180.01</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="kc">False</span>


    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;LambertCylindrical&#39;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertCylindrical</span><span class="p">()</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="kc">True</span>


    <span class="c1"># Add a plot containing the projection</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span><span class="p">:</span>
        <span class="n">delta_x</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span>
        <span class="n">delta_y</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span>
        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span><span class="p">,</span>
                                              <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span><span class="p">,</span>
                                              <span class="n">delta_x</span><span class="p">,</span> <span class="n">delta_y</span><span class="p">],</span>
                                              <span class="n">projection</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span>
                                                 <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
                                                 <span class="n">plotvars</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span>
                                                 <span class="n">projection</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>

    <span class="c1"># Set map extent</span>
    <span class="n">set_extent</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;OSGB&#39;</span><span class="p">,</span> <span class="s1">&#39;EuroPP&#39;</span><span class="p">,</span> <span class="s1">&#39;UKCP&#39;</span><span class="p">,</span> <span class="s1">&#39;robin&#39;</span><span class="p">,</span> <span class="s1">&#39;lcc&#39;</span><span class="p">]:</span>
        <span class="n">set_extent</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">extent</span> <span class="ow">and</span> <span class="n">set_extent</span><span class="p">:</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">latmin</span><span class="p">,</span> <span class="n">latmax</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># Set the scaling for PlateCarree</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">aspect</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;lcc&#39;</span><span class="p">:</span>
        <span class="c1"># Special case of lcc</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">latmin</span><span class="p">,</span> <span class="n">latmax</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;UKCP&#39;</span><span class="p">:</span>
        <span class="c1"># Special case of TransverseMercator for UKCP</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">61</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;EuroPP&#39;</span><span class="p">:</span>
        <span class="c1"># EuroPP somehow needs some limits setting.</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">75</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># Remove any plotvars.plot axes leaving just the plotvars.mymap axes</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

    <span class="c1"># Store map</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span> <span class="o">=</span> <span class="n">mymap</span></div>



<div class="viewcode-block" id="polar_regular_grid">
<a class="viewcode-back" href="../polar_regular_grid.html#cfplot.polar_regular_grid">[docs]</a>
<span class="k">def</span> <span class="nf">polar_regular_grid</span><span class="p">(</span><span class="n">pts</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | polar_regular_grid - return a regular grid over a polar</span>
<span class="sd">     |                      stereographic area</span>
<span class="sd">     |</span>
<span class="sd">     | pts=50 - number  of grid points in the x and y directions</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      lons, lats of grid in degrees</span>
<span class="sd">      x, y locations of lons and lats</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">boundinglat</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
        <span class="n">thisproj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">thisproj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>

    <span class="c1"># Find min and max of plotting region in device coordinates</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lon_0</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">+</span><span class="mi">90</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">+</span><span class="mi">180</span><span class="p">])</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">boundinglat</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">])</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">thisproj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

    <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">extent</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">extent</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">extent</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">extent</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Make up a stipple of points for cover the pole</span>
    <span class="n">points_device</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span>
        <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points_device</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">ynew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points_device</span><span class="p">)[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">points_polar</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">thisproj</span><span class="p">,</span> <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">)</span>

    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points_polar</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points_polar</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&gt;=</span> <span class="n">boundinglat</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&lt;=</span> <span class="n">boundinglat</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lons</span><span class="p">[</span><span class="n">valid</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">valid</span><span class="p">],</span> <span class="n">xnew</span><span class="p">[</span><span class="n">valid</span><span class="p">],</span> <span class="n">ynew</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span></div>



<div class="viewcode-block" id="cf_var_name">
<a class="viewcode-back" href="../cf_var_name.html#cfplot.cf_var_name">[docs]</a>
<span class="k">def</span> <span class="nf">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | cf_var_name - return the name from a supplied dimension</span>
<span class="sd">     |               in the following order</span>
<span class="sd">     |               ncvar</span>
<span class="sd">     |               short_name</span>
<span class="sd">     |               long_name</span>
<span class="sd">     |               standard_name</span>
<span class="sd">     |</span>
<span class="sd">     | field=None - field</span>
<span class="sd">     | dim=None - dimension required - &#39;dim0&#39;, &#39;dim1&#39; etc.</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      name</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check for multiple Z coordinates</span>
    <span class="c1"># Adjust dim if necessary</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span>
        <span class="n">z_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">z_names</span> <span class="o">=</span><span class="p">[]</span>
        <span class="k">for</span> <span class="n">mycoord</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">coords</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                <span class="n">z_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">z_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span>
                            
        <span class="k">if</span> <span class="n">z_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">z_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            
            
    <span class="nb">id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">ncvar</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">short_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;short_name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">long_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;No Name&#39;</span>
    <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">id</span>
    <span class="k">if</span> <span class="n">ncvar</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">ncvar</span>
    <span class="k">if</span> <span class="n">short_name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">short_name</span>
    <span class="k">if</span> <span class="n">long_name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">long_name</span>
    <span class="k">if</span> <span class="n">standard_name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">standard_name</span>

    <span class="k">return</span> <span class="n">name</span></div>



<span class="k">def</span> <span class="nf">cf_var_name_titles</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | cf_var_name - return the name from a supplied dimension</span>
<span class="sd">     |               in the following preference order:</span>
<span class="sd">     |               standard_name</span>
<span class="sd">     |               long_name</span>
<span class="sd">     |               short_name</span>
<span class="sd">     |               ncvar</span>
<span class="sd">     |</span>
<span class="sd">     | field=None - field</span>
<span class="sd">     | dim=None - dimension required - &#39;dim0&#39;, &#39;dim1&#39; etc.</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      name</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">units</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">ncvar</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">short_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;short_name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">long_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1">#name = &#39;No Name&#39;</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">if</span> <span class="n">ncvar</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">ncvar</span>
        <span class="k">if</span> <span class="n">short_name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">short_name</span>
        <span class="k">if</span> <span class="n">long_name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">long_name</span>
        <span class="k">if</span> <span class="n">standard_name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">standard_name</span>

        <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s1">&#39;units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">units</span>


<div class="viewcode-block" id="process_color_scales">
<a class="viewcode-back" href="../process_color_scales.html#cfplot.process_color_scales">[docs]</a>
<span class="k">def</span> <span class="nf">process_color_scales</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | Process colour scales to generate images of them for the web</span>
<span class="sd">     | documentation and the rst code for inclusion in the</span>
<span class="sd">     | colour_scale.rst file.</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     | No inputs</span>
<span class="sd">     | This is an internal routine and not used by the user</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Define scale categories</span>
    <span class="n">uniform</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="s1">&#39;magma&#39;</span><span class="p">,</span> <span class="s1">&#39;inferno&#39;</span><span class="p">,</span> <span class="s1">&#39;plasma&#39;</span><span class="p">,</span> <span class="s1">&#39;parula&#39;</span><span class="p">,</span> <span class="s1">&#39;gray&#39;</span><span class="p">]</span>

    <span class="n">ncl_large</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;amwg256&#39;</span><span class="p">,</span> <span class="s1">&#39;BkBlAqGrYeOrReViWh200&#39;</span><span class="p">,</span> <span class="s1">&#39;BlAqGrYeOrRe&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;BlAqGrYeOrReVi200&#39;</span><span class="p">,</span> <span class="s1">&#39;BlGrYeOrReVi200&#39;</span><span class="p">,</span> <span class="s1">&#39;BlRe&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueRed&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;BlueRedGray&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueWhiteOrangeRed&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueYellowRed&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;BlWhRe&#39;</span><span class="p">,</span> <span class="s1">&#39;cmp_b2r&#39;</span><span class="p">,</span> <span class="s1">&#39;cmp_haxby&#39;</span><span class="p">,</span> <span class="s1">&#39;detail&#39;</span><span class="p">,</span> <span class="s1">&#39;extrema&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;GrayWhiteGray&#39;</span><span class="p">,</span> <span class="s1">&#39;GreenYellow&#39;</span><span class="p">,</span> <span class="s1">&#39;helix&#39;</span><span class="p">,</span> <span class="s1">&#39;helix1&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;hotres&#39;</span><span class="p">,</span> <span class="s1">&#39;matlab_hot&#39;</span><span class="p">,</span> <span class="s1">&#39;matlab_hsv&#39;</span><span class="p">,</span> <span class="s1">&#39;matlab_jet&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;matlab_lines&#39;</span><span class="p">,</span> <span class="s1">&#39;ncl_default&#39;</span><span class="p">,</span> <span class="s1">&#39;ncview_default&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;OceanLakeLandSnow&#39;</span><span class="p">,</span> <span class="s1">&#39;rainbow&#39;</span><span class="p">,</span> <span class="s1">&#39;rainbow_white_gray&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;rainbow_white&#39;</span><span class="p">,</span> <span class="s1">&#39;rainbow_gray&#39;</span><span class="p">,</span> <span class="s1">&#39;tbr_240_300&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;tbr_stdev_0_30&#39;</span><span class="p">,</span> <span class="s1">&#39;tbr_var_0_500&#39;</span><span class="p">,</span> <span class="s1">&#39;tbrAvg1&#39;</span><span class="p">,</span> <span class="s1">&#39;tbrStd1&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;tbrVar1&#39;</span><span class="p">,</span> <span class="s1">&#39;thelix&#39;</span><span class="p">,</span> <span class="s1">&#39;ViBlGrWhYeOrRe&#39;</span><span class="p">,</span> <span class="s1">&#39;wh_bl_gr_ye_re&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;WhBlGrYeRe&#39;</span><span class="p">,</span> <span class="s1">&#39;WhBlReWh&#39;</span><span class="p">,</span> <span class="s1">&#39;WhiteBlue&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;WhiteBlueGreenYellowRed&#39;</span><span class="p">,</span> <span class="s1">&#39;WhiteGreen&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;WhiteYellowOrangeRed&#39;</span><span class="p">,</span> <span class="s1">&#39;WhViBlGrYeOrRe&#39;</span><span class="p">,</span> <span class="s1">&#39;WhViBlGrYeOrReWh&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;wxpEnIR&#39;</span><span class="p">,</span> <span class="s1">&#39;3gauss&#39;</span><span class="p">,</span> <span class="s1">&#39;3saw&#39;</span><span class="p">,</span> <span class="s1">&#39;BrBG&#39;</span><span class="p">]</span>

    <span class="n">ncl_meteoswiss</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;hotcold_18lev&#39;</span><span class="p">,</span> <span class="s1">&#39;hotcolr_19lev&#39;</span><span class="p">,</span> <span class="s1">&#39;mch_default&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;perc2_9lev&#39;</span><span class="p">,</span> <span class="s1">&#39;percent_11lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip2_15lev&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;precip2_17lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip3_16lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip4_11lev&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;precip4_diff_19lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip_11lev&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;precip_diff_12lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip_diff_1lev&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;rh_19lev&#39;</span><span class="p">,</span> <span class="s1">&#39;spread_15lev&#39;</span><span class="p">]</span>

    <span class="n">ncl_color_blindness</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;StepSeq25&#39;</span><span class="p">,</span> <span class="s1">&#39;posneg_2&#39;</span><span class="p">,</span> <span class="s1">&#39;posneg_1&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;BlueDarkOrange18&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueDarkRed18&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;GreenMagenta16&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueGreen14&#39;</span><span class="p">,</span> <span class="s1">&#39;BrownBlue12&#39;</span><span class="p">,</span>
                           <span class="s1">&#39;Cat12&#39;</span><span class="p">]</span>

    <span class="n">ncl_small</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;amwg&#39;</span><span class="p">,</span> <span class="s1">&#39;amwg_blueyellowred&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueDarkRed18&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;BlueDarkOrange18&#39;</span><span class="p">,</span> <span class="s1">&#39;BlueGreen14&#39;</span><span class="p">,</span> <span class="s1">&#39;BrownBlue12&#39;</span><span class="p">,</span> <span class="s1">&#39;Cat12&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;cmp_flux&#39;</span><span class="p">,</span> <span class="s1">&#39;cosam12&#39;</span><span class="p">,</span> <span class="s1">&#39;cosam&#39;</span><span class="p">,</span> <span class="s1">&#39;GHRSST_anomaly&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;GreenMagenta16&#39;</span><span class="p">,</span> <span class="s1">&#39;hotcold_18lev&#39;</span><span class="p">,</span> <span class="s1">&#39;hotcolr_19lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;mch_default&#39;</span><span class="p">,</span> <span class="s1">&#39;nrl_sirkes&#39;</span><span class="p">,</span> <span class="s1">&#39;nrl_sirkes_nowhite&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;perc2_9lev&#39;</span><span class="p">,</span> <span class="s1">&#39;percent_11lev&#39;</span><span class="p">,</span> <span class="s1">&#39;posneg_2&#39;</span><span class="p">,</span> <span class="s1">&#39;prcp_1&#39;</span><span class="p">,</span> <span class="s1">&#39;prcp_2&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;prcp_3&#39;</span><span class="p">,</span> <span class="s1">&#39;precip_11lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip_diff_12lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;precip_diff_1lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip2_15lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip2_17lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;precip3_16lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip4_11lev&#39;</span><span class="p">,</span> <span class="s1">&#39;precip4_diff_19lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;radar&#39;</span><span class="p">,</span> <span class="s1">&#39;radar_1&#39;</span><span class="p">,</span> <span class="s1">&#39;rh_19lev&#39;</span><span class="p">,</span> <span class="s1">&#39;seaice_1&#39;</span><span class="p">,</span> <span class="s1">&#39;seaice_2&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;so4_21&#39;</span><span class="p">,</span> <span class="s1">&#39;spread_15lev&#39;</span><span class="p">,</span> <span class="s1">&#39;StepSeq25&#39;</span><span class="p">,</span> <span class="s1">&#39;sunshine_9lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;sunshine_diff_12lev&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_19lev&#39;</span><span class="p">,</span> <span class="s1">&#39;temp_diff_18lev&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;temp_diff_1lev&#39;</span><span class="p">,</span> <span class="s1">&#39;topo_15lev&#39;</span><span class="p">,</span> <span class="s1">&#39;wgne15&#39;</span><span class="p">,</span> <span class="s1">&#39;wind_17lev&#39;</span><span class="p">]</span>

    <span class="n">orography</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;os250kmetres&#39;</span><span class="p">,</span> <span class="s1">&#39;wiki_1_0_2&#39;</span><span class="p">,</span> <span class="s1">&#39;wiki_1_0_3&#39;</span><span class="p">,</span>
                 <span class="s1">&#39;wiki_2_0&#39;</span><span class="p">,</span> <span class="s1">&#39;wiki_2_0_reduced&#39;</span><span class="p">,</span> <span class="s1">&#39;arctic&#39;</span><span class="p">]</span>

    <span class="n">idl_guide</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">45</span><span class="p">):</span>
        <span class="n">idl_guide</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;scale&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span> <span class="s1">&#39;ncl_meteoswiss&#39;</span><span class="p">,</span> <span class="s1">&#39;ncl_small&#39;</span><span class="p">,</span> <span class="s1">&#39;ncl_large&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;ncl_color_blindness&#39;</span><span class="p">,</span> <span class="s1">&#39;orography&#39;</span><span class="p">,</span> <span class="s1">&#39;idl_guide&#39;</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;uniform&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">uniform</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;================== =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;Perceptually uniform colour maps for use with continuous &#39;</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;data&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name               Scale&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;ncl_meteoswiss&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_meteoswiss</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;================== =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">19</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NCAR Command Language - MeteoSwiss colour maps&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name               Scale&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;ncl_small&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_small</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;=================== =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NCAR Command Language - small color maps (&lt;50 colours)&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------------------------------------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name                Scale&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;ncl_large&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_large</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;======================= =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">24</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NCAR Command Language - large colour maps (&gt;50 colours)&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-------------------------------------------------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name                    Scale&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;ncl_color_blindness&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_color_blindness</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;================ =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;NCAR Command Language - Enhanced to help with colour&#39;</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;blindness&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;-----------------------------------------------------&#39;</span>
            <span class="n">title</span> <span class="o">+=</span> <span class="s1">&#39;---------&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name             Scale&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;orography&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">orography</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;================ =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Orography/bathymetry colour scales&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name             Scale&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s1">&#39;idl_guide&#39;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">idl_guide</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s1">&#39;======= =====&#39;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;IDL guide scales&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Name    Scale&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">8</span>

        <span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">scales</span><span class="p">:</span>
            <span class="c1"># Make image of scale</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
            <span class="n">cscale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
            <span class="n">cb1</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span>
                <span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">cb1</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
            <span class="n">cb1</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">])</span>
            <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;/home/andy/cf-docs/cfplot_sphinx/images/&#39;</span>
            <span class="n">file</span> <span class="o">+=</span> <span class="s1">&#39;colour_scales/&#39;</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Use convert to trim the png file to remove white space</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">&quot;convert&quot;</span><span class="p">,</span> <span class="s2">&quot;-trim&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">file</span><span class="p">])</span>

            <span class="n">name_pad</span> <span class="o">=</span> <span class="n">scale</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_pad</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">chars</span><span class="p">:</span>
                <span class="n">name_pad</span> <span class="o">=</span> <span class="n">name_pad</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="n">name_pad</span> <span class="o">+</span> <span class="s1">&#39;.. image:: images/colour_scales/&#39;</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span></div>



<div class="viewcode-block" id="reset">
<a class="viewcode-back" href="../reset.html#cfplot.reset">[docs]</a>
<span class="k">def</span> <span class="nf">reset</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | reset all plotting variables</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      name</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">axes</span><span class="p">()</span>
    <span class="n">cscale</span><span class="p">()</span>
    <span class="n">levs</span><span class="p">()</span>
    <span class="n">gset</span><span class="p">()</span>
    <span class="n">mapset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">()</span></div>



<div class="viewcode-block" id="setvars">
<a class="viewcode-back" href="../setvars.html#cfplot.setvars">[docs]</a>
<span class="k">def</span> <span class="nf">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">text_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">colorbar_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">text_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis_label_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">continent_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">continent_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">continent_linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">viewer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">tspace_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tspace_month</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tspace_day</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">tspace_hour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xtick_label_rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">xtick_label_align</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ytick_label_rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">ytick_label_align</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend_text_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">legend_text_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cs_uniform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">master_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">master_title_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">master_title_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">master_title_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">land_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ocean_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">lake_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">feature_zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">rotated_grid_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotated_deg_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">rotated_continents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotated_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">rotated_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotated_grid_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">legend_frame</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">legend_frame_edge_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend_frame_face_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">degsym</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axis_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">grid_x_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_y_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">grid_colour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">grid_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">tight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | setvars - set plotting variables and their defaults</span>
<span class="sd">     |</span>
<span class="sd">     | file=None - output file name</span>
<span class="sd">     | title_fontsize=None - title fontsize, default=15</span>
<span class="sd">     | title_fontweight=&#39;normal&#39; - title fontweight</span>
<span class="sd">     | text_fontsize=&#39;normal&#39; - text font size, default=11</span>
<span class="sd">     | text_fontweight=&#39;normal&#39; - text font weight</span>
<span class="sd">     | axis_label_fontsize=None - axis label fontsize, default=11</span>
<span class="sd">     | axis_label_fontweight=&#39;normal&#39; - axis font weight</span>
<span class="sd">     | legend_text_size=&#39;11&#39; - legend text size</span>
<span class="sd">     | legend_text_weight=&#39;normal&#39; - legend text weight</span>
<span class="sd">     | colorbar_fontsize=&#39;11&#39; - colorbar text size</span>
<span class="sd">     | colorbar_fontweight=&#39;normal&#39; - colorbar font weight</span>
<span class="sd">     | legend_text_weight=&#39;normal&#39; - legend text weight</span>
<span class="sd">     | master_title_fontsize=30 - master title font size</span>
<span class="sd">     | master_title_fontweight=&#39;normal&#39; - master title font weight</span>
<span class="sd">     | continent_thickness=1.5 - default=1.5</span>
<span class="sd">     | continent_color=&#39;k&#39; - default=&#39;k&#39; (black)</span>
<span class="sd">     | continent_linestyle=&#39;solid&#39; - default=&#39;k&#39; (black)</span>
<span class="sd">     | viewer=&#39;display&#39; - use ImageMagick display program</span>
<span class="sd">     |                    &#39;matplotlib&#39; to use image widget to view the picture</span>
<span class="sd">     | tspace_year=None - time axis spacing in years</span>
<span class="sd">     | tspace_month=None - time axis spacing in months</span>
<span class="sd">     | tspace_day=None - time axis spacing in days</span>
<span class="sd">     | tspace_hour=None - time axis spacing in hours</span>
<span class="sd">     | xtick_label_rotation=0 - rotation of xtick labels</span>
<span class="sd">     | xtick_label_align=&#39;center&#39; - alignment of xtick labels</span>
<span class="sd">     | ytick_label_rotation=0 - rotation of ytick labels</span>
<span class="sd">     | ytick_label_align=&#39;right&#39; - alignment of ytick labels</span>

<span class="sd">     | cs_uniform=True - make a uniform differential colour scale</span>
<span class="sd">     | master_title=None - master title text</span>
<span class="sd">     | master_title_location=[0.5,0.95] - master title location</span>
<span class="sd">     | dpi=None - dots per inch setting</span>
<span class="sd">     | land_color=None - land colour</span>
<span class="sd">     | ocean_color=None - ocean colour</span>
<span class="sd">     | lake_color=None - lake colour</span>
<span class="sd">     | feature_zorder=None - plotting zorder for above three features</span>
<span class="sd">     | rotated_grid_spacing=10 - rotated grid spacing in degrees</span>
<span class="sd">     | rotated_deg_spacing=0.75 - rotated grid spacing between graticule dots</span>
<span class="sd">     | rotated_deg_tkickness=1.0 - rotated grid thickness for longitude and latitude lines</span>
<span class="sd">     | rotated_continents=True - draw rotated continents</span>
<span class="sd">     | rotated_grid=True - draw rotated grid</span>
<span class="sd">     | rotated_labels=True - draw rotated grid labels</span>
<span class="sd">     | legend_frame=True - draw a frame around a lineplot legend</span>
<span class="sd">     | legend_frame_edge_color=&#39;k&#39; - color for the legend frame</span>
<span class="sd">     | legend_frame_face_color=None - color for the legend background</span>
<span class="sd">     | degsym=True - add degree symbol to longitude and latitude axis labels</span>
<span class="sd">     | axis_width=None - width of line for the axes</span>
<span class="sd">     | grid=True - draw grid</span>
<span class="sd">     | grid_x_spacing=60 - grid longitude spacing in degrees</span>
<span class="sd">     | grid_x_spacing=30 - grid latitude spacing in degrees</span>
<span class="sd">     | grid_colour=&#39;k&#39; - grid colour</span>
<span class="sd">     | grid_linestyle=&#39;--&#39; - grid line style</span>
<span class="sd">     | grid_zorder=100 - plotting order for the grid lines</span>
<span class="sd">     | grid_thickness=1.0 - grid thickness</span>
<span class="sd">     | tight=False - remove whitespace around the plot</span>
<span class="sd">     | level_spacing=None - default contour level spacing - takes &#39;linear&#39;, &#39;log&#39;, &#39;loglike&#39;, </span>
<span class="sd">     |                      &#39;outlier&#39; and &#39;inspect&#39;</span>
<span class="sd">     |</span>
<span class="sd">     | Use setvars() to reset to the defaults</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      name</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">file</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="p">,</span> <span class="n">text_fontsize</span><span class="p">,</span> <span class="n">axis_label_fontsize</span><span class="p">,</span>
            <span class="n">continent_thickness</span><span class="p">,</span> <span class="n">title_fontweight</span><span class="p">,</span> <span class="n">text_fontweight</span><span class="p">,</span>
            <span class="n">axis_label_fontweight</span><span class="p">,</span> <span class="n">fontweight</span><span class="p">,</span>  <span class="n">continent_color</span><span class="p">,</span>
            <span class="n">continent_linestyle</span><span class="p">,</span> <span class="n">tspace_year</span><span class="p">,</span>
            <span class="n">tspace_month</span><span class="p">,</span> <span class="n">tspace_day</span><span class="p">,</span> <span class="n">tspace_hour</span><span class="p">,</span> <span class="n">xtick_label_rotation</span><span class="p">,</span>
            <span class="n">xtick_label_align</span><span class="p">,</span> <span class="n">ytick_label_rotation</span><span class="p">,</span> <span class="n">ytick_label_align</span><span class="p">,</span>
            <span class="n">legend_text_size</span><span class="p">,</span> <span class="n">legend_text_weight</span><span class="p">,</span> <span class="n">cs_uniform</span><span class="p">,</span>
            <span class="n">master_title</span><span class="p">,</span> <span class="n">master_title_location</span><span class="p">,</span>
            <span class="n">master_title_fontsize</span><span class="p">,</span> <span class="n">master_title_fontweight</span><span class="p">,</span> <span class="n">dpi</span><span class="p">,</span>
            <span class="n">land_color</span><span class="p">,</span> <span class="n">ocean_color</span><span class="p">,</span> <span class="n">lake_color</span><span class="p">,</span> <span class="n">feature_zorder</span><span class="p">,</span> <span class="n">rotated_grid_spacing</span><span class="p">,</span>
            <span class="n">rotated_deg_spacing</span><span class="p">,</span> <span class="n">rotated_continents</span><span class="p">,</span> <span class="n">rotated_grid</span><span class="p">,</span>
            <span class="n">rotated_grid_thickness</span><span class="p">,</span>
            <span class="n">rotated_labels</span><span class="p">,</span> <span class="n">colorbar_fontsize</span><span class="p">,</span> <span class="n">colorbar_fontweight</span><span class="p">,</span>
            <span class="n">legend_frame</span><span class="p">,</span> <span class="n">legend_frame_edge_color</span><span class="p">,</span> <span class="n">legend_frame_face_color</span><span class="p">,</span>
            <span class="n">degsym</span><span class="p">,</span> <span class="n">axis_width</span><span class="p">,</span> <span class="n">grid</span><span class="p">,</span> <span class="n">grid_x_spacing</span><span class="p">,</span> <span class="n">grid_y_spacing</span><span class="p">,</span> <span class="n">grid_zorder</span><span class="p">,</span>
            <span class="n">grid_colour</span><span class="p">,</span> <span class="n">grid_linestyle</span><span class="p">,</span> <span class="n">grid_thickness</span><span class="p">,</span> <span class="n">tight</span><span class="p">,</span> <span class="n">level_spacing</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontweight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">fontweight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_month</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_size</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_weight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_uniform</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">global_viewer</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_location</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontsize</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontweight</span> <span class="o">=</span> <span class="s1">&#39;normal&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">land_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ocean_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lake_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_spacing</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_deg_spacing</span> <span class="o">=</span> <span class="mf">0.75</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_thickness</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_continents</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_labels</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_edge_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_face_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">degsym</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span> <span class="o">=</span> <span class="s1">&#39;--&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_zorder</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">level_spacing</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
    <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">title_fontsize</span>
    <span class="k">if</span> <span class="n">axis_label_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="n">axis_label_fontsize</span>
    <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">continent_thickness</span>
    <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="o">=</span> <span class="n">continent_color</span>
    <span class="k">if</span> <span class="n">continent_linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span> <span class="o">=</span> <span class="n">continent_linestyle</span>
    <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">colorbar_fontsize</span>
    <span class="k">if</span> <span class="n">colorbar_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontsize</span> <span class="o">=</span> <span class="n">colorbar_fontsize</span>
    <span class="k">if</span> <span class="n">text_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span> <span class="o">=</span> <span class="n">text_fontweight</span>
    <span class="k">if</span> <span class="n">axis_label_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="n">axis_label_fontweight</span>
    <span class="k">if</span> <span class="n">colorbar_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontweight</span> <span class="o">=</span> <span class="n">colorbar_fontweight</span>
    <span class="k">if</span> <span class="n">title_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">title_fontweight</span>
    <span class="k">if</span> <span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="n">viewer</span>
    <span class="k">if</span> <span class="n">tspace_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span> <span class="o">=</span> <span class="n">tspace_year</span>
    <span class="k">if</span> <span class="n">tspace_month</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_month</span> <span class="o">=</span> <span class="n">tspace_month</span>
    <span class="k">if</span> <span class="n">tspace_day</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="o">=</span> <span class="n">tspace_day</span>
    <span class="k">if</span> <span class="n">tspace_hour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span> <span class="o">=</span> <span class="n">tspace_hour</span>
    <span class="k">if</span> <span class="n">xtick_label_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span> <span class="o">=</span> <span class="n">xtick_label_rotation</span>
    <span class="k">if</span> <span class="n">xtick_label_align</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span> <span class="o">=</span> <span class="n">xtick_label_align</span>
    <span class="k">if</span> <span class="n">ytick_label_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span> <span class="o">=</span> <span class="n">ytick_label_rotation</span>
    <span class="k">if</span> <span class="n">ytick_label_align</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span> <span class="o">=</span> <span class="n">ytick_label_align</span>
    <span class="k">if</span> <span class="n">legend_text_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_size</span> <span class="o">=</span> <span class="n">legend_text_size</span>
    <span class="k">if</span> <span class="n">legend_text_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_weight</span> <span class="o">=</span> <span class="n">legend_text_weight</span>
    <span class="k">if</span> <span class="n">cs_uniform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_uniform</span> <span class="o">=</span> <span class="n">cs_uniform</span>
    <span class="k">if</span> <span class="n">master_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title</span> <span class="o">=</span> <span class="n">master_title</span>
    <span class="k">if</span> <span class="n">master_title_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_location</span> <span class="o">=</span> <span class="n">master_title_location</span>
    <span class="k">if</span> <span class="n">master_title_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontsize</span> <span class="o">=</span> <span class="n">master_title_fontsize</span>
    <span class="k">if</span> <span class="n">master_title_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontweight</span> <span class="o">=</span> <span class="n">master_title_fontweight</span>
    <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span>
    <span class="k">if</span> <span class="n">land_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">land_color</span> <span class="o">=</span> <span class="n">land_color</span>
    <span class="k">if</span> <span class="n">ocean_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ocean_color</span> <span class="o">=</span> <span class="n">ocean_color</span>
    <span class="k">if</span> <span class="n">lake_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lake_color</span> <span class="o">=</span> <span class="n">lake_color</span>
    <span class="k">if</span> <span class="n">feature_zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span> <span class="o">=</span> <span class="mi">999</span>
    <span class="k">if</span> <span class="n">rotated_grid_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_spacing</span> <span class="o">=</span> <span class="n">rotated_grid_spacing</span>
    <span class="k">if</span> <span class="n">rotated_deg_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_deg_spacing</span> <span class="o">=</span> <span class="n">rotated_deg_spacing</span>
    <span class="k">if</span> <span class="n">rotated_grid_thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_thickness</span> <span class="o">=</span> <span class="n">rotated_grid_thickness</span>
    <span class="k">if</span> <span class="n">rotated_continents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_continents</span> <span class="o">=</span> <span class="n">rotated_continents</span>
    <span class="k">if</span> <span class="n">rotated_grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid</span> <span class="o">=</span> <span class="n">rotated_grid</span>
    <span class="k">if</span> <span class="n">rotated_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_labels</span> <span class="o">=</span> <span class="n">rotated_labels</span>
    <span class="k">if</span> <span class="n">legend_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame</span> <span class="o">=</span> <span class="n">legend_frame</span>
    <span class="k">if</span> <span class="n">legend_frame_edge_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_edge_color</span> <span class="o">=</span> <span class="n">legend_frame_edge_color</span>
    <span class="k">if</span> <span class="n">legend_frame_face_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_face_color</span> <span class="o">=</span> <span class="n">legend_frame_face_color</span>
    <span class="k">if</span> <span class="n">degsym</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">degsym</span> <span class="o">=</span> <span class="n">degsym</span>
    <span class="k">if</span> <span class="n">axis_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span> <span class="o">=</span> <span class="n">axis_width</span>
    <span class="k">if</span> <span class="n">grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>
    <span class="k">if</span> <span class="n">grid_x_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span> <span class="o">=</span> <span class="n">grid_x_spacing</span>
    <span class="k">if</span> <span class="n">grid_y_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span> <span class="o">=</span> <span class="n">grid_y_spacing</span>        
    <span class="k">if</span> <span class="n">grid_colour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span> <span class="o">=</span> <span class="n">grid_colour</span>
    <span class="k">if</span> <span class="n">grid_linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span> <span class="o">=</span> <span class="n">grid_linestyle</span>
    <span class="k">if</span> <span class="n">grid_thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span> <span class="o">=</span> <span class="n">grid_thickness</span>
    <span class="k">if</span> <span class="n">grid_zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_zorder</span> <span class="o">=</span> <span class="n">grid_zorder</span>
    <span class="k">if</span> <span class="n">tight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="n">tight</span>
    <span class="k">if</span> <span class="n">level_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">level_spacing</span> <span class="o">=</span> <span class="n">level_spacing</span></div>


<div class="viewcode-block" id="vloc">
<a class="viewcode-back" href="../vloc.html#cfplot.vloc">[docs]</a>
<span class="k">def</span> <span class="nf">vloc</span><span class="p">(</span><span class="n">xvec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | vloc is used to locate the positions of a set of points in a vector</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     | xvec=None - data longitudes</span>
<span class="sd">     | yvec=None - data latitudes</span>
<span class="sd">     | lons=None - required longitude positions</span>
<span class="sd">     | lats=None - required latitude positions</span>

<span class="sd">     :Returns:</span>
<span class="sd">      locations of user points in the longitude and latitude points</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check input parameters</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">]):</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">vloc error</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;xvec, yvec, lons, lats all need to be passed to vloc to</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;generate a set of location points</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span>
    <span class="n">yarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>

    <span class="c1"># Convert longitudes to -180 to 180.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)):</span>
        <span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>

    <span class="c1"># Centre around 180 degrees longitude if needed.</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)):</span>
            <span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xvec</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">xvec</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">xvec</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
            <span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span>

    <span class="c1"># Find position in array</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">xvec</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">xvec</span><span class="p">))):</span>
            <span class="n">xpt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">xvec</span><span class="p">)</span>
            <span class="n">xpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">yvec</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">yvec</span><span class="p">))):</span>
            <span class="n">ypt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">yvec</span><span class="p">)</span>
            <span class="n">ypt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">xpt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">xarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpt</span> <span class="o">+</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ypt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ypt</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">yarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ypt</span> <span class="o">+</span> <span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">yarr</span><span class="p">)</span></div>



<div class="viewcode-block" id="rgaxes">
<a class="viewcode-back" href="../rgaxes.html#cfplot.rgaxes">[docs]</a>
<span class="k">def</span> <span class="nf">rgaxes</span><span class="p">(</span><span class="n">xpole</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | rgaxes - label rotated grid plots</span>
<span class="sd">     |</span>
<span class="sd">     | xpole=None - location of xpole in degrees</span>
<span class="sd">     | ypole=None - location of ypole in degrees</span>
<span class="sd">     | xvec=None - location of x grid points</span>
<span class="sd">     | yvec=None - location of y grid points</span>
<span class="sd">     |</span>
<span class="sd">     | axes=True - plot x and y axes</span>
<span class="sd">     | xaxis=True - plot xaxis</span>
<span class="sd">     | yaxis=True - plot y axis</span>
<span class="sd">     | xticks=None - xtick positions</span>
<span class="sd">     | xticklabels=None - xtick labels</span>
<span class="sd">     | yticks=None - y tick positions</span>
<span class="sd">     | yticklabels=None - ytick labels</span>
<span class="sd">     | xlabel=None - label for x axis</span>
<span class="sd">     | ylabel=None - label for y axis</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      name</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spacing</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_spacing</span>
    <span class="n">degspacing</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_deg_spacing</span>
    <span class="n">continents</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_continents</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_labels</span>
    <span class="n">grid_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_thickness</span>

    <span class="c1"># Invert y array if going from north to south</span>
    <span class="c1"># Otherwise this gives nans for all output</span>
    <span class="n">yvec_orig</span> <span class="o">=</span> <span class="n">yvec</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">yvec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yvec</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
        <span class="n">yvec</span> <span class="o">=</span> <span class="n">yvec</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
         <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Set continent thickness and color if not already set</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>

    <span class="c1"># Draw continents</span>
    <span class="k">if</span> <span class="n">continents</span><span class="p">:</span>

        <span class="kn">import</span> <span class="nn">cartopy.io.shapereader</span> <span class="k">as</span> <span class="nn">shpreader</span>
        <span class="kn">import</span> <span class="nn">shapefile</span>
        <span class="n">shpfilename</span> <span class="o">=</span> <span class="n">shpreader</span><span class="o">.</span><span class="n">natural_earth</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                                              <span class="n">category</span><span class="o">=</span><span class="s1">&#39;physical&#39;</span><span class="p">,</span>
                                              <span class="n">name</span><span class="o">=</span><span class="s1">&#39;coastline&#39;</span><span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">shpfilename</span><span class="p">)</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">points</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">shapes</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span>

            <span class="n">rotated_transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">RotatedPole</span><span class="p">(</span><span class="n">pole_latitude</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="o">=</span><span class="n">xpole</span><span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">rotated_transform</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
            <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
                               <span class="n">color</span><span class="o">=</span><span class="n">continent_color</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">360</span> <span class="o">/</span> <span class="n">spacing</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">xticks</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">spacing</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">yticks</span>

    <span class="c1"># Work out how far from plot to plot the longitude and latitude labels</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">spacing_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">spacing_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span>
    <span class="n">spacing</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">spacing_x</span><span class="p">,</span> <span class="n">spacing_y</span><span class="p">)</span>

    <span class="c1"># Draw lines along a longitude</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
                <span class="n">ipts</span> <span class="o">=</span> <span class="mf">179.0</span> <span class="o">/</span> <span class="n">degspacing</span>
                <span class="n">lona</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ipts</span><span class="p">))</span> <span class="o">+</span> <span class="n">lons</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
                <span class="n">lata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ipts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">degspacing</span>

                <span class="n">rotated_transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">RotatedPole</span><span class="p">(</span><span class="n">pole_latitude</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="o">=</span><span class="n">xpole</span><span class="p">)</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">rotated_transform</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lona</span><span class="p">,</span> <span class="n">lata</span><span class="p">)</span>
                <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

                <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_thickness</span><span class="p">,</span>
                                       <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
                    <span class="c1"># Make a label unless the axis is all Nans</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ypts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ypts</span><span class="p">[</span><span class="mi">5</span><span class="p">:]))):</span>
                        <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ypts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
                        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">==</span> <span class="n">ymin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">loc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">]):</span>
                                <span class="n">line</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                                       <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">]],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">spacing</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                                <span class="n">line</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                                <span class="n">fw</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span>
                                <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">xticklabel</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">val</span><span class="p">],</span> <span class="n">lons</span><span class="p">[</span><span class="n">val</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">xticklabel</span> <span class="o">=</span> <span class="n">xticks</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>

                                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="o">-</span><span class="n">spacing</span><span class="p">,</span>
                                                   <span class="n">xticklabel</span><span class="p">,</span>
                                                   <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                                   <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                                                   <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span><span class="p">,</span>
                                                   <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">)</span>

    <span class="c1"># Draw lines along a latitude</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)):</span>
                <span class="n">ipts</span> <span class="o">=</span> <span class="mf">359.0</span> <span class="o">/</span> <span class="n">degspacing</span>
                <span class="n">lata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ipts</span><span class="p">))</span> <span class="o">+</span> <span class="n">lats</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
                <span class="n">lona</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ipts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">degspacing</span>

                <span class="n">rotated_transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">RotatedPole</span><span class="p">(</span><span class="n">pole_latitude</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="o">=</span><span class="n">xpole</span><span class="p">)</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">rotated_transform</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lona</span><span class="p">,</span> <span class="n">lata</span><span class="p">)</span>
                <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_thickness</span><span class="p">,</span>
                                       <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
                    <span class="c1"># Make a label unless the axis is all Nans</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="mi">5</span><span class="p">:]))):</span>
                        <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
                        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xpts</span> <span class="o">==</span> <span class="n">xmin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">loc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">]):</span>
                                    <span class="n">line</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                                           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">spacing</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
                                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                                    <span class="n">line</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                                    <span class="n">fw</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span>
                                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="n">yticklabel</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">val</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">val</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">yticklabel</span> <span class="o">=</span> <span class="n">yticks</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>

                                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="n">spacing</span><span class="p">,</span> <span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span>
                                                       <span class="n">yticklabel</span><span class="p">,</span>
                                                       <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                                                       <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                                                       <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span><span class="p">,</span>
                                                       <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">)</span>

    <span class="c1"># Reset yvec</span>
    <span class="n">yvec</span> <span class="o">=</span> <span class="n">yvec_orig</span></div>



<div class="viewcode-block" id="lineplot">
<a class="viewcode-back" href="../lineplot.html#cfplot.lineplot">[docs]</a>
<span class="k">def</span> <span class="nf">lineplot</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">line_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
             <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">xlog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">swap_xy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
             <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
             <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">legend_location</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">xunits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yunits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
             <span class="n">axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">titles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | lineplot is the interface to line plotting in cf-plot.</span>
<span class="sd">    | The minimum use is lineplot(f) where f is a CF field.</span>
<span class="sd">    | If x and y are passed then an appropriate plot is made allowing</span>
<span class="sd">    | x vs data and y vs data plots.</span>

<span class="sd">    | When making a labelled line plot:</span>
<span class="sd">    | always have a label for each line</span>
<span class="sd">    | always put the legend location as an option to the last call to lineplot</span>
<span class="sd">    |</span>
<span class="sd">    | f - CF data used to make a line plot</span>
<span class="sd">    | x - x locations of data in y</span>
<span class="sd">    | y - y locations of data in x</span>
<span class="sd">    | linestyle=&#39;-&#39; - line style</span>
<span class="sd">    | color=None - line color.  Defaults to Matplotlib colour scheme unless specified</span>
<span class="sd">    | linewidth=1.0 - line width</span>
<span class="sd">    | marker=None - marker for points along the line</span>
<span class="sd">    | markersize=5.0 - size of the marker</span>
<span class="sd">    | markeredgecolor = &#39;k&#39; - colour of edge around the marker</span>
<span class="sd">    | markeredgewidth = 0.5 - width of edge around the marker</span>
<span class="sd">    | xlog=False - log x-axis</span>
<span class="sd">    | ylog=False - log y-axis</span>
<span class="sd">    | label=None - line label - label for line</span>
<span class="sd">    | legend_location=&#39;upper right&#39; - default location of legend</span>
<span class="sd">    |                 Other options are {&#39;best&#39;: 0, &#39;center&#39;: 10, &#39;center left&#39;: 6,</span>
<span class="sd">    |                                    &#39;center right&#39;: 7, &#39;lower center&#39;: 8,</span>
<span class="sd">    |                                    &#39;lower left&#39;: 3, &#39;lower right&#39;: 4, &#39;right&#39;: 5,</span>
<span class="sd">    |                                    &#39;upper center&#39;: 9, &#39;upper left&#39;: 2, &#39;upper right&#39;: 1}</span>
<span class="sd">    | titles=False - set to True to have a dimensions title</span>
<span class="sd">    | verbose=None - change to 1 to get a verbose listing of what lineplot</span>
<span class="sd">    |                is doing</span>
<span class="sd">    | zorder=None - plotting order</span>
<span class="sd">    |</span>
<span class="sd">    | The following parameters override any CF data defaults:</span>
<span class="sd">    | title=None - plot title</span>
<span class="sd">    | xunits=None - x units</span>
<span class="sd">    | yunits=None - y units</span>
<span class="sd">    | xlabel=None - x name</span>
<span class="sd">    | ylabel=None - y name</span>
<span class="sd">    | xname=None - depreciated keyword</span>
<span class="sd">    | yname=None - depreciated keyword</span>
<span class="sd">    | xticks=None - x ticks</span>
<span class="sd">    | xticklabels=None - x tick labels</span>
<span class="sd">    | yticks=None - y ticks</span>
<span class="sd">    | yticklabels - y tick labels</span>
<span class="sd">    | axes=True - plot x and y axes</span>
<span class="sd">    | xaxis=True - plot xaxis</span>
<span class="sd">    | yaxis=True - plot y axis</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    | When making a multiple line plot:</span>
<span class="sd">    | a) set the axis limits with gset before plotting the lines</span>
<span class="sd">    | b) the last call to lineplot is the one that any of the above</span>
<span class="sd">    |    axis overrides should be placed in.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lineplot - making a line plot&#39;</span><span class="p">)</span>

    <span class="c1"># Catch depreciated keywords</span>
    <span class="k">if</span> <span class="n">xname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">yname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">lineplot error&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;xname and yname are now depreciated keywords&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Please use xlabel and ylabel</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1">##################</span>
    <span class="c1"># Open a new plot is necessary</span>
    <span class="c1">##################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Call gpos(1) if not already called</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">##################</span>
    <span class="c1"># Extract required data</span>
    <span class="c1"># If a cf-python field</span>
    <span class="c1">##################</span>
    <span class="n">cf_field</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
            <span class="n">cf_field</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Check data is 1D</span>
            <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
            <span class="k">if</span> <span class="n">ndims</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.lineplot error need a 1 dimensonal field to make a line</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;received &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.lineplot error - two or more cf-fields passed for plotting.</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;To plot two cf-fields open a graphics plot with cfp.gopen(), </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;plot the two fields separately with cfp.lineplot and then close</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;the graphics plot with cfp.gclose()</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.lineplot - cannot plot a field list</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>



    <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">xlabel_units</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">ylabel_units</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="n">cf_field</span><span class="p">:</span>
        <span class="c1"># Extract data</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lineplot - CF field, extracting data&#39;</span><span class="p">)</span>

        <span class="n">has_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dimension_coordinates</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">has_count</span> <span class="o">=</span> <span class="n">has_count</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

                <span class="c1"># x label</span>
                <span class="n">xlabel_units</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;Units&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">))</span>
                <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; (&#39;</span>
                <span class="n">plot_xlabel</span> <span class="o">+=</span> <span class="n">xlabel_units</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

                <span class="c1"># y label</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">):</span>
                    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span>
                <span class="n">nc</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nc</span><span class="p">:</span>
                    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;short_name&#39;</span><span class="p">):</span>
                    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">short_name</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">):</span>
                    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">long_name</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">):</span>
                    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">standard_name</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;Units&#39;</span><span class="p">):</span>
                    <span class="n">ylabel_units</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ylabel_units</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">plot_ylabel</span> <span class="o">+=</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="n">ylabel_units</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

        <span class="k">if</span> <span class="n">has_count</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1"> lineplot error - passed field is not suitable &#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;for plotting as a line</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dimension_coordinates</span><span class="p">()):</span>
                <span class="n">sn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">ln</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s1">&#39;long_name&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sn</span><span class="p">:</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> \
                        <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ln</span><span class="p">:</span>
                        <span class="n">errstr</span> <span class="o">=</span> <span class="n">errstr</span> <span class="o">+</span> \
                            <span class="nb">str</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;,&#39;</span> <span class="o">+</span> \
                            <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lineplot - not a CF field, using passed data&#39;</span><span class="p">)</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;lineplot error- must define both x and y&#39;</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;lineplot error- must define just x and y to make &#39;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;a lineplot&#39;</span>
        <span class="k">if</span> <span class="n">errstr</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">errstr</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Z on y-axis</span>
    <span class="n">ztype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">xlabel_units</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mb&#39;</span><span class="p">,</span> <span class="s1">&#39;mbar&#39;</span><span class="p">,</span> <span class="s1">&#39;millibar&#39;</span><span class="p">,</span> <span class="s1">&#39;decibar&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;atmosphere&#39;</span><span class="p">,</span> <span class="s1">&#39;atm&#39;</span><span class="p">,</span> <span class="s1">&#39;pascal&#39;</span><span class="p">,</span> <span class="s1">&#39;Pa&#39;</span><span class="p">,</span> <span class="s1">&#39;hPa&#39;</span><span class="p">]:</span>
        <span class="n">ztype</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">xlabel_units</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;meter&#39;</span><span class="p">,</span> <span class="s1">&#39;metre&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;kilometer&#39;</span><span class="p">,</span> <span class="s1">&#39;kilometre&#39;</span><span class="p">,</span> <span class="s1">&#39;km&#39;</span><span class="p">]:</span>
        <span class="n">ztype</span> <span class="o">=</span> <span class="mi">2</span>
        
        
    <span class="n">myz</span> <span class="o">=</span> <span class="n">find_z</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cf_field</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="n">myz</span><span class="p">):</span>
        <span class="n">z_coord</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">myz</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_coord</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">zlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">z_coord</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">):</span>
                <span class="n">zlabel</span> <span class="o">=</span> <span class="n">z_coord</span><span class="o">.</span><span class="n">long_name</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">z_coord</span><span class="p">,</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">):</span>
                <span class="n">zlabel</span> <span class="o">=</span> <span class="n">z_coord</span><span class="o">.</span><span class="n">standard_name</span>
            <span class="k">if</span> <span class="n">zlabel</span> <span class="o">==</span> <span class="s1">&#39;atmosphere_hybrid_height_coordinate&#39;</span><span class="p">:</span>
                <span class="n">ztype</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">ztype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>
        <span class="n">plot_xlabel</span><span class="p">,</span> <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">plot_ylabel</span><span class="p">,</span> <span class="n">plot_xlabel</span>

    <span class="c1"># Set data values</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lineplot - setting data values&#39;</span><span class="p">)</span>
    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">minx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># Use accumulated plot limits if making a multiple line plot</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span> <span class="o">=</span> <span class="n">minx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">minx</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span> <span class="o">=</span> <span class="n">minx</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span> <span class="o">=</span> <span class="n">maxx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">maxx</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span> <span class="o">=</span> <span class="n">maxx</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span> <span class="o">=</span> <span class="n">miny</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">miny</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span> <span class="o">=</span> <span class="n">miny</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span> <span class="o">=</span> <span class="n">maxy</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">maxy</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span> <span class="o">=</span> <span class="n">maxy</span>

    <span class="c1"># Reset plot limits based on accumulated plot limits</span>
    <span class="n">minx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span>
    <span class="n">miny</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span>
    <span class="n">maxy</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span>

    <span class="k">if</span> <span class="n">cf_field</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">):</span>
        <span class="n">taxis</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ztype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ztype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cf_field</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">positive</span> <span class="o">==</span> <span class="s1">&#39;down&#39;</span><span class="p">:</span>
                <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># Use user set values if present</span>
    <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">minx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

        <span class="c1"># Change from date string to a number if strings are passed</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">minx</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">miny</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">cf_field</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">):</span>
            <span class="n">taxis</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time_xstr</span> <span class="ow">or</span> <span class="n">time_ystr</span><span class="p">:</span>
                <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
                <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
                <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">time_xstr</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">minx</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">minx</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">maxx</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">maxx</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">([</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">),</span>
                                    <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">)],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">time_ystr</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">miny</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">miny</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">maxy</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">maxy</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">([</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span>
                                     <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">)],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>

    <span class="c1"># Set x and y labelling</span>
    <span class="c1"># Retrieve any user defined axis labels</span>
    <span class="k">if</span> <span class="n">plot_xlabel</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span>
    <span class="k">if</span> <span class="n">plot_ylabel</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">xticks</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">yticks</span><span class="p">))</span>

    <span class="n">mod</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">ymult</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plot_xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span>
            <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;lat&#39;</span><span class="p">:</span>
            <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cf_field</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="p">,</span> <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="n">timeaxis</span><span class="p">(</span><span class="n">taxis</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xticks</span><span class="p">,</span> <span class="n">ymult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">minx</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">maxx</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">)</span>

        <span class="c1"># Fix long floating point numbers if necessary</span>
        <span class="n">fix_floats</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
        <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">xticks</span><span class="p">:</span>
                <span class="n">xticklabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">miny</span> <span class="o">&lt;</span> <span class="n">maxy</span><span class="p">:</span>
                <span class="n">yticks</span><span class="p">,</span> <span class="n">ymult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">miny</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">maxy</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">maxy</span> <span class="o">&lt;</span> <span class="n">miny</span><span class="p">:</span>
                <span class="n">yticks</span><span class="p">,</span> <span class="n">ymult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">maxy</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">miny</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">yticks</span><span class="p">,</span> <span class="n">ymult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">miny</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">maxy</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">)</span>

            <span class="c1"># Fix long floating point numbers if necessary</span>
            <span class="n">fix_floats</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yticklabels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">yticks</span><span class="p">:</span>
            <span class="n">yticklabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_xlabel</span> <span class="o">+=</span> <span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">xunits</span><span class="o">+</span><span class="s1">&#39;)&#39;</span>

    <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_ylabel</span> <span class="o">+=</span> <span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="n">yunits</span><span class="o">+</span><span class="s1">&#39;)&#39;</span>

    <span class="k">if</span> <span class="n">swap_xy</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lineplot - swapping x and y&#39;</span><span class="p">)</span>

        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">xpts</span>
        <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span> <span class="o">=</span> <span class="n">miny</span><span class="p">,</span> <span class="n">minx</span>
        <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">maxx</span>
        <span class="n">plot_xlabel</span><span class="p">,</span> <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">plot_ylabel</span><span class="p">,</span> <span class="n">plot_xlabel</span>
        <span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span> <span class="o">=</span> <span class="n">yticks</span><span class="p">,</span> <span class="n">xticks</span>
        <span class="n">xticklabels</span><span class="p">,</span> <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">yticklabels</span><span class="p">,</span> <span class="n">xticklabels</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">time_xstr</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">time_ystr</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">minx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">maxx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
            <span class="n">miny</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">maxy</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
            <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

        <span class="k">if</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">yticks</span>
            <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
        <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
        <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">yticks</span>
        <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>



    <span class="c1"># Generate titles if requested</span>
    <span class="k">if</span> <span class="n">titles</span><span class="p">:</span> 
        <span class="n">title_dims</span> <span class="o">=</span> <span class="n">generate_titles</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>



    <span class="c1"># Make graph</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;lineplot - making graph&#39;</span><span class="p">)</span>

    <span class="n">xlabelalignment</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span>
    <span class="n">ylabelalignment</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span>

    <span class="k">if</span> <span class="n">lines</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">colorarg</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorarg</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;color&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">}</span>

    <span class="n">graph</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">twinx</span><span class="p">:</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">ylabelalignment</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">twiny</span><span class="p">:</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>

    <span class="c1"># Reset y limits if minx = maxy</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">miny</span> <span class="o">==</span> <span class="n">maxy</span><span class="p">:</span>
            <span class="n">miny</span> <span class="o">=</span> <span class="n">miny</span> <span class="o">-</span> <span class="mf">1.0</span>
            <span class="n">maxy</span> <span class="o">=</span> <span class="n">maxy</span> <span class="o">+</span> <span class="mf">1.0</span>

    <span class="n">graph</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span><span class="p">])</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;out&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">plot_xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                     <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">plot_ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                     <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span> <span class="ow">or</span> <span class="n">xlog</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="ow">or</span> <span class="n">ylog</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xticklabels</span><span class="p">,</span>
                              <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span><span class="p">,</span>
                              <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">xlabelalignment</span><span class="p">,</span>
                              <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                              <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yticklabels</span><span class="p">,</span>
                              <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span><span class="p">,</span>
                              <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">ylabelalignment</span><span class="p">,</span>
                              <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                              <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">)</span>

    <span class="n">graph</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="o">**</span><span class="n">colorarg</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
               <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
               <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
               <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">markeredgecolor</span><span class="p">,</span>
               <span class="n">markeredgewidth</span><span class="o">=</span><span class="n">markeredgewidth</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">)</span>

    <span class="c1"># Set axis width if required</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span><span class="p">)</span>

    <span class="c1"># Add a legend if needed</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">legend_properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_size</span><span class="p">,</span>
            <span class="s1">&#39;weight&#39;</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_weight</span><span class="p">}</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="n">legend_location</span><span class="p">,</span> <span class="n">prop</span><span class="o">=</span><span class="n">legend_properties</span><span class="p">,</span>
                     <span class="n">frameon</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame</span><span class="p">,</span>
                     <span class="n">edgecolor</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_edge_color</span><span class="p">,</span>
                     <span class="n">facecolor</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_face_color</span><span class="p">)</span>

    <span class="c1"># Set title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span><span class="p">,</span>
                        <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span><span class="p">)</span>

    <span class="c1"># Titles for dimensions</span>
    <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>


    <span class="c1">##################</span>
    <span class="c1"># Save or view plot</span>
    <span class="c1">##################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saving or viewing plot&#39;</span><span class="p">)</span>
        <span class="n">gclose</span><span class="p">()</span></div>



<div class="viewcode-block" id="regression_tests">
<a class="viewcode-back" href="../regression_tests.html#cfplot.regression_tests">[docs]</a>
<span class="k">def</span> <span class="nf">regression_tests</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Test for cf-plot regressions</span>
<span class="sd">    | Run through some standard levs, gvals, lon and lat labelling</span>
<span class="sd">    | Make all the gallery plots and use Imagemagick to display them</span>
<span class="sd">    | alongside a reference plot</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==================&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Regression testing&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;==================&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing for levels&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;------------------&#39;</span><span class="p">)</span>
    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span>
                  <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">55</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">65</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="n">levs_test</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">35</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">65</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">6.</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">,</span> <span class="mf">3.6</span><span class="p">,</span> <span class="mf">4.8</span><span class="p">,</span> <span class="mf">6.</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="n">levs_test</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">6</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.2</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">50000</span><span class="p">,</span> <span class="mi">51000</span><span class="p">,</span> <span class="mi">52000</span><span class="p">,</span> <span class="mi">53000</span><span class="p">,</span> <span class="mi">54000</span><span class="p">,</span> <span class="mi">55000</span><span class="p">,</span> <span class="mi">56000</span><span class="p">,</span> <span class="mi">57000</span><span class="p">,</span>
                  <span class="mi">58000</span><span class="p">,</span> <span class="mi">59000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="n">levs_test</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">50000</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">60000</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">7000</span><span class="p">,</span> <span class="o">-</span><span class="mi">6500</span><span class="p">,</span> <span class="o">-</span><span class="mi">6000</span><span class="p">,</span> <span class="o">-</span><span class="mi">5500</span><span class="p">,</span> <span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="o">-</span><span class="mi">4500</span><span class="p">,</span> <span class="o">-</span><span class="mi">4000</span><span class="p">,</span> <span class="o">-</span><span class="mi">3500</span><span class="p">,</span>
                  <span class="o">-</span><span class="mi">3000</span><span class="p">,</span> <span class="o">-</span><span class="mi">2500</span><span class="p">,</span> <span class="o">-</span><span class="mi">2000</span><span class="p">,</span> <span class="o">-</span><span class="mi">1500</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="o">-</span><span class="mi">500</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span>
        <span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span>
        <span class="n">levs_test</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="nb">min</span><span class="o">=-</span><span class="mi">7000</span><span class="p">,</span>
        <span class="nb">max</span><span class="o">=-</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">step</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing for gvals&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">281</span><span class="p">,</span> <span class="mi">282</span><span class="p">,</span> <span class="mi">283</span><span class="p">,</span> <span class="mi">284</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="mi">286</span><span class="p">,</span> <span class="mi">287</span><span class="p">,</span> <span class="mi">288</span><span class="p">,</span> <span class="mi">289</span><span class="p">,</span> <span class="mi">290</span><span class="p">,</span> <span class="mi">291</span><span class="p">,</span> <span class="mi">292</span><span class="p">,</span> <span class="mi">293</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">280.50619506835938</span><span class="p">,</span>
                   <span class="nb">max</span><span class="o">=</span><span class="mf">293.48431396484375</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gvals_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.356</span><span class="p">,</span>  <span class="mf">0.385</span><span class="p">,</span>  <span class="mf">0.414</span><span class="p">,</span>  <span class="mf">0.443</span><span class="p">,</span>  <span class="mf">0.472</span><span class="p">,</span>  <span class="mf">0.501</span><span class="p">,</span>  <span class="mf">0.53</span><span class="p">,</span>  <span class="mf">0.559</span><span class="p">,</span>
                  <span class="mf">0.588</span><span class="p">,</span>  <span class="mf">0.617</span><span class="p">,</span>  <span class="mf">0.646</span><span class="p">,</span>  <span class="mf">0.675</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.356</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.675</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">gvals_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">35</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">25</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span>
                  <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">35</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">49.510975</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">53.206604</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">gvals_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="mi">47000</span><span class="p">,</span> <span class="mi">48000</span><span class="p">,</span> <span class="mi">49000</span><span class="p">,</span> <span class="mi">50000</span><span class="p">,</span> <span class="mi">51000</span><span class="p">,</span> <span class="mi">52000</span><span class="p">,</span> <span class="mi">53000</span><span class="p">,</span> <span class="mi">54000</span><span class="p">,</span>
                  <span class="mi">55000</span><span class="p">,</span> <span class="mi">56000</span><span class="p">,</span> <span class="mi">57000</span><span class="p">,</span> <span class="mi">58000</span><span class="p">,</span> <span class="mi">59000</span><span class="p">,</span> <span class="mi">60000</span><span class="p">,</span> <span class="mi">61000</span><span class="p">,</span> <span class="mi">62000</span><span class="p">,</span>
                  <span class="mi">63000</span><span class="p">,</span> <span class="mi">64000</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">46956</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">64538</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">gvals_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">1.</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.8</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mf">1.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                   <span class="n">gvals_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing for longitude/latitude labelling&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;----------------------------------------&#39;</span><span class="p">)</span>
    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">([</span><span class="o">-</span><span class="mi">180</span><span class="p">,</span> <span class="o">-</span><span class="mi">120</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">180</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;180&#39;</span><span class="p">,</span> <span class="s1">&#39;120W&#39;</span><span class="p">,</span> <span class="s1">&#39;60W&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;60E&#39;</span><span class="p">,</span> <span class="s1">&#39;120E&#39;</span><span class="p">,</span> <span class="s1">&#39;180&#39;</span><span class="p">])</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">mapaxis_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">([</span><span class="mi">150</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">210</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">270</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;150E&#39;</span><span class="p">,</span> <span class="s1">&#39;180&#39;</span><span class="p">,</span> <span class="s1">&#39;150W&#39;</span><span class="p">,</span> <span class="s1">&#39;120W&#39;</span><span class="p">,</span> <span class="s1">&#39;90W&#39;</span><span class="p">])</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">135</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">280</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                   <span class="n">mapaxis_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;10E&#39;</span><span class="p">,</span> <span class="s1">&#39;20E&#39;</span><span class="p">,</span>
                  <span class="s1">&#39;30E&#39;</span><span class="p">,</span> <span class="s1">&#39;40E&#39;</span><span class="p">,</span> <span class="s1">&#39;50E&#39;</span><span class="p">,</span> <span class="s1">&#39;60E&#39;</span><span class="p">,</span> <span class="s1">&#39;70E&#39;</span><span class="p">,</span> <span class="s1">&#39;80E&#39;</span><span class="p">,</span> <span class="s1">&#39;90E&#39;</span><span class="p">])</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mapaxis_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">90</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;90S&#39;</span><span class="p">,</span> <span class="s1">&#39;60S&#39;</span><span class="p">,</span> <span class="s1">&#39;30S&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;30N&#39;</span><span class="p">,</span> <span class="s1">&#39;60N&#39;</span><span class="p">,</span> <span class="s1">&#39;90N&#39;</span><span class="p">])</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mapaxis_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">ref_answer</span> <span class="o">=</span> <span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">],</span>
                  <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;5N&#39;</span><span class="p">,</span> <span class="s1">&#39;10N&#39;</span><span class="p">,</span> <span class="s1">&#39;15N&#39;</span><span class="p">,</span> <span class="s1">&#39;20N&#39;</span><span class="p">,</span> <span class="s1">&#39;25N&#39;</span><span class="p">,</span> <span class="s1">&#39;30N&#39;</span><span class="p">])</span>
    <span class="n">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="n">ref_answer</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mapaxis_test</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Testing for plots&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-----------------&#39;</span><span class="p">)</span>

    <span class="c1"># Run through gallery examples and compare to reference plots</span>

    <span class="c1"># example1</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig1.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># example2</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig2.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">blockfill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

    <span class="c1"># example3</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig3.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=-</span><span class="mi">15</span><span class="p">,</span> <span class="n">lonmax</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">265</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">285</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># example4</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig4.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;npstere&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># example5</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig5.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;spstere&#39;</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=-</span><span class="mi">30</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="c1"># example6</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig6.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

    <span class="c1"># example7</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig7.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>

    <span class="c1"># example8</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig8.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;longitude&#39;</span><span class="p">),</span> <span class="n">ylog</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

    <span class="c1"># example9</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig9.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;latitude&#39;</span><span class="p">))</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>

    <span class="c1"># example10</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig10.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">lines</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>

    <span class="c1"># example11</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig11.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">gset</span><span class="p">(</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="s1">&#39;1960-1-1&#39;</span><span class="p">,</span> <span class="s1">&#39;1980-1-1&#39;</span><span class="p">)</span>
    <span class="n">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">280</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">305</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">longitude</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">lines</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span>

    <span class="c1"># example12</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig12.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">lines</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

    <span class="c1"># example13</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig13.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">vect</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">key_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>

    <span class="c1"># example14</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig14.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">lonmax</span><span class="o">=</span><span class="mi">120</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=-</span><span class="mi">30</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">254</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">270</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">vect</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">key_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>

    <span class="c1"># example15</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig15.png&#39;</span><span class="p">)</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Z</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>

    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;npstere&#39;</span><span class="p">)</span>
    <span class="n">vect</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">,</span> <span class="n">key_length</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Polar plot with regular point distribution&#39;</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>

    <span class="c1"># example16</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig16.png&#39;</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/vaAMIPlcd_DJF.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">160</span><span class="p">))</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: mean X: mean&#39;</span><span class="p">)</span>

    <span class="n">g</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/wapAMIPlcd_DJF.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">60</span><span class="p">))</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">X</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">160</span><span class="p">))</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: mean X: mean&#39;</span><span class="p">)</span>

    <span class="n">vect</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="o">=-</span><span class="n">g</span><span class="p">,</span> <span class="n">key_length</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">],</span>
         <span class="n">scale</span><span class="o">=</span><span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;DJF&#39;</span><span class="p">,</span> <span class="n">key_location</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.05</span><span class="p">])</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>

    <span class="c1"># example17</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig17.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;magma&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">stipple</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">220</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">260</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00ff00&#39;</span><span class="p">)</span>
    <span class="n">stipple</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">330</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#0000ff&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>

    <span class="c1"># example18</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig18.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;magma&#39;</span><span class="p">)</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;npstere&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">g</span><span class="p">)</span>
    <span class="n">stipple</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">g</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">265</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">295</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;#00ff00&#39;</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span>

    <span class="c1"># example19</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig19.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">gopen</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">gpos</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;moll&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">gpos</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;npstere&#39;</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">gpos</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">mapset</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;spstere&#39;</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=-</span><span class="mi">30</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">180</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span> <span class="n">colorbar_position</span><span class="o">=</span><span class="p">[</span>
        <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">],</span> <span class="n">colorbar_orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">19</span><span class="p">)</span>

    <span class="c1"># example20</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig20.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/Geostropic_Adjustment.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">[</span><span class="mi">9</span><span class="p">])</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>

    <span class="c1"># example21</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig21.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/Geostropic_Adjustment.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;test data&#39;</span><span class="p">,</span>
        <span class="n">xticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100000</span> <span class="o">+</span> <span class="mi">100000</span><span class="p">,</span>
        <span class="n">yticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2000</span> <span class="o">+</span> <span class="mi">2000</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;x-axis&#39;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;z-axis&#39;</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span>

    <span class="c1"># example22</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig22.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read_field</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/rgp.nc&#39;</span><span class="p">)</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">22</span><span class="p">)</span>

    <span class="c1"># example23</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig23.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read_field</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/rgp.nc&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">array</span>
    <span class="n">xvec</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;dim1&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
    <span class="n">yvec</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s1">&#39;dim0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
    <span class="n">xpole</span> <span class="o">=</span> <span class="mi">160</span>
    <span class="n">ypole</span> <span class="o">=</span> <span class="mi">30</span>

    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;plasma&#39;</span><span class="p">)</span>
    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">))</span>
    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">))</span>
    <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">980</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1035</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">rgaxes</span><span class="p">(</span><span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">23</span><span class="p">)</span>

    <span class="c1"># example24</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig24.png&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">matplotlib.mlab</span> <span class="kn">import</span> <span class="n">griddata</span>

    <span class="c1"># Arrays for data</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">pressure</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Read data</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/synop_data.txt&#39;</span><span class="p">)</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
        <span class="n">mysplit</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mysplit</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mysplit</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
        <span class="n">pressure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mysplit</span><span class="p">[</span><span class="mi">3</span><span class="p">]))</span>
        <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">mysplit</span><span class="p">[</span><span class="mi">4</span><span class="p">]))</span>

    <span class="c1"># Linearly interpolate data to a regular grid</span>
    <span class="n">lons_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">140</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">-</span> <span class="mf">11.0</span>
    <span class="n">lats_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">140</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span> <span class="o">+</span> <span class="mf">49.0</span>
    <span class="n">temp_new</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">lons_new</span><span class="p">,</span> <span class="n">lats_new</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

    <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;parula&#39;</span><span class="p">)</span>
    <span class="n">con</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lons_new</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lats_new</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">temp_new</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>

    <span class="c1"># example25</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig25.png&#39;</span><span class="p">)</span>
    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">con</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lons_new</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lats_new</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">temp_new</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">float</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="nb">str</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                           <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                           <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>

    <span class="c1"># example26</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig26.png&#39;</span><span class="p">)</span>
    <span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span> <span class="k">as</span> <span class="n">ncfile</span>
    <span class="kn">from</span> <span class="nn">matplotlib.mlab</span> <span class="kn">import</span> <span class="n">griddata</span>

    <span class="c1"># Get an Orca grid and flatten the arrays</span>
    <span class="n">nc</span> <span class="o">=</span> <span class="n">ncfile</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/orca2.nc&#39;</span><span class="p">)</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">])</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">])</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nc</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;sst&#39;</span><span class="p">])</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Add wrap around at both longitude limits</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">150</span><span class="p">))</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">+</span> <span class="mi">360</span><span class="p">)</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">temp</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>

    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">))</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span><span class="p">)</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lats</span><span class="p">,</span> <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">temp</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>

    <span class="n">lons_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">181</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">-</span> <span class="mf">180.0</span>
    <span class="n">lats_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">91</span> <span class="o">*</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span> <span class="o">-</span> <span class="mf">90.0</span>
    <span class="n">temp_new</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">lons_new</span><span class="p">,</span> <span class="n">lats_new</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

    <span class="n">con</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">lons_new</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">lats_new</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="n">temp_new</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span>

    <span class="c1"># example27</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig27.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;X: mean&#39;</span><span class="p">)</span>
    <span class="n">lineplot</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Zonal mean zonal wind at 100mb&#39;</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">27</span><span class="p">)</span>

    <span class="c1"># example28</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig28.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/ggap.nc&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">g</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;X: mean&#39;</span><span class="p">)</span>
    <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">75</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">15</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">90</span><span class="p">]</span>
    <span class="n">xticklabels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;90S&#39;</span><span class="p">,</span> <span class="s1">&#39;75S&#39;</span><span class="p">,</span> <span class="s1">&#39;60S&#39;</span><span class="p">,</span> <span class="s1">&#39;45S&#39;</span><span class="p">,</span> <span class="s1">&#39;30S&#39;</span><span class="p">,</span> <span class="s1">&#39;15S&#39;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;15N&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;30N&#39;</span><span class="p">,</span> <span class="s1">&#39;45N&#39;</span><span class="p">,</span> <span class="s1">&#39;60N&#39;</span><span class="p">,</span> <span class="s1">&#39;75N&#39;</span><span class="p">,</span> <span class="s1">&#39;90N&#39;</span><span class="p">]</span>
    <span class="n">xpts</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">]</span>
    <span class="n">ypts</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">8</span><span class="p">]</span>

    <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">gopen</span><span class="p">()</span>
    <span class="n">lineplot</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">100</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span>
             <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Zonal mean zonal wind&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;100mb&#39;</span><span class="p">)</span>
    <span class="n">lineplot</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">pressure</span><span class="o">=</span><span class="mi">200</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
             <span class="n">label</span><span class="o">=</span><span class="s1">&#39;200mb&#39;</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
             <span class="n">legend_location</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Region of interest&#39;</span><span class="p">,</span>
                       <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">gclose</span><span class="p">()</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">28</span><span class="p">)</span>

    <span class="c1"># example29</span>
    <span class="n">reset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s1">&#39;fig29.png&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="s1">&#39;/opt/graphics/cfplot_data/tas_A1.nc&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="s1">&#39;1900-01-01&#39;</span><span class="p">),</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="s1">&#39;1980-01-01&#39;</span><span class="p">)))</span>
    <span class="n">temp_annual</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;T: mean&#39;</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">Y</span><span class="p">())</span>
    <span class="n">temp_annual_global</span> <span class="o">=</span> <span class="n">temp_annual</span><span class="o">.</span><span class="n">collapse</span><span class="p">(</span><span class="s1">&#39;area: mean&#39;</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s1">&#39;area&#39;</span><span class="p">)</span>
    <span class="n">temp_annual_global</span><span class="o">.</span><span class="n">Units</span> <span class="o">-=</span> <span class="mf">273.15</span>
    <span class="n">lineplot</span><span class="p">(</span>
        <span class="n">temp_annual_global</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Global average annual temperature&#39;</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">compare_images</span><span class="p">(</span><span class="mi">29</span><span class="p">)</span></div>



<div class="viewcode-block" id="compare_images">
<a class="viewcode-back" href="../compare_images.html#cfplot.compare_images">[docs]</a>
<span class="k">def</span> <span class="nf">compare_images</span><span class="p">(</span><span class="n">example</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Compare images and return an error string if they don&#39;t match</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">hashlib</span>
    <span class="n">disp</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s1">&#39;display&#39;</span><span class="p">)</span>
    <span class="n">conv</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s1">&#39;convert&#39;</span><span class="p">)</span>
    <span class="n">comp</span> <span class="o">=</span> <span class="n">which</span><span class="p">(</span><span class="s1">&#39;compare&#39;</span><span class="p">)</span>
    <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;fig&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">example</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
    <span class="n">file_new</span> <span class="o">=</span> <span class="s1">&#39;/home/andy/cfplot.src/cfplot/&#39;</span> <span class="o">+</span> <span class="n">file</span>
    <span class="n">file_ref</span> <span class="o">=</span> <span class="s1">&#39;/home/andy/regression/&#39;</span> <span class="o">+</span> <span class="n">file</span>

    <span class="c1"># Check md5 checksums are the same and display files if not</span>
    <span class="k">if</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">file_new</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span> <span class="o">!=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">md5</span><span class="p">(</span>
            <span class="nb">open</span><span class="p">(</span><span class="n">file_ref</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;***Failed example &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">example</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;**&#39;</span><span class="p">)</span>
        <span class="n">error_image</span> <span class="o">=</span> <span class="s1">&#39;/home/andy/cfplot.src/cfplot/&#39;</span> <span class="o">+</span> <span class="s1">&#39;error_&#39;</span> <span class="o">+</span> <span class="n">file</span>
        <span class="n">diff_image</span> <span class="o">=</span> <span class="s1">&#39;/home/andy/cfplot.src/cfplot/&#39;</span> <span class="o">+</span> <span class="s1">&#39;difference_&#39;</span> <span class="o">+</span> <span class="n">file</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">comp</span><span class="p">,</span> <span class="n">file_new</span><span class="p">,</span> <span class="n">file_ref</span><span class="p">,</span> <span class="n">diff_image</span><span class="p">])</span>
        <span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">conv</span><span class="p">,</span> <span class="s2">&quot;+append&quot;</span><span class="p">,</span> <span class="n">file_new</span><span class="p">,</span>
                             <span class="n">file_ref</span><span class="p">,</span> <span class="n">error_image</span><span class="p">])</span>
        <span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">err</span><span class="p">)</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">disp</span><span class="p">,</span> <span class="n">diff_image</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Passed example &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">example</span><span class="p">))</span></div>



<div class="viewcode-block" id="compare_arrays">
<a class="viewcode-back" href="../compare_arrays.html#cfplot.compare_arrays">[docs]</a>
<span class="k">def</span> <span class="nf">compare_arrays</span><span class="p">(</span><span class="n">ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">levs_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gvals_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">mapaxis_test</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                   <span class="n">mult</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Compare arrays and return an error string if they don&#39;t match</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">anom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">levs_test</span><span class="p">:</span>
        <span class="n">levs</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">):</span>
            <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">val</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">1e-6</span><span class="p">:</span>
                    <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">anom</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;***levs failure***&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;min, max, step are&#39;</span><span class="p">,</span> <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generated levels are:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;expected levels:&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pass_str</span> <span class="o">=</span> <span class="s1">&#39;Passed cfp.levs(min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, max=&#39;</span>
            <span class="n">pass_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, step=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">pass_str</span><span class="p">)</span>

    <span class="n">anom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">gvals_test</span><span class="p">:</span>
        <span class="n">vals</span><span class="p">,</span> <span class="n">testmult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
            <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ref</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">-</span> <span class="n">vals</span><span class="p">[</span><span class="n">val</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">1e-6</span><span class="p">:</span>
                    <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">mult</span> <span class="o">!=</span> <span class="n">testmult</span><span class="p">:</span>
            <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">anom</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;***gvals failure***&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cfp.gvals(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generated values are:&#39;</span><span class="p">,</span> <span class="n">vals</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;with a  multiplier of &#39;</span><span class="p">,</span> <span class="n">testmult</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;expected values:&#39;</span><span class="p">,</span> <span class="n">ref</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;with a  multiplier of &#39;</span><span class="p">,</span> <span class="n">mult</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pass_str</span> <span class="o">=</span> <span class="s1">&#39;Passed cfp.gvals(&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">pass_str</span><span class="p">)</span>

    <span class="n">anom</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">mapaxis_test</span><span class="p">:</span>
        <span class="n">ref_ticks</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ref_labels</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">test_ticks</span><span class="p">,</span> <span class="n">test_labels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">test_ticks</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref_ticks</span><span class="p">):</span>
            <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ref_ticks</span><span class="p">)):</span>
                <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ref_ticks</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">-</span> <span class="n">test_ticks</span><span class="p">[</span><span class="n">val</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mf">1e-6</span><span class="p">:</span>
                    <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">ref_labels</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="o">!=</span> <span class="n">test_labels</span><span class="p">[</span><span class="n">val</span><span class="p">]:</span>
                    <span class="n">anom</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">anom</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;***mapaxis failure***&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cfp.mapaxis(min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, max=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">))</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;, type=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;generated values are:&#39;</span><span class="p">,</span> <span class="n">test_ticks</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;with labels:&#39;</span><span class="p">,</span> <span class="n">test_labels</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;expected ticks:&#39;</span><span class="p">,</span> <span class="n">ref_ticks</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;with labels:&#39;</span><span class="p">,</span> <span class="n">ref_labels</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">pass_str</span> <span class="o">=</span> <span class="s1">&#39;Passed cfp.mapaxis(min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, max=&#39;</span>
            <span class="n">pass_str</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, type=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">type</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">pass_str</span><span class="p">)</span></div>



<div class="viewcode-block" id="traj">
<a class="viewcode-back" href="../traj.html#cfplot.traj">[docs]</a>
<span class="k">def</span> <span class="nf">traj</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">linecolor</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span>
         <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">markevery</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">markerfacecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
         <span class="n">markeredgecolor</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
         <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">legend_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">colorbar_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span>
         <span class="n">colorbar_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_text_up_down</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
         <span class="n">colorbar_text_down_up</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">colorbar_drawedges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
         <span class="n">colorbar_fraction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_thick</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">colorbar_anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">colorbar_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">vector</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">head_width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">head_length</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
         <span class="n">fc</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | traj is the interface to trajectory plotting in cf-plot.</span>
<span class="sd">    | The minimum use is traj(f) where f is a CF field.</span>
<span class="sd">    |</span>
<span class="sd">    | f - CF data used to make a line plot</span>
<span class="sd">    | linestyle=&#39;-&#39; - line style</span>
<span class="sd">    | linecolor=&#39;b&#39; - line colour</span>
<span class="sd">    | linewidth=1.0 - line width</span>
<span class="sd">    | marker=&#39;o&#39; - marker for points along the line</span>
<span class="sd">    | markersize=30 - size of the marker</span>
<span class="sd">    | markerfacecolor=&#39;b&#39; - colour of the marker face</span>
<span class="sd">    | markeredgecolor=&#39;g&#39; - colour of the marker edge</span>
<span class="sd">    | legend=False - plot different colour markers based on a set of user levels</span>
<span class="sd">    | zorder=None - order for plotting</span>
<span class="sd">    | verbose=None - Set to True to get a verbose listing of what traj is doing</span>
<span class="sd">    |</span>
<span class="sd">    | The following parameters override any CF data defaults:</span>
<span class="sd">    | title=None - plot title</span>
<span class="sd">    | axes=True - plot x and y axes</span>
<span class="sd">    | xaxis=True - plot xaxis</span>
<span class="sd">    | yaxis=True - plot y axis</span>
<span class="sd">    | xlabel=None - x name</span>
<span class="sd">    | ylabel=None - y name</span>
<span class="sd">    | xticks=None - x ticks</span>
<span class="sd">    | xticklabels=None - x tick labels</span>
<span class="sd">    | yticks=None - y ticks</span>
<span class="sd">    | yticklabels=None - y tick labels</span>
<span class="sd">    | colorbar=None - plot a colorbar</span>
<span class="sd">    | colorbar_position=None - position of colorbar</span>
<span class="sd">    |                          [xmin, ymin, x_extent,y_extent] in normalised</span>
<span class="sd">    |                          coordinates. Use when a common colorbar</span>
<span class="sd">    |                          is required for a set of plots. A typical set</span>
<span class="sd">    |                          of values would be [0.1, 0.05, 0.8, 0.02]</span>
<span class="sd">    | colorbar_orientation=None - orientation of the colorbar</span>
<span class="sd">    | colorbar_title=None - title for the colorbar</span>
<span class="sd">    | colorbar_text_up_down=False - if True horizontal colour bar labels alternate</span>
<span class="sd">    |                             above (start) and below the colour bar</span>
<span class="sd">    | colorbar_text_down_up=False - if True horizontal colour bar labels alternate</span>
<span class="sd">    |                             below (start) and above the colour bar</span>
<span class="sd">    | colorbar_drawedges=True - draw internal divisions in the colorbar</span>
<span class="sd">    | colorbar_fraction=None - space for the colorbar - default = 0.21, in normalised</span>
<span class="sd">    |                       coordinates</span>
<span class="sd">    | colorbar_thick=None - thickness of the colorbar - default = 0.015, in normalised</span>
<span class="sd">    |                       coordinates</span>
<span class="sd">    | colorbar_anchor=None - default=0.5 - anchor point of colorbar within the fraction space.</span>
<span class="sd">    |                        0.0 = close to plot, 1.0 = further away</span>
<span class="sd">    | colorbar_shrink=None - value to shrink the colorbar by.  If the colorbar</span>
<span class="sd">    |                        exceeds the plot area then values of 1.0, 0.55</span>
<span class="sd">    |                        or 0.5m ay help it better fit the plot area.</span>
<span class="sd">    | colorbar_labels=None - labels for the colorbar.  Default is to use the levels defined</span>
<span class="sd">    |                        using cfp.levs</span>
<span class="sd">    | Vector options</span>
<span class="sd">    | vector=False - Draw vectors</span>
<span class="sd">    | head_width=2.0 - vector head width</span>
<span class="sd">    | head_length=2.0 - vector head length</span>
<span class="sd">    | fc=&#39;k&#39; - vector face colour</span>
<span class="sd">    | ec=&#39;k&#39; - vector edge colour</span>


<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;traj - making a trajectory plot&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.traj - cannot make a trajectory plot from a field list &quot;</span>
        <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;- need to pass a field</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Read in data</span>
    <span class="c1"># Find the auxiliary lons and lats if provided</span>
    <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">auxiliary_coordinates</span><span class="p">()):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]:</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">array</span>

    <span class="c1"># Raise an error if lons and lats not found in the input data</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_lons</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_lats</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n\n\n</span><span class="s1">traj error</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_lons</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s1">&#39;missing longitudes in the field auxiliary data</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_lats</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s1">&#39;missing latitudes in the field auxiliary data</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n\n\n</span><span class="s1">&#39;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">latmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&gt;=</span> <span class="n">latmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">if</span> <span class="n">latmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&lt;=</span> <span class="n">latmin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Set potential user axis labels</span>
    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>

    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Set plotting parameters</span>
    <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">continent_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span>
    <span class="n">land_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">land_color</span>
    <span class="n">ocean_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ocean_color</span>
    <span class="n">lake_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lake_color</span>

    <span class="c1">##################</span>
    <span class="c1"># Open a new plot is necessary</span>
    <span class="c1">##################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Call gpos(1) if not already called</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Set up mapping</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="mi">180</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>

    <span class="n">set_map</span><span class="p">()</span>
    <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>

    <span class="c1"># Set the plot limits</span>
    <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span>
         <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Make lons and lats 2d if they are 1d</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">ntracks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lons</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ntracks</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">legend</span> <span class="ow">or</span> <span class="n">legend_lines</span><span class="p">:</span>
        <span class="c1"># Check levels are not None</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;traj - plotting different colour markers based on a user set of levels&#39;</span><span class="p">)</span>
            <span class="n">levs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Automatic levels</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;traj - generating automatic legend levels&#39;</span><span class="p">)</span>
            <span class="n">dmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">dmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">levs</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">dmax</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Add extend options to the levels if set</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
            <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">1e-30</span><span class="p">,</span> <span class="n">levs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
            <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">levs</span><span class="p">,</span> <span class="mf">1e30</span><span class="p">)</span>

        <span class="c1"># Set the default colour scale</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># User selected colour map but no mods so fit to levels</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cscale</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs_user</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1">##################################</span>
    <span class="c1"># Line, symbol and vector plotting</span>
    <span class="c1">##################################</span>
    <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ntracks</span><span class="p">):</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">xpts_orig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xpts</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>

        <span class="c1"># Check if xpts are only within the remapped longitudes above</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">170</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">170</span><span class="p">:</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts_orig</span>

            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
                    <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">360.0</span>
                <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">60</span><span class="p">:</span>
                    <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span>

        <span class="c1"># Plot lines and markers</span>
        <span class="n">plot_linewidth</span> <span class="o">=</span> <span class="n">linewidth</span>
        <span class="n">plot_markersize</span> <span class="o">=</span> <span class="n">markersize</span>
        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">plot_markersize</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">if</span> <span class="n">plot_linewidth</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">plot_markersize</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">track</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">linewidth</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting lines&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">track</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">markersize</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting markers&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">legend_lines</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span>
                           <span class="n">linewidth</span><span class="o">=</span><span class="n">plot_linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                           <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span> <span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="n">plot_markersize</span><span class="p">,</span>
                           <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">markerfacecolor</span><span class="p">,</span> <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">markeredgecolor</span><span class="p">,</span>
                           <span class="n">markeredgewidth</span><span class="o">=</span><span class="n">markeredgewidth</span><span class="p">,</span>
                           <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line_xpts</span> <span class="o">=</span> <span class="n">xpts</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
                <span class="n">line_ypts</span> <span class="o">=</span> <span class="n">ypts</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
                <span class="n">line_data</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">line_xpts</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">line_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_data</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>

                    <span class="n">col</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">))]</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">line_xpts</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="n">line_ypts</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                               <span class="n">linewidth</span><span class="o">=</span><span class="n">plot_linewidth</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                               <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

        <span class="c1"># Plot vectors</span>
        <span class="k">if</span> <span class="n">vector</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">track</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;plotting vectors&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plot_zorder</span> <span class="o">=</span> <span class="mi">101</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plot_zorder</span> <span class="o">=</span> <span class="n">zorder</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">xpts</span><span class="o">.</span><span class="n">size</span>

                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">pts</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span>
                                <span class="n">xpts</span><span class="p">[</span><span class="n">pt</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xpts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span>
                                <span class="n">ypts</span><span class="p">[</span><span class="n">pt</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ypts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span>
                                <span class="n">head_width</span><span class="o">=</span><span class="n">head_width</span><span class="p">,</span>
                                <span class="n">head_length</span><span class="o">=</span><span class="n">head_length</span><span class="p">,</span>
                                <span class="n">fc</span><span class="o">=</span><span class="n">fc</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">ec</span><span class="p">,</span>
                                <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="n">plot_zorder</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># Plot different colour markers based on a user set of levels</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>

        <span class="c1"># For polar stereographic plots mask any points outside the plotting limb</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ntracks</span><span class="p">):</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">data2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>



            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">data2</span><span class="p">):</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">data2</span> <span class="o">&gt;=</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data2</span> <span class="o">&lt;=</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">data2</span> <span class="o">&gt;=</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data2</span> <span class="o">&lt;=</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span>

                <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">plot_zorder</span> <span class="o">=</span> <span class="mi">101</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plot_zorder</span> <span class="o">=</span> <span class="n">zorder</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                    <span class="n">mymap</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">pts</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">],</span>
                                  <span class="n">s</span><span class="o">=</span><span class="n">markersize</span><span class="o">*</span><span class="mi">15</span><span class="p">,</span>
                                  <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                                  <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                                  <span class="n">edgecolors</span><span class="o">=</span><span class="n">markeredgecolor</span><span class="p">,</span>
                                  <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">zorder</span><span class="o">=</span><span class="n">plot_zorder</span><span class="p">)</span>

    <span class="c1"># Axes</span>
    <span class="n">plot_map_axes</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                  <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                  <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                  <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span> <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1"># Coastlines</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;land&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;physical&#39;</span><span class="p">,</span>
                                           <span class="n">scale</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                                           <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>

    <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">continent_color</span><span class="p">,</span>
                      <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
                      <span class="n">linestyle</span><span class="o">=</span><span class="n">continent_linestyle</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ocean_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;face&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">ocean_color</span><span class="p">,</span>
                          <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">land_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;face&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">land_color</span><span class="p">,</span>
                          <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lake_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAKES</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;face&#39;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="n">lake_color</span><span class="p">,</span>
                          <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">)</span>

    <span class="c1"># Title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># Color bar</span>
    <span class="n">plot_colorbar</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">colorbar</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">plot_colorbar</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">colorbar</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">legend_lines</span><span class="p">:</span>
        <span class="n">plot_colorbar</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
        <span class="n">plot_colorbar</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">plot_colorbar</span><span class="p">:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">colorbar_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;No Name&#39;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">):</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nc</span><span class="p">:</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;short_name&#39;</span><span class="p">):</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">short_name</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;long_name&#39;</span><span class="p">):</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">long_name</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;standard_name&#39;</span><span class="p">):</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">standard_name</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s1">&#39;Units&#39;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">colorbar_title</span> <span class="o">+=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">colorbar_title</span> <span class="o">+=</span> <span class="s1">&#39;(&#39;</span> <span class="o">+</span> <span class="n">supscr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span>

        <span class="n">levs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>
        <span class="k">if</span> <span class="n">colorbar_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">levs</span> <span class="o">=</span> <span class="n">colorbar_labels</span>
        <span class="n">cbar</span><span class="p">(</span><span class="n">levs</span><span class="o">=</span><span class="n">levs</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="n">levs</span><span class="p">,</span>
             <span class="n">orientation</span><span class="o">=</span><span class="n">colorbar_orientation</span><span class="p">,</span>
             <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
             <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
             <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span>
             <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
             <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span>
             <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
             <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span>
             <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span>
             <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

    <span class="c1">##########</span>
    <span class="c1"># Save plot</span>
    <span class="c1">##########</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gclose</span><span class="p">()</span></div>



<div class="viewcode-block" id="cbar">
<a class="viewcode-back" href="../cbar.html#cfplot.cbar">[docs]</a>
<span class="k">def</span> <span class="nf">cbar</span><span class="p">(</span><span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">orientation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">shrink</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">fraction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">text_up_down</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">text_down_up</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">drawedges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">levs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">thick</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">mid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
         <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | cbar is the cf-plot interface to the Matplotlib colorbar routine</span>
<span class="sd">    |</span>
<span class="sd">    | labels - colorbar labels</span>
<span class="sd">    | orientation - orientation &#39;horizontal&#39; or &#39;vertical&#39;</span>
<span class="sd">    | position - user specified colorbar position in normalised</span>
<span class="sd">    |            plot coordinates [left, bottom, width, height]</span>
<span class="sd">    | shrink - default=1.0 - scale colorbar along length</span>
<span class="sd">    | fraction - default = 0.21 - space for the colorbar in</span>
<span class="sd">    |            normalised plot coordinates</span>
<span class="sd">    | title - title for the colorbar</span>
<span class="sd">    | fontsize - font size for the colorbar text</span>
<span class="sd">    | fontweight - font weight for the colorbar text</span>
<span class="sd">    | text_up_down - label division text up and down starting with up</span>
<span class="sd">    | text_down_up - label division text down and up starting with down</span>
<span class="sd">    | drawedges - Draw internal delimeter lines in colorbar</span>
<span class="sd">    | levs - colorbar levels</span>
<span class="sd">    | thick - set height of colorbar - default = 0.015,</span>
<span class="sd">    |         in normalised plot coordinates</span>
<span class="sd">    | anchor - default=0.3 - anchor point of colorbar within the fraction space.</span>
<span class="sd">    |                        0.0 = close to plot, 1.0 = further away</span>
<span class="sd">    | extend = None - extensions for colorbar.  The default is for extensions at</span>
<span class="sd">    |                 both ends.</span>
<span class="sd">    | mid = False - label mid points of colours rather than the boundaries</span>
<span class="sd">    | verbose = None</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - adding a colour bar&#39;</span><span class="p">)</span>
        
        
    <span class="k">if</span> <span class="n">fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontsize</span>
    <span class="k">if</span> <span class="n">fontweight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontweight</span>
    <span class="k">if</span> <span class="n">thick</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">thick</span> <span class="o">=</span> <span class="mf">0.012</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">thick</span> <span class="o">=</span> <span class="mf">0.008</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">thick</span> <span class="o">=</span> <span class="mf">0.005</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">thick</span> <span class="o">=</span> <span class="mf">0.003</span>
    <span class="k">if</span> <span class="n">drawedges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">drawedges</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">orientation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="s1">&#39;horizontal&#39;</span>
    <span class="k">if</span> <span class="n">fraction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="mf">0.12</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="mf">0.08</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="mf">0.06</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="mf">0.04</span>
            
    <span class="k">if</span> <span class="n">shrink</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shrink</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">if</span> <span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">anchor</span> <span class="o">=</span> <span class="mf">0.3</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="mf">0.5</span>
    
    
 
        
        
    <span class="c1"># Code for when the user specifies nlevs to the contour command rather than </span>
    <span class="c1"># letting cf-plot work out some levels</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span> <span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">myplot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">myplot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>
            
        <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>
        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">myplot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>


        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">)</span>                       
            
        
        <span class="k">return</span>


    <span class="c1"># Change plot position based on colorbar location  </span>
    <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Work out whether the plot is a map plot or normal plot</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">):</span>
            <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;rotated&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;UKCP&#39;</span><span class="p">):</span>
            <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>     

        <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>

        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span> <span class="s1">&#39;lcc&#39;</span><span class="p">,</span> <span class="s1">&#39;moll&#39;</span><span class="p">,</span> <span class="s1">&#39;merc&#39;</span><span class="p">,</span> <span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="s1">&#39;robin&#39;</span><span class="p">]:</span>
                <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="n">fraction</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="n">fraction</span><span class="p">])</span>

            <span class="c1">#if plotvars.plot_type == 1 and plotvars.proj == &#39;cyl&#39;:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span> <span class="s1">&#39;lcc&#39;</span><span class="p">,</span> <span class="s1">&#39;moll&#39;</span><span class="p">,</span> <span class="s1">&#39;merc&#39;</span><span class="p">,</span> <span class="s1">&#39;ortho&#39;</span><span class="p">,</span> <span class="s1">&#39;robin&#39;</span><span class="p">]:</span>
                <span class="c1"># Move plot up if aspect ratio is &lt; 1.5</span>
                <span class="n">lonrange</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
                <span class="n">latrange</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">/</span> <span class="n">latrange</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.5</span><span class="p">:</span>
                    <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mf">0.08</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="mf">0.12</span><span class="p">])</span>
                    <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>

                <span class="n">ax1</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">l</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">shrink</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span>
                                                     <span class="n">b</span> <span class="o">-</span> <span class="n">fraction</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">anchor</span><span class="p">),</span>
                                                     <span class="n">w</span> <span class="o">*</span> <span class="n">shrink</span><span class="p">,</span>
                                                     <span class="n">thick</span><span class="p">])</span>
                                                     
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="n">fraction</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">-</span> <span class="n">fraction</span><span class="p">])</span>  
                 
                <span class="n">ax1</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">l</span> <span class="o">+</span> <span class="n">w</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">shrink</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span><span class="p">,</span>
                                                     <span class="c1">#b - fraction * (1.0 - anchor),</span>
                                                     <span class="n">b</span><span class="p">,</span>
                                                     <span class="n">w</span> <span class="o">*</span> <span class="n">shrink</span><span class="p">,</span>
                                                     <span class="n">thick</span><span class="p">])</span>                
                
                                                                   
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">l</span> <span class="o">+</span> <span class="n">w</span> <span class="o">+</span> <span class="n">fraction</span> <span class="o">*</span> <span class="p">(</span><span class="n">anchor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                                                 <span class="n">b</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">shrink</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                                                 <span class="n">thick</span><span class="p">,</span>
                                                 <span class="n">h</span> <span class="o">*</span> <span class="n">shrink</span><span class="p">])</span>
            <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span> <span class="o">-</span> <span class="n">fraction</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Set axes position on coords supplied by the user</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
     
        
        
    <span class="k">if</span> <span class="n">levs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cbar error - No levels or labels supplied </span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>





    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">levs</span>

    <span class="c1"># Work out colour bar labeling</span>
    <span class="n">lbot</span> <span class="o">=</span> <span class="n">levs</span>
    <span class="k">if</span> <span class="n">text_up_down</span><span class="p">:</span>
        <span class="n">lbot</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[</span><span class="mi">1</span><span class="p">:][::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ltop</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">text_down_up</span><span class="p">:</span>
        <span class="n">lbot</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ltop</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[</span><span class="mi">1</span><span class="p">:][::</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Get the colour map</span>
    <span class="n">colmap</span> <span class="o">=</span> <span class="n">cscale_get_map</span><span class="p">()</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">extend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">extend</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span>


    <span class="n">ncolors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span>

         
    <span class="k">if</span> <span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="n">ncolors</span> <span class="o">=</span> <span class="n">ncolors</span> <span class="o">-</span> <span class="mi">1</span>
        
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">boundaries</span><span class="o">=</span><span class="n">levs</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="n">ncolors</span><span class="p">)</span>

        <span class="c1"># Change boundaries to floats</span>
        <span class="n">boundaries</span> <span class="o">=</span> <span class="n">levs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># Add colorbar extensions if definded by levs.  Using boundaries[0]-1</span>
        <span class="c1"># for the lower and boundaries[-1]+1 is just for the colorbar and</span>
        <span class="c1"># has no meaning for the plot.</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">boundaries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">boundaries</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">boundaries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">):</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">boundaries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">boundaries</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundaries</span><span class="p">),</span> <span class="n">boundaries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>



        <span class="k">if</span> <span class="n">mid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lbot_new</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
                <span class="n">mid_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">lbot</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lbot</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="n">lbot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">lbot_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mid_point</span><span class="p">)</span>
            <span class="n">lbot</span> <span class="o">=</span> <span class="n">lbot_new</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">lbot</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                                                    <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                                                    <span class="n">extend</span><span class="o">=</span><span class="n">extend</span><span class="p">,</span>
                                                    <span class="n">extendfrac</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                                                    <span class="n">boundaries</span><span class="o">=</span><span class="n">boundaries</span><span class="p">,</span>
                                                    <span class="n">ticks</span><span class="o">=</span><span class="n">lbot</span><span class="p">,</span>
                                                    <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span>
                                                    <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
                                                    <span class="n">drawedges</span><span class="o">=</span><span class="n">drawedges</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">mid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lbot_new</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
                <span class="n">mid_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">lbot</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">lbot</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="o">+</span><span class="n">lbot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">lbot_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mid_point</span><span class="p">)</span>
            <span class="n">lbot</span> <span class="o">=</span> <span class="n">lbot_new</span>

        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span>
                    <span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                    <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                    <span class="n">extend</span><span class="o">=</span><span class="n">extend</span><span class="p">,</span>
                    <span class="n">extendfrac</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span>
                    <span class="n">boundaries</span><span class="o">=</span><span class="n">boundaries</span><span class="p">,</span>
                    <span class="n">ticks</span><span class="o">=</span><span class="n">lbot</span><span class="p">,</span>
                    <span class="n">spacing</span><span class="o">=</span><span class="s1">&#39;uniform&#39;</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
                    <span class="n">drawedges</span><span class="o">=</span><span class="n">drawedges</span><span class="p">)</span>

    <span class="n">colorbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                       <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">)</span>

    <span class="c1"># Bug in Matplotlib colorbar labelling</span>
    <span class="c1"># With clevs=[-1, 1, 10000, 20000, 30000, 40000, 50000, 60000]</span>
    <span class="c1"># Labels are [0, 2, 10001, 20001, 30001, 40001, 50001, 60001]</span>
    <span class="c1"># With a +1 near to the colorbar label</span>


    <span class="c1"># Check for an extraneous level compared to the levs</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">levs</span><span class="p">):</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[:</span><span class="nb">len</span><span class="p">(</span><span class="n">levs</span><span class="p">)]</span>

    <span class="n">colorbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s1">&#39;horizontal&#39;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklines</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">fontweight</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklines</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">fontweight</span><span class="p">)</span>

    <span class="c1"># Alternate text top and bottom on a horizontal colorbar if requested</span>
    <span class="c1"># Use method described at:</span>
    <span class="c1"># https://stackoverflow.com/questions/37161022/matplotlib-colorbar-</span>
    <span class="c1"># alternating-top-bottom-labels</span>
    <span class="k">if</span> <span class="n">text_up_down</span> <span class="ow">or</span> <span class="n">text_down_up</span><span class="p">:</span>

        <span class="n">vmin</span> <span class="o">=</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">vmin</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">vmax</span>

        <span class="k">if</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
            <span class="n">shift_l</span> <span class="o">=</span> <span class="mf">0.05</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="mf">0.95</span>
        <span class="k">elif</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
            <span class="n">shift_l</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="mf">0.95</span>
        <span class="k">elif</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
            <span class="n">shift_l</span> <span class="o">=</span> <span class="mf">0.05</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="mf">0.9</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shift_l</span> <span class="o">=</span> <span class="mf">0.</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># Print bottom tick labels</span>
        <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">lbot</span><span class="p">)</span>

        <span class="c1"># Print top tick labels</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ltop</span><span class="p">:</span>
            <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">shift_l</span> <span class="o">+</span> <span class="n">scaling</span><span class="o">*</span><span class="p">(</span><span class="n">ii</span><span class="o">-</span><span class="n">vmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">vmax</span><span class="o">-</span><span class="n">vmin</span><span class="p">),</span>
                             <span class="mf">1.5</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span> <span class="n">transform</span><span class="o">=</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                             <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                             <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">fontweight</span><span class="p">)</span></div>



<div class="viewcode-block" id="map_title">
<a class="viewcode-back" href="../map_title.html#cfplot.map_title">[docs]</a>
<span class="k">def</span> <span class="nf">map_title</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | map_title is an internal routine to draw a title on a map plot</span>
<span class="sd">    |</span>
<span class="sd">    | title=None - title to put on map plot</span>
<span class="sd">    | dim=False - draw a set of dimension titles</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">boundinglat</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span>
    <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
    <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
    <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
    <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>
    <span class="n">polar_range</span> <span class="o">=</span> <span class="mi">90</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">boundinglat</span><span class="p">)</span>

    <span class="n">myprojs</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;cyl&#39;</span><span class="p">,</span> <span class="s1">&#39;robin&#39;</span><span class="p">,</span> <span class="s1">&#39;moll&#39;</span><span class="p">,</span> <span class="s1">&#39;merc&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="ow">in</span> <span class="n">myprojs</span><span class="p">:</span>    
        <span class="n">lon_mid</span> <span class="o">=</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_mid</span>
        <span class="k">if</span> <span class="n">dims</span><span class="p">:</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lonmin</span>
        <span class="n">projs</span> <span class="o">=</span> <span class="p">[</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">]</span>
        <span class="n">myind</span> <span class="o">=</span> <span class="n">myprojs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span><span class="p">)</span>
        <span class="c1">#if plotvars.proj == &#39;cyl&#39;:</span>
        <span class="c1">#    proj = ccrs.PlateCarree(central_longitude=lon_mid)</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">projs</span><span class="p">[</span><span class="n">myind</span><span class="p">](</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">)</span>
        <span class="n">mylat</span> <span class="o">=</span> <span class="n">latmax</span>
        <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="n">ypt</span> <span class="o">=</span> <span class="n">ypt</span> <span class="o">+</span> <span class="p">(</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">latmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">40.0</span>        
        
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
        <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mi">180</span>
        <span class="n">mylat</span> <span class="o">=</span> <span class="n">boundinglat</span><span class="o">-</span><span class="n">polar_range</span><span class="o">/</span><span class="mf">15.0</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>
        <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">dims</span><span class="p">:</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mi">180</span>
            <span class="n">mylat</span> <span class="o">=</span> <span class="n">boundinglat</span><span class="o">-</span><span class="n">polar_range</span><span class="o">/</span><span class="mf">15.0</span>
            <span class="n">xpt_mid</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">-</span> <span class="mi">90</span>
            <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt_mid</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
        <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span>
        <span class="n">mylat</span> <span class="o">=</span> <span class="n">boundinglat</span><span class="o">+</span><span class="n">polar_range</span><span class="o">/</span><span class="mf">15.0</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>
        <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">dims</span><span class="p">:</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mi">0</span>
            <span class="c1">#mylat = boundinglat-polar_range/15.0</span>
            <span class="n">mylat</span> <span class="o">=</span> <span class="n">boundinglat</span><span class="o">-</span><span class="n">polar_range</span><span class="o">/</span><span class="mf">15.0</span>
            <span class="n">xpt_mid</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">-</span> <span class="mi">90</span>
            <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt_mid</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        


    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;lcc&#39;</span><span class="p">:</span>
        <span class="n">mylon</span> <span class="o">=</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">if</span> <span class="n">dims</span><span class="p">:</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lonmin</span>
        <span class="n">lat_0</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="k">if</span> <span class="n">latmin</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">latmax</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lat_0</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span>
                                     <span class="n">central_latitude</span><span class="o">=</span><span class="n">lat_0</span><span class="p">,</span>
                                     <span class="n">cutoff</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">)</span>
        <span class="n">mylat</span> <span class="o">=</span> <span class="n">latmax</span>
        <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="n">fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>

    <span class="k">if</span> <span class="n">dims</span><span class="p">:</span>
        <span class="n">halign</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>

        <span class="c1"># Get plot position</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>
        <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>
 
        <span class="c1"># Shift to left</span>
        <span class="c1">#if plotvars.plot_type == 1 and plotvars.proj !=cyl:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-</span> <span class="mf">0.1</span>
        <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>

        <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>


        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">l</span> <span class="o">+</span> <span class="n">w</span> <span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="n">h</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                            <span class="n">ha</span><span class="o">=</span><span class="n">halign</span><span class="p">,</span>
                            <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                            <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span><span class="p">)</span>


    <span class="k">else</span><span class="p">:</span>
        <span class="n">halign</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                            <span class="n">ha</span><span class="o">=</span><span class="n">halign</span><span class="p">,</span>
                            <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">,</span>
                            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                            <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span><span class="p">)</span></div>





<span class="k">def</span> <span class="nf">dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title3</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | dim_titles is an internal routine to draw a set of dimension titles on a  plot</span>
<span class="sd">    |</span>
<span class="sd">    | title=None - title to put on the plot</span>
<span class="sd">    | title2=None - additional title </span>
<span class="sd">    | title3=None - additional title     </span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Logic for the supplied titles</span>
    <span class="c1"># if just title is supplied:</span>
    <span class="c1">#     title - contour or line title</span>
    <span class="c1">#</span>
    <span class="c1"># if both title and title2 are supplied:</span>
    <span class="c1">#     title u component of title</span>
    <span class="c1">#     title2 v component of the title</span>
    <span class="c1">#</span>
    <span class="c1"># if title2 and title3 are supplied:</span>
    <span class="c1">#     title2 u component of title</span>
    <span class="c1">#     title3 v component of title</span>
    <span class="c1">#</span>
    <span class="c1"># move the plot around if title3 is None</span>
    

    <span class="c1"># Get plot position</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

    <span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>

    <span class="n">valign</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>
 
    
    <span class="c1"># Shift down if a cylindrical projection plot else to the left</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
        <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-</span> <span class="mf">0.1</span>
        <span class="n">myx</span> <span class="o">=</span> <span class="mf">1.25</span>
        <span class="n">myy</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">valign</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
        <span class="k">if</span> <span class="n">title3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">myx</span> <span class="o">=</span> <span class="mf">1.05</span>
    <span class="k">elif</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
        <span class="n">latrange</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">/</span> <span class="n">latrange</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">:</span>
            <span class="n">myx</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">myy</span> <span class="o">=</span> <span class="mf">1.02</span>
            
        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">/</span> <span class="n">latrange</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.2</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">/</span> <span class="n">latrange</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.5</span><span class="p">:</span>
            <span class="n">myx</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">myy</span> <span class="o">=</span> <span class="mf">1.02</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">h</span> <span class="o">-</span> <span class="mf">0.015</span>        
        
        
        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">/</span> <span class="n">latrange</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.2</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="n">l</span> <span class="o">-</span> <span class="mf">0.1</span>
            <span class="c1">#if title2 is not None:</span>
            <span class="c1">#    l = l - 0.1</span>
            <span class="n">myx</span> <span class="o">=</span> <span class="mf">1.05</span>
            <span class="n">myy</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">w</span> <span class="o">-</span> <span class="mf">0.1</span>
            <span class="n">valign</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">h</span> <span class="o">=</span> <span class="n">h</span> <span class="o">-</span> <span class="mf">0.1</span>
        <span class="n">myx</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">myy</span> <span class="o">=</span> <span class="mf">1.02</span>
        



    <span class="c1"># Change the plot position if title3 is None</span>
    <span class="k">if</span> <span class="n">title3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">l</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">])</span>


    <span class="c1"># Set x and y spacing depending on the label location</span>
    <span class="n">xspacing</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">yspacing</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">myx</span> <span class="o">==</span> <span class="mf">1.05</span> <span class="ow">or</span> <span class="n">myx</span> <span class="o">==</span> <span class="mf">1.25</span><span class="p">:</span>
        <span class="n">xspacing</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">yspacing</span> <span class="o">=</span> <span class="mf">0.2</span>


    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">this_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">myx</span><span class="p">,</span> <span class="n">myy</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">valign</span><span class="p">,</span>
                       <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                       <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                       <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
                       <span class="n">transform</span><span class="o">=</span><span class="n">this_plot</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">this_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">myx</span> <span class="o">+</span> <span class="n">xspacing</span><span class="p">,</span> <span class="n">myy</span> <span class="o">-</span> <span class="n">yspacing</span><span class="p">,</span> <span class="n">title2</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">valign</span><span class="p">,</span>
                   <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                   <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
                   <span class="n">transform</span><span class="o">=</span><span class="n">this_plot</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">title3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">this_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">myx</span> <span class="o">+</span> <span class="n">xspacing</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">myy</span> <span class="o">-</span> <span class="n">yspacing</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">title3</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="n">valign</span><span class="p">,</span>
                   <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                   <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                   <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
                   <span class="n">transform</span><span class="o">=</span><span class="n">this_plot</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>





<div class="viewcode-block" id="plot_map_axes">
<a class="viewcode-back" href="../plot_map_axes.html#cfplot.plot_map_axes">[docs]</a>
<span class="k">def</span> <span class="nf">plot_map_axes</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">user_xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                  <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | plot_map_axes is an internal routine to draw the axes on a map plot</span>
<span class="sd">    |</span>
<span class="sd">    | axes=None - drawing axes</span>
<span class="sd">    | xaxis=None - drawing x-axis</span>
<span class="sd">    | yaxis=None - drawing x-axis</span>
<span class="sd">    | xticks=None - user defined xticks</span>
<span class="sd">    | xticklabels=None - user defined xtick labels</span>
<span class="sd">    | yticks=None - user defined yticks</span>
<span class="sd">    | yticklabels=None - user defined ytick labels</span>
<span class="sd">    | user_xlabel=None - user defined xlabel</span>
<span class="sd">    | user_ylabel=None - user defined ylabel</span>
<span class="sd">    | verbose=None</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Font definitions</span>
    <span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>
    <span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span>

    <span class="c1"># Map parameters</span>
    <span class="n">boundinglat</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span>
    <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
    <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
    <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
    <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>

    <span class="c1"># Cylindrical</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;cyl&#39;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - adding cylindrical axes&#39;</span><span class="p">)</span>
        <span class="n">lonticks</span><span class="p">,</span> <span class="n">lonlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span>
            <span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">latticks</span><span class="p">,</span> <span class="n">latlabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span>
            <span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlabels</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticks</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticks</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.10</span><span class="p">,</span> <span class="n">user_xlabel</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                          <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                          <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">,</span>
                          <span class="n">transform</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                          <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                          <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="o">-</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">,</span> <span class="n">user_ylabel</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span>
                          <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                          <span class="n">rotation</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span> <span class="n">rotation_mode</span><span class="o">=</span><span class="s1">&#39;anchor&#39;</span><span class="p">,</span>
                          <span class="n">transform</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                          <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                          <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">)</span>

    <span class="c1"># Polar stereographic</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;spstere&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;con - adding stereographic axes&#39;</span><span class="p">)</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="n">latrange</span> <span class="o">=</span> <span class="mi">90</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">boundinglat</span><span class="p">)</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">()</span>

        <span class="c1"># Add</span>
        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">latvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="o">*</span><span class="mi">30</span><span class="o">-</span><span class="mi">60</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">latvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
                    <span class="n">latvals</span> <span class="o">=</span> <span class="n">latvals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">latvals</span> <span class="o">&gt;=</span> <span class="n">boundinglat</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">latvals</span> <span class="o">=</span> <span class="n">latvals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">latvals</span> <span class="o">&lt;=</span> <span class="n">boundinglat</span><span class="p">)]</span>

                <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">latvals</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lat</span> <span class="o">-</span> <span class="n">boundinglat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">361</span><span class="p">)</span>
                        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">361</span><span class="p">)</span><span class="o">+</span><span class="n">lat</span>
                        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
                                   <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
                                   <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                                   <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">lonvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">*</span><span class="mi">60</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lonvals</span> <span class="o">=</span> <span class="n">xticks</span>

                <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lonvals</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
                        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">90</span><span class="o">-</span><span class="n">boundinglat</span><span class="p">)</span><span class="o">+</span><span class="n">boundinglat</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">boundinglat</span><span class="o">+</span><span class="mi">91</span><span class="p">)</span><span class="o">-</span><span class="mi">90</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span><span class="o">+</span><span class="n">lon</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
                               <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
                               <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                               <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">)</span>

            <span class="c1"># Add longitude labels</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;npstere&#39;</span><span class="p">:</span>
                <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="mi">90</span>
                <span class="n">latpt</span> <span class="o">=</span> <span class="n">boundinglat</span> <span class="o">-</span> <span class="n">latrange</span><span class="o">/</span><span class="mf">40.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
                <span class="n">latpt</span> <span class="o">=</span> <span class="n">boundinglat</span> <span class="o">+</span> <span class="n">latrange</span> <span class="o">/</span> <span class="mf">40.0</span>

            <span class="n">lon_mid</span><span class="p">,</span> <span class="n">lat_mid</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">pole</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">xaxis</span> <span class="ow">and</span> <span class="n">axis_label_fontsize</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">xtick</span> <span class="ow">in</span> <span class="n">lonvals</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="n">xtick</span><span class="p">,</span> <span class="n">xtick</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lonr</span><span class="p">,</span> <span class="n">latr</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">xtick</span><span class="p">,</span> <span class="n">latpt</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

                    <span class="n">v_align</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                    <span class="k">if</span> <span class="n">lonr</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">h_align</span> <span class="o">=</span> <span class="s1">&#39;right&#39;</span>
                    <span class="k">if</span> <span class="n">lonr</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">h_align</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lonr</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">h_align</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span>
                        <span class="k">if</span> <span class="n">latr</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">v_align</span> <span class="o">=</span> <span class="s1">&#39;top&#39;</span>
                        <span class="k">if</span> <span class="n">latr</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">v_align</span> <span class="o">=</span> <span class="s1">&#39;bottom&#39;</span>

                    <span class="n">mymap</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">lonr</span><span class="p">,</span> <span class="n">latr</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">h_align</span><span class="p">,</span>
                               <span class="n">verticalalignment</span><span class="o">=</span><span class="n">v_align</span><span class="p">,</span>
                               <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                               <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>

        <span class="c1"># Make the plot circular by blanking off around the plot</span>
        <span class="c1"># Find min and max of plotting region in map coordinates</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span><span class="o">+</span><span class="n">boundinglat</span>
        <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="c1"># blank off data past the bounding latitude</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">pts</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">))</span> <span class="o">+</span> <span class="n">xmax</span><span class="p">)</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">pts</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">pts</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">))</span> <span class="o">+</span> <span class="n">xmin</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">pts</span><span class="p">])</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">pts</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">pts</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Turn off map outside the cicular plot area</span>
        <span class="c1">#mymap.outline_patch.set_visible(False)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="c1"># Draw a line around the bounding latitude</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">361</span><span class="p">)</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">boundinglat</span>
        <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
                   <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Modify xlim and ylim values as the default values clip the plot slightly</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mymap</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="n">xmax</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="n">emit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="n">emit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Lambert conformal</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;lcc&#39;</span><span class="p">:</span>
        <span class="n">lon_0</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="o">+</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="o">-</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
        <span class="n">lat_0</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="o">+</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="o">-</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="n">standard_parallels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">latmin</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">latmax</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">standard_parallels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="o">-</span><span class="mi">33</span><span class="p">]</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">,</span>
                                     <span class="n">central_latitude</span><span class="o">=</span><span class="n">lat_0</span><span class="p">,</span>
                                     <span class="n">cutoff</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
                                     <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">)</span>

        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>

        <span class="c1"># Modify xlim and ylim values as the default values clip the plot slightly</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span><span class="o">*</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">emit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Mask off contours that appear because of the plot extention</span>
        <span class="c1"># mymap.add_patch(mpatches.Polygon([[xmin, ymin], [xmax,ymin],</span>
        <span class="c1">#                                  [xmax, ymin*1.05], [xmin, ymin*1.05]],</span>
        <span class="c1">#                                  facecolor=&#39;red&#39;))</span>
        <span class="c1"># transform=ccrs.PlateCarree()))</span>

        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span><span class="o">-</span><span class="n">lonmin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">latmax</span><span class="o">-</span><span class="n">latmin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">latmin</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">:</span>
            <span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">lat</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">:</span>
            <span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lon</span><span class="p">,</span> <span class="n">latmax</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lonmax</span><span class="p">,</span> <span class="n">lat</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lon</span><span class="p">,</span> <span class="n">latmin</span><span class="p">])</span>

        <span class="c1"># Mask left and right of plot</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">latmax</span><span class="o">-</span><span class="n">latmin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">latmin</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span> <span class="o">+</span> <span class="n">lonmin</span>
        <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">lat_0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Left</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">],</span>
                   <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Right</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">([</span><span class="o">-</span><span class="n">xmin</span><span class="p">,</span> <span class="o">-</span><span class="n">xmin</span><span class="p">,</span> <span class="o">-</span><span class="n">xmax</span><span class="p">,</span> <span class="o">-</span><span class="n">xmin</span><span class="p">],</span>
                   <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">],</span>
                   <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="o">-</span><span class="n">xmin</span><span class="p">,</span> <span class="o">-</span><span class="n">xmax</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Upper</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span><span class="o">-</span><span class="n">lonmin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">latmax</span>
        <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span><span class="o">+</span><span class="n">ymax</span><span class="p">)</span>

        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Lower</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span><span class="o">-</span><span class="n">lonmin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">latmin</span>
        <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.05</span>

        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span><span class="o">+</span><span class="n">ymin</span><span class="p">)</span>

        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Turn off drawing of the rectangular box around the plot</span>
        <span class="c1">#mymap.outline_patch.set_visible(False)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lat_0</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">latmax</span>
            <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span><span class="o">-</span><span class="n">lonmin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">latmin</span>
            <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymax</span> <span class="o">*</span> <span class="mf">1.1</span>

            <span class="n">xpts</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmin</span><span class="p">]</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">]</span>
            <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Draw longitudes and latitudes if requested</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>
        <span class="n">fw</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">and</span> <span class="n">xaxis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">map_xticks</span><span class="p">,</span> <span class="n">map_xticklabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span>
                                                      <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">map_xticks</span> <span class="o">=</span> <span class="n">xticks</span>
                <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">map_xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">map_xticklabels</span> <span class="o">=</span> <span class="n">xticklabels</span>

            <span class="k">if</span> <span class="n">axes</span> <span class="ow">and</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">latmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">latmin</span>
                <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">map_xticks</span><span class="p">)):</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span> <span class="o">+</span> <span class="n">map_xticks</span><span class="p">[</span><span class="n">tick</span><span class="p">]</span>
                    <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                               <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
                               <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                               <span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
                               <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>

                    <span class="n">latpt</span> <span class="o">=</span> <span class="n">latmin</span> <span class="o">-</span> <span class="mi">3</span>
                    <span class="k">if</span> <span class="n">lat_0</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">latpt</span> <span class="o">=</span> <span class="n">latmax</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">map_xticks</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span> <span class="n">latpt</span><span class="p">,</span>
                                                         <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                               <span class="n">map_xticklabels</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span>
                               <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                               <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                               <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">,</span>
                               <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">map_yticks</span><span class="p">,</span> <span class="n">map_yticklabels</span> <span class="o">=</span> <span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span>
                                                  <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span>
                                                  <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">map_yticks</span> <span class="o">=</span> <span class="n">yticks</span>
            <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">map_yticklabels</span> <span class="o">=</span> <span class="n">yticks</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">map_yticklabels</span> <span class="o">=</span> <span class="n">yticklabels</span>

        <span class="k">if</span> <span class="n">axes</span> <span class="ow">and</span> <span class="n">yaxis</span><span class="p">:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span><span class="o">-</span><span class="n">lonmin</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
            <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">map_yticks</span><span class="p">)):</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">map_yticks</span><span class="p">[</span><span class="n">tick</span><span class="p">]</span>
                <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
                <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                           <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                           <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
                           <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                           <span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
                           <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>

                <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lonmin</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                                     <span class="n">map_yticks</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span>
                                                     <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
                <span class="n">mymap</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">device_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">map_yticklabels</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span>
                           <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
                           <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                           <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                           <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">,</span>
                           <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>

                <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">lonmax</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span>
                                                     <span class="n">map_yticks</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span>
                                                     <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
                <span class="n">mymap</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                           <span class="n">device_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                           <span class="n">map_yticklabels</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span>
                           <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                           <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                           <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                           <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">,</span>
                           <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">)</span>

    <span class="c1"># UKCP grid</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s1">&#39;UKCP&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
        <span class="c1">#lonmin = -11</span>
        <span class="c1">#lonmax = 3</span>
        <span class="c1">#latmin = 49</span>
        <span class="c1">#latmax = 61</span>
        <span class="c1">#spacing = plotvars.grid_spacing</span>
        <span class="c1">#if xticks is None:</span>
        <span class="c1">#    lons = np.arange(30 / spacing + 1) * spacing</span>
        <span class="c1">#    lons = np.append((lons*-1)[::-1], lons[1:])</span>
        <span class="c1">#else:</span>
        <span class="c1">#    lons = xticks</span>
        <span class="c1">#if yticks is None:</span>
        <span class="c1">#    lats = np.arange(90.0 / spacing + 1) * spacing</span>
        <span class="c1">#else:</span>
        <span class="c1">#    lats = yticks</span>
            
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="mi">360</span><span class="o">/</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons</span> <span class="o">-</span> <span class="mi">360</span><span class="p">,</span> <span class="n">lons</span><span class="p">])</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="mi">180</span><span class="o">/</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span> <span class="o">-</span> <span class="mi">90</span>    
    
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
                                     <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
                                     <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                                     <span class="n">xlocs</span><span class="o">=</span><span class="n">lons</span><span class="p">,</span> <span class="n">ylocs</span><span class="o">=</span><span class="n">lats</span><span class="p">)</span></div>



<div class="viewcode-block" id="add_cyclic">
<a class="viewcode-back" href="../add_cyclic.html#cfplot.add_cyclic">[docs]</a>
<span class="k">def</span> <span class="nf">add_cyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">lons</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | add_cyclic is a wrapper for cartopy_util.add_cyclic_point(field, lons)</span>
<span class="sd">    | This is needed for the case of when the longitudes are not evenly spaced</span>
<span class="sd">    | due to numpy rounding which causes an error from the cartopy wrapping routine.</span>
<span class="sd">    | In this case the longitudes are promoted to 64 bit and then rounded</span>
<span class="sd">    | to an appropriate number of decimal places before passing to the cartopy</span>
<span class="sd">    | add_cyclic routine.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">try</span><span class="p">:</span>
        <span class="n">field</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="n">cartopy_util</span><span class="o">.</span><span class="n">add_cyclic_point</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">lons</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">ndecs_max</span> <span class="o">=</span> <span class="n">max_ndecs_data</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ndecs_max</span><span class="p">)</span>
        <span class="n">field</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="n">cartopy_util</span><span class="o">.</span><span class="n">add_cyclic_point</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">lons</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">field</span><span class="p">,</span> <span class="n">lons</span></div>



<span class="k">def</span> <span class="nf">irregular_window</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">):</span>

    <span class="n">field_irregular</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
    <span class="n">lats_irregular</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span>


    <span class="c1"># Fix longitudes to be -180 to 180</span>
    <span class="c1"># lons_irregular = ((lons_irregular + plotvars.lonmin) % 360) + plotvars.lonmin</span>

    <span class="c1"># Test data to get appropiate longitude offset to perform remapping</span>
    <span class="n">found_lon</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">ilon</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">]:</span>
        <span class="n">lons_test</span> <span class="o">=</span> <span class="n">lons_irregular</span> <span class="o">+</span> <span class="n">ilon</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lons_test</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">:</span>
            <span class="n">found_lon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lons_offset</span> <span class="o">=</span> <span class="n">ilon</span>

    <span class="k">if</span> <span class="n">found_lon</span><span class="p">:</span>
        <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">lons_irregular</span> <span class="o">+</span> <span class="n">lons_offset</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons_irregular</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span>
        <span class="n">lons_irregular</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons_irregular</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;/n/n cf-plot error - cannot determine grid offset in add_cyclic_irregular/n/n&#39;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">field_wrap</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field_irregular</span><span class="p">)</span>
    <span class="n">lons_wrap</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lons_irregular</span><span class="p">)</span>
    <span class="n">lats_wrap</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lats_irregular</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="mf">120.0</span>

    <span class="n">pts_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons_wrap</span> <span class="o">&gt;=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">+</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">delta</span><span class="p">)</span>
    <span class="n">lons_left</span> <span class="o">=</span> <span class="n">lons_wrap</span><span class="p">[</span><span class="n">pts_left</span><span class="p">]</span> <span class="o">-</span> <span class="mf">360.0</span>
    <span class="n">lats_left</span> <span class="o">=</span> <span class="n">lats_wrap</span><span class="p">[</span><span class="n">pts_left</span><span class="p">]</span>
    <span class="n">field_left</span> <span class="o">=</span> <span class="n">field_wrap</span><span class="p">[</span><span class="n">pts_left</span><span class="p">]</span>

    <span class="n">field_wrap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">field_wrap</span><span class="p">,</span> <span class="n">field_left</span><span class="p">])</span>
    <span class="n">lons_wrap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons_wrap</span><span class="p">,</span> <span class="n">lons_left</span><span class="p">])</span>
    <span class="n">lats_wrap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lats_wrap</span><span class="p">,</span> <span class="n">lats_left</span><span class="p">])</span>

    <span class="c1"># Make a line of interpolated data on left hand side of plot and insert this into the data</span>
    <span class="c1"># on both the left and the right before contouring</span>
    <span class="n">lons_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span> <span class="o">+</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
    <span class="n">lats_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span> <span class="o">-</span> <span class="mi">90</span>
    <span class="n">field_new</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">((</span><span class="n">lons_wrap</span><span class="p">,</span> <span class="n">lats_wrap</span><span class="p">),</span> <span class="n">field_wrap</span><span class="p">,</span> <span class="p">(</span><span class="n">lons_new</span><span class="p">,</span> <span class="n">lats_new</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

    <span class="c1"># Remove any non finite points in the interpolated data</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">field_new</span><span class="p">))</span>
    <span class="n">field_new</span> <span class="o">=</span> <span class="n">field_new</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
    <span class="n">lons_new</span> <span class="o">=</span> <span class="n">lons_new</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
    <span class="n">lats_new</span> <span class="o">=</span> <span class="n">lats_new</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>

    <span class="c1"># Add the interpolated data to the left</span>
    <span class="n">field_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">field_irregular</span><span class="p">,</span> <span class="n">field_new</span><span class="p">])</span>
    <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons_irregular</span><span class="p">,</span> <span class="n">lons_new</span><span class="p">])</span>
    <span class="n">lats_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lats_irregular</span><span class="p">,</span> <span class="n">lats_new</span><span class="p">])</span>

    <span class="c1"># Add to the right if a fiull globe is being plotted</span>
    <span class="c1"># The 359.99 here is needed or Cartopy will map 360 back to 0</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">==</span> <span class="mi">360</span><span class="p">:</span>
        <span class="n">field_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">field_irregular</span><span class="p">,</span> <span class="n">field_new</span><span class="p">])</span>
        <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons_irregular</span><span class="p">,</span> <span class="n">lons_new</span> <span class="o">+</span> <span class="mf">359.95</span><span class="p">])</span>
        <span class="n">lats_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lats_irregular</span><span class="p">,</span> <span class="n">lats_new</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lons_new2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span> <span class="o">+</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">lats_new2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span> <span class="o">-</span> <span class="mi">90</span>
        <span class="n">field_new2</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">((</span><span class="n">lons_wrap</span><span class="p">,</span> <span class="n">lats_wrap</span><span class="p">),</span> <span class="n">field_wrap</span><span class="p">,</span> <span class="p">(</span><span class="n">lons_new2</span><span class="p">,</span> <span class="n">lats_new2</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">)</span>

        <span class="c1"># Remove any non finite points in the interpolated data</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">field_new2</span><span class="p">))</span>
        <span class="n">field_new2</span> <span class="o">=</span> <span class="n">field_new2</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
        <span class="n">lons_new2</span> <span class="o">=</span> <span class="n">lons_new2</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
        <span class="n">lats_new2</span> <span class="o">=</span> <span class="n">lats_new2</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>


        <span class="c1"># Add the interpolated data to the right</span>
        <span class="n">field_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">field_irregular</span><span class="p">,</span> <span class="n">field_new2</span><span class="p">])</span>
        <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons_irregular</span><span class="p">,</span> <span class="n">lons_new2</span><span class="p">])</span>
        <span class="n">lats_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lats_irregular</span><span class="p">,</span> <span class="n">lats_new2</span><span class="p">])</span>

    <span class="c1"># Finally remove any point off to the right of plotvars.lonmax</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons_irregular</span> <span class="o">&lt;=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">field_irregular</span> <span class="o">=</span> <span class="n">field_irregular</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
        <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">lons_irregular</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
        <span class="n">lats_irregular</span> <span class="o">=</span> <span class="n">lats_irregular</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">field_irregular</span><span class="p">,</span> <span class="n">lons_irregular</span><span class="p">,</span> <span class="n">lats_irregular</span>


<div class="viewcode-block" id="max_ndecs_data">
<a class="viewcode-back" href="../max_ndecs_data.html#cfplot.max_ndecs_data">[docs]</a>
<span class="k">def</span> <span class="nf">max_ndecs_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">ndecs_max</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">data_ndecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">data_ndecs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ndecs_max</span><span class="p">:</span>
        <span class="c1"># Reset large decimal vales to zero</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_ndecs</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">data_ndecs</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ndecs_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ndecs_max</span></div>



<div class="viewcode-block" id="fix_floats">
<a class="viewcode-back" href="../fix_floats.html#cfplot.fix_floats">[docs]</a>
<span class="k">def</span> <span class="nf">fix_floats</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | fix_floats fixes numpy rounding issues where 0.4 becomes</span>
<span class="sd">    | 0.399999999999999999999</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Return unchecked if any values have an e in them, for example 7.85e-8</span>
    <span class="n">has_e</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;e&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="n">has_e</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">has_e</span><span class="p">:</span>
        <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="n">data_ndecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">data_ndecs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="c1"># Reset large decimal vales to zero</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_ndecs</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">data_ndecs</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ndecs_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">))</span>
            <span class="c1"># Reset to new ndecs_max decimal places</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ndecs_max</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># fix to two or more decimal places</span>
            <span class="n">nd</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">data_range</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">data_temp</span> <span class="o">=</span> <span class="n">data</span>

            <span class="k">while</span> <span class="n">data_range</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">data_temp</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_temp</span><span class="p">)):</span>
                    <span class="n">data_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">data_temp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nd</span><span class="p">)</span>

                <span class="n">data_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data_temp</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data_temp</span><span class="p">)</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">nd</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data_temp</span>

    <span class="k">return</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></div>



<div class="viewcode-block" id="calculate_levels">
<a class="viewcode-back" href="../calculate_levels.html#cfplot.calculate_levels">[docs]</a>
<span class="k">def</span> <span class="nf">calculate_levels</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="n">dmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="n">dmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="n">tight</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">field2</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>




    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># User defined</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cfp.calculate_levels - using user defined contour levels&#39;</span><span class="p">)</span>
        <span class="n">clevs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fmult</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Automatic levels</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">fmult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;cfp.calculate_levels - generating automatic contour levels&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s1">&#39;outlier&#39;</span> <span class="ow">or</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s1">&#39;inspect&#39;</span><span class="p">:</span>
                <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="mf">0.01</span>
                <span class="n">outlier_detected</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">hist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rate</span><span class="p">:</span>
                        <span class="n">outlier_detected</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">==</span> <span class="n">dmin</span><span class="p">)</span>
                        <span class="n">field2</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">dmax</span>
                        <span class="n">dmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">field2</span><span class="p">)</span>
                            
                    <span class="k">if</span> <span class="n">hist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rate</span><span class="p">:</span>
                        <span class="n">outlier_detected</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">==</span> <span class="n">dmax</span><span class="p">)</span>
                        <span class="n">field2</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">dmin</span>
                        <span class="n">dmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">field2</span><span class="p">)</span>
                            
                <span class="n">clevs</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">dmax</span><span class="p">)</span>
                <span class="n">fmult</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="n">mult</span>
                <span class="n">tight</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s1">&#39;linear&#39;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedConstant</span><span class="p">)</span> <span class="ow">or</span> \
                   <span class="nb">isinstance</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dmax</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedConstant</span><span class="p">):</span>
                   <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;cf-plot calculate_levels error - data is entirely masked</span><span class="se">\n</span><span class="s1">&#39;</span>
                   <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;setting levels to 0 and 0.1 to produce a plot&#39;</span>
                   <span class="nb">print</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
                   <span class="n">dmin</span> <span class="o">=</span> <span class="mf">0.0</span>
                   <span class="n">dmax</span> <span class="o">=</span> <span class="mf">0.1</span>

                <span class="c1">#if dmax - dmin &lt; 1e-12:</span>
                <span class="c1">#   errstr = &#39;cf-plot calculate_levels error - field difference is &lt; 1e-12\n&#39;</span>
                <span class="c1">#   errstr += &#39;setting levels to min-0.1 and min+0.1 to produce a plot&#39;</span>
                <span class="c1">#   print(errstr)</span>
                <span class="c1">#   dmin = dmin - 1</span>
                <span class="c1">#   dmax = dmin + 1</span>
                   
                <span class="n">clevs</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">dmax</span><span class="p">)</span>
                <span class="n">fmult</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="n">mult</span>
                <span class="n">tight</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span> <span class="ow">or</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s1">&#39;loglike&#39;</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">dmin</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">dmax</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">dmin1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmax</span><span class="p">)</span>
                    <span class="n">dmax1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmin</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dmin</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">dmax</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">dmin1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmin</span><span class="p">)</span>
                    <span class="n">dmax1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmax</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dmin</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">dmax</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">dmax1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmin</span><span class="p">),</span> <span class="n">dmax</span><span class="p">)</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
                    <span class="n">close_below</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
                    <span class="n">close_above</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>
                    <span class="n">dmin1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">close_below</span><span class="p">),</span> <span class="n">close_above</span><span class="p">)</span>

                <span class="c1"># Generate levels </span>
                <span class="k">if</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s1">&#39;log&#39;</span><span class="p">:</span>
                    <span class="n">clevs</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">31</span><span class="p">):</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mf">30.</span><span class="p">)</span>
                        <span class="n">clevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.0e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s1">&#39;loglike&#39;</span><span class="p">:</span>
                    <span class="n">clevs</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">61</span><span class="p">):</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mf">30.</span><span class="p">)</span>
                        <span class="n">clevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.0e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
                        <span class="n">clevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.0e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span>
                        <span class="n">clevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.0e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="o">*</span><span class="mi">5</span><span class="p">))</span>
                    <span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>

                <span class="c1"># Remove out of range levels</span>
                <span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">clevs</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmin1</span><span class="p">),</span> <span class="n">clevs</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmax1</span><span class="p">)))</span>
                <span class="n">clevs</span> <span class="o">=</span> <span class="n">clevs</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">dmin</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">dmax</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">clevs</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">clevs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">dmin</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">dmax</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">clevs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">clevs</span><span class="p">])</span>

    <span class="c1"># Use step to generate the levels</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;calculate_levels - using specified step to generate contour levels&#39;</span><span class="p">)</span>

        <span class="n">step</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">dmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dmin</span><span class="p">)</span>
            <span class="n">dmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dmax</span><span class="p">)</span>

        <span class="n">fmult</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">clevs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">dmin</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">clevs</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">dmin</span><span class="o">/</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*-</span><span class="n">step</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">dmax</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">clevs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dmax</span><span class="o">/</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">step</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dmax</span><span class="o">/</span><span class="n">step</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">step</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">clevs</span> <span class="o">=</span> <span class="n">clevs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Remove any out of data range values</span>
    <span class="k">if</span> <span class="n">tight</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">clevs</span> <span class="o">&gt;=</span> <span class="n">dmin</span><span class="p">,</span> <span class="n">clevs</span> <span class="o">&lt;=</span> <span class="n">dmax</span><span class="p">))</span>
        <span class="n">clevs</span> <span class="o">=</span> <span class="n">clevs</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>

    <span class="c1"># Add an extra contour level if less than two levels are present</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">clevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clevs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>

    <span class="c1"># Test for large numer of decimal places and fix if necessary</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clevs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">clevs</span> <span class="o">=</span> <span class="n">fix_floats</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>

    <span class="k">return</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">fmult</span><span class="p">)</span></div>



<div class="viewcode-block" id="stream">
<a class="viewcode-back" href="../stream.html#cfplot.stream">[docs]</a>
<span class="k">def</span> <span class="nf">stream</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arrowsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">arrowstyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">maxlength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
           <span class="n">xaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
           <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | stream - plot a streamplot which is used to show fluid flow and 2D field gradients</span>
<span class="sd">     |</span>
<span class="sd">     | u=None - u wind</span>
<span class="sd">     | v=None - v wind</span>
<span class="sd">     | x=None - x locations of u and v</span>
<span class="sd">     | y=None - y locations of u and v</span>
<span class="sd">     | density=None - controls the closeness of streamlines. When density = 1,</span>
<span class="sd">     |                the domain is divided into a 30x30 grid</span>
<span class="sd">     | linewidth=None - the width of the stream lines. With a 2D array the line width</span>
<span class="sd">     |                  can be varied across the grid. The array must have the same shape</span>
<span class="sd">     |                  as u and v</span>
<span class="sd">     | color=None - the streamline color</span>
<span class="sd">     | arrowsize=None - scaling factor for the arrow size</span>
<span class="sd">     | arrowstyle=None - arrow style specification</span>
<span class="sd">     | minlength=None - minimum length of streamline in axes coordinates</span>
<span class="sd">     | maxlength=None - maximum length of streamline in axes coordinates</span>
<span class="sd">     | axes=True - plot x and y axes</span>
<span class="sd">     | xaxis=True - plot xaxis</span>
<span class="sd">     | yaxis=True - plot y axis</span>
<span class="sd">     | xticks=None - xtick positions</span>
<span class="sd">     | xticklabels=None - xtick labels</span>
<span class="sd">     | yticks=None - y tick positions</span>
<span class="sd">     | yticklabels=None - ytick labels</span>
<span class="sd">     | xlabel=None - label for x axis</span>
<span class="sd">     | ylabel=None - label for y axis</span>
<span class="sd">     | title=None - title for plot</span>
<span class="sd">     | zorder=None - plotting order</span>
<span class="sd">     |</span>
<span class="sd">     :Returns:</span>
<span class="sd">      None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
    <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
    <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
    <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
    <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title_fontsize</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">resolution_orig</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span>
    <span class="n">rotated_vect</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Set potential user axis labels</span>
    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>

    <span class="c1"># Set any additional arguments to streamplot</span>
    <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s1">&#39;density&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">density</span>
    <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">if</span> <span class="n">arrowsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s1">&#39;arrowsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrowsize</span>
    <span class="k">if</span> <span class="n">arrowstyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s1">&#39;arrowstyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrowstyle</span>
    <span class="k">if</span> <span class="n">minlength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s1">&#39;minlength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minlength</span>
    <span class="k">if</span> <span class="n">maxlength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s1">&#39;maxlength&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxlength</span>

    <span class="c1"># Extract required data</span>
    <span class="c1"># If a cf-python field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

        <span class="c1"># Check data is 2D</span>
        <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndims</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.vect error need a 2 dimensonal u field to make vectors</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;received &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ndims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimension</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> \
            <span class="n">ypole</span> <span class="o">=</span> <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">rotated_vect</span><span class="o">=</span><span class="n">rotated_vect</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t plot a field list&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># field=f #field data passed in as f</span>
        <span class="n">check_data</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">u_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">u_x</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">u_y</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

        <span class="c1"># Check data is 2D</span>
        <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndims</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.vect error need a 2 dimensonal v field to make vectors</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;received &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ndims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimension</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> \
            <span class="n">ypole</span> <span class="o">=</span> <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">rotated_vect</span><span class="o">=</span><span class="n">rotated_vect</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t plot a field list&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># field=f #field data passed in as f</span>
        <span class="n">check_data</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">v_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>

    <span class="c1"># Reset xlabel and ylabel values with user defined labels in specified</span>
    <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
    <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>

    <span class="c1"># Retrieve any user defined axis labels</span>
    <span class="k">if</span> <span class="n">xlabel</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">xticks</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">yticks</span><span class="p">))</span>

    <span class="c1"># Open a new plot if necessary</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Call gpos(1) if not already called</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Set plot type if user specified</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">ptype</span>

    <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
    <span class="n">latrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Set up mapping</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">and</span> <span class="n">latrange</span> <span class="o">&gt;</span> <span class="mi">170</span><span class="p">)</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">set_map</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span> <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                   <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span> <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                   <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">)</span>
            <span class="n">set_map</span><span class="p">()</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>

    <span class="c1"># Map streamplot</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

        <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_data</span><span class="p">,</span> <span class="n">v_data</span><span class="p">,</span>
                                  <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                                  <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>

        <span class="c1"># axes</span>
        <span class="n">plot_map_axes</span><span class="p">(</span><span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span> <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                      <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                      <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                      <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span> <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
                      <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Coastlines</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
        <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span>
        <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_color</span> <span class="o">=</span> <span class="s1">&#39;k&#39;</span>
        <span class="k">if</span> <span class="n">continent_linestyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="s1">&#39;solid&#39;</span>

        <span class="n">feature</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
                      <span class="n">name</span><span class="o">=</span><span class="s1">&#39;land&#39;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="s1">&#39;physical&#39;</span><span class="p">,</span>
                      <span class="n">scale</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                      <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">feature</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">continent_color</span><span class="p">,</span>
                          <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
                          <span class="n">linestyle</span><span class="o">=</span><span class="n">continent_linestyle</span><span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1">##########</span>
    <span class="c1"># Save plot</span>
    <span class="c1">##########</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gset</span><span class="p">()</span>
        <span class="n">cscale</span><span class="p">()</span>
        <span class="n">gclose</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mapset</span><span class="p">()</span>
        <span class="n">mapset</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">bfill_ugrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">face_lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">face_lats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">face_connectivity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">     | bfill_ugrid - block fill a irregular field with colour rectangles</span>
<span class="sd">     | This is an internal routine and is not generally used by the user.</span>
<span class="sd">     |</span>
<span class="sd">     | f=None - field</span>
<span class="sd">     | face_lons=None - longitude points for face vertices</span>
<span class="sd">     | face_lats=None - latitude points for face verticies</span>
<span class="sd">     | face_connectivity=None - connectivity for face verticies</span>
<span class="sd">     | clevs=None - levels for filling</span>
<span class="sd">     | lonlat=False - lonlat data</span>
<span class="sd">     | bound=False - x and y are cf data boundaries</span>
<span class="sd">     | alpha=alpha - transparency setting 0 to 1</span>
<span class="sd">     | zorder=None - plotting order</span>
<span class="sd">     |</span>
<span class="sd">      :Returns:</span>
<span class="sd">        None</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>



    <span class="c1"># Colour faces according to value</span>
    <span class="c1"># Set faces to white initially</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#000000&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">face_connectivity</span><span class="p">))]</span>

    <span class="n">levs</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">clevs</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="o">-</span><span class="mf">1e20</span><span class="p">],</span> <span class="n">levs</span><span class="p">])</span>
    <span class="n">ilevs_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s1">&#39;both&#39;</span><span class="p">:</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">levs</span><span class="p">,</span> <span class="p">[</span><span class="mf">1e20</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ilevs_max</span> <span class="o">=</span> <span class="n">ilevs_max</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">ilev</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ilevs_max</span><span class="p">):</span>
        <span class="n">lev</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[</span><span class="n">ilev</span><span class="p">]</span>  
        <span class="n">col</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">ilev</span><span class="p">]</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">lev</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)):</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
                    <span class="n">cols</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span><span class="o">=</span><span class="n">col</span>
    
    <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;transform&#39;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()}</span>

    <span class="n">coords_all</span> <span class="o">=</span> <span class="p">[]</span>
     
    <span class="n">nfaces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">face_connectivity</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>   

    <span class="n">coords_all</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nfaces</span><span class="p">):</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">face_lons</span><span class="p">[</span><span class="n">iface</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">face_lats</span><span class="p">[</span><span class="n">iface</span><span class="p">,</span> <span class="p">:]</span>
        
        <span class="c1"># Wrapping in longitude</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
                    <span class="n">lons</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span> <span class="o">-</span> <span class="mi">180</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
                    <span class="n">lons</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span>

        <span class="n">nverts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>                    
                    
        <span class="c1"># Add extra verticies if any of the points are at the north or south pole</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">90</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>

            <span class="n">geom</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">([(</span><span class="n">lons</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nverts</span><span class="p">)])</span>            
            <span class="n">geom_cyl</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">project_geometry</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">())</span>
            
            <span class="c1"># Original method for shapely &lt; 2.0</span>
            <span class="c1"># coords = geom_cyl[0].exterior.coords[:]</span>

            <span class="c1"># New method for shapely 2.0 +</span>
            <span class="n">poly_mapped</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">geom_cyl</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            
            <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">poly_mapped</span><span class="p">[</span><span class="s1">&#39;coordinates&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>    
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[(</span><span class="n">lons</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nverts</span><span class="p">)]</span>
            
        <span class="n">coords_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
       
    
    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">PolyCollection</span><span class="p">(</span><span class="n">coords_all</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">))</span>











<span class="k">def</span> <span class="nf">generate_titles</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;Generate a set of title dims to put at the top of plots&#39;&#39;&#39;</span>

    <span class="n">mycoords</span> <span class="o">=</span> <span class="n">find_dim_names</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">well_formed</span> <span class="o">=</span> <span class="n">check_well_formed</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="n">title_dims</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idim</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mycoords</span><span class="p">)):</span>
            <span class="n">mycoord</span> <span class="o">=</span> <span class="n">mycoords</span><span class="p">[</span><span class="n">idim</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mycoord</span> <span class="o">==</span> <span class="s1">&#39;Z&#39;</span><span class="p">:</span>
                <span class="n">mycoord</span> <span class="o">=</span> <span class="n">find_z</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
            
            <span class="n">title</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">cf_var_name_titles</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">mycoord</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">title_dims</span> <span class="o">+=</span> <span class="n">mycoord</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span>  <span class="o">+</span> <span class="n">units</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="c1">#if well_formed:</span>
                <span class="c1">#    values = f.construct(mycoord).dtarray</span>
                <span class="c1">#else:</span>
                <span class="c1">#    values = f.construct(mycoord).array</span>
                    
                <span class="n">values</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">dtarray</span>    
                    
                    
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">datetime_as_string</span><span class="p">)</span>
                <span class="n">title_dims</span> <span class="o">+=</span> <span class="n">mycoord</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span>  <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

  
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>                    
            <span class="n">title_dims</span> <span class="o">+=</span> <span class="s1">&#39;cell_methods: &#39;</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">()[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">get_axes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">axis</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">()[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Change domainaxis0 etc to an axis</span>
                        <span class="n">myid</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">constructs</span><span class="o">.</span><span class="n">domain_axis_identity</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="n">myid</span> <span class="o">=</span> <span class="n">axis</span>
        
                    <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">()[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">has_method</span><span class="p">():</span> 
                        <span class="n">value</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">()[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">get_method</span><span class="p">()</span>       
    
                    <span class="n">qualifiers</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">()[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">()</span>
                    <span class="n">qualifier_text</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qualifiers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">qualifier_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">qualifiers</span><span class="p">)</span>   
    
                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">title_dims</span> <span class="o">+=</span> <span class="s1">&#39;, &#39;</span>

                    <span class="n">title_dims</span> <span class="o">+=</span> <span class="n">myid</span> <span class="o">+</span> <span class="s1">&#39;: &#39;</span> <span class="o">+</span> <span class="n">value</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span> <span class="o">+</span> <span class="n">qualifier_text</span>
        
                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                                            
    <span class="k">return</span> <span class="n">title_dims</span>


<span class="k">def</span> <span class="nf">check_well_formed</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">        Check the coordinates are all recognizably of the form X, Y, Z, T</span>
<span class="sd">        returns boolean</span>
<span class="sd">    &#39;&#39;&#39;</span> 
            
    <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">coords</span><span class="p">())</span>
    <span class="n">mycoords</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
            <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Z&#39;</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;T&#39;</span>
            
        
    <span class="c1"># Check if the coordtinates are all of the form X, Y, Z, T    </span>
    <span class="n">well_formed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">dimension_coords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;dimensioncoordinate0&#39;</span><span class="p">,</span><span class="s1">&#39;dimensioncoordinate1&#39;</span><span class="p">,</span><span class="s1">&#39;dimensioncoordinate2&#39;</span><span class="p">,</span><span class="s1">&#39;dimensioncoordinate3&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dimension_coords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">mycoords</span><span class="p">:</span>
            <span class="n">well_formed</span> <span class="o">=</span> <span class="kc">False</span>
                
        
    <span class="k">return</span> <span class="n">well_formed</span>






<span class="k">def</span> <span class="nf">find_dim_names</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Find the field dimension coordinate names</span>
<span class="sd">        Ignores auxiliary coordinates (for now)</span>
<span class="sd">        returns:</span>
<span class="sd">        coordinates in the order [T, X, Y, Z]       </span>
<span class="sd">    &#39;&#39;&#39;</span>
        
    <span class="c1"># Get the field domain axes</span>
    <span class="n">daxes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">get_data_axes</span><span class="p">())</span>
        
    <span class="c1"># Get the field coordinates</span>
    <span class="n">dcoords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">coords</span><span class="p">())</span>     
        
        
    <span class="c1"># Calculate the number of coordinates of type X, Y, Z and T</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nz</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dcoords</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="n">nx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
            <span class="n">ny</span> <span class="o">+=</span> <span class="mi">1</span>            
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="n">nz</span> <span class="o">+=</span> <span class="mi">1</span>        
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="c1">#print(&#39;ajh - t found - &#39;, coords[i])</span>
            <span class="n">nt</span> <span class="o">+=</span> <span class="mi">1</span>      
                
                
    <span class="c1">#print(&#39;ajh - find_dim_names - nx, ny, nz, nt are &#39;, nx, ny, nz, nt)</span>
        
   
    <span class="c1"># Strip out any auxiliary coordinates if the field is not a trajectory field</span>
    <span class="c1">#remove_aux = True</span>
    <span class="c1">#if field.get_property(&#39;featureType&#39;, False) is not False:</span>
    <span class="c1">#    if field.featureType == &#39;trajectory&#39;:</span>
    <span class="c1">#        remove_aux = False</span>

    <span class="c1"># New test</span>
    <span class="n">remove_aux</span> <span class="o">=</span> <span class="kc">False</span>
    
    <span class="c1"># Strip out any auxiliary coordinates if the field is not a trajectory field</span>
    <span class="k">if</span> <span class="n">remove_aux</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dcoords</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;auxiliarycoordinate&#39;</span><span class="p">:</span>
                <span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;aux&#39;</span> 
        <span class="n">dcoords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">((</span><span class="s1">&#39;aux&#39;</span><span class="p">)</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">,</span><span class="n">dcoords</span><span class="p">))</span>
        
        
    <span class="c1">#print(&#39;ajh - daxes are&#39;, daxes)</span>
    <span class="c1">#print(&#39;ajh - dcoords are&#39;, dcoords)</span>
        
        
        
    <span class="c1"># Convert these into corresponding dimension coordinates</span>
    <span class="k">if</span> <span class="n">remove_aux</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daxes</span><span class="p">)):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">daxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dcoords</span><span class="p">)):</span>
            
                <span class="c1">#print(ajh - daxes[i], dcoords[j], field.get_data_axes(dcoords[j])[0])</span>
                
                <span class="k">if</span> <span class="n">daxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">field</span><span class="o">.</span><span class="n">get_data_axes</span><span class="p">(</span><span class="n">dcoords</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="n">dcoords</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>      
        
            <span class="k">if</span> <span class="n">coord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s1">&#39;find_data_names error  - cannot find a coordinate for &#39;</span> <span class="o">+</span> <span class="n">daxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s1">&#39;in the data</span><span class="se">\n</span><span class="s1">&#39;</span>
                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">dcoords</span>
        
    <span class="c1">#print(&#39;ajh - coords are&#39;, coords)</span>
    <span class="c1">#print(&#39;ajh - dcoords are&#39;, dcoords)</span>
        

                
    <span class="c1"># Make a copy of coords in mycoords</span>
    <span class="n">mycoords</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
        
    <span class="c1"># Convert to X, Y, Z, T if coordinate is one of these</span>
    <span class="c1"># If the number of coordinates of this type is greater than 1 then don&#39;t do this as f.coord(&#39;Z&#39;) gives an </span>
    <span class="c1"># error as there are more that one coordinates to return</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daxes</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;X&#39;</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ny</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Y&#39;</span>            
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nz</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Z&#39;</span>  
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;T&#39;</span>            
            
            
    <span class="c1"># Return the reverse of the coordinates so that they are in the order [X, Y, Z, T]</span>
    <span class="n">mycoords</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        
    <span class="c1">#print(&#39;ajh - find_dim_names - mycoords are &#39;, mycoords)</span>
        
    <span class="k">return</span> <span class="n">mycoords</span>


<span class="k">def</span> <span class="nf">find_z</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Find the Z coordinate if it exists&#39;&#39;&#39;</span>

    <span class="c1"># Return if f is undefined</span>
    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
        
        
    <span class="n">myz</span> <span class="o">=</span><span class="s1">&#39;Z&#39;</span>
    <span class="n">z_count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">z_names</span> <span class="o">=</span><span class="p">[]</span>
    
    <span class="n">mycoords</span> <span class="o">=</span> <span class="n">find_dim_names</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    
    <span class="n">myz</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">mycoord</span> <span class="ow">in</span> <span class="n">mycoords</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="n">myz</span> <span class="o">=</span> <span class="n">mycoord</span>

    <span class="c1">#if myz is None:</span>
    <span class="c1">#    errstr = &#39;cf-plot error - cannot find the Z coordinate&#39;</span>
    <span class="c1">#    raise Warning(errstr)</span>

    <span class="k">return</span> <span class="n">myz</span>



<span class="k">def</span> <span class="nf">orca_check</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Check input data to see if it is an orca ocean grid</span>
<span class="sd">        We look for a single discontinuity in longitude where the data changes by </span>
<span class="sd">        greater that 120 degrees.&#39;&#39;&#39;</span>
    
    <span class="n">lons</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
 
    <span class="c1"># Only check for longitude range &gt; 350 degrees</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">350</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>
 
    <span class="n">nvpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lons</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        
    <span class="n">lons_lower</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nvpts</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span> <span class="p">:]</span>
    <span class="n">discont_lower_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lons_lower</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">)</span>
    <span class="n">discont_lower</span> <span class="o">=</span> <span class="n">lons_lower</span><span class="p">[</span><span class="n">discont_lower_idx</span><span class="p">]</span>

    <span class="n">lons_mid</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nvpts</span><span class="o">/</span><span class="mi">2</span><span class="p">),</span> <span class="p">:]</span>
    <span class="n">discont_mid_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lons_mid</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">)</span>
    <span class="n">discont_mid</span> <span class="o">=</span> <span class="n">lons_mid</span><span class="p">[</span><span class="n">discont_mid_idx</span><span class="p">]</span>    
    
    <span class="n">lons_upper</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nvpts</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">),</span> <span class="p">:]</span>
    <span class="n">discont_upper_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lons_upper</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">)</span>
    <span class="n">discont_mid</span> <span class="o">=</span> <span class="n">lons_mid</span><span class="p">[</span><span class="n">discont_mid_idx</span><span class="p">]</span>        
    
    <span class="c1"># Check for one discontinuity   </span>
    <span class="n">retval</span> <span class="o">=</span> <span class="kc">False</span> 
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">discont_lower_idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">discont_mid_idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">discont_upper_idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;orca_check - one discontinutity&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">discont_lower_idx</span><span class="p">,</span> <span class="n">discont_mid_idx</span><span class="p">,</span> <span class="n">discont_upper_idx</span><span class="p">)</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">discont_lower_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">discont_mid_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>     
        <span class="n">v3</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">discont_upper_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>        

        <span class="n">spread</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">([</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">])))</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;orca_check spread is &#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">([</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">]))))</span>
        
        <span class="c1"># Check for discontinuity spead of less than 20 places</span>
        <span class="k">if</span> <span class="n">spread</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="kc">True</span>
            
    
    <span class="k">return</span> <span class="n">retval</span>
    

<span class="k">def</span> <span class="nf">map_grid</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Plot a grid on a map &#39;&#39;&#39;</span>
        
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="mi">360</span><span class="o">/</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons</span> <span class="o">-</span> <span class="mi">360</span><span class="p">,</span> <span class="n">lons</span><span class="p">])</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="mi">180</span><span class="o">/</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span> <span class="o">-</span> <span class="mi">90</span>    

    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
                             <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
                             <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                             <span class="n">xlocs</span><span class="o">=</span><span class="n">lons</span><span class="p">,</span> <span class="n">ylocs</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_zorder</span><span class="p">)</span>
                             
                             
                             
                             

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">

<h3><a href="http://ajheaps.github.io/cf-plot/#">Homepage</a><p></h3>
<h5><a href="http://ajheaps.github.io/cf-plot/gallery.html">Gallery</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/user_guide.html">User Guide</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/training.html">Training material</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/routines.html">Routines</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/internal_routines.html">Routines - internal</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/advanced.html">Advanced Use</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/versions.html">Versions</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/issues.html">Issues</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/download.html">Download/Install</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/license.html">License</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/older_documentation.html">Older documentation</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-plot/search.html">Search</a><p></h5>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="nav-item nav-item-0"><a href="../index.html">cf-plot 3.3.0 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">cfplot</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    &#169; Copyright 2022, Andy Heaps.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.2.6.
    </div>
  </body>
</html>