
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>cfplot &#8212; cf-plot 3.3.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=3eb8911e"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/cfplot';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">This is the new permanent home of the cf-plot documentation: please consult this and not the old frozen version under 'http://ajheaps.github.io'.</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">cf-plot 3.3.0 documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
        </div>
      
      
        <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script>
    </div>
  

  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

<h3><a href="index.html">Homepage</a><p></h3>
<h5><a href="gallery.html">Gallery</a><p></h5>
<h5><a href="user_guide.html">User Guide</a><p></h5>
<h5><a href="training.html">Training material</a><p></h5>
<h5><a href="routines.html">Routines</a><p></h5>
<h5><a href="internal_routines.html">Routines - internal</a><p></h5>
<h5><a href="advanced.html">Advanced Use</a><p></h5>
<h5><a href="versions.html">Versions</a><p></h5>
<h5><a href="issues.html">Issues</a><p></h5>
<h5><a href="download.html">Download/Install</a><p></h5>
<h5><a href="license.html">License</a><p></h5>
<h5><a href="older_documentation.html">Older documentation</a><p></h5>
<h5><a href="search.html">Search</a><p></h5></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">cfplot</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for cfplot</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Climate contour/vector plots using cf-python, matplotlib and cartopy.</span>
<span class="sd">Andy Heaps NCAS-CMS November 2023</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
<span class="kn">from</span> <span class="nn">distutils.version</span> <span class="kn">import</span> <span class="n">StrictVersion</span>

<span class="kn">import</span> <span class="nn">cartopy</span>
<span class="kn">import</span> <span class="nn">cartopy.crs</span> <span class="k">as</span> <span class="nn">ccrs</span>
<span class="kn">import</span> <span class="nn">cartopy.feature</span> <span class="k">as</span> <span class="nn">cfeature</span>
<span class="kn">import</span> <span class="nn">cartopy.util</span> <span class="k">as</span> <span class="nn">cartopy_util</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">mpatches</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plot</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">shapely.geometry</span> <span class="k">as</span> <span class="nn">sgeom</span>
<span class="kn">from</span> <span class="nn">matplotlib.collections</span> <span class="kn">import</span> <span class="n">PolyCollection</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>

<span class="c1"># Check for the minimum cf-python version</span>
<span class="n">cf_version_min</span> <span class="o">=</span> <span class="s2">&quot;3.0.0b2&quot;</span>
<span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> cf-python &gt; </span><span class="si">{</span><span class="n">cf_version_min</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> needs to be installed to use cf-plot </span><span class="se">\n\n</span><span class="s2">&quot;</span>
<span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">cf</span>

    <span class="k">if</span> <span class="n">StrictVersion</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">StrictVersion</span><span class="p">(</span><span class="n">cf_version_min</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">pvars</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Stores plotting variables in `cfp.plotvars`.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize a new Pvars instance.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;`x.__str__() &lt;==&gt; str(x)`&quot;&quot;&quot;</span>
        <span class="n">a</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">v</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s2"> = </span><span class="si">{</span><span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>


<span class="c1"># Check for a display and use the Agg backing store if none is present</span>
<span class="c1"># This is for batch mode processing</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">disp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;DISPLAY&quot;</span><span class="p">]</span>
<span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s2">&quot;Agg&quot;</span><span class="p">)</span>


<span class="c1"># Check for user setting of pre_existing_data_dir pointing to central</span>
<span class="c1"># cartopy setup</span>
<span class="c1"># This is used in the cfview simple setup process</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">pre_existing_data_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;pre_existing_data_dir&quot;</span><span class="p">]</span>
    <span class="n">cartopy</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s2">&quot;pre_existing_data_dir&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pre_existing_data_dir</span>
<span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
    <span class="k">pass</span>


<span class="c1"># Default colour scales</span>
<span class="c1"># cscale1 is a differential data scale - blue to red</span>
<span class="n">cscale1</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;#0a3278&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#0f4ba5&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1e6ec8&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3ca0f0&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#50b4fa&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#82d2ff&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#a0f0ff&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#c8faff&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#e6ffff&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#fffadc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#ffe878&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#ffc03c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#ffa000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#ff6000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#ff3200&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#e11400&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#c00000&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#a50000&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># viridis is a continuous data scale - blue, green, yellow</span>
<span class="n">viridis</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;#440154&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#440255&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#440357&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#450558&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#45065a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#45085b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#46095c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#460b5e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#460c5f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#460e61&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#470f62&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#471163&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#471265&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#471466&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#471567&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#471669&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#47186a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#48196b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#481a6c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#481c6e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#481d6f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#481e70&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#482071&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#482172&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#482273&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#482374&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#472575&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#472676&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#472777&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#472878&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#472a79&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#472b7a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#472c7b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#462d7c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#462f7c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#46307d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#46317e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#45327f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#45347f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#453580&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#453681&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#443781&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#443982&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#433a83&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#433b83&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#433c84&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#423d84&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#423e85&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#424085&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#414186&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#414286&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#404387&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#404487&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3f4587&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3f4788&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3e4888&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3e4989&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3d4a89&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3d4b89&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3d4c89&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3c4d8a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3c4e8a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3b508a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3b518a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3a528b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3a538b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#39548b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#39558b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#38568b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#38578c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#37588c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#37598c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#365a8c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#365b8c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#355c8c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#355d8c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#345e8d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#345f8d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#33608d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#33618d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#32628d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#32638d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#31648d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#31658d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#31668d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#30678d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#30688d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2f698d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2f6a8d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2e6b8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2e6c8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2e6d8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2d6e8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2d6f8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2c708e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2c718e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2c728e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2b738e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2b748e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2a758e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2a768e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2a778e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#29788e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#29798e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#287a8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#287a8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#287b8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#277c8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#277d8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#277e8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#267f8e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#26808e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#26818e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#25828e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#25838d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#24848d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#24858d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#24868d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#23878d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#23888d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#23898d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#22898d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#228a8d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#228b8d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#218c8d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#218d8c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#218e8c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#208f8c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#20908c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#20918c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1f928c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1f938b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1f948b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1f958b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1f968b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1e978a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1e988a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1e998a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1e998a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1e9a89&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1e9b89&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1e9c89&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1e9d88&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1e9e88&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1e9f88&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1ea087&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1fa187&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1fa286&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#1fa386&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#20a485&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#20a585&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#21a685&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#21a784&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#22a784&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#23a883&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#23a982&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#24aa82&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#25ab81&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#26ac81&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#27ad80&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#28ae7f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#29af7f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2ab07e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2bb17d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2cb17d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2eb27c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#2fb37b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#30b47a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#32b57a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#33b679&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#35b778&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#36b877&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#38b976&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#39b976&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3bba75&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3dbb74&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#3ebc73&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#40bd72&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#42be71&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#44be70&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#45bf6f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#47c06e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#49c16d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#4bc26c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#4dc26b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#4fc369&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#51c468&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#53c567&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#55c666&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#57c665&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#59c764&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#5bc862&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#5ec961&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#60c960&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#62ca5f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#64cb5d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#67cc5c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#69cc5b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#6bcd59&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#6dce58&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#70ce56&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#72cf55&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#74d054&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#77d052&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#79d151&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#7cd24f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#7ed24e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#81d34c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#83d34b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#86d449&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#88d547&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#8bd546&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#8dd644&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#90d643&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#92d741&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#95d73f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#97d83e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#9ad83c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#9dd93a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#9fd938&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#a2da37&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#a5da35&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#a7db33&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#aadb32&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#addc30&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#afdc2e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#b2dd2c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#b5dd2b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#b7dd29&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#bade27&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#bdde26&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#bfdf24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#c2df22&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#c5df21&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#c7e01f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#cae01e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#cde01d&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#cfe11c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#d2e11b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#d4e11a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#d7e219&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#dae218&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#dce218&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#dfe318&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#e1e318&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#e4e318&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#e7e419&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#e9e419&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#ece41a&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#eee51b&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#f1e51c&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#f3e51e&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#f6e61f&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#f8e621&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#fae622&quot;</span><span class="p">,</span>
    <span class="s2">&quot;#fde724&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="c1"># Read in defaults if they exist and overlay</span>
<span class="c1"># for contour options of fill, blockfill and lines</span>
<span class="n">global_fill</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">global_lines</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">global_blockfill</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">global_degsym</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">global_viewer</span> <span class="o">=</span> <span class="s2">&quot;display&quot;</span>
<span class="n">defaults_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s2">&quot;~&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;/.cfplot_defaults&quot;</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">defaults_file</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">defaults_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
            <span class="n">com</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">vals</span>
            <span class="n">v</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;True&quot;</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">com</span> <span class="o">==</span> <span class="s2">&quot;blockfill&quot;</span><span class="p">:</span>
                <span class="n">global_blockfill</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">com</span> <span class="o">==</span> <span class="s2">&quot;lines&quot;</span><span class="p">:</span>
                <span class="n">global_lines</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">com</span> <span class="o">==</span> <span class="s2">&quot;fill&quot;</span><span class="p">:</span>
                <span class="n">global_fill</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">com</span> <span class="o">==</span> <span class="s2">&quot;degsym&quot;</span><span class="p">:</span>
                <span class="n">global_degsym</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">if</span> <span class="n">com</span> <span class="o">==</span> <span class="s2">&quot;viewer&quot;</span><span class="p">:</span>
                <span class="n">global_viewer</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

<span class="sd">&quot;&quot;&quot;Global plotting variables.&quot;&quot;&quot;</span>
<span class="n">plotvars</span> <span class="o">=</span> <span class="n">pvars</span><span class="p">(</span>
    <span class="n">lonmin</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span>
    <span class="n">lonmax</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
    <span class="n">latmin</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span>
    <span class="n">latmax</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span>
    <span class="n">proj</span><span class="o">=</span><span class="s2">&quot;cyl&quot;</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;110m&quot;</span><span class="p">,</span>
    <span class="n">plot_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">boundinglat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">lon_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">levels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">levels_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">levels_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">levels_step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">norm</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">levels_extend</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span>
    <span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylog</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;landscape&quot;</span><span class="p">,</span>
    <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">cscale_flag</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">user_levs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">master_plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cs</span><span class="o">=</span><span class="n">cscale1</span><span class="p">,</span>
    <span class="n">cs_user</span><span class="o">=</span><span class="s2">&quot;cscale1&quot;</span><span class="p">,</span>
    <span class="n">mymap</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xstep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ystep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
    <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
    <span class="n">text_fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
    <span class="n">text_fontweight</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span>
    <span class="n">axis_label_fontweight</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span>
    <span class="n">colorbar_fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
    <span class="n">colorbar_fontweight</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span>
    <span class="n">title_fontweight</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span>
    <span class="n">continent_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">continent_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">continent_linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">viewer</span><span class="o">=</span><span class="n">global_viewer</span><span class="p">,</span>
    <span class="n">global_viewer</span><span class="o">=</span><span class="n">global_viewer</span><span class="p">,</span>
    <span class="n">tspace_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tspace_month</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tspace_day</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tspace_hour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xtick_label_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">xtick_label_align</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
    <span class="n">ytick_label_rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">ytick_label_align</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
    <span class="n">legend_text_size</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
    <span class="n">legend_text_weight</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span>
    <span class="n">cs_uniform</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">master_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">master_title_location</span><span class="o">=</span><span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">],</span>
    <span class="n">master_title_fontsize</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">master_title_fontweight</span><span class="o">=</span><span class="s2">&quot;normal&quot;</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">plot_ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">land_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ocean_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">lake_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_zorder</span><span class="o">=</span><span class="mi">99</span><span class="p">,</span>
    <span class="n">twinx</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">twiny</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">rotated_grid_thickness</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
    <span class="n">rotated_grid_spacing</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">rotated_deg_spacing</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span>
    <span class="n">rotated_continents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">rotated_grid</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">rotated_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">legend_frame_edge_color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">legend_frame_face_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">degsym</span><span class="o">=</span><span class="n">global_degsym</span><span class="p">,</span>
    <span class="n">axis_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">grid_x_spacing</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">grid_y_spacing</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">grid_colour</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">grid_linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span>
    <span class="n">grid_zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">grid_thickness</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span>
    <span class="n">graph_xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">graph_xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">graph_ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">graph_ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">level_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tight</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">gpos_called</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">titles_con_called</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># Check for iPython notebook inline</span>
<span class="c1"># and set the viewer to None if found</span>
<span class="n">is_inline</span> <span class="o">=</span> <span class="s2">&quot;inline&quot;</span> <span class="ow">in</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">get_backend</span><span class="p">()</span>
<span class="k">if</span> <span class="n">is_inline</span><span class="p">:</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="kc">None</span>

<span class="c1"># Check for OSX and if so use matplotlib for for the viewer</span>
<span class="c1"># Not all users will have ImageMagick installed / XQuartz running</span>
<span class="c1"># Users can still select this with cfp.setvars(viewer=&#39;display&#39;)</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">platform</span> <span class="o">==</span> <span class="s2">&quot;darwin&quot;</span><span class="p">:</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">global_viewer</span> <span class="o">=</span> <span class="s2">&quot;matplotlib&quot;</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="s2">&quot;matplotlib&quot;</span>


<span class="c1"># ===================================</span>
<span class="c1"># INTERNAL-INTENT FUNCTIONS</span>
<span class="c1"># ===================================</span>

<span class="k">def</span> <span class="nf">_which</span><span class="p">(</span><span class="n">program</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the ImageMagick display command is available.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">is_exe</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO DOCS.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">access</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">X_OK</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ext_candidates</span><span class="p">(</span><span class="n">fpath</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;TODO DOCS.&quot;&quot;&quot;</span>
        <span class="k">yield</span> <span class="n">fpath</span>
        <span class="k">for</span> <span class="n">ext</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PATHEXT&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
            <span class="k">yield</span> <span class="n">fpath</span> <span class="o">+</span> <span class="n">ext</span>

    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PATH&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">pathsep</span><span class="p">):</span>
        <span class="n">exe_file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">program</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">candidate</span> <span class="ow">in</span> <span class="n">ext_candidates</span><span class="p">(</span><span class="n">exe_file</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">is_exe</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">candidate</span>

    <span class="k">return</span> <span class="kc">None</span>


<span class="k">def</span> <span class="nf">_dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title2</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title3</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | An internal routine to draw a set of dimension titles on a plot.</span>
<span class="sd">    |</span>
<span class="sd">    | title=None - title to put on the plot</span>
<span class="sd">    | title2=None - additional title</span>
<span class="sd">    | title3=None - additional title</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Logic for the supplied titles</span>
    <span class="c1"># if just title is supplied:</span>
    <span class="c1">#     title - contour or line title</span>
    <span class="c1">#</span>
    <span class="c1"># if both title and title2 are supplied:</span>
    <span class="c1">#     title u component of title</span>
    <span class="c1">#     title2 v component of the title</span>
    <span class="c1">#</span>
    <span class="c1"># if title2 and title3 are supplied:</span>
    <span class="c1">#     title2 u component of title</span>
    <span class="c1">#     title3 v component of title</span>
    <span class="c1">#</span>
    <span class="c1"># move the plot around if title3 is None</span>

    <span class="c1"># Get plot position</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

    <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>

    <span class="n">valign</span> <span class="o">=</span> <span class="s2">&quot;bottom&quot;</span>

    <span class="c1"># Shift down if a cylindrical projection plot else to the left</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">-=</span> <span class="mf">0.1</span>
        <span class="n">myx</span> <span class="o">=</span> <span class="mf">1.25</span>
        <span class="n">myy</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">valign</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span>
        <span class="k">if</span> <span class="n">title3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">myx</span> <span class="o">=</span> <span class="mf">1.05</span>
    <span class="k">elif</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
        <span class="n">latrange</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">/</span> <span class="n">latrange</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.5</span><span class="p">:</span>
            <span class="n">myx</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">myy</span> <span class="o">=</span> <span class="mf">1.02</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">/</span> <span class="n">latrange</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1.2</span> <span class="ow">and</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">/</span> <span class="n">latrange</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.5</span><span class="p">:</span>
            <span class="n">myx</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">myy</span> <span class="o">=</span> <span class="mf">1.02</span>
            <span class="n">height</span> <span class="o">-=</span> <span class="mf">0.015</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">/</span> <span class="n">latrange</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.2</span><span class="p">:</span>
            <span class="n">left</span> <span class="o">-=</span> <span class="mf">0.1</span>
            <span class="c1"># if title2 is not None:</span>
            <span class="c1">#    l = l - 0.1</span>
            <span class="n">myx</span> <span class="o">=</span> <span class="mf">1.05</span>
            <span class="n">myy</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">width</span> <span class="o">-=</span> <span class="mf">0.1</span>
            <span class="n">valign</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">height</span> <span class="o">-=</span> <span class="mf">0.1</span>
        <span class="n">myx</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">myy</span> <span class="o">=</span> <span class="mf">1.02</span>

    <span class="c1"># Change the plot position if title3 is None</span>
    <span class="k">if</span> <span class="n">title3</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>

    <span class="c1"># Set x and y spacing depending on the label location</span>
    <span class="n">xspacing</span> <span class="o">=</span> <span class="mf">0.3</span>
    <span class="n">yspacing</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">if</span> <span class="n">myx</span> <span class="o">==</span> <span class="mf">1.05</span> <span class="ow">or</span> <span class="n">myx</span> <span class="o">==</span> <span class="mf">1.25</span><span class="p">:</span>
        <span class="n">xspacing</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">yspacing</span> <span class="o">=</span> <span class="mf">0.2</span>

    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">this_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">myx</span><span class="p">,</span>
            <span class="n">myy</span><span class="p">,</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="n">valign</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">this_plot</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">title2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">this_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">myx</span> <span class="o">+</span> <span class="n">xspacing</span><span class="p">,</span>
            <span class="n">myy</span> <span class="o">-</span> <span class="n">yspacing</span><span class="p">,</span>
            <span class="n">title2</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="n">valign</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">this_plot</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">title3</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">this_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">myx</span> <span class="o">+</span> <span class="n">xspacing</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">myy</span> <span class="o">-</span> <span class="n">yspacing</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">title3</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="n">valign</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">this_plot</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">_bfill_ugrid</span><span class="p">(</span>
    <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">face_lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">face_lats</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">face_connectivity</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">clevs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Block fill a irregular field with colour rectangles.</span>
<span class="sd">    | This is an internal routine and is not generally used by the user.</span>
<span class="sd">    |</span>
<span class="sd">    | f=None - field</span>
<span class="sd">    | face_lons=None - longitude points for face vertices</span>
<span class="sd">    | face_lats=None - latitude points for face verticies</span>
<span class="sd">    | face_connectivity=None - connectivity for face verticies</span>
<span class="sd">    | clevs=None - levels for filling</span>
<span class="sd">    | lonlat=False - lonlat data</span>
<span class="sd">    | bound=False - x and y are cf data boundaries</span>
<span class="sd">    | alpha=alpha - transparency setting 0 to 1</span>
<span class="sd">    | zorder=None - plotting order</span>
<span class="sd">    |</span>
<span class="sd">     :Returns:</span>
<span class="sd">       None</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Colour faces according to value</span>
    <span class="c1"># Set faces to white initially</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;#000000&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">face_connectivity</span><span class="p">))]</span>

    <span class="n">levs</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">clevs</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([[</span><span class="o">-</span><span class="mf">1e20</span><span class="p">],</span> <span class="n">levs</span><span class="p">])</span>
    <span class="n">ilevs_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">levs</span><span class="p">,</span> <span class="p">[</span><span class="mf">1e20</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ilevs_max</span> <span class="o">=</span> <span class="n">ilevs_max</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">for</span> <span class="n">ilev</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ilevs_max</span><span class="p">):</span>
        <span class="n">lev</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[</span><span class="n">ilev</span><span class="p">]</span>
        <span class="n">col</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">ilev</span><span class="p">]</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">lev</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)):</span>
                    <span class="n">pt</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
                    <span class="n">cols</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">=</span> <span class="n">col</span>

    <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()}</span>

    <span class="n">coords_all</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">nfaces</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">face_connectivity</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">coords_all</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nfaces</span><span class="p">):</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">face_lons</span><span class="p">[</span><span class="n">iface</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">face_lats</span><span class="p">[</span><span class="n">iface</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># Wrapping in longitude</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
                    <span class="n">lons</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span> <span class="o">-</span> <span class="mi">180</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
                    <span class="n">lons</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">%</span> <span class="mi">360</span>

        <span class="n">nverts</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>

        <span class="c1"># Add extra verticies if any of the points are at the north or</span>
        <span class="c1"># south pole</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">90</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>

            <span class="n">geom</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>
                <span class="p">[(</span><span class="n">lons</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nverts</span><span class="p">)]</span>
            <span class="p">)</span>
            <span class="n">geom_cyl</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">project_geometry</span><span class="p">(</span>
                <span class="n">geom</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="c1"># New method for shapely 2.0 +</span>
            <span class="n">poly_mapped</span> <span class="o">=</span> <span class="n">sgeom</span><span class="o">.</span><span class="n">mapping</span><span class="p">(</span><span class="n">geom_cyl</span><span class="o">.</span><span class="n">geoms</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

            <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">poly_mapped</span><span class="p">[</span><span class="s2">&quot;coordinates&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="p">[(</span><span class="n">lons</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nverts</span><span class="p">)]</span>

        <span class="n">coords_all</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span>
        <span class="n">PolyCollection</span><span class="p">(</span>
            <span class="n">coords_all</span><span class="p">,</span>
            <span class="n">facecolors</span><span class="o">=</span><span class="n">cols</span><span class="p">,</span>
            <span class="n">edgecolors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="o">**</span><span class="n">plotargs</span>
        <span class="p">)</span>
    <span class="p">)</span>


<span class="k">def</span> <span class="nf">_mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Work out a sensible set of longitude and latitude</span>
<span class="sd">    | tick marks and labels. This is an internal routine and is not used</span>
<span class="sd">    | by the user.</span>

<span class="sd">    | min=None - minimum axis value</span>
<span class="sd">    | max=None - maximum axis value</span>
<span class="sd">    | type=None - 1 = longitude, 2 = latitude</span>

<span class="sd">    :Returns:</span>
<span class="sd">     longtitude/latitude ticks and longitude/latitude tick labels</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">degsym</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">degsym</span><span class="p">:</span>
        <span class="n">degsym</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$\degree$&quot;</span>
    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span>
        <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">lonstep</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">720</span><span class="p">,</span> <span class="mi">720</span> <span class="o">+</span> <span class="n">lonstep</span><span class="p">,</span> <span class="n">lonstep</span><span class="p">)</span>
        <span class="n">lonticks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;=</span> <span class="n">lonmin</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&lt;=</span> <span class="n">lonmax</span><span class="p">:</span>
                <span class="n">lonticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>

        <span class="n">lonlabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lonticks</span><span class="p">:</span>
            <span class="n">lon2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
            <span class="k">if</span> <span class="n">lon2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lon2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lon</span> <span class="o">!=</span> <span class="mi">180</span><span class="p">:</span>
                    <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lon2</span><span class="p">))</span> <span class="o">+</span> <span class="n">degsym</span> <span class="o">+</span> <span class="s2">&quot;W&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lon2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lon2</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span>
                <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span> <span class="o">+</span> <span class="n">degsym</span> <span class="o">+</span> <span class="s2">&quot;E&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lon2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="n">degsym</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">lon</span> <span class="o">==</span> <span class="mi">180</span> <span class="ow">or</span> <span class="n">lon</span> <span class="o">==</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span>
                <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;180&quot;</span> <span class="o">+</span> <span class="n">degsym</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">lonlabels</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="nb">min</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="nb">max</span>
        <span class="n">latrange</span> <span class="o">=</span> <span class="n">latmax</span> <span class="o">-</span> <span class="n">latmin</span>
        <span class="n">latstep</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">latstep</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span> <span class="o">+</span> <span class="n">latstep</span><span class="p">,</span> <span class="n">latstep</span><span class="p">)</span>
        <span class="n">latticks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;=</span> <span class="n">latmin</span> <span class="ow">and</span> <span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">latmax</span><span class="p">:</span>
                <span class="n">latticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>

        <span class="n">latlabels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">latticks</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span> <span class="o">+</span> <span class="n">degsym</span> <span class="o">+</span> <span class="s2">&quot;S&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="o">+</span> <span class="n">degsym</span> <span class="o">+</span> <span class="s2">&quot;N&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">lat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="n">degsym</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">latticks</span><span class="p">,</span> <span class="n">latlabels</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_timeaxis</span><span class="p">(</span><span class="n">dtimes</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Work out a sensible set of time labels and tick</span>
<span class="sd">    | marks given a time span. This is an internal routine and is not used</span>
<span class="sd">    | by the user.</span>

<span class="sd">    | dtimes=None - data times as a CF variable</span>

<span class="sd">    :Returns:</span>
<span class="sd">     time ticks and labels</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time_units</span> <span class="o">=</span> <span class="n">dtimes</span><span class="o">.</span><span class="n">Units</span>
    <span class="n">time_ticks</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">time_labels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Time&quot;</span>

    <span class="n">yearmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
    <span class="n">yearmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
    <span class="n">tmin</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">dtarray</span><span class="p">)</span>
    <span class="n">tmax</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">dtimes</span><span class="o">.</span><span class="n">dtarray</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">dtimes</span><span class="p">,</span> <span class="s2">&quot;calendar&quot;</span><span class="p">):</span>
        <span class="n">calendar</span> <span class="o">=</span> <span class="n">dtimes</span><span class="o">.</span><span class="n">calendar</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">calendar</span> <span class="o">=</span> <span class="s2">&quot;standard&quot;</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span>
            <span class="p">)</span>
            <span class="n">yearmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span>
            <span class="p">)</span>
            <span class="n">yearmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span>
            <span class="p">)</span>
            <span class="n">yearmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span>
            <span class="p">)</span>
            <span class="n">yearmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">year</span><span class="p">)</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">)</span>

    <span class="c1"># Years</span>
    <span class="n">span</span> <span class="o">=</span> <span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span>
    <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">span</span> <span class="o">&lt;</span> <span class="mi">3000</span><span class="p">:</span>
        <span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Time (year)&quot;</span>
        <span class="n">tvals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">15</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">60</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">160</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">50</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">600</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">1300</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">200</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span>

        <span class="n">years</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yearmax</span> <span class="o">/</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span>
        <span class="n">tvals</span> <span class="o">=</span> <span class="n">years</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">years</span> <span class="o">&gt;=</span> <span class="n">yearmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">years</span> <span class="o">&lt;=</span> <span class="n">yearmax</span><span class="p">))]</span>

        <span class="c1"># Catch tvals if not properly defined and use gvals to generate some</span>
        <span class="c1"># year tick marks</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">tvals</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">tvals</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">yearmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">yearmax</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">tvals</span><span class="p">:</span>
            <span class="n">time_ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
                    <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                        <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)</span><span class="si">}</span><span class="s2">-01-01 00:00:00&quot;</span><span class="p">),</span>
                        <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span>
                        <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">,</span>
                    <span class="p">)</span><span class="o">.</span><span class="n">array</span>
                <span class="p">)</span>
            <span class="p">)</span>
            <span class="n">time_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">)))</span>

    <span class="c1"># Months</span>
    <span class="k">if</span> <span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span> <span class="o">&lt;=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">months</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s2">&quot;Jan&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Feb&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Mar&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Apr&quot;</span><span class="p">,</span>
            <span class="s2">&quot;May&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Jun&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Jul&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Aug&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Sep&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Oct&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Nov&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Dec&quot;</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># Check number of labels with 1 month steps</span>
        <span class="n">tsteps</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">yearmin</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">):</span>
                <span class="n">mytime</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">-01 00:00:00&quot;</span><span class="p">,</span>
                    <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">mytime</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mytime</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                    <span class="n">tsteps</span> <span class="o">=</span> <span class="n">tsteps</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">tsteps</span> <span class="o">&lt;</span> <span class="mi">17</span><span class="p">:</span>
            <span class="n">mvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tsteps</span> <span class="o">&gt;=</span> <span class="mi">17</span><span class="p">:</span>
            <span class="n">mvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="o">*</span> <span class="mi">3</span>

        <span class="k">for</span> <span class="n">year</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">yearmax</span> <span class="o">-</span> <span class="n">yearmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">yearmin</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">month</span> <span class="ow">in</span> <span class="n">mvals</span><span class="p">:</span>
                <span class="n">mytime</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">month</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">-01 00:00:00&quot;</span><span class="p">,</span>
                    <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">mytime</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mytime</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                    <span class="n">time_ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span>
                            <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                                <span class="n">mytime</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span>
                            <span class="p">)</span><span class="o">.</span><span class="n">array</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                    <span class="n">time_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">months</span><span class="p">[</span><span class="n">month</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">year</span><span class="p">))</span>
                    <span class="p">)</span>

    <span class="c1"># Days and hours</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time_ticks</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">myday</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span>
            <span class="nb">int</span><span class="p">(</span><span class="n">tmin</span><span class="o">.</span><span class="n">year</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmin</span><span class="o">.</span><span class="n">month</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">tmin</span><span class="o">.</span><span class="n">day</span><span class="p">),</span> <span class="n">calendar</span><span class="o">=</span><span class="n">calendar</span>
        <span class="p">)</span>
        <span class="n">not_found</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">hour_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">span</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">not_found</span> <span class="o">&lt;=</span> <span class="mi">48</span><span class="p">:</span>
            <span class="n">mydate</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">myday</span><span class="p">,</span> <span class="n">dtimes</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">+</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                <span class="n">hour_counter</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">mydate</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mydate</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                <span class="n">span</span> <span class="o">=</span> <span class="n">span</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">not_found</span> <span class="o">=</span> <span class="n">not_found</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">hour_counter</span> <span class="o">=</span> <span class="n">hour_counter</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">13</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">13</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">6</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">24</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">400</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">48</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;</span> <span class="mi">800</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="mi">96</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="o">*</span> <span class="mi">24</span>

        <span class="n">not_found</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">hour_counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Time (hour)&quot;</span>
        <span class="k">if</span> <span class="n">span</span> <span class="o">&gt;=</span> <span class="mi">24</span><span class="p">:</span>
            <span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Time&quot;</span>
        <span class="n">time_ticks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">time_labels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">while</span> <span class="n">not_found</span> <span class="o">&lt;=</span> <span class="mi">48</span><span class="p">:</span>
            <span class="n">mytime</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">myday</span><span class="p">,</span> <span class="n">dtimes</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">+</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                <span class="n">hour_counter</span><span class="p">,</span> <span class="s2">&quot;hour&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">mytime</span> <span class="o">&gt;=</span> <span class="n">tmin</span> <span class="ow">and</span> <span class="n">mytime</span> <span class="o">&lt;=</span> <span class="n">tmax</span><span class="p">:</span>
                <span class="n">time_ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mytime</span><span class="o">.</span><span class="n">array</span><span class="p">))</span>
                <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mytime</span><span class="o">.</span><span class="n">year</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">mytime</span><span class="o">.</span><span class="n">month</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">mytime</span><span class="o">.</span><span class="n">day</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">hour_counter</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hour_counter</span> <span class="o">/</span> <span class="mi">24</span><span class="p">):</span>
                    <span class="n">label</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">mytime</span><span class="o">.</span><span class="n">hour</span><span class="si">}</span><span class="s2">:00:00&quot;</span>
                <span class="n">time_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">not_found</span> <span class="o">=</span> <span class="n">not_found</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">hour_counter</span> <span class="o">=</span> <span class="n">hour_counter</span> <span class="o">+</span> <span class="n">step</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">time_ticks</span><span class="p">,</span> <span class="n">time_labels</span><span class="p">,</span> <span class="n">axis_label</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_supscr</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Add superscript text formatting for `**` and `^`.</span>
<span class="sd">    | This is an internal routine used in titles and colour bars</span>
<span class="sd">    | and not used by the user.</span>
<span class="sd">    |</span>
<span class="sd">    | text=None - input text</span>

<span class="sd">    :Returns:</span>
<span class="sd">     Formatted text</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> _supscr error - _supscr must have text input</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">tform</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="n">sup</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;^&quot;</span><span class="p">:</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="n">sup</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">sup</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="n">i</span>
        <span class="k">if</span> <span class="n">sup</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s2">&quot;*&quot;</span><span class="p">:</span>
                <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s2">&quot;*&quot;</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">sup</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">sup</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="s2">&quot;-0123456789&quot;</span><span class="p">:</span>
                <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="n">i</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s2">&quot;}$&quot;</span> <span class="o">+</span> <span class="n">i</span>
                <span class="n">sup</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">sup</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s2">&quot;$^{&quot;</span>
            <span class="n">sup</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">if</span> <span class="n">sup</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span> <span class="o">+</span> <span class="s2">&quot;}$&quot;</span>

    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;m2&quot;</span><span class="p">,</span> <span class="s2">&quot;m$^</span><span class="si">{2}</span><span class="s2">$&quot;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;m3&quot;</span><span class="p">,</span> <span class="s2">&quot;m$^</span><span class="si">{3}</span><span class="s2">$&quot;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;m-2&quot;</span><span class="p">,</span> <span class="s2">&quot;m$^{-2}$&quot;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;m-3&quot;</span><span class="p">,</span> <span class="s2">&quot;m$^{-3}$&quot;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;s-1&quot;</span><span class="p">,</span> <span class="s2">&quot;s$^{-1}$&quot;</span><span class="p">)</span>
    <span class="n">tform</span> <span class="o">=</span> <span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;s-2&quot;</span><span class="p">,</span> <span class="s2">&quot;s$^{-2}$&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tform</span>


<span class="k">def</span> <span class="nf">_gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Work out a sensible set of values between two limits.</span>
<span class="sd">    | This is an internal routine used for contour levels and axis</span>
<span class="sd">    | labelling and is not generally used by the user.</span>

<span class="sd">    | dmin = None - minimum</span>
<span class="sd">    | dmax = None - maximum</span>
<span class="sd">    | mystep = None - use this step</span>
<span class="sd">    | mod = True - modify data to make use of a multipler</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Copies of inputs as these might be changed</span>
    <span class="n">dmin1</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">dmin</span><span class="p">)</span>
    <span class="n">dmax1</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">dmax</span><span class="p">)</span>

    <span class="c1"># Swap values if dmin1 &gt; dmax1</span>
    <span class="k">if</span> <span class="n">dmax1</span> <span class="o">&lt;</span> <span class="n">dmin1</span><span class="p">:</span>
        <span class="n">dmin1</span><span class="p">,</span> <span class="n">dmax1</span> <span class="o">=</span> <span class="n">dmax1</span><span class="p">,</span> <span class="n">dmin1</span>

    <span class="c1"># Data range</span>
    <span class="n">data_range</span> <span class="o">=</span> <span class="n">dmax1</span> <span class="o">-</span> <span class="n">dmin1</span>

    <span class="c1"># field multiplier</span>
    <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Return some values if dmin1 = dmax1</span>
    <span class="k">if</span> <span class="n">dmin1</span> <span class="o">==</span> <span class="n">dmax1</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dmin1</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dmin1</span><span class="p">,</span> <span class="n">dmin1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mult</span>

    <span class="c1"># Modify if requested or if out of range 0.001 to 2000000</span>
    <span class="k">if</span> <span class="n">data_range</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">dmax1</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">dmin1</span> <span class="o">=</span> <span class="n">dmin1</span> <span class="o">*</span> <span class="mf">10.0</span>
            <span class="n">dmax1</span> <span class="o">=</span> <span class="n">dmax1</span> <span class="o">*</span> <span class="mf">10.0</span>
            <span class="n">data_range</span> <span class="o">=</span> <span class="n">dmax1</span> <span class="o">-</span> <span class="n">dmin1</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="n">mult</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">data_range</span> <span class="o">&gt;</span> <span class="mi">2000000</span><span class="p">:</span>
        <span class="k">while</span> <span class="n">dmax1</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">dmin1</span> <span class="o">=</span> <span class="n">dmin1</span> <span class="o">/</span> <span class="mf">10.0</span>
            <span class="n">dmax1</span> <span class="o">=</span> <span class="n">dmax1</span> <span class="o">/</span> <span class="mf">10.0</span>
            <span class="n">data_range</span> <span class="o">=</span> <span class="n">dmax1</span> <span class="o">-</span> <span class="n">dmin1</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="n">mult</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">data_range</span> <span class="o">&gt;=</span> <span class="mf">0.001</span> <span class="ow">and</span> <span class="n">data_range</span> <span class="o">&lt;=</span> <span class="mi">2000000</span><span class="p">:</span>

        <span class="c1"># Calculate an appropriate step</span>
        <span class="n">step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">test_steps</span> <span class="o">=</span> <span class="p">[</span>
            <span class="mf">0.0001</span><span class="p">,</span>
            <span class="mf">0.0002</span><span class="p">,</span>
            <span class="mf">0.0005</span><span class="p">,</span>
            <span class="mf">0.001</span><span class="p">,</span>
            <span class="mf">0.002</span><span class="p">,</span>
            <span class="mf">0.005</span><span class="p">,</span>
            <span class="mf">0.01</span><span class="p">,</span>
            <span class="mf">0.02</span><span class="p">,</span>
            <span class="mf">0.05</span><span class="p">,</span>
            <span class="mf">0.1</span><span class="p">,</span>
            <span class="mf">0.2</span><span class="p">,</span>
            <span class="mf">0.5</span><span class="p">,</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="mi">2</span><span class="p">,</span>
            <span class="mi">5</span><span class="p">,</span>
            <span class="mi">10</span><span class="p">,</span>
            <span class="mi">20</span><span class="p">,</span>
            <span class="mi">50</span><span class="p">,</span>
            <span class="mi">100</span><span class="p">,</span>
            <span class="mi">200</span><span class="p">,</span>
            <span class="mi">500</span><span class="p">,</span>
            <span class="mi">1000</span><span class="p">,</span>
            <span class="mi">2000</span><span class="p">,</span>
            <span class="mi">5000</span><span class="p">,</span>
            <span class="mi">10000</span><span class="p">,</span>
            <span class="mi">20000</span><span class="p">,</span>
            <span class="mi">50000</span><span class="p">,</span>
            <span class="mi">100000</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">mystep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">step</span> <span class="o">=</span> <span class="n">mystep</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">test_steps</span><span class="p">:</span>
                <span class="n">nvals</span> <span class="o">=</span> <span class="n">data_range</span> <span class="o">/</span> <span class="n">val</span>

                <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nvals</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">:</span>
                        <span class="n">step</span> <span class="o">=</span> <span class="n">val</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">nvals</span> <span class="o">&gt;</span> <span class="mi">11</span><span class="p">:</span>
                        <span class="n">step</span> <span class="o">=</span> <span class="n">val</span>

        <span class="c1"># Return an error if no step found</span>
        <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> cfp._gvals - no valid step values found </span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;cfp._gvals(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dmin1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">dmax1</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="c1"># values  &lt; 0.0</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">vals1</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dmin1</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">vals1</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="n">dmin1</span> <span class="o">/</span> <span class="n">step</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="n">step</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">step</span>

        <span class="c1"># values  &gt;= 0.0</span>
        <span class="n">vals2</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">dmax1</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">vals2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dmax1</span> <span class="o">/</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span>

        <span class="k">if</span> <span class="n">vals1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vals2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals1</span>
        <span class="k">if</span> <span class="n">vals2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vals1</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals2</span>
        <span class="k">if</span> <span class="n">vals1</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">vals2</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">vals1</span><span class="p">,</span> <span class="n">vals2</span><span class="p">))</span>

        <span class="c1"># Round off decimal numbers so that</span>
        <span class="c1"># (np.arange(4) * -0.1)[3] = -0.30000000000000004 gives -0.3</span>
        <span class="c1"># as expected</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>

        <span class="c1"># Change values to integers for values &gt;= 1</span>
        <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">vals</span> <span class="o">&gt;=</span> <span class="n">dmin1</span><span class="p">,</span> <span class="n">vals</span> <span class="o">&lt;=</span> <span class="n">dmax1</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">mod</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">vals</span> <span class="o">*</span> <span class="mi">10</span><span class="o">**</span><span class="n">mult</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Catch if no values have been defined</span>
    <span class="k">if</span> <span class="n">vals</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">])</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">mult</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_cf_data_assign</span><span class="p">(</span>
    <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotated_vect</span><span class="o">=</span><span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Check cf input data is okay and return data for contour plot.</span>
<span class="sd">    | This is an internal routine not used by the user.</span>
<span class="sd">    |</span>
<span class="sd">    | f=None - input cf field</span>
<span class="sd">    | colorbar_title=None - input colour bar title</span>
<span class="sd">    | rotated vect=False - return 1D x and y for rotated plot vectors</span>
<span class="sd">    | verbose=None - set to 1 to get a verbose idea of what the</span>
<span class="sd">    |          _cf_data_assign is doing</span>

<span class="sd">    :Returns:</span>
<span class="sd">     | f - data for contouring</span>
<span class="sd">     | x - x coordinates of data (optional)</span>
<span class="sd">     | y - y coordinates of data (optional)</span>
<span class="sd">     | ptype - plot type</span>
<span class="sd">     | colorbar_title - colour bar title</span>
<span class="sd">     | xlabel - x label for plot</span>
<span class="sd">     | ylabel - y label for plot</span>
<span class="sd">     |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check input data has the correct number of dimensions</span>
    <span class="c1"># Take into account rotated pole fields having extra dimensions</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">domain_axes</span><span class="p">()</span><span class="o">.</span><span class="n">filter_by_size</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;grid_mapping_name:rotated_latitude_longitude&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="ow">is</span> <span class="kc">False</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;_cf_data_assign error - data has too many dimensions&quot;</span>
            <span class="k">if</span> <span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;_cf_data_assign error - data has too few dimensions&quot;</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> cf-plot requires one or two dimensional data</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dimension_coordinates</span><span class="p">()):</span>
                <span class="n">sn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">ln</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sn</span><span class="p">:</span>
                    <span class="n">errstr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mydim</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">sn</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">ln</span><span class="p">:</span>
                        <span class="n">errstr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mydim</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">ln</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Set up data arrays and variables</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">height</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">time</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">has_height</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">has_time</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">xpole</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ypole</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">ptype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">field</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">x</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">y</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Check for multiple Z coordinates</span>
    <span class="n">myz</span> <span class="o">=</span> <span class="n">find_z</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># Extract coordinate data if a matching CF standard_name or axis is found</span>
    <span class="k">for</span> <span class="n">mycoord</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">coords</span><span class="p">():</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lons -&quot;</span><span class="p">,</span> <span class="n">mydim</span><span class="p">)</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lats -&quot;</span><span class="p">,</span> <span class="n">mydim</span><span class="p">)</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;height -&quot;</span><span class="p">,</span> <span class="n">mydim</span><span class="p">)</span>
            <span class="n">height</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">has_height</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;time -&quot;</span><span class="p">,</span> <span class="n">mydim</span><span class="p">)</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">has_time</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># assign field data</span>
    <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

    <span class="c1"># Change Boolean data to integer</span>
    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;bool&quot;</span><span class="p">:</span>
        <span class="n">warnstr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2"> Warning - boolean data found - converting to &quot;</span>
            <span class="s2">&quot;integers</span><span class="se">\n\n\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">warnstr</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">g</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="nb">int</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

    <span class="c1"># Check what plot type is required.</span>
    <span class="c1"># 0=simple contour plot, 1=map plot, 2=latitude-height plot,</span>
    <span class="c1"># 3=longitude-time plot, 4=latitude-time plot.</span>
    <span class="k">if</span> <span class="n">has_lons</span> <span class="ow">and</span> <span class="n">has_lats</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">lats</span>

    <span class="k">if</span> <span class="n">has_lats</span> <span class="ow">and</span> <span class="n">has_height</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">height</span>

        <span class="n">xname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">==</span> <span class="s2">&quot;degrees_north&quot;</span><span class="p">:</span>
            <span class="n">xunits</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xname</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">xunits</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span>

        <span class="n">yname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">myz</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">myz</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">yname</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">yunits</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span>

    <span class="k">if</span> <span class="n">has_lons</span> <span class="ow">and</span> <span class="n">has_height</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">height</span>

        <span class="n">xname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">==</span> <span class="s2">&quot;degrees_east&quot;</span><span class="p">:</span>
            <span class="n">xunits</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xname</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">xunits</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span>

        <span class="n">yname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">myz</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">myz</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">yname</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">yunits</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span>

    <span class="k">if</span> <span class="n">has_lons</span> <span class="ow">and</span> <span class="n">has_time</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lons</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">time</span>

        <span class="n">xname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">==</span> <span class="s2">&quot;degrees_east&quot;</span><span class="p">:</span>
            <span class="n">xunits</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xname</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">xunits</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span>

        <span class="n">yname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">yname</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">yunits</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span>

    <span class="k">if</span> <span class="n">has_lats</span> <span class="ow">and</span> <span class="n">has_time</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">lats</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">time</span>

        <span class="n">xname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">==</span> <span class="s2">&quot;degrees_north&quot;</span><span class="p">:</span>
            <span class="n">xunits</span> <span class="o">=</span> <span class="s2">&quot;degrees&quot;</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xname</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">xunits</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span>

        <span class="n">yname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">yname</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">yunits</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span>

    <span class="c1"># time height plot</span>
    <span class="k">if</span> <span class="n">has_height</span> <span class="ow">and</span> <span class="n">has_time</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">time</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">height</span>

        <span class="n">xname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xname</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">xunits</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">xname</span>

        <span class="n">yname</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span>
        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">yname</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">yunits</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">yname</span>

        <span class="c1"># Rotate array to get it as time vs height</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="c1"># Rotated pole</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;grid_mapping_name:rotated_latitude_longitude&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">6</span>

        <span class="n">rotated_pole</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;grid_mapping_name:rotated_latitude_longitude&quot;</span><span class="p">)</span>
        <span class="n">xpole</span> <span class="o">=</span> <span class="n">rotated_pole</span><span class="p">[</span><span class="s2">&quot;grid_north_pole_longitude&quot;</span><span class="p">]</span>
        <span class="n">ypole</span> <span class="o">=</span> <span class="n">rotated_pole</span><span class="p">[</span><span class="s2">&quot;grid_north_pole_latitude&quot;</span><span class="p">]</span>

        <span class="c1"># Extract grid x and y coordinates</span>
        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dimension_coordinates</span><span class="p">()):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;grid_longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;longitude&quot;</span><span class="p">,</span> <span class="s2">&quot;x&quot;</span><span class="p">]:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;grid_latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;latitude&quot;</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">]:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                <span class="c1"># Flip y and data if reversed</span>
                <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span> <span class="o">+</span> <span class="n">yunits</span>

    <span class="c1"># Extract auxiliary lons and lats if they exist</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s2">&quot;rotated&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rotated_vect</span><span class="p">:</span>
            <span class="n">aux_lons</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">aux_lats</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">auxiliary_coordinates</span><span class="p">()):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]:</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                    <span class="n">aux_lons</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]:</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                    <span class="n">aux_lats</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">aux_lons</span> <span class="ow">and</span> <span class="n">aux_lats</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">xpts</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">ypts</span>
                <span class="n">ptype</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># UKCP grid</span>
    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;grid_mapping_name:transverse_mercator&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

        <span class="c1"># Find the auxiliary lons and lats if provided</span>
        <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">auxiliary_coordinates</span><span class="p">()):</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
                <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Calculate lons and lats if no auxiliary data for these</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_lons</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_lats</span><span class="p">:</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

            <span class="n">ref</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;grid_mapping_name:transverse_mercator&quot;</span><span class="p">)</span>
            <span class="n">false_easting</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;false_easting&quot;</span><span class="p">]</span>
            <span class="n">false_northing</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;false_northing&quot;</span><span class="p">]</span>
            <span class="n">central_longitude</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;longitude_of_central_meridian&quot;</span><span class="p">]</span>
            <span class="n">central_latitude</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;latitude_of_projection_origin&quot;</span><span class="p">]</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;scale_factor_at_central_meridian&quot;</span><span class="p">]</span>

            <span class="c1"># Set the transform</span>
            <span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">TransverseMercator</span><span class="p">(</span>
                <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
                <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
                <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                <span class="n">central_latitude</span><span class="o">=</span><span class="n">central_latitude</span><span class="p">,</span>
                <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Calculate the longitude and latitude points</span>
            <span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
                <span class="n">transform</span><span class="p">,</span> <span class="n">xvals</span><span class="p">,</span> <span class="n">yvals</span>
            <span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="c1"># None of the above</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ptype</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">data_axes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_data_axes</span><span class="p">()</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_axes</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">coordinate</span><span class="p">(</span><span class="n">filter_by_axis</span><span class="o">=</span><span class="p">[</span><span class="n">d</span><span class="p">])</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

                        <span class="n">y</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="n">mycoord</span> <span class="o">=</span> <span class="s2">&quot;dimensioncoordinate&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">yunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">yunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="n">yunits</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">yunits</span><span class="si">}</span><span class="s2">)&quot;</span>
                        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mycoord</span><span class="p">)</span> <span class="o">+</span> <span class="n">yunits</span>
                    <span class="k">elif</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">c</span>
                        <span class="n">mycoord</span> <span class="o">=</span> <span class="s2">&quot;dimensioncoordinate&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                        <span class="n">xunits</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">),</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">xunits</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                            <span class="n">xunits</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">xunits</span><span class="si">}</span><span class="s2">)&quot;</span>
                        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mycoord</span><span class="p">)</span> <span class="o">+</span> <span class="n">xunits</span>
                    <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">_cf_data_assign - cannot find data to return</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">constructs</span><span class="o">.</span><span class="n">domain_axis_identity</span><span class="p">(</span><span class="n">d</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Assign colorbar_title</span>
    <span class="k">if</span> <span class="n">colorbar_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s2">&quot;No Name&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span>
        <span class="n">nc</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nc</span><span class="p">:</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">short_name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;long_name&quot;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">long_name</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">):</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">standard_name</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;Units&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">colorbar_title</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">colorbar_title</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="n">_supscr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">))</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>

    <span class="c1"># Return data</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_check_data</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Check user input contour data is correct.</span>
<span class="sd">    | This is an internal routine and is not used by the user.</span>
<span class="sd">    |</span>
<span class="sd">    | field=None - field</span>
<span class="sd">    | x=None - x points for field</span>
<span class="sd">    | y=None - y points for field</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Input error trapping</span>
    <span class="n">args</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">field</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">con error - a field for contouring must be &quot;</span>
                <span class="s2">&quot;passed with the f= flag</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Check input dimensions look okay.</span>
    <span class="c1"># All inputs 2D</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">xpts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">xpts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">ypts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ypts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="c1"># Field x and y all 1D</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">args</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="c1"># Field 2D, x and y 1D</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">args</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Input arguments incorrectly shaped:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;x has shape:</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;y has shape:</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;field has shape</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Expected x=xpts, y=ypts, field=(ypts,xpts)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;x=npts, y=npts, field=npts</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;or x=[ypts, xpts], y=[ypts, xpts], field=[ypts, xpts]</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_cscale_get_map</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Return colour map for use in contour plots.</span>
<span class="sd">    | This is an internal routine and is not used by the user.</span>
<span class="sd">    |</span>
<span class="sd">    | This depends on the colour bar extensions.</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">         colour map</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cscale_ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span> <span class="n">cscale_ncols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[:</span> <span class="n">cscale_ncols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;neither&quot;</span><span class="p">:</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span>
    <span class="k">return</span> <span class="n">colmap</span>


<span class="k">def</span> <span class="nf">_bfill</span><span class="p">(</span>
    <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">clevs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">lonlat</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">bound</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">single_fill_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">white</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">fast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">transform</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">orca</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Block fill a field with colour rectangles.</span>
<span class="sd">    | This is an internal routine and is not generally used by the user.</span>
<span class="sd">    |</span>
<span class="sd">    | f=None - field</span>
<span class="sd">    | x=None - x points for field</span>
<span class="sd">    | y=None - y points for field</span>
<span class="sd">    | clevs=None - levels for filling</span>
<span class="sd">    | lonlat=None - longitude and latitude data</span>
<span class="sd">    | bound=False - x and y are cf data boundaries</span>
<span class="sd">    | alpha=alpha - transparency setting 0 to 1</span>
<span class="sd">    | white=True - colour unplotted areas white</span>
<span class="sd">    | single_fill_color=None - colour for a blockfill between two levels</span>
<span class="sd">    |                        - makes maplotlib named colours or</span>
<span class="sd">    |                        - hexadecimal notation - &#39;#d3d3d3&#39; for grey</span>
<span class="sd">    | zorder=4 - plotting order</span>
<span class="sd">    | fast=None - use fast plotting with pcolormesh which is useful for</span>
<span class="sd">    |             larger datasets</span>
<span class="sd">    | transform=False - map transform supplied by calling routine</span>
<span class="sd">    | orca=False - data is orca data</span>
<span class="sd">    |</span>
<span class="sd">     :Returns:</span>
<span class="sd">       None</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set lonlat if not specified</span>
    <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># If single_fill_color is defined then turn off whiting out the background.</span>
    <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">white</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Set 2D lon lat if data is that format</span>
    <span class="n">two_d</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">two_d</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Set the default map coordinates for the data to be PlateCarree</span>
    <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
        <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()}</span>

    <span class="c1"># Set the field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">array</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>

    <span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">clevs</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s2">&quot;float&quot;</span><span class="p">)</span>

    <span class="c1"># Get colour scale for use in contouring</span>
    <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
    <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions</span>
    <span class="c1"># are then changed on the colorbar and plot after the plot is made</span>

    <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">_cscale_get_map</span><span class="p">()</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">]:</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">]:</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cols</span> <span class="o">=</span> <span class="n">single_fill_color</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">cols</span><span class="p">)</span>

    <span class="c1"># Colour array for storing the cell colour.  Start with -1 as the default</span>
    <span class="c1"># as the colours run from 0 to np.size(levels)-1</span>
    <span class="n">colarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">]])</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">lev</span> <span class="o">=</span> <span class="n">levels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">field</span> <span class="o">&gt;=</span> <span class="n">lev</span><span class="p">,</span> <span class="n">field</span> <span class="o">&lt;</span> <span class="n">levels</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">colarr</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

    <span class="c1"># Change points that are masked back to -1</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">colarr</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

    <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;grid_mapping_name:transverse_mercator&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
            <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Case of transverse mercator of which UKCP is an example</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;grid_mapping_name:transverse_mercator&quot;</span><span class="p">)</span>
            <span class="n">false_easting</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;false_easting&quot;</span><span class="p">]</span>
            <span class="n">false_northing</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;false_northing&quot;</span><span class="p">]</span>
            <span class="n">central_longitude</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;longitude_of_central_meridian&quot;</span><span class="p">]</span>
            <span class="n">central_latitude</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;latitude_of_projection_origin&quot;</span><span class="p">]</span>
            <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">ref</span><span class="p">[</span><span class="s2">&quot;scale_factor_at_central_meridian&quot;</span><span class="p">]</span>

            <span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">TransverseMercator</span><span class="p">(</span>
                <span class="n">false_easting</span><span class="o">=</span><span class="n">false_easting</span><span class="p">,</span>
                <span class="n">false_northing</span><span class="o">=</span><span class="n">false_northing</span><span class="p">,</span>
                <span class="n">central_longitude</span><span class="o">=</span><span class="n">central_longitude</span><span class="p">,</span>
                <span class="n">central_latitude</span><span class="o">=</span><span class="n">central_latitude</span><span class="p">,</span>
                <span class="n">scale_factor</span><span class="o">=</span><span class="n">scale_factor</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Extract the axes and data</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">f</span><span class="o">.</span><span class="n">dim</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">transform</span><span class="p">}</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">two_d</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">bound</span><span class="p">:</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Find x box boundaries</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

                <span class="c1"># Find y box boundaries</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>
                <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>

            <span class="c1"># Shift lon grid if needed</span>
            <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                <span class="c1"># Extract upper bound and original rhs of box longitude</span>
                <span class="c1"># bounding points</span>
                <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="c1"># Reduce xpts and ypts by 1 or shifting of grid fails</span>
                <span class="c1"># The last points are the right / upper bounds for the</span>
                <span class="c1"># last data box</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span> <span class="o">-</span> <span class="mi">360</span>
                <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span>
                    <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span> <span class="o">+</span> <span class="mi">360</span>

                <span class="c1"># Add cyclic information if missing.</span>
                <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span> <span class="ow">and</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span><span class="p">:</span>
                    <span class="c1"># field, xpts = cartopy_util.add_cyclic_point(field, xpts)</span>
                    <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

                <span class="n">right_bound</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

                <span class="c1"># Add end x and y end points</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">right_bound</span><span class="p">)</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">two_d</span><span class="p">:</span>
            <span class="c1"># 2D lons and lats code</span>
            <span class="k">if</span> <span class="n">fast</span><span class="p">:</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span>
                <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">ny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
                    <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>

                        <span class="c1"># Calculate the local size difference and set the</span>
                        <span class="c1"># square points</span>
                        <span class="k">if</span> <span class="n">ix</span> <span class="o">&lt;</span> <span class="n">nx</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">xdiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">xdiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

                        <span class="k">if</span> <span class="n">iy</span> <span class="o">&lt;</span> <span class="n">ny</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
                            <span class="n">ydiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">ydiff</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ix</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

                        <span class="n">xpts</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">xdiff</span><span class="p">,</span>
                            <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="n">xdiff</span><span class="p">,</span>
                            <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="n">xdiff</span><span class="p">,</span>
                            <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">xdiff</span><span class="p">,</span>
                            <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">xdiff</span><span class="p">,</span>
                        <span class="p">]</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="p">[</span>
                            <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">ydiff</span><span class="p">,</span>
                            <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">ydiff</span><span class="p">,</span>
                            <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="n">ydiff</span><span class="p">,</span>
                            <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">+</span> <span class="n">ydiff</span><span class="p">,</span>
                            <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">]</span> <span class="o">-</span> <span class="n">ydiff</span><span class="p">,</span>
                        <span class="p">]</span>

                        <span class="c1"># Plot the square</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span>
                            <span class="n">mpatches</span><span class="o">.</span><span class="n">Polygon</span><span class="p">(</span>
                                <span class="p">[</span>
                                    <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                                    <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                                    <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                                    <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                                    <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
                                <span class="p">],</span>
                                <span class="n">facecolor</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">colarr</span><span class="p">[</span><span class="n">iy</span><span class="p">,</span> <span class="n">ix</span><span class="p">])],</span>
                                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                                <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                            <span class="p">)</span>
                        <span class="p">)</span>

                <span class="k">return</span>

    <span class="c1"># Polar stereographic</span>
    <span class="c1"># Set points past plotting limb to be plotvars.boundinglat</span>
    <span class="c1"># Also set any lats past the pole to be the pole</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&gt;</span> <span class="mf">90.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="mf">90.0</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;spstere&quot;</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">90.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">90.0</span>

    <span class="c1"># Set the transform if not supplied to _bfill</span>
    <span class="k">if</span> <span class="n">transform</span><span class="p">:</span>
        <span class="n">lonlat</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">fast</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">norm</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">two_d</span><span class="p">:</span>
            <span class="c1"># Plot using pcolormesh if a 2D grid</span>
            <span class="c1"># field = f</span>
            <span class="n">fixed_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="n">fixed_x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">+=</span> <span class="mi">360</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
                <span class="n">fixed_x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">]:</span>
                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
                            <span class="n">xpts</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span>
                            <span class="n">ypts</span><span class="p">,</span>
                            <span class="n">field</span><span class="p">,</span>
                            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
                            <span class="n">xpts</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span>
                            <span class="n">ypts</span><span class="p">,</span>
                            <span class="n">field</span><span class="p">,</span>
                            <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
                            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                            <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span>
                        <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
                        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span>
                        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span>
                    <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">allverts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">xy_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">colarr</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xy_stack</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">ix</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">iy</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span>
                        <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span>
                        <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span>
                    <span class="p">]</span>
                    <span class="n">lats</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span>
                        <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span>
                        <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span>
                    <span class="p">]</span>

                    <span class="n">txpts</span><span class="p">,</span> <span class="n">typts</span> <span class="o">=</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span>
                    <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">3</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">txpts</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">typts</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span>
                    <span class="p">]</span>

                    <span class="n">allverts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

                <span class="c1"># Make the collection and add it to the plot.</span>
                <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">single_fill_color</span>
                <span class="n">coll</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span>
                    <span class="n">allverts</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">plotargs</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>

                <span class="n">allverts</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">xy_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">colarr</span> <span class="o">==</span> <span class="n">i</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xy_stack</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                    <span class="n">ix</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">iy</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span>
                        <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                    <span class="p">]</span>

                    <span class="n">allverts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

                <span class="c1"># Make the collection and add it to the plot.</span>
                <span class="k">if</span> <span class="n">single_fill_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">color</span> <span class="o">=</span> <span class="n">single_fill_color</span>

                <span class="n">coll</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span>
                    <span class="n">allverts</span><span class="p">,</span>
                    <span class="n">facecolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">edgecolors</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">plotargs</span>
                <span class="p">)</span>

                <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>

        <span class="c1"># Add white for undefined areas</span>
        <span class="k">if</span> <span class="n">white</span><span class="p">:</span>
            <span class="n">allverts</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">xy_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">colarr</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">xy_stack</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
                <span class="n">ix</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">iy</span> <span class="o">=</span> <span class="n">xy_stack</span><span class="p">[</span><span class="n">pt</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                <span class="n">verts</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]),</span>
                    <span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">iy</span><span class="p">]),</span>
                <span class="p">]</span>

                <span class="n">allverts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">verts</span><span class="p">)</span>

            <span class="c1"># Make the collection and add it to the plot.</span>
            <span class="n">color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">coll</span> <span class="o">=</span> <span class="n">PolyCollection</span><span class="p">(</span>
                <span class="n">allverts</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span>
                <span class="n">edgecolors</span><span class="o">=</span><span class="s2">&quot;#ffffff&quot;</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="o">**</span><span class="n">plotargs</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">lonlat</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_collection</span><span class="p">(</span><span class="n">coll</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">_set_map</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Set map and write into `plotvars.mymap`.</span>
<span class="sd">    | This is an internal routine and not used by the user.</span>
<span class="sd">    |</span>
<span class="sd">    | No inputs</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Return if mymap is already set</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c1"># Set up mapping</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">lon_mid</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
    <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
    <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
    <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">)</span>

        <span class="c1"># Cartopy line plotting and identical left == right fix</span>

        <span class="k">if</span> <span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span> <span class="o">==</span> <span class="mf">360.0</span><span class="p">:</span>
            <span class="n">lonmax</span> <span class="o">=</span> <span class="n">lonmax</span> <span class="o">+</span> <span class="mf">0.01</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;merc&quot;</span><span class="p">:</span>
        <span class="n">min_latitude</span> <span class="o">=</span> <span class="o">-</span><span class="mf">80.0</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">min_latitude</span><span class="p">:</span>
            <span class="n">min_latitude</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
        <span class="n">max_latitude</span> <span class="o">=</span> <span class="mf">84.0</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">&lt;</span> <span class="n">max_latitude</span><span class="p">:</span>
            <span class="n">max_latitude</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">(</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span>
            <span class="n">min_latitude</span><span class="o">=</span><span class="n">min_latitude</span><span class="p">,</span>
            <span class="n">max_latitude</span><span class="o">=</span><span class="n">max_latitude</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">)</span>
        <span class="c1"># **cartopy 0.16 fix</span>
        <span class="c1"># Here we add in 0.01 to the longitude extent as this helps with</span>
        <span class="c1"># plotting lines and line labels</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">+</span> <span class="mf">180.01</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;spstere&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">)</span>
        <span class="c1"># **cartopy 0.16 fix</span>
        <span class="c1"># Here we add in 0.01 to the longitude extent as this helps with</span>
        <span class="c1"># plotting lines and line labels</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">+</span> <span class="mf">180.01</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;ortho&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Orthographic</span><span class="p">(</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">central_latitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lat_0</span>
        <span class="p">)</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">-</span> <span class="mf">180.0</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">+</span> <span class="mf">180.01</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;moll&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">)</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">-</span> <span class="mf">180.0</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">+</span> <span class="mf">180.01</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;robin&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;lcc&quot;</span><span class="p">:</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">lon_0</span> <span class="o">=</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">lat_0</span> <span class="o">=</span> <span class="n">latmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">latmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">cutoff</span> <span class="o">=</span> <span class="o">-</span><span class="mi">40</span>
        <span class="k">if</span> <span class="n">lat_0</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cutoff</span> <span class="o">=</span> <span class="mi">40</span>

        <span class="n">standard_parallels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">latmin</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">latmax</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">standard_parallels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="o">-</span><span class="mi">33</span><span class="p">]</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">,</span>
            <span class="n">central_latitude</span><span class="o">=</span><span class="n">lat_0</span><span class="p">,</span>
            <span class="n">cutoff</span><span class="o">=</span><span class="n">cutoff</span><span class="p">,</span>
            <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;rotated&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;OSGB&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">OSGB</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;EuroPP&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">EuroPP</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;UKCP&quot;</span><span class="p">:</span>
        <span class="c1"># Special case of TransverseMercator for UKCP</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">TransverseMercator</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;TransverseMercator&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">TransverseMercator</span><span class="p">()</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">-</span> <span class="mf">180.0</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">+</span> <span class="mf">180.01</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;LambertCylindrical&quot;</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertCylindrical</span><span class="p">()</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>
        <span class="n">extent</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Add a plot containing the projection</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span><span class="p">:</span>
        <span class="n">delta_x</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span>
        <span class="n">delta_y</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span>
        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span>
            <span class="p">[</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span><span class="p">,</span> <span class="n">delta_x</span><span class="p">,</span> <span class="n">delta_y</span><span class="p">],</span>
            <span class="n">projection</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">pos</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="n">proj</span>
        <span class="p">)</span>

    <span class="c1"># Set map extent</span>
    <span class="n">set_extent</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;OSGB&quot;</span><span class="p">,</span> <span class="s2">&quot;EuroPP&quot;</span><span class="p">,</span> <span class="s2">&quot;UKCP&quot;</span><span class="p">,</span> <span class="s2">&quot;robin&quot;</span><span class="p">,</span> <span class="s2">&quot;lcc&quot;</span><span class="p">]:</span>
        <span class="n">set_extent</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">extent</span> <span class="ow">and</span> <span class="n">set_extent</span><span class="p">:</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span>
            <span class="p">[</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">latmin</span><span class="p">,</span> <span class="n">latmax</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="c1"># Set the scaling for PlateCarree</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">aspect</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;lcc&quot;</span><span class="p">:</span>
        <span class="c1"># Special case of lcc</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_extent</span><span class="p">(</span>
            <span class="p">[</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">latmin</span><span class="p">,</span> <span class="n">latmax</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;UKCP&quot;</span><span class="p">:</span>
        <span class="c1"># Special case of TransverseMercator for UKCP</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">11</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">49</span><span class="p">,</span> <span class="mi">61</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;EuroPP&quot;</span><span class="p">:</span>
        <span class="c1"># EuroPP somehow needs some limits setting.</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="o">-</span><span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">75</span><span class="p">],</span> <span class="n">crs</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="c1"># Remove any plotvars.plot axes leaving just the plotvars.mymap axes</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">([])</span>

    <span class="c1"># Store map</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span> <span class="o">=</span> <span class="n">mymap</span>


<span class="k">def</span> <span class="nf">_map_title</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | An internal routine to draw a title on a map plot.</span>
<span class="sd">    |</span>
<span class="sd">    | title=None - title to put on map plot</span>
<span class="sd">    | dim=False - draw a set of dimension titles</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">boundinglat</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span>
    <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
    <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
    <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
    <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>
    <span class="n">polar_range</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">boundinglat</span><span class="p">)</span>

    <span class="n">myprojs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;cyl&quot;</span><span class="p">,</span> <span class="s2">&quot;robin&quot;</span><span class="p">,</span> <span class="s2">&quot;moll&quot;</span><span class="p">,</span> <span class="s2">&quot;merc&quot;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="ow">in</span> <span class="n">myprojs</span><span class="p">:</span>
        <span class="n">lon_mid</span> <span class="o">=</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_mid</span>
        <span class="k">if</span> <span class="n">dims</span><span class="p">:</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lonmin</span>
        <span class="n">projs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">,</span>
            <span class="n">ccrs</span><span class="o">.</span><span class="n">Robinson</span><span class="p">,</span>
            <span class="n">ccrs</span><span class="o">.</span><span class="n">Mollweide</span><span class="p">,</span>
            <span class="n">ccrs</span><span class="o">.</span><span class="n">Mercator</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">myind</span> <span class="o">=</span> <span class="n">myprojs</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span><span class="p">)</span>
        <span class="c1"># if plotvars.proj == &#39;cyl&#39;:</span>
        <span class="c1">#    proj = ccrs.PlateCarree(central_longitude=lon_mid)</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">projs</span><span class="p">[</span><span class="n">myind</span><span class="p">](</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">)</span>
        <span class="n">mylat</span> <span class="o">=</span> <span class="n">latmax</span>
        <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="n">ypt</span> <span class="o">=</span> <span class="n">ypt</span> <span class="o">+</span> <span class="p">(</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">latmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">40.0</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span><span class="p">:</span>
        <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mi">180</span>
        <span class="n">mylat</span> <span class="o">=</span> <span class="n">boundinglat</span> <span class="o">-</span> <span class="n">polar_range</span> <span class="o">/</span> <span class="mf">15.0</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>
        <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">dims</span><span class="p">:</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mi">180</span>
            <span class="n">mylat</span> <span class="o">=</span> <span class="n">boundinglat</span> <span class="o">-</span> <span class="n">polar_range</span> <span class="o">/</span> <span class="mf">15.0</span>
            <span class="n">xpt_mid</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span>
                <span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">-</span> <span class="mi">90</span>
            <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt_mid</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span>
                <span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;spstere&quot;</span><span class="p">:</span>
        <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span>
        <span class="n">mylat</span> <span class="o">=</span> <span class="n">boundinglat</span> <span class="o">+</span> <span class="n">polar_range</span> <span class="o">/</span> <span class="mf">15.0</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>
        <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">dims</span><span class="p">:</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mi">0</span>
            <span class="c1"># mylat = boundinglat-polar_range/15.0</span>
            <span class="n">mylat</span> <span class="o">=</span> <span class="n">boundinglat</span> <span class="o">-</span> <span class="n">polar_range</span> <span class="o">/</span> <span class="mf">15.0</span>
            <span class="n">xpt_mid</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span>
                <span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
            <span class="p">)</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">-</span> <span class="mi">90</span>
            <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt_mid</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span>
                <span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;lcc&quot;</span><span class="p">:</span>
        <span class="n">mylon</span> <span class="o">=</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="k">if</span> <span class="n">dims</span><span class="p">:</span>
            <span class="n">mylon</span> <span class="o">=</span> <span class="n">lonmin</span>
        <span class="n">lat_0</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="k">if</span> <span class="n">latmin</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">latmax</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lat_0</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span>
            <span class="n">central_latitude</span><span class="o">=</span><span class="n">lat_0</span><span class="p">,</span>
            <span class="n">cutoff</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mylat</span> <span class="o">=</span> <span class="n">latmax</span>
        <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span><span class="n">mylon</span><span class="p">,</span> <span class="n">mylat</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">())</span>

    <span class="n">fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>

    <span class="k">if</span> <span class="n">dims</span><span class="p">:</span>
        <span class="n">halign</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>

        <span class="c1"># Get plot position</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>
        <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>

        <span class="c1"># Shift to left</span>
        <span class="c1"># if plotvars.plot_type == 1 and plotvars.proj !=cyl:</span>
        <span class="n">left</span> <span class="o">-=</span> <span class="mf">0.1</span>
        <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">([</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>

        <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>

        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">left</span> <span class="o">+</span> <span class="n">width</span><span class="p">,</span>
            <span class="n">bottom</span> <span class="o">+</span> <span class="n">height</span><span class="p">,</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="n">halign</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
            <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">halign</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">xpt</span><span class="p">,</span>
            <span class="n">ypt</span><span class="p">,</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
            <span class="n">ha</span><span class="o">=</span><span class="n">halign</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
            <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span><span class="p">,</span>
        <span class="p">)</span>


<span class="k">def</span> <span class="nf">_plot_map_axes</span><span class="p">(</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">user_xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">user_ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | An internal routine to draw the axes on a map plot.</span>
<span class="sd">    |</span>
<span class="sd">    | axes=None - drawing axes</span>
<span class="sd">    | xaxis=None - drawing x-axis</span>
<span class="sd">    | yaxis=None - drawing x-axis</span>
<span class="sd">    | xticks=None - user defined xticks</span>
<span class="sd">    | xticklabels=None - user defined xtick labels</span>
<span class="sd">    | yticks=None - user defined yticks</span>
<span class="sd">    | yticklabels=None - user defined ytick labels</span>
<span class="sd">    | user_xlabel=None - user defined xlabel</span>
<span class="sd">    | user_ylabel=None - user defined ylabel</span>
<span class="sd">    | verbose=None</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Font definitions</span>
    <span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>
    <span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span>

    <span class="c1"># Map parameters</span>
    <span class="n">boundinglat</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span>
    <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
    <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
    <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
    <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>

    <span class="c1"># Cylindrical</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - adding cylindrical axes&quot;</span><span class="p">)</span>
        <span class="n">lonticks</span><span class="p">,</span> <span class="n">lonlabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span>
            <span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">latticks</span><span class="p">,</span> <span class="n">latlabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span>
            <span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlabels</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticks</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticks</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="mf">0.5</span><span class="p">,</span>
                    <span class="o">-</span><span class="mf">0.10</span><span class="p">,</span>
                    <span class="n">user_xlabel</span><span class="p">,</span>
                    <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
                    <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                    <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="o">-</span><span class="mf">0.05</span><span class="p">,</span>
                    <span class="mf">0.50</span><span class="p">,</span>
                    <span class="n">user_ylabel</span><span class="p">,</span>
                    <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                    <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">rotation</span><span class="o">=</span><span class="s2">&quot;vertical&quot;</span><span class="p">,</span>
                    <span class="n">rotation_mode</span><span class="o">=</span><span class="s2">&quot;anchor&quot;</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                    <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="c1"># Polar stereographic</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;spstere&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - adding stereographic axes&quot;</span><span class="p">)</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="n">latrange</span> <span class="o">=</span> <span class="mi">90</span> <span class="o">-</span> <span class="nb">abs</span><span class="p">(</span><span class="n">boundinglat</span><span class="p">)</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">Geodetic</span><span class="p">()</span>

        <span class="c1"># Add</span>
        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">latvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">-</span> <span class="mi">60</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">latvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span><span class="p">:</span>
                    <span class="n">latvals</span> <span class="o">=</span> <span class="n">latvals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">latvals</span> <span class="o">&gt;=</span> <span class="n">boundinglat</span><span class="p">)]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">latvals</span> <span class="o">=</span> <span class="n">latvals</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">latvals</span> <span class="o">&lt;=</span> <span class="n">boundinglat</span><span class="p">)]</span>

                <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">latvals</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lat</span> <span class="o">-</span> <span class="n">boundinglat</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">361</span><span class="p">)</span>
                        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">361</span><span class="p">)</span> <span class="o">+</span> <span class="n">lat</span>
                        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                            <span class="n">lons</span><span class="p">,</span>
                            <span class="n">lats</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
                            <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
                            <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                            <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
                        <span class="p">)</span>

            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">lonvals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span> <span class="o">*</span> <span class="mi">60</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lonvals</span> <span class="o">=</span> <span class="n">xticks</span>

                <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lonvals</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span><span class="p">:</span>
                        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">90</span> <span class="o">-</span> <span class="n">boundinglat</span><span class="p">)</span> <span class="o">+</span> <span class="n">boundinglat</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">boundinglat</span> <span class="o">+</span> <span class="mi">91</span><span class="p">)</span> <span class="o">-</span> <span class="mi">90</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span> <span class="o">+</span> <span class="n">lon</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">lons</span><span class="p">,</span>
                        <span class="n">lats</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                        <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="c1"># Add longitude labels</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span><span class="p">:</span>
                <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="mi">90</span>
                <span class="n">latpt</span> <span class="o">=</span> <span class="n">boundinglat</span> <span class="o">-</span> <span class="n">latrange</span> <span class="o">/</span> <span class="mf">40.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>
                <span class="n">pole</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
                <span class="n">latpt</span> <span class="o">=</span> <span class="n">boundinglat</span> <span class="o">+</span> <span class="n">latrange</span> <span class="o">/</span> <span class="mf">40.0</span>

            <span class="n">lon_mid</span><span class="p">,</span> <span class="n">lat_mid</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span>
                <span class="mi">0</span><span class="p">,</span> <span class="n">pole</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">xaxis</span> <span class="ow">and</span> <span class="n">axis_label_fontsize</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">xtick</span> <span class="ow">in</span> <span class="n">lonvals</span><span class="p">:</span>
                    <span class="n">label</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span><span class="n">xtick</span><span class="p">,</span> <span class="n">xtick</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">lonr</span><span class="p">,</span> <span class="n">latr</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span>
                        <span class="n">xtick</span><span class="p">,</span> <span class="n">latpt</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
                    <span class="p">)</span>

                    <span class="n">v_align</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span>
                    <span class="k">if</span> <span class="n">lonr</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">h_align</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
                    <span class="k">if</span> <span class="n">lonr</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">h_align</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">lonr</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">h_align</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span>
                        <span class="k">if</span> <span class="n">latr</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">v_align</span> <span class="o">=</span> <span class="s2">&quot;top&quot;</span>
                        <span class="k">if</span> <span class="n">latr</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">v_align</span> <span class="o">=</span> <span class="s2">&quot;bottom&quot;</span>

                    <span class="n">mymap</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                        <span class="n">lonr</span><span class="p">,</span>
                        <span class="n">latr</span><span class="p">,</span>
                        <span class="n">label</span><span class="p">,</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">h_align</span><span class="p">,</span>
                        <span class="n">verticalalignment</span><span class="o">=</span><span class="n">v_align</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
                        <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="c1"># Make the plot circular by blanking off around the plot</span>
        <span class="c1"># Find min and max of plotting region in map coordinates</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">360</span><span class="p">)</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">boundinglat</span>
        <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="c1"># blank off data past the bounding latitude</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">pts</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">))</span> <span class="o">+</span> <span class="n">xmax</span>
        <span class="p">)</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">pts</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">pts</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">))</span> <span class="o">+</span> <span class="n">xmin</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="n">pts</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">pts</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">][</span><span class="n">pts</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Turn off map outside the cicular plot area</span>
        <span class="c1"># mymap.outline_patch.set_visible(False)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Draw a line around the bounding latitude</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">361</span><span class="p">)</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">boundinglat</span>
        <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
            <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Modify xlim and ylim values as the default values clip the</span>
        <span class="c1"># plot slightly</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mymap</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">((</span><span class="o">-</span><span class="n">xmax</span><span class="p">,</span> <span class="n">xmax</span><span class="p">),</span> <span class="n">emit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="kc">None</span><span class="p">)))</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">((</span><span class="o">-</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="n">emit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Lambert conformal</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;lcc&quot;</span><span class="p">:</span>
        <span class="n">lon_0</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">lat_0</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="n">standard_parallels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">33</span><span class="p">,</span> <span class="mi">45</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">latmin</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">latmax</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">standard_parallels</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span> <span class="o">-</span><span class="mi">33</span><span class="p">]</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">LambertConformal</span><span class="p">(</span>
            <span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">,</span>
            <span class="n">central_latitude</span><span class="o">=</span><span class="n">lat_0</span><span class="p">,</span>
            <span class="n">cutoff</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
            <span class="n">standard_parallels</span><span class="o">=</span><span class="n">standard_parallels</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>

        <span class="c1"># Modify xlim and ylim values as the default values clip the</span>
        <span class="c1"># plot slightly</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="kc">None</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="kc">None</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ymin</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">emit</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">latmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">latmin</span>
        <span class="n">verts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">:</span>
            <span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">lat</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">:</span>
            <span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lon</span><span class="p">,</span> <span class="n">latmax</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lonmax</span><span class="p">,</span> <span class="n">lat</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">verts</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">lon</span><span class="p">,</span> <span class="n">latmin</span><span class="p">])</span>

        <span class="c1"># Mask left and right of plot</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">latmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">latmin</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span> <span class="o">+</span> <span class="n">lonmin</span>
        <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">lat_0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Left</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
            <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span><span class="p">],</span>
            <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">],</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="c1"># Right</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span>
            <span class="p">[</span><span class="o">-</span><span class="n">xmin</span><span class="p">,</span> <span class="o">-</span><span class="n">xmin</span><span class="p">,</span> <span class="o">-</span><span class="n">xmax</span><span class="p">,</span> <span class="o">-</span><span class="n">xmin</span><span class="p">],</span>
            <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">],</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="p">[</span><span class="o">-</span><span class="n">xmin</span><span class="p">,</span> <span class="o">-</span><span class="n">xmax</span><span class="p">],</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

        <span class="c1"># Upper</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">latmax</span>
        <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">ymax</span><span class="p">)</span>

        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
            <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Lower</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">latmin</span>
        <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="mf">1.05</span>

        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">ymin</span><span class="p">)</span>

        <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
            <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
            <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Turn off drawing of the rectangular box around the plot</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">set_frame_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lat_0</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">latmax</span>
            <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
                <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span>
            <span class="p">)</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">latmin</span>
            <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
                <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span>
            <span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymax</span> <span class="o">*</span> <span class="mf">1.1</span>

            <span class="n">xpts</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">xmin</span><span class="p">,</span> <span class="n">xmin</span><span class="p">]</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="p">[</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">]</span>
            <span class="n">mymap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="c1"># Draw longitudes and latitudes if requested</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>
        <span class="n">fw</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span>
        <span class="k">if</span> <span class="n">axes</span> <span class="ow">and</span> <span class="n">xaxis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">map_xticks</span><span class="p">,</span> <span class="n">map_xticklabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span>
                    <span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">map_xticks</span> <span class="o">=</span> <span class="n">xticks</span>
                <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">map_xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">map_xticklabels</span> <span class="o">=</span> <span class="n">xticklabels</span>

            <span class="k">if</span> <span class="n">axes</span> <span class="ow">and</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">latmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">latmin</span>
                <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">map_xticks</span><span class="p">)):</span>
                    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span> <span class="o">+</span> <span class="n">map_xticks</span><span class="p">[</span><span class="n">tick</span><span class="p">]</span>
                    <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
                        <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span>
                    <span class="p">)</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
                    <span class="p">)</span>

                    <span class="n">latpt</span> <span class="o">=</span> <span class="n">latmin</span> <span class="o">-</span> <span class="mi">3</span>
                    <span class="k">if</span> <span class="n">lat_0</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">latpt</span> <span class="o">=</span> <span class="n">latmax</span> <span class="o">+</span> <span class="mi">1</span>
                    <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span>
                        <span class="n">map_xticks</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span> <span class="n">latpt</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
                    <span class="p">)</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                        <span class="n">device_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                        <span class="n">device_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                        <span class="n">map_xticklabels</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span>
                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                        <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                        <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">map_yticks</span><span class="p">,</span> <span class="n">map_yticklabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span>
                <span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">map_yticks</span> <span class="o">=</span> <span class="n">yticks</span>
            <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">map_yticklabels</span> <span class="o">=</span> <span class="n">yticks</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">map_yticklabels</span> <span class="o">=</span> <span class="n">yticklabels</span>

        <span class="k">if</span> <span class="n">axes</span> <span class="ow">and</span> <span class="n">yaxis</span><span class="p">:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">lonmin</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">lonmin</span>
            <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">map_yticks</span><span class="p">)):</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span> <span class="o">+</span> <span class="n">map_yticks</span><span class="p">[</span><span class="n">tick</span><span class="p">]</span>
                <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
                    <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span>
                <span class="p">)</span>
                <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">device_coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span>
                    <span class="n">lonmin</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">map_yticks</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">mymap</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">device_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">device_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">map_yticklabels</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                    <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">device_coords</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span>
                    <span class="n">lonmax</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">map_yticks</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">mymap</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">device_coords</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">device_coords</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">map_yticklabels</span><span class="p">[</span><span class="n">tick</span><span class="p">],</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">fs</span><span class="p">,</span>
                    <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="mi">101</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="c1"># UKCP grid</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;UKCP&quot;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="mi">360</span> <span class="o">/</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span>
        <span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons</span> <span class="o">-</span> <span class="mi">360</span><span class="p">,</span> <span class="n">lons</span><span class="p">])</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="mi">180</span> <span class="o">/</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span>
            <span class="o">-</span> <span class="mi">90</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span>
                <span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
                <span class="n">xlocs</span><span class="o">=</span><span class="n">lons</span><span class="p">,</span>
                <span class="n">ylocs</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span>
            <span class="p">)</span>


<span class="c1"># ===================================</span>
<span class="c1"># USER-FACING FUNCTIONS</span>
<span class="c1"># ===================================</span>

<div class="viewcode-block" id="con">
<a class="viewcode-back" href="../con.html#cfplot.con">[docs]</a>
<span class="k">def</span> <span class="nf">con</span><span class="p">(</span>
    <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="n">global_fill</span><span class="p">,</span>
    <span class="n">lines</span><span class="o">=</span><span class="n">global_lines</span><span class="p">,</span>
    <span class="n">line_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">colorbar_label_skip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ptype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">negative_linestyle</span><span class="o">=</span><span class="s2">&quot;solid&quot;</span><span class="p">,</span>
    <span class="n">blockfill</span><span class="o">=</span><span class="n">global_blockfill</span><span class="p">,</span>
    <span class="n">zero_thick</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">colorbar_shrink</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_orientation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ylog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">swap_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">linewidths</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">colorbar_text_up_down</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">colorbar_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_text_down_up</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">colorbar_drawedges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">colorbar_fraction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_thick</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">linestyles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">level_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">irregular</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">face_lons</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">face_lats</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">face_connectivity</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">titles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">mytest</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">transform_first</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">blockfill_fast</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">nlevs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">orca</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orca_skip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | The interface to contouring in cf-plot.</span>
<span class="sd">    |</span>
<span class="sd">    | The minimum use is con(f)</span>
<span class="sd">    | where f is a 2 dimensional array. If a cf field is passed then an</span>
<span class="sd">    | appropriate plot will be produced i.e. a longitude-latitude or</span>
<span class="sd">    | latitude-height plot for example. If a 2d numeric array is passed then</span>
<span class="sd">    | the optional arrays x and y can be used to describe the x and y data</span>
<span class="sd">    | point locations.</span>
<span class="sd">    |</span>
<span class="sd">    | f - array to contour</span>
<span class="sd">    | x - x locations of data in f (optional)</span>
<span class="sd">    | y - y locations of data in f (optional)</span>
<span class="sd">    | fill=True - colour fill contours</span>
<span class="sd">    | lines=True - draw contour lines and labels</span>
<span class="sd">    | line_labels=True - label contour lines</span>
<span class="sd">    | title=title - title for the plot</span>
<span class="sd">    | ptype=0 - plot type - not needed for cf fields.</span>
<span class="sd">    |                       0 = no specific plot type,</span>
<span class="sd">    |                       1 = longitude-latitude,</span>
<span class="sd">    |                       2 = latitude - height,</span>
<span class="sd">    |                       3 = longitude - height,</span>
<span class="sd">    |                       4 = latitude - time,</span>
<span class="sd">    |                       5 = longitude - time</span>
<span class="sd">    |                       6 = rotated pole</span>
<span class="sd">    | negative_linestyle=&#39;solid&#39; - set to one of &#39;solid&#39;, &#39;dashed&#39;</span>
<span class="sd">    | zero_thick=False - add a thick zero contour line. Set to 3 for example.</span>
<span class="sd">    | blockfill=False - set to True for a blockfill plot</span>
<span class="sd">    | colorbar_title=colbar_title - title for the colour bar</span>
<span class="sd">    | colorbar=True - add a colour bar if a filled contour plot</span>
<span class="sd">    | colorbar_label_skip=None - skip colour bar labels. Set to 2 to skip</span>
<span class="sd">    |                            every other label.</span>
<span class="sd">    | colorbar_orientation=None - options are &#39;horizontal&#39; and &#39;vertical&#39;</span>
<span class="sd">    |                      The default for most plots is horizontal but</span>
<span class="sd">    |                      for polar stereographic plots this is vertical.</span>
<span class="sd">    | colorbar_shrink=None - value to shrink the colorbar by.  If the colorbar</span>
<span class="sd">    |                        exceeds the plot area then values of 1.0, 0.55</span>
<span class="sd">    |                        or 0.5m may help it better fit the plot area.</span>
<span class="sd">    | colorbar_position=None - position of colorbar</span>
<span class="sd">    |                          [xmin, ymin, x_extent,y_extent] in normalised</span>
<span class="sd">    |                          coordinates. Use when a common colorbar</span>
<span class="sd">    |                          is required for a set of plots. A typical set</span>
<span class="sd">    |                          of values would be [0.1, 0.05, 0.8, 0.02]</span>
<span class="sd">    | colorbar_fontsize=None - text size for colorbar labels and title</span>
<span class="sd">    | colorbar_fontweight=None - font weight for colorbar labels and title</span>
<span class="sd">    | colorbar_text_up_down=False - if True horizontal colour bar labels</span>
<span class="sd">    |                               alternate above (start) and below the</span>
<span class="sd">    |                               colour bar</span>
<span class="sd">    | colorbar_text_down_up=False - if True horizontal colour bar labels</span>
<span class="sd">    |                               alternate below (start) and above the</span>
<span class="sd">    |                               colour bar</span>
<span class="sd">    | colorbar_drawedges=True - draw internal divisions in the colorbar</span>
<span class="sd">    | colorbar_fraction=None - space for the colorbar - default = 0.21,</span>
<span class="sd">    |                          in normalised</span>
<span class="sd">    |                       coordinates</span>
<span class="sd">    | colorbar_thick=None - thickness of the colorbar - default = 0.015,</span>
<span class="sd">    |                       in normalised coordinates</span>
<span class="sd">    | colorbar_anchor=None - default=0.5 - anchor point of colorbar within</span>
<span class="sd">    |                        the fraction space.</span>
<span class="sd">    |                        0.0 = close to plot, 1.0 = further away</span>
<span class="sd">    | colorbar_labels=None - labels to use for colorbar. The default is to</span>
<span class="sd">    |                        use the contour levels as labels</span>
<span class="sd">    | colorbar_text_up_down=False - on a horizontal colorbar alternate the</span>
<span class="sd">    |                               labels top and bottom starting in the</span>
<span class="sd">    |                               up position</span>
<span class="sd">    | colorbar_text_down_up=False - on a horizontal colorbar alternate the</span>
<span class="sd">    |                               labels bottom and top starting in the</span>
<span class="sd">    |                               bottom position</span>
<span class="sd">    | colorbar_drawedges=True - draw internal delimeter lines in the colorbar</span>
<span class="sd">    | colors=&#39;k&#39; - contour line colors - takes one or many values.</span>
<span class="sd">    | xlog=False - logarithmic x axis</span>
<span class="sd">    | ylog=False - logarithmic y axis</span>
<span class="sd">    | axes=True - plot x and y axes</span>
<span class="sd">    | xaxis=True - plot xaxis</span>
<span class="sd">    | yaxis=True - plot y axis</span>
<span class="sd">    | xticks=None - xtick positions</span>
<span class="sd">    | xticklabels=None - xtick labels</span>
<span class="sd">    | yticks=None - y tick positions</span>
<span class="sd">    | yticklabels=None - ytick labels</span>
<span class="sd">    | xlabel=None - label for x axis</span>
<span class="sd">    | ylabel=None - label for y axis</span>
<span class="sd">    | swap_axes=False - swap plotted axes - only valid for X, Y, Z vs T plots</span>
<span class="sd">    | verbose=None - change to 1 to get a verbose listing of what con</span>
<span class="sd">    |                is doing</span>
<span class="sd">    | linewidths=None - contour linewidths.  Either a single number for all</span>
<span class="sd">    |                   lines or array of widths</span>
<span class="sd">    | linestyles=None - takes &#39;solid&#39;, &#39;dashed&#39;, &#39;dashdot&#39; or &#39;dotted&#39;</span>
<span class="sd">    | alpha=1.0 - transparency setting.  The default is no transparency.</span>
<span class="sd">    | zorder=1 - order of drawing</span>
<span class="sd">    | level_spacing=None - Default of &#39;linear&#39; level spacing.  Also takes</span>
<span class="sd">    |                      &#39;log&#39;, &#39;loglike&#39;, &#39;outlier&#39; and &#39;inspect&#39;</span>
<span class="sd">    | irregular=None - flag for contouring irregular data</span>
<span class="sd">    | face_lons=None - longitude points for face vertices</span>
<span class="sd">    | face_lats=None - latitude points for face verticies</span>
<span class="sd">    | face_connectivity=None - connectivity for face verticies</span>
<span class="sd">    | titles=False - set to True to have a dimensions title</span>
<span class="sd">    | transform_first=None - Cartopy should transform the points before</span>
<span class="sd">    |                        calling the contouring algorithm, which can have</span>
<span class="sd">    |                        a significant impact on speed (it is much</span>
<span class="sd">    |                        faster to transform points than it is to</span>
<span class="sd">    |                        transform patches) If this is unset and the</span>
<span class="sd">    |                        number of points in the x direction is &gt; 400</span>
<span class="sd">    |                        then it is set to True.</span>
<span class="sd">    | blockfill_fast=None - Use pcolormesh blockfill. This is possibly less</span>
<span class="sd">    |                       reliable that the usual code but is</span>
<span class="sd">    |                       faster for higher resolution datasets</span>
<span class="sd">    | nlevs=False - Let Matplotlib work out the levels for the contour plot</span>
<span class="sd">    | orca=None - User specifies this is an orca tripolar grid. Internally</span>
<span class="sd">    |             cf-plot tries to detect this by looking for a single</span>
<span class="sd">    |             discontinuity in the logitude 2D array. If found a fix</span>
<span class="sd">    |             it make to the longitudes so that they are no longer</span>
<span class="sd">    |             discontinuous.</span>
<span class="sd">    | orca_skip=None - Only plot every nth grid point in the 2D longitude</span>
<span class="sd">    |                  and latitude arrays.  This is useful for when</span>
<span class="sd">    |                  plotting his resolution data over the whole globe</span>
<span class="sd">    |                  which would otherwise be very slow to visualize.</span>
<span class="sd">    | grid=False - Draw a grid on the map using the parameters set by</span>
<span class="sd">    |              cfp.setvars. Defaults are grid_x_spacing=60,</span>
<span class="sd">    |              grid_y_spacing=30, grid_colour=&#39;k&#39;,</span>
<span class="sd">    |              grid_linestyle = &#39;--&#39;, grid_thickness=1.0</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Turn off divide warning in contour routine which is a numpy issue</span>
    <span class="n">old_settings</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="nb">all</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

    <span class="c1"># Set potential user axis labels</span>
    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>

    <span class="c1"># Set blockfill to True if blockfill_fast is not None</span>
    <span class="k">if</span> <span class="n">blockfill_fast</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">blockfill</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Check if the field is a CF ugrid field with cell faces</span>
    <span class="n">blockfill_ugrid</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">)</span> <span class="ow">and</span> <span class="n">blockfill</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">domain_topologies</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">domain_topology</span><span class="p">(</span><span class="s2">&quot;cell:face&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">face_lons_array</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">aux</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span>
                <span class="n">face_lats_array</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">aux</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span>
                <span class="n">face_connectivity_array</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">domain_topology</span><span class="p">(</span><span class="s2">&quot;cell:face&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
                <span class="n">blockfill_ugrid</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="n">irregular</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Error - field does not contain the UGRID face &quot;</span>
                    <span class="s2">&quot;information to plot a blockfill plot</span><span class="se">\n\n\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Set blockfill_2d if blockfill and x and y are 2D</span>
    <span class="n">blockfill_2d</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">blockfill</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">blockfill_2d</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Call gpos(1) if not already called</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Extract required data for contouring</span>
    <span class="c1"># If a cf-python field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

        <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndims</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.con error need a 1 or 2 dimensional field to &quot;</span>
                <span class="s2">&quot;contour</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;received </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">f</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="c1"># Extract data</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - calling _cf_data_assign&quot;</span><span class="p">)</span>

        <span class="c1"># Subset the data if a user map is set</span>
        <span class="c1"># This is use to speed up the plotting</span>
        <span class="c1"># myfield is used for calculating the contour levels</span>
        <span class="c1"># myfield_extended is used to make the contour plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">,</span> <span class="mf">90.0</span><span class="p">))</span>

            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;spstere&quot;</span><span class="p">:</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">subspace</span><span class="p">(</span><span class="n">Y</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">wi</span><span class="p">(</span><span class="o">-</span><span class="mf">90.0</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">))</span>

        <span class="c1"># Extract the data</span>
        <span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">_cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
        <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.con - cannot contour a field list</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - using user assigned data&quot;</span><span class="p">)</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>  <span class="c1"># field data passed in as f</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">_check_data</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Assign irregular and orca keywords unless already set</span>
    <span class="k">if</span> <span class="n">irregular</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">x</span><span class="p">)):</span>
            <span class="n">irregular</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">irregular</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">orca</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">orca</span> <span class="o">=</span> <span class="n">orca_check</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">orca</span><span class="p">:</span>

                    <span class="c1"># Apply orca_skip if set</span>
                    <span class="k">if</span> <span class="n">orca_skip</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;applying orca_skip value of &quot;</span><span class="p">,</span> <span class="n">orca_skip</span><span class="p">)</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="n">orca_skip</span><span class="p">,</span> <span class="p">::</span><span class="n">orca_skip</span><span class="p">]</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="n">orca_skip</span><span class="p">,</span> <span class="p">::</span><span class="n">orca_skip</span><span class="p">]</span>
                        <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[::</span><span class="n">orca_skip</span><span class="p">,</span> <span class="p">::</span><span class="n">orca_skip</span><span class="p">]</span>

                    <span class="c1"># orca grids have a discontinuity in the longitude grid</span>
                    <span class="c1"># use the method at</span>
                    <span class="c1"># https://gist.github.com/pelson/79cf31ef324774c97ae7</span>
                    <span class="c1"># to remove the discontinuity</span>

                    <span class="n">fixed_x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                    <span class="p">):</span>
                        <span class="n">fixed_x</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">start</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span> <span class="o">+=</span> <span class="mi">360</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">fixed_x</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">irregular</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Set contour line styles</span>
    <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;contour.negative_linestyle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">negative_linestyle</span>

    <span class="c1"># Set contour lines off on block plots</span>
    <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
        <span class="n">fill</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">field_orig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
        <span class="n">x_orig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y_orig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># Check number of colours and levels match if user has modified the</span>
        <span class="c1"># number of colours</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
            <span class="n">nintervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
                <span class="n">nintervals</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
                <span class="n">nintervals</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
                <span class="n">nintervals</span> <span class="o">+=</span> <span class="mi">2</span>
            <span class="k">if</span> <span class="n">ncols</span> <span class="o">!=</span> <span class="n">nintervals</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.con - blockfill error </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;need to match number of colours and contour intervals</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;Don&#39;t forget to take account of the colorbar &quot;</span>
                    <span class="s2">&quot;extensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Turn off colorbar if fill is turned off</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">fill</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span><span class="p">:</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Revert to default colour scale if cscale_flag flag is set</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">cscale1</span>

    <span class="c1"># Set the orientation of the colorbar</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;spstere&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">colorbar_orientation</span> <span class="o">=</span> <span class="s2">&quot;vertical&quot;</span>
    <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_orientation</span> <span class="o">=</span> <span class="s2">&quot;horizontal&quot;</span>

    <span class="c1"># Store original map resolution</span>
    <span class="n">resolution_orig</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span>

    <span class="c1"># Set size of color bar if not specified</span>
    <span class="k">if</span> <span class="n">colorbar_shrink</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;spstere&quot;</span><span class="p">:</span>
            <span class="n">colorbar_shrink</span> <span class="o">=</span> <span class="mf">0.8</span>

    <span class="c1"># Set plot type if user specified</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">ptype</span>

    <span class="c1"># Get contour levels if none are defined</span>
    <span class="n">spacing</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">level_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">spacing</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">level_spacing</span>
    <span class="k">if</span> <span class="n">level_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">spacing</span> <span class="o">=</span> <span class="n">level_spacing</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
            <span class="p">(</span>
                <span class="n">field</span><span class="p">,</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="n">ptype</span><span class="p">,</span>
                <span class="n">colorbar_title</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="p">,</span>
                <span class="n">ylabel</span><span class="p">,</span>
                <span class="n">xpole</span><span class="p">,</span>
                <span class="n">ypole</span><span class="p">,</span>
            <span class="p">)</span> <span class="o">=</span> <span class="n">_cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="n">clevs</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">fmult</span> <span class="o">=</span> <span class="n">calculate_levels</span><span class="p">(</span>
            <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">,</span> <span class="n">level_spacing</span><span class="o">=</span><span class="n">spacing</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">clevs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fmult</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Set the colour scale if nothing is defined</span>
    <span class="n">includes_zero</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">col_zero</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">cval</span> <span class="ow">in</span> <span class="n">clevs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">includes_zero</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">col_zero</span> <span class="o">=</span> <span class="n">col_zero</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">cval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">includes_zero</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">includes_zero</span><span class="p">:</span>
            <span class="n">cs_below</span> <span class="o">=</span> <span class="n">col_zero</span>
            <span class="n">cs_above</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">-</span> <span class="n">col_zero</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;neither&quot;</span>
            <span class="p">):</span>
                <span class="n">cs_below</span> <span class="o">=</span> <span class="n">cs_below</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;neither&quot;</span>
            <span class="p">):</span>
                <span class="n">cs_above</span> <span class="o">=</span> <span class="n">cs_above</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="n">uniform</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_uniform</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">uniform</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s2">&quot;scale1&quot;</span><span class="p">,</span> <span class="n">below</span><span class="o">=</span><span class="n">cs_below</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="n">cs_above</span><span class="p">,</span> <span class="n">uniform</span><span class="o">=</span><span class="n">uniform</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span>
            <span class="p">):</span>
                <span class="n">ncols</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;neither&quot;</span><span class="p">:</span>
                <span class="n">ncols</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">-</span> <span class="mi">2</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">)</span>

        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># User selected colour map but no mods so fit to levels</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ncols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;neither&quot;</span><span class="p">:</span>
            <span class="n">ncols</span> <span class="o">=</span> <span class="n">ncols</span> <span class="o">-</span> <span class="mi">2</span>
        <span class="n">cscale</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs_user</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">ncols</span><span class="p">)</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Set colorbar labels</span>
    <span class="c1"># Set a sensible label spacing if the user hasn&#39;t already done so</span>
    <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">:</span>
            <span class="n">nchars</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">lev</span> <span class="ow">in</span> <span class="n">clevs</span><span class="p">:</span>
                <span class="n">nchars</span> <span class="o">=</span> <span class="n">nchars</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lev</span><span class="p">))</span>
            <span class="n">colorbar_label_skip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nchars</span> <span class="o">/</span> <span class="mi">80</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">colorbar_label_skip</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nchars</span> <span class="o">*</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">/</span> <span class="mi">80</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">colorbar_label_skip</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">includes_zero</span><span class="p">:</span>
            <span class="c1"># include zero in the colorbar labels</span>
            <span class="n">zero_pos</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mylev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="k">if</span> <span class="n">mylev</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">clevs</span><span class="p">[</span><span class="n">zero_pos</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">zero_pos</span> <span class="o">+</span> <span class="n">colorbar_label_skip</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cbar_labels</span><span class="p">,</span> <span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">colorbar_label_skip</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">zero_pos</span> <span class="o">-</span> <span class="n">colorbar_label_skip</span>
            <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">cbar_labels</span><span class="p">)</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="n">colorbar_label_skip</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">clevs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">colorbar_label_skip</span><span class="p">)</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cbar_labels</span><span class="p">,</span> <span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
                <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="n">colorbar_label_skip</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">clevs</span>

    <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_label_skip</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Make a list of strings of the colorbar levels for later labelling</span>
    <span class="n">clabels</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cbar_labels</span><span class="p">:</span>
        <span class="n">clabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">skip</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">colorbar_label_skip</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">clabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">colorbar_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">colorbar_labels</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cbar_labels</span> <span class="o">=</span> <span class="n">clabels</span>

    <span class="c1"># Turn off line_labels if the field is all the same</span>
    <span class="c1"># Matplotlib 3.2.2 throws an error if there are no line labels</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
        <span class="n">line_labels</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Add mult to colorbar_title if used</span>
    <span class="k">if</span> <span class="n">colorbar_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mult</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">colorbar_title</span> <span class="o">+</span> <span class="s2">&quot; *10$^{&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mult</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;}$&quot;</span>

    <span class="c1"># Catch null title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span>

    <span class="c1"># Set plot variables</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
    <span class="k">if</span> <span class="n">colorbar_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontsize</span>
    <span class="k">if</span> <span class="n">colorbar_fontweight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorbar_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontweight</span>
    <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
    <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
    <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span>
    <span class="n">land_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">land_color</span>
    <span class="n">ocean_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ocean_color</span>
    <span class="n">lake_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lake_color</span>
    <span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span>
    <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
    <span class="k">if</span> <span class="n">continent_linestyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="s2">&quot;solid&quot;</span>
    <span class="n">cb_orient</span> <span class="o">=</span> <span class="n">colorbar_orientation</span>

    <span class="c1"># Retrieve any user defined axis labels</span>
    <span class="k">if</span> <span class="n">xlabel</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">xticks</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">yticks</span><span class="p">))</span>

    <span class="c1"># Calculate a set of dimension titles if requested</span>
    <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">titles_con_called</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">title_dims</span> <span class="o">=</span> <span class="n">generate_titles</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">title_dims</span> <span class="o">=</span> <span class="n">colorbar_title</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">title_dims</span>

    <span class="c1"># Check if data is well formed</span>
    <span class="c1"># i.e. dimensions have only recognizable X, Y, Z, T or a subset</span>
    <span class="n">well_formed</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">well_formed</span> <span class="o">=</span> <span class="n">check_well_formed</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="c1"># TODO SLB - probably there should be an error raised here if not</span>
        <span class="c1"># &#39;well-formed&#39;?</span>

    <span class="k">if</span> <span class="n">nlevs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">clevs</span> <span class="o">=</span> <span class="n">nlevs</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">=</span> <span class="s2">&quot;neither&quot;</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cscale</span><span class="p">(</span><span class="s2">&quot;scale1&quot;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">nlevs</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cscale</span><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">nlevs</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cscale</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs_user</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">nlevs</span><span class="p">)</span>

    <span class="c1">##################</span>
    <span class="c1"># Map contour plot</span>
    <span class="c1">##################</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - making a map plot&quot;</span><span class="p">)</span>

        <span class="c1"># Open a new plot if necessary</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Reset the stored mapping</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="mi">180</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>

        <span class="c1"># Set up mapping</span>
        <span class="n">mylonmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">mylonmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">mylatmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">mylatmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">mylonmax</span> <span class="o">-</span> <span class="n">mylonmin</span>
        <span class="n">latrange</span> <span class="o">=</span> <span class="n">mylatmax</span> <span class="o">-</span> <span class="n">mylatmin</span>

        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mf">360.0</span><span class="p">:</span>
            <span class="n">mylonmax</span> <span class="o">=</span> <span class="n">mylonmin</span> <span class="o">+</span> <span class="mf">360.0</span>
            <span class="n">lonrange</span> <span class="o">=</span> <span class="mf">360.0</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">and</span> <span class="n">latrange</span> <span class="o">&gt;</span> <span class="mi">160</span><span class="p">)</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">_set_map</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapset</span><span class="p">(</span>
                <span class="n">lonmin</span><span class="o">=</span><span class="n">mylonmin</span><span class="p">,</span>
                <span class="n">lonmax</span><span class="o">=</span><span class="n">mylonmax</span><span class="p">,</span>
                <span class="n">latmin</span><span class="o">=</span><span class="n">mylatmin</span><span class="p">,</span>
                <span class="n">latmax</span><span class="o">=</span><span class="n">mylatmax</span><span class="p">,</span>
                <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">_set_map</span><span class="p">()</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="n">user_mapset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span>

        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_2d</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">irregular</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Add cyclic information if missing.</span>
                    <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
                        <span class="c1"># field, x = cartopy_util.add_cyclic_point(field, x)</span>
                        <span class="c1"># Call add_cyclic_point it spacing is regular</span>
                        <span class="n">x_regular</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">xspacing</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                            <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span> <span class="o">!=</span> <span class="n">xspacing</span><span class="p">:</span>
                                <span class="n">x_regular</span> <span class="o">=</span> <span class="kc">False</span>
                        <span class="k">if</span> <span class="n">x_regular</span><span class="p">:</span>
                            <span class="n">field</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

                        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

                        <span class="c1"># cartopy line drawing fix</span>
                        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mf">360.0</span><span class="p">:</span>
                            <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.001</span>

                    <span class="c1"># Shift grid if needed</span>
                    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                        <span class="c1"># Cartopy feature at version 0.20.0</span>
                        <span class="c1"># -360 to 0 creates strange contours</span>
                        <span class="n">vers</span> <span class="o">=</span> <span class="n">cartopy</span><span class="o">.</span><span class="n">__version__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">vers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">vers</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="p">:</span>
                            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">360</span>
                    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
                        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">360</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="n">orca</span><span class="p">:</span>
                <span class="c1"># Get the irregular data within the map coordinates</span>
                <span class="c1"># Matplotlib tricontour cannot plot missing data so we need to</span>
                <span class="c1"># split the missing data into a separate field to deal with</span>
                <span class="c1"># this</span>

                <span class="n">field_modified</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="n">pts_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">field_modified</span><span class="p">))</span>
                <span class="n">field_modified</span><span class="p">[</span><span class="n">pts_nan</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1e30</span>

                <span class="n">field_irregular</span><span class="p">,</span> <span class="n">lons_irregular</span><span class="p">,</span> <span class="n">lats_irregular</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="n">irregular_window</span><span class="p">(</span><span class="n">field_modified</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="c1"># pts_real  = np.where(np.isfinite(field_irregular))</span>
                <span class="n">pts_real</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field_irregular</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">1e29</span><span class="p">)</span>
                <span class="n">pts_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field_irregular</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1e29</span><span class="p">)</span>

                <span class="n">field_irregular_nan</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">lons_irregular_nan</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">lats_irregular_nan</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts_nan</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">field_irregular_nan</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field_irregular</span><span class="p">)</span>
                    <span class="n">lons_irregular_nan</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lons_irregular</span><span class="p">)</span>
                    <span class="n">lats_irregular_nan</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lats_irregular</span><span class="p">)</span>
                    <span class="n">field_irregular_nan</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">field_irregular_nan</span><span class="p">[</span><span class="n">pts_nan</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

                <span class="n">field_irregular_real</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field_irregular</span><span class="p">[</span><span class="n">pts_real</span><span class="p">])</span>
                <span class="n">lons_irregular_real</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lons_irregular</span><span class="p">[</span><span class="n">pts_real</span><span class="p">])</span>
                <span class="n">lats_irregular_real</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lats_irregular</span><span class="p">[</span><span class="n">pts_real</span><span class="p">])</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">irregular</span><span class="p">:</span>
            <span class="c1"># Flip latitudes and field if latitudes are in descending order</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

        <span class="c1"># Plotting a sub-area of the grid produces stray contour labels</span>
        <span class="c1"># in polar plots. Subsample the latitudes to remove this problem</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_2d</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">irregular</span><span class="p">:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats_irregular</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                    <span class="n">lons_irregular_real</span> <span class="o">=</span> <span class="n">lons_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                    <span class="n">lats_irregular_real</span> <span class="o">=</span> <span class="n">lats_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                    <span class="n">field_irregular_real</span> <span class="o">=</span> <span class="n">field_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">myypos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span>
                        <span class="n">vals</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">myypos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">myypos</span><span class="p">:]</span>
                        <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="n">myypos</span><span class="p">:,</span> <span class="p">:]</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;spstere&quot;</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_2d</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">irregular</span><span class="p">:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="n">lats_irregular_real</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span> <span class="o">+</span> <span class="mi">5</span>
                    <span class="p">)</span>
                    <span class="n">lons_irregular_real</span> <span class="o">=</span> <span class="n">lons_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                    <span class="n">lats_irregular_real</span> <span class="o">=</span> <span class="n">lats_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                    <span class="n">field_irregular_real</span> <span class="o">=</span> <span class="n">field_irregular_real</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">myypos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span>
                        <span class="n">vals</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="k">if</span> <span class="n">myypos</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">myypos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="n">field</span> <span class="o">=</span> <span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span> <span class="n">myypos</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

        <span class="c1"># Set the longitudes and latitudes</span>
        <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span>

        <span class="c1"># Set the plot limits</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span>
                <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span>
                <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span>
                <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span>
                <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span>
                    <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span>
                    <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span>
                    <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span>
                    <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span>
                    <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span>
                    <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span>
                    <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span>
                    <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span>
                    <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span>
                    <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - adding filled contours&quot;</span><span class="p">)</span>
            <span class="c1"># Get colour scale for use in contouring</span>
            <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
            <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions</span>
            <span class="c1"># are then changed on the colorbar and plot after the plot is made</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">_cscale_get_map</span><span class="p">()</span>

            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span>
            <span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span>
            <span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># For fast map contours add transform_first=True to contourf</span>
            <span class="c1"># command and make lons and lats 2D</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">transform_first</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
            <span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">400</span><span class="p">:</span>
                    <span class="n">transform_first</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Fast map contours are also needed when clevs is a integer</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>
                <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span>
                <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span>
            <span class="p">):</span>
                <span class="n">transform_first</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="n">transform_first</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

            <span class="c1"># Filled colour contours</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">irregular</span> <span class="ow">or</span> <span class="n">orca</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                    <span class="n">lons</span><span class="p">,</span>
                    <span class="n">lats</span><span class="p">,</span>
                    <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                    <span class="n">clevs</span><span class="p">,</span>
                    <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                    <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="n">transform_first</span><span class="o">=</span><span class="n">transform_first</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field_irregular_real</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span>
                        <span class="n">lons_irregular_real</span><span class="p">,</span>
                        <span class="n">lats_irregular_real</span><span class="p">,</span>
                        <span class="n">field_irregular_real</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="p">,</span>
                        <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                        <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                        <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - adding blockfill&quot;</span><span class="p">)</span>

            <span class="n">two_d</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">two_d</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span>
                    <span class="s2">&quot;grid_mapping_name:transverse_mercator&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span>
                <span class="p">):</span>
                    <span class="c1"># Special case for transverse mercator</span>
                    <span class="n">_bfill</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                        <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="c1"># elif orca:</span>
                <span class="k">elif</span> <span class="n">two_d</span><span class="p">:</span>
                    <span class="n">_bfill</span><span class="p">(</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                        <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>

                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">()</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">():</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
                        <span class="c1"># Add last longitude point</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="c1"># Add last latitude point</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">ypts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>

                        <span class="n">_bfill</span><span class="p">(</span>
                            <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                            <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span>
                            <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span>
                            <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                            <span class="n">lonlat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                            <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                            <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">_bfill</span><span class="p">(</span>
                            <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                            <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                            <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                            <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                            <span class="n">lonlat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                            <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                            <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                        <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">_bfill</span><span class="p">(</span>
                    <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                    <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                    <span class="n">lonlat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Block fill for irregular</span>
        <span class="k">if</span> <span class="n">blockfill_ugrid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_2d</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - adding blockfill for irregular&quot;</span><span class="p">)</span>
            <span class="n">_bfill_ugrid</span><span class="p">(</span>
                <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                <span class="n">face_lons</span><span class="o">=</span><span class="n">face_lons_array</span><span class="p">,</span>
                <span class="n">face_lats</span><span class="o">=</span><span class="n">face_lats_array</span><span class="p">,</span>
                <span class="n">face_connectivity</span><span class="o">=</span><span class="n">face_connectivity_array</span><span class="p">,</span>
                <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - adding contour lines and labels&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">irregular</span> <span class="ow">or</span> <span class="n">blockfill_2d</span> <span class="ow">or</span> <span class="n">orca</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                    <span class="n">lons</span><span class="p">,</span>
                    <span class="n">lats</span><span class="p">,</span>
                    <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                    <span class="n">clevs</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
                    <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">tricontour</span><span class="p">(</span>
                    <span class="n">lons_irregular_real</span><span class="p">,</span>
                    <span class="n">lats_irregular_real</span><span class="p">,</span>
                    <span class="n">field_irregular_real</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                    <span class="n">clevs</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
                    <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">line_labels</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;%1.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;f&quot;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span>
                    <span class="n">cs</span><span class="p">,</span>
                    <span class="n">levels</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                    <span class="n">lons</span><span class="p">,</span>
                    <span class="n">lats</span><span class="p">,</span>
                    <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                    <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span>
                    <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Add a irregular mask if there is one</span>
        <span class="k">if</span> <span class="n">irregular</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_ugrid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">orca</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">blockfill_2d</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field_irregular_nan</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">cmap_white</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
                <span class="n">mymap</span><span class="o">.</span><span class="n">tricontourf</span><span class="p">(</span>
                    <span class="n">lons_irregular_nan</span><span class="p">,</span>
                    <span class="n">lats_irregular_nan</span><span class="p">,</span>
                    <span class="n">field_irregular_nan</span><span class="p">,</span>
                    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">],</span>
                    <span class="n">extend</span><span class="o">=</span><span class="s2">&quot;neither&quot;</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap_white</span><span class="p">,</span>
                    <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Axes</span>
        <span class="n">_plot_map_axes</span><span class="p">(</span>
            <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
            <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span>
            <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
            <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span>
            <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
            <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span>
            <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Coastlines and features</span>
        <span class="n">feature</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;land&quot;</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="s2">&quot;physical&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span>
            <span class="n">feature</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">continent_color</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">continent_linestyle</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">ocean_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span>
                <span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;face&quot;</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">ocean_color</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">land_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span>
                <span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;face&quot;</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">land_color</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">lake_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span>
                <span class="n">cfeature</span><span class="o">.</span><span class="n">LAKES</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;face&quot;</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="n">lake_color</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
            <span class="n">map_grid</span><span class="p">()</span>

        <span class="c1"># Title</span>
        <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="n">_map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="n">_dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>

        <span class="c1"># Color bar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">cbar</span><span class="p">(</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">cbar_labels</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
                <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">colorbar_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">colorbar_fontweight</span><span class="p">,</span>
                <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
                <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span>
                <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
                <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span>
                <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span>
                <span class="n">levs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">################################################</span>
    <span class="c1"># Latitude, longitude or time vs Z contour plots</span>
    <span class="c1">################################################</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - making a latitude-pressure plot&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - making a longitude-pressure plot&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - making a time-pressure plot&quot;</span><span class="p">)</span>

        <span class="c1"># Work out which way is up</span>
        <span class="n">positive</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">myz</span> <span class="o">=</span> <span class="n">find_z</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">)</span> <span class="ow">and</span> <span class="n">well_formed</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">myz</span><span class="p">),</span> <span class="s2">&quot;positive&quot;</span><span class="p">):</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">myz</span><span class="p">)</span><span class="o">.</span><span class="n">positive</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">cf-plot - data error </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;data needs a vertical coordinate direction&quot;</span>
                    <span class="s2">&quot; as required in CF data conventions&quot;</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Making a contour plot assuming positive is down</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;If this is incorrect the data needs to be modified to </span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;include a correct value for the direction attribute</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="s2">&quot;such as in f.coord(&#39;Z&#39;).positive=&#39;down&#39;</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">positive</span> <span class="o">=</span> <span class="s2">&quot;down&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;theta&quot;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="s2">&quot;up&quot;</span>
            <span class="k">if</span> <span class="s2">&quot;height&quot;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
                <span class="n">positive</span> <span class="o">=</span> <span class="s2">&quot;up&quot;</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Use gset parameter of ylog if user has set this</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="ow">is</span> <span class="kc">True</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ylog</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Set plot limits</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Program selected data plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">80</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
                <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
                <span class="n">xmax</span> <span class="o">=</span> <span class="mi">90</span>

            <span class="k">if</span> <span class="n">positive</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ymax</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
                    <span class="n">ymax</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Use user specified plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

        <span class="n">ystep</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">myrange</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">myrange</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">200</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">500</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">15000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">5000</span>

        <span class="c1"># Work out ticks and tick labels</span>
        <span class="k">if</span> <span class="n">ylog</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">ylog</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">heightticks</span> <span class="o">=</span> <span class="n">_gvals</span><span class="p">(</span>
                <span class="n">dmin</span><span class="o">=</span><span class="nb">min</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span>
                <span class="n">dmax</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span>
                <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span>
                <span class="n">mod</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">myrange</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">myrange</span> <span class="o">&gt;</span> <span class="mf">0.1</span><span class="p">:</span>
                <span class="n">heightticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="mf">10.0</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">tick</span> <span class="o">&gt;=</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)</span> <span class="ow">and</span> <span class="n">tick</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">):</span>
                    <span class="n">heightticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tick</span><span class="p">)</span>
        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">heightticks</span>

        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">heightticks</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
            <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">heightticks</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yticks</span> <span class="o">=</span> <span class="n">heightticks</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">heightlabels</span>

        <span class="c1"># Time - height contour plot</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">tmin</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dtarray</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="n">tmax</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">dtarray</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Use user set values if present</span>
                    <span class="n">tmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
                    <span class="n">tmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>

                    <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
                    <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
                    <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">xmin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">xmax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>

        <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">xaxis</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span>
                    <span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span>
                <span class="p">)</span>  <span class="c1"># lat-pressure</span>
            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span>
                    <span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span>
                <span class="p">)</span>  <span class="c1"># lon-pressure</span>

            <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                <span class="c1"># time-pressure</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

                    <span class="c1"># Change plotvars.xmin and plotvars.xmax from a date string</span>
                    <span class="c1"># to a number</span>
                    <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
                    <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
                    <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>

                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">xmin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">xmax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>

                    <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmin</span><span class="p">),</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">tmax</span><span class="p">)],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span>
                    <span class="p">)</span>
                    <span class="n">time_ticks</span><span class="p">,</span> <span class="n">time_labels</span><span class="p">,</span> <span class="n">tlabel</span> <span class="o">=</span> <span class="n">_timeaxis</span><span class="p">(</span><span class="n">taxis</span><span class="p">)</span>

                    <span class="c1"># Use user supplied labels if present</span>
                    <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">tlabel</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xticks</span> <span class="o">=</span> <span class="n">time_ticks</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">time_labels</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Not a CF field</span><span class="se">\n</span><span class="s2">Please use ptype=0 and &quot;</span>
                        <span class="s2">&quot;specify axis labels manually</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="n">ylog</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">ylog</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ymax</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># Avoid zero in a log plot</span>
            <span class="n">gset</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                <span class="n">ylog</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Label axes</span>
        <span class="n">axes_plot</span><span class="p">(</span>
            <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span>
            <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
            <span class="n">yticks</span><span class="o">=</span><span class="n">heightticks</span><span class="p">,</span>
            <span class="n">yticklabels</span><span class="o">=</span><span class="n">heightlabels</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions are</span>
        <span class="c1"># then changed on the colorbar and plot after the plot is made</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">_cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">_cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span>
            <span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span>
            <span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                <span class="n">clevs</span><span class="p">,</span>
                <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

                <span class="n">hasbounds</span> <span class="o">=</span> <span class="kc">True</span>

                <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">()</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">():</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">ypts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hasbounds</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">()</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">():</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="c1"># Use &#39;noqa&#39; to prevent PEP8 E501 being raised due to</span>
                        <span class="c1"># line length being too long. Can&#39;t prevent this</span>
                        <span class="c1"># straightforwardly given function name of that length.</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeAllTrop_UpStrat_Eq_Total_AllWN_Timeseries_2ze</span><span class="p">(</span>  <span class="c1"># noqa: E501</span>
                            <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span>
                        <span class="p">)[</span>
                            <span class="p">:,</span> <span class="mi">0</span>
                        <span class="p">]</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hasbounds</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">()</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">():</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">hasbounds</span> <span class="o">=</span> <span class="kc">False</span>

                <span class="k">if</span> <span class="n">hasbounds</span><span class="p">:</span>
                    <span class="n">_bfill</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                        <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_bfill</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                        <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">_bfill</span><span class="p">(</span>
                    <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                    <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                    <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                <span class="n">clevs</span><span class="p">,</span>
                <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
                <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;%1.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;f&quot;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span>
                    <span class="n">cs</span><span class="p">,</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Thick zero contour line</span>
                <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                    <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">,</span>
                        <span class="n">y</span><span class="p">,</span>
                        <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                        <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                        <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span>
                        <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="n">_dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>

        <span class="c1"># Color bar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">cbar</span><span class="p">(</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">cbar_labels</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
                <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">colorbar_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">colorbar_fontweight</span><span class="p">,</span>
                <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
                <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span>
                <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
                <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span>
                <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
                <span class="n">levs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span>
        <span class="p">)</span>

        <span class="c1"># Reset plot limits to those supplied by the user</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">tmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">tmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span>
            <span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">########################</span>
    <span class="c1"># Hovmuller contour plot</span>
    <span class="c1">########################</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - making a Hovmuller plot&quot;</span><span class="p">)</span>
        <span class="n">yplotlabel</span> <span class="o">=</span> <span class="s2">&quot;Time&quot;</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="s2">&quot;Longitude&quot;</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="s2">&quot;Latitude&quot;</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>

        <span class="c1"># Time strings set to None initially</span>
        <span class="n">tmin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">tmax</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
            <span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="c1"># Store time strings for later use</span>
            <span class="n">tmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">tmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

            <span class="c1"># Check data has CF attributes needed</span>
            <span class="n">check_units</span> <span class="o">=</span> <span class="n">check_units</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">check_calendar</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">check_Units_reftime</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">),</span> <span class="s2">&quot;units&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">check_units</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">),</span> <span class="s2">&quot;calendar&quot;</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">check_calendar</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Units</span><span class="p">,</span> <span class="s2">&quot;reftime&quot;</span><span class="p">):</span>
                    <span class="n">check_Units_reftime</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">check_Units_reftime</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">if</span> <span class="kc">False</span> <span class="ow">in</span> <span class="p">[</span><span class="n">check_units</span><span class="p">,</span> <span class="n">check_calendar</span><span class="p">,</span> <span class="n">check_Units_reftime</span><span class="p">]:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The required CF time information to make the plot &quot;</span>
                    <span class="s2">&quot;is not available please fix the following before &quot;</span>
                    <span class="s2">&quot;trying to plot again&quot;</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">check_units</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time axis missing: units&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">check_calendar</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time axis missing: calendar&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">check_Units_reftime</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time axis missing: Units.reftime&quot;</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="c1"># Change from date string in ymin and ymax to date as a float</span>

            <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
            <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>

            <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

        <span class="c1"># Extract axis labels</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">constructs</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">Time axis error - only one time axis allowed</span><span class="se">\n</span><span class="s2"> &quot;</span>
                <span class="s2">&quot;Please list time axes with print(f.constructs())</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;and remove the ones not needed for a hovmuller plot </span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;with f.del_construct(&#39;unwanted_time_axis&#39;)</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;before trying to plot again</span><span class="se">\n\n\n\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="n">time_ticks</span><span class="p">,</span> <span class="n">time_labels</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="n">_timeaxis</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">lonlatticks</span><span class="p">,</span> <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
            <span class="n">lonlatticks</span><span class="p">,</span> <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">lonlatticks</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">lonlatlabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lonlatticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">timeticks</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="n">timelabels</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">timelabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">timeticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">timeticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
        <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>

        <span class="c1"># Use the automatically generated labels if none are supplied</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="s2">&quot;time&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time_ticks</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">timeticks</span> <span class="o">=</span> <span class="n">time_ticks</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time_labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">timelabels</span> <span class="o">=</span> <span class="n">time_labels</span>

        <span class="c1"># Swap axes if requested</span>
        <span class="k">if</span> <span class="n">swap_axes</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmin</span>
            <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">xmax</span>
            <span class="n">xplotlabel</span><span class="p">,</span> <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">yplotlabel</span><span class="p">,</span> <span class="n">xplotlabel</span>
            <span class="n">lonlatticks</span><span class="p">,</span> <span class="n">timeticks</span> <span class="o">=</span> <span class="n">timeticks</span><span class="p">,</span> <span class="n">lonlatticks</span>
            <span class="n">lonlatlabels</span><span class="p">,</span> <span class="n">timelabels</span> <span class="o">=</span> <span class="n">timelabels</span><span class="p">,</span> <span class="n">lonlatlabels</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

        <span class="c1"># Revert to time strings if set</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">]):</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">tmin</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">tmax</span>

        <span class="c1"># Set and label axes</span>
        <span class="n">axes_plot</span><span class="p">(</span>
            <span class="n">xticks</span><span class="o">=</span><span class="n">lonlatticks</span><span class="p">,</span>
            <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlatlabels</span><span class="p">,</span>
            <span class="n">yticks</span><span class="o">=</span><span class="n">timeticks</span><span class="p">,</span>
            <span class="n">yticklabels</span><span class="o">=</span><span class="n">timelabels</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">xplotlabel</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">yplotlabel</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions are</span>
        <span class="c1"># then changed on the colorbar and plot after the plot is made</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">_cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">_cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span>
            <span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span>
            <span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                <span class="n">clevs</span><span class="p">,</span>
                <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">has_bounds</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
                        <span class="p">)</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="k">if</span> <span class="n">swap_axes</span><span class="p">:</span>
                        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">xpts</span>
                        <span class="n">field_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field_orig</span><span class="p">))</span>

                    <span class="n">_bfill</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                        <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">swap_axes</span><span class="p">:</span>
                        <span class="n">x_orig</span><span class="p">,</span> <span class="n">y_orig</span> <span class="o">=</span> <span class="n">y_orig</span><span class="p">,</span> <span class="n">x_orig</span>
                        <span class="n">field_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field_orig</span><span class="p">))</span>
                    <span class="n">_bfill</span><span class="p">(</span>
                        <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                        <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                        <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                        <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                        <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                        <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                        <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">swap_axes</span><span class="p">:</span>
                    <span class="n">x_orig</span><span class="p">,</span> <span class="n">y_orig</span> <span class="o">=</span> <span class="n">y_orig</span><span class="p">,</span> <span class="n">x_orig</span>
                    <span class="n">field_orig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field_orig</span><span class="p">))</span>
                <span class="n">_bfill</span><span class="p">(</span>
                    <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                    <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                    <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                <span class="n">clevs</span><span class="p">,</span>
                <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
                <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;%1.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;f&quot;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span>
                    <span class="n">cs</span><span class="p">,</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="c1"># Thick zero contour line</span>
                <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                    <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                        <span class="n">x</span><span class="p">,</span>
                        <span class="n">y</span><span class="p">,</span>
                        <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                        <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                        <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                        <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span>
                        <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="p">)</span>
        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="n">_dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>

        <span class="c1"># Color bar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">cbar</span><span class="p">(</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">cbar_labels</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
                <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">colorbar_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">colorbar_fontweight</span><span class="p">,</span>
                <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
                <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span>
                <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
                <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span>
                <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
                <span class="n">levs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span>
        <span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">###########################</span>
    <span class="c1"># Rotated pole contour plot</span>
    <span class="c1">###########################</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>

        <span class="c1"># Extract x and y grid points</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - making a rotated pole plot&quot;</span><span class="p">)</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;rotated&quot;</span><span class="p">:</span>
            <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">gset</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
                <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

        <span class="c1"># Set plot limits</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;UKCP&quot;</span><span class="p">:</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>
            <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
            <span class="n">rotated_pole</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span>
                <span class="s2">&quot;grid_mapping_name:rotated_latitude_longitude&quot;</span>
            <span class="p">)</span>
            <span class="n">xpole</span> <span class="o">=</span> <span class="n">rotated_pole</span><span class="p">[</span><span class="s2">&quot;grid_north_pole_longitude&quot;</span><span class="p">]</span>
            <span class="n">ypole</span> <span class="o">=</span> <span class="n">rotated_pole</span><span class="p">[</span><span class="s2">&quot;grid_north_pole_latitude&quot;</span><span class="p">]</span>

            <span class="n">transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">RotatedPole</span><span class="p">(</span>
                <span class="n">pole_latitude</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="o">=</span><span class="n">xpole</span>
            <span class="p">)</span>
            <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">transform</span><span class="p">}</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">_set_map</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">lonpts</span><span class="p">,</span> <span class="n">latpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">lonpts</span> <span class="o">=</span> <span class="n">xpts</span>
                    <span class="n">latpts</span> <span class="o">=</span> <span class="n">ypts</span>

                <span class="n">points</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
                    <span class="n">transform</span><span class="p">,</span> <span class="n">lonpts</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">latpts</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

                <span class="n">mapset</span><span class="p">(</span>
                    <span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span>
                    <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span>
                    <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span>
                    <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span>
                    <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">_set_map</span><span class="p">()</span>

            <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;transform&quot;</span><span class="p">:</span> <span class="n">transform</span><span class="p">}</span>
            <span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># from 1 to ncols-2.  The colours for the colour bar extensions are</span>
        <span class="c1"># then changed on the colorbar and plot after the plot is made</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">_cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">_cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span>
            <span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span>
            <span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">xpts</span><span class="p">,</span>
                <span class="n">ypts</span><span class="p">,</span>
                <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                <span class="n">clevs</span><span class="p">,</span>
                <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="o">**</span><span class="n">plotargs</span>
            <span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="n">_bfill</span><span class="p">(</span>
                <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span>
                <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">transform</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">xpts</span><span class="p">,</span>
                <span class="n">ypts</span><span class="p">,</span>
                <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                <span class="n">clevs</span><span class="p">,</span>
                <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
                <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="o">**</span><span class="n">plotargs</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;%1.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;f&quot;</span>
                <span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span>
                    <span class="n">cs</span><span class="p">,</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                    <span class="n">xpts</span><span class="p">,</span>
                    <span class="n">ypts</span><span class="p">,</span>
                    <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                    <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span>
                    <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">plotargs</span>
                <span class="p">)</span>

        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="n">_dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>

        <span class="c1"># Color bar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">cbar</span><span class="p">(</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">cbar_labels</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
                <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">colorbar_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">colorbar_fontweight</span><span class="p">,</span>
                <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
                <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span>
                <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
                <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span>
                <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
                <span class="n">levs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Rotated grid axes</span>
        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
                <span class="n">_plot_map_axes</span><span class="p">(</span>
                    <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                    <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span>
                    <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                    <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span>
                    <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                    <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span>
                    <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                    <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span>
                    <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rgaxes</span><span class="p">(</span>
                    <span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span>
                    <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span>
                    <span class="n">xvec</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">yvec</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span>
                    <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                    <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span>
                    <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                    <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                    <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span>
                    <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;rotated&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;UKCP&quot;</span><span class="p">:</span>
            <span class="c1"># Remove Matplotlib default axis labels</span>
            <span class="n">axes_plot</span><span class="p">(</span>
                <span class="n">xticks</span><span class="o">=</span><span class="p">[</span><span class="mi">100000000</span><span class="p">],</span>
                <span class="n">xticklabels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">],</span>
                <span class="n">yticks</span><span class="o">=</span><span class="p">[</span><span class="mi">100000000</span><span class="p">],</span>
                <span class="n">yticklabels</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">],</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Add title and coastlines for cylindrical projection</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
            <span class="c1"># Coastlines</span>
            <span class="n">feature</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
                <span class="n">name</span><span class="o">=</span><span class="s2">&quot;land&quot;</span><span class="p">,</span>
                <span class="n">category</span><span class="o">=</span><span class="s2">&quot;physical&quot;</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span>
                <span class="n">feature</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="n">continent_color</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
                <span class="n">linestyle</span><span class="o">=</span><span class="n">continent_linestyle</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Title</span>
            <span class="k">if</span> <span class="n">title</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                <span class="n">_map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># Add title for native grid</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;rotated&quot;</span><span class="p">:</span>
            <span class="c1"># Title</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="n">title</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">#############</span>
    <span class="c1"># Other plots</span>
    <span class="c1">#############</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - making an other plot&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>

        <span class="c1"># Set axis labels to None</span>
        <span class="n">xplotlabel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">yplotlabel</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">cf_field</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="n">cf_field</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

        <span class="c1"># Work out axes if none are supplied</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
            <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="p">):</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

        <span class="c1"># Change from date string to a number if strings are passed</span>
        <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">ymin</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">xaxisticks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">yaxisticks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">xtimeaxis</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">ytimeaxis</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">cf_field</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>

                <span class="n">taxis</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>

                <span class="n">data_axes</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">get_data_axes</span><span class="p">()</span>
                <span class="n">count</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data_axes</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">constructs</span><span class="o">.</span><span class="n">domain_axis_identity</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">c</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">coordinate</span><span class="p">([</span><span class="n">i</span><span class="p">])</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">test_for_time_axis</span> <span class="o">=</span> <span class="kc">False</span>
                            <span class="n">sn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="s2">&quot;NoName&quot;</span><span class="p">)</span>
                            <span class="n">an</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">get_property</span><span class="p">(</span><span class="s2">&quot;axis&quot;</span><span class="p">,</span> <span class="s2">&quot;NoName&quot;</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">sn</span> <span class="o">==</span> <span class="s2">&quot;time&quot;</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">==</span> <span class="s2">&quot;T&quot;</span><span class="p">:</span>
                                <span class="n">test_for_time_axis</span> <span class="o">=</span> <span class="kc">True</span>

                            <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">test_for_time_axis</span><span class="p">:</span>
                                    <span class="n">ytimeaxis</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="k">elif</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">test_for_time_axis</span><span class="p">:</span>
                                    <span class="n">xtimeaxis</span> <span class="o">=</span> <span class="kc">True</span>
                            <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;no sensible coordinates for this axis&quot;</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">time_xstr</span> <span class="ow">or</span> <span class="n">time_ystr</span><span class="p">:</span>
                    <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
                    <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
                    <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">time_xstr</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">xmin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">xmin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">xmax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">xmax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                        <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">([</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">taxis</span><span class="o">.</span><span class="n">calendar</span> <span class="o">=</span> <span class="n">ref_calendar</span>

                    <span class="k">if</span> <span class="n">time_ystr</span><span class="p">:</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">ymin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">ymin</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                        <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">ymax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">ymax</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                        <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">([</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                        <span class="n">taxis</span><span class="o">.</span><span class="n">calendar</span> <span class="o">=</span> <span class="n">ref_calendar</span>

                <span class="k">if</span> <span class="n">xtimeaxis</span><span class="p">:</span>
                    <span class="n">xaxisticks</span><span class="p">,</span> <span class="n">xaxislabels</span><span class="p">,</span> <span class="n">xplotlabel</span> <span class="o">=</span> <span class="n">_timeaxis</span><span class="p">(</span><span class="n">taxis</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ytimeaxis</span><span class="p">:</span>
                    <span class="n">yaxisticks</span><span class="p">,</span> <span class="n">yaxislabels</span><span class="p">,</span> <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">_timeaxis</span><span class="p">(</span><span class="n">taxis</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cf_field</span><span class="p">:</span>
            <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coords</span><span class="p">())</span>
            <span class="n">mycoords</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">coord</span> <span class="ow">in</span> <span class="n">coords</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">mycoords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
            <span class="n">mycoords</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">icoord</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mycoords</span><span class="p">)):</span>

                <span class="n">myaxisticks</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">myaxislabels</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="n">mylabel</span> <span class="o">=</span> <span class="kc">None</span>

                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoords</span><span class="p">[</span><span class="n">icoord</span><span class="p">])</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
                    <span class="n">myaxisticks</span><span class="p">,</span> <span class="n">myaxislabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;X&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">),</span>
                        <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">mylabel</span> <span class="o">=</span> <span class="s2">&quot;longitude&quot;</span>

                <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoords</span><span class="p">[</span><span class="n">icoord</span><span class="p">])</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
                    <span class="n">myaxisticks</span><span class="p">,</span> <span class="n">myaxislabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">),</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s2">&quot;Y&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">),</span>
                        <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">mylabel</span> <span class="o">=</span> <span class="s2">&quot;latitude&quot;</span>

                <span class="k">if</span> <span class="n">myaxisticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">icoord</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">xaxisticks</span><span class="p">,</span> <span class="n">xaxislabels</span><span class="p">,</span> <span class="n">xlabel</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">myaxisticks</span><span class="p">,</span>
                            <span class="n">myaxislabels</span><span class="p">,</span>
                            <span class="n">mylabel</span><span class="p">,</span>
                        <span class="p">)</span>
                    <span class="k">if</span> <span class="n">icoord</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">yaxisticks</span><span class="p">,</span> <span class="n">yaxislabels</span><span class="p">,</span> <span class="n">ylabel</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="n">myaxisticks</span><span class="p">,</span>
                            <span class="n">myaxislabels</span><span class="p">,</span>
                            <span class="n">mylabel</span><span class="p">,</span>
                        <span class="p">)</span>

        <span class="k">if</span> <span class="n">xaxisticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xaxisticks</span> <span class="o">=</span> <span class="n">_gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">xaxislabels</span> <span class="o">=</span> <span class="n">xaxisticks</span>

        <span class="k">if</span> <span class="n">yaxisticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yaxisticks</span> <span class="o">=</span> <span class="n">_gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">yaxislabels</span> <span class="o">=</span> <span class="n">yaxisticks</span>

        <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xplotlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xplotlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">xplotlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
        <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">yplotlabel</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">ylabel</span>

        <span class="c1"># Draw axes</span>
        <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">xaxisticks</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="n">xaxislabels</span> <span class="o">=</span> <span class="n">xticks</span>
                    <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">xaxislabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">xaxisticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">yaxisticks</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="n">yaxislabels</span> <span class="o">=</span> <span class="n">yticks</span>
                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">yaxislabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">yaxisticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">xaxisticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">yaxisticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Swap axes if requested</span>
        <span class="k">if</span> <span class="n">swap_axes</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>
            <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rot90</span><span class="p">(</span><span class="n">field</span><span class="p">))</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmin</span>
            <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span><span class="p">,</span> <span class="n">xmax</span>
            <span class="n">xplotlabel</span><span class="p">,</span> <span class="n">yplotlabel</span> <span class="o">=</span> <span class="n">yplotlabel</span><span class="p">,</span> <span class="n">xplotlabel</span>
            <span class="n">xaxisticks</span><span class="p">,</span> <span class="n">yaxisticks</span> <span class="o">=</span> <span class="n">yaxisticks</span><span class="p">,</span> <span class="n">xaxisticks</span>
            <span class="n">xaxislabels</span><span class="p">,</span> <span class="n">yaxislabels</span> <span class="o">=</span> <span class="n">yaxislabels</span><span class="p">,</span> <span class="n">xaxislabels</span>

        <span class="c1"># Set plot limits and set default plot labels</span>
        <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

        <span class="c1"># Draw axes</span>
        <span class="n">axes_plot</span><span class="p">(</span>
            <span class="n">xticks</span><span class="o">=</span><span class="n">xaxisticks</span><span class="p">,</span>
            <span class="n">xticklabels</span><span class="o">=</span><span class="n">xaxislabels</span><span class="p">,</span>
            <span class="n">yticks</span><span class="o">=</span><span class="n">yaxisticks</span><span class="p">,</span>
            <span class="n">yticklabels</span><span class="o">=</span><span class="n">yaxislabels</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">xplotlabel</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">yplotlabel</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Get colour scale for use in contouring</span>
        <span class="c1"># If colour bar extensions are enabled then the colour map goes</span>
        <span class="c1"># then from 1 to ncols-2.  The colours for the colour bar extensions</span>
        <span class="c1"># are changed on the colorbar and plot after the plot is made</span>
        <span class="n">colmap</span> <span class="o">=</span> <span class="n">_cscale_get_map</span><span class="p">()</span>

        <span class="c1"># Filled contours</span>
        <span class="k">if</span> <span class="n">fill</span><span class="p">:</span>
            <span class="n">colmap</span> <span class="o">=</span> <span class="n">_cscale_get_map</span><span class="p">()</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span>
            <span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span>
            <span class="p">):</span>
                <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                <span class="n">clevs</span><span class="p">,</span>
                <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
                <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Block fill</span>
        <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span>
            <span class="n">_bfill</span><span class="p">(</span>
                <span class="n">f</span><span class="o">=</span><span class="n">field_orig</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span>
                <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                <span class="n">lonlat</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">fast</span><span class="o">=</span><span class="n">blockfill_fast</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Contour lines and labels</span>
        <span class="k">if</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                <span class="n">x</span><span class="p">,</span>
                <span class="n">y</span><span class="p">,</span>
                <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                <span class="n">clevs</span><span class="p">,</span>
                <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                <span class="n">linewidths</span><span class="o">=</span><span class="n">linewidths</span><span class="p">,</span>
                <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">line_labels</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%d</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;%1.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;f&quot;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span>
                    <span class="n">cs</span><span class="p">,</span>
                    <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span><span class="p">:</span>
                <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span>
                    <span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="n">field</span> <span class="o">*</span> <span class="n">fmult</span><span class="p">,</span>
                    <span class="p">[</span><span class="o">-</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>
                    <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span>
                    <span class="n">linestyles</span><span class="o">=</span><span class="n">linestyles</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="n">_dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>

        <span class="c1"># Color bar</span>
        <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
            <span class="n">cbar</span><span class="p">(</span>
                <span class="n">labels</span><span class="o">=</span><span class="n">cbar_labels</span><span class="p">,</span>
                <span class="n">orientation</span><span class="o">=</span><span class="n">cb_orient</span><span class="p">,</span>
                <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
                <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">colorbar_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">colorbar_fontweight</span><span class="p">,</span>
                <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
                <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span>
                <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
                <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span>
                <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
                <span class="n">levs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span>
                <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span>
                <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span>
        <span class="p">)</span>

        <span class="c1"># reset plot limits if not a user plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">()</span>

    <span class="c1">############################</span>
    <span class="c1"># Set axis width if required</span>
    <span class="c1">############################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span><span class="p">)</span>

    <span class="c1">################################</span>
    <span class="c1"># Add a master title if reqested</span>
    <span class="c1">################################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">location</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_location</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
            <span class="n">location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontweight</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontsize</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Reset map resolution</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mapset</span><span class="p">()</span>
        <span class="n">mapset</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">)</span>

    <span class="c1">##################</span>
    <span class="c1"># Save or view plot</span>
    <span class="c1">##################</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - saving or viewing plot&quot;</span><span class="p">)</span>

        <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="o">**</span><span class="n">old_settings</span><span class="p">)</span>  <span class="c1"># reset to default numpy error settings</span>

        <span class="n">gclose</span><span class="p">()</span></div>



<div class="viewcode-block" id="mapset">
<a class="viewcode-back" href="../mapset.html#cfplot.mapset">[docs]</a>
<span class="k">def</span> <span class="nf">mapset</span><span class="p">(</span>
    <span class="n">lonmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">lonmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">latmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">latmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">proj</span><span class="o">=</span><span class="s2">&quot;cyl&quot;</span><span class="p">,</span>
    <span class="n">boundinglat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">lon_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">lat_0</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
    <span class="n">resolution</span><span class="o">=</span><span class="s2">&quot;110m&quot;</span><span class="p">,</span>
    <span class="n">user_mapset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Sets the mapping parameters.</span>
<span class="sd">    |</span>
<span class="sd">    | lonmin=lonmin - minimum longitude</span>
<span class="sd">    | lonmax=lonmax - maximum longitude</span>
<span class="sd">    | latmin=latmin - minimum latitude</span>
<span class="sd">    | latmax=latmax - maximum latitude</span>
<span class="sd">    | proj=proj - &#39;cyl&#39; for cylindrical projection. &#39;npstere&#39; or &#39;spstere&#39;</span>
<span class="sd">    |      for northern hemisphere or southern hemisphere polar stereographic.</span>
<span class="sd">    |      ortho, merc, moll, robin and lcc are abreviations for orthographic,</span>
<span class="sd">    |      mercator, mollweide, robinson and lambert conformal projections</span>
<span class="sd">    |      &#39;rotated&#39; for contour plots on the native rotated grid.</span>
<span class="sd">    |</span>
<span class="sd">    | boundinglat=boundinglat - edge of the viewable latitudes in a</span>
<span class="sd">    |      stereographic plot</span>
<span class="sd">    | lon_0=0 - longitude centre of desired map domain in polar</span>
<span class="sd">    |           stereographic and orthogrphic plots</span>
<span class="sd">    | lat_0=40 - latitude centre of desired map domain in orthogrphic plots</span>
<span class="sd">    | resolution=&#39;110m&#39; - the map resolution - can be one of &#39;110m&#39;,</span>
<span class="sd">    | &#39;50m&#39; or &#39;10m&#39;.  &#39;50m&#39; means 1:50,000,000 and not 50 metre.</span>
<span class="sd">    | user_mapset=user_mapset - variable to indicate whether a user call</span>
<span class="sd">    |      to mapset has been made.</span>
<span class="sd">    |</span>
<span class="sd">    | The default map plotting projection is the cyclindrical equidistant</span>
<span class="sd">    | projection from -180 to 180 in longitude and -90 to 90 in latitude.</span>
<span class="sd">    | To change the map view in this projection to over the United Kingdom,</span>
<span class="sd">    | for example, you would use</span>
<span class="sd">    | mapset(lonmin=-6, lonmax=3, latmin=50, latmax=60)</span>
<span class="sd">    | or</span>
<span class="sd">    | mapset(-6, 3, 50, 60)</span>
<span class="sd">    |</span>
<span class="sd">    | The limits are -360 to 720 in longitude so to look at the equatorial</span>
<span class="sd">    | Pacific you could use</span>
<span class="sd">    | mapset(lonmin=90, lonmax=300, latmin=-30, latmax=30)</span>
<span class="sd">    | or</span>
<span class="sd">    | mapset(lonmin=-270, lonmax=-60, latmin=-30, latmax=30)</span>
<span class="sd">    |</span>
<span class="sd">    | The default setting for the cylindrical projection is for 1 degree of</span>
<span class="sd">    | longitude to have the same size as one degree of latitude.  When plotting</span>
<span class="sd">    | a smaller map setting aspect=&#39;auto&#39; turns this off and the map fills the</span>
<span class="sd">    | plot area. Setting aspect to a number a circle will be stretched such</span>
<span class="sd">    | that the height is num times the width. aspect=1 is the same as</span>
<span class="sd">    | aspect=&#39;equal&#39;.</span>
<span class="sd">    |</span>
<span class="sd">    | The proj parameter accepts &#39;npstere&#39; and &#39;spstere&#39; for northern</span>
<span class="sd">    | hemisphere or southern hemisphere polar stereographic projections.</span>
<span class="sd">    | In addition to these the boundinglat parameter sets the edge of the</span>
<span class="sd">    | viewable latitudes and lon_0 sets the centre of desired map domain.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    | Map settings are persistent until a new call to mapset is made. To</span>
<span class="sd">    | reset to the default map settings use mapset().</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set the continent resolution</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">lonmax</span><span class="p">,</span> <span class="n">latmin</span><span class="p">,</span> <span class="n">latmax</span><span class="p">,</span> <span class="n">aspect</span><span class="p">])</span>
        <span class="ow">and</span> <span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span>
    <span class="p">):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="mi">180</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="s2">&quot;cyl&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="s2">&quot;equal&quot;</span>

        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">return</span>

    <span class="c1"># Set the aspect ratio</span>
    <span class="k">if</span> <span class="n">aspect</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">aspect</span> <span class="o">=</span> <span class="s2">&quot;equal&quot;</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">aspect</span> <span class="o">=</span> <span class="n">aspect</span>

    <span class="k">if</span> <span class="n">lonmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
    <span class="k">if</span> <span class="n">lonmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="mi">180</span>
    <span class="k">if</span> <span class="n">latmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;merc&quot;</span><span class="p">:</span>
            <span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">80</span>
    <span class="k">if</span> <span class="n">latmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>
        <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;merc&quot;</span><span class="p">:</span>
            <span class="n">latmax</span> <span class="o">=</span> <span class="mi">80</span>

    <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;moll&quot;</span><span class="p">:</span>
        <span class="n">lonmin</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">-</span> <span class="mi">180</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mi">180</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="n">lonmin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="n">lonmax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="n">latmin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="n">latmax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="n">proj</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span> <span class="o">=</span> <span class="n">boundinglat</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span> <span class="o">=</span> <span class="n">lon_0</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">lat_0</span> <span class="o">=</span> <span class="n">lat_0</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">=</span> <span class="n">user_mapset</span></div>



<div class="viewcode-block" id="levs">
<a class="viewcode-back" href="../levs.html#cfplot.levs">[docs]</a>
<span class="k">def</span> <span class="nf">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">manual</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Manually sets the contour levels.</span>

<span class="sd">    | min=min - minimum level</span>
<span class="sd">    | max=max - maximum level</span>
<span class="sd">    | step=step - step between levels</span>
<span class="sd">    | manual= manual - set levels manually</span>
<span class="sd">    | extend=&#39;neither&#39;, &#39;both&#39;, &#39;min&#39;, or &#39;max&#39; - colour bar limit extensions</span>

<span class="sd">    | Use the levs command when a predefined set of levels is required. The</span>
<span class="sd">    | min, max and step parameters can be used to define a set of levels.</span>
<span class="sd">    | These can take integer or floating point numbers. If the min and max</span>
<span class="sd">    | are specified then a step also needs to be specified.</span>

<span class="sd">    | If just the step is specified then cf-plot will internally try to</span>
<span class="sd">    | define a reasonable set of levels.</span>

<span class="sd">    | If colour filled contours are plotted then the default is to extend</span>
<span class="sd">    | the minimum and maximum contours coloured for out of range values</span>
<span class="sd">    | - extend=&#39;both&#39;.</span>

<span class="sd">    | Once a user call is made to levs the levels are persistent.</span>
<span class="sd">    | i.e. the next plot will use the same set of levels.</span>
<span class="sd">    | Use levs() to reset to undefined levels.</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">])</span> <span class="ow">and</span> <span class="n">step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">cfp.levs error: when the min and max are specified &quot;</span>
            <span class="s2">&quot;a step also needs to be specified</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">manual</span><span class="p">]):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">=</span> <span class="s2">&quot;both&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>

    <span class="k">if</span> <span class="n">manual</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">manual</span><span class="p">)</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># Set the normalization object as we are using potentially unevenly</span>
        <span class="c1"># spaced levels</span>
        <span class="n">ncolors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span> <span class="ow">or</span> <span class="n">extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
            <span class="n">ncolors</span> <span class="o">=</span> <span class="n">ncolors</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span>
            <span class="n">boundaries</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="n">ncolors</span>
        <span class="p">)</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">]):</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span> <span class="o">=</span> <span class="nb">min</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span> <span class="o">=</span> <span class="nb">max</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="o">=</span> <span class="n">step</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">item</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">step</span><span class="p">]):</span>
                <span class="n">lstep</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="mf">1e-10</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">+</span> <span class="n">lstep</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="p">((</span><span class="n">levs</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="p">(</span><span class="n">levs</span> <span class="o">/</span> <span class="mf">1e10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levs</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lstep</span> <span class="o">=</span> <span class="n">step</span> <span class="o">*</span> <span class="mf">1e-10</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">+</span> <span class="n">lstep</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="p">(</span><span class="n">levs</span> <span class="o">*</span> <span class="mf">1e10</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="n">levs</span> <span class="o">/</span> <span class="mf">1e10</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="n">levs</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># Check for spurious decimal places due to numeric representation</span>
            <span class="c1"># and fix if found</span>
            <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">)):</span>
                <span class="n">ndecs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">pt</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ndecs</span> <span class="o">&gt;</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span> <span class="mi">7</span><span class="p">)</span>

    <span class="c1"># If step only is set then reset user_levs to zero</span>
    <span class="k">if</span> <span class="n">step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">]):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="o">=</span> <span class="n">step</span>

    <span class="c1"># Check extend has a proper value</span>
    <span class="k">if</span> <span class="n">extend</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;neither&quot;</span><span class="p">,</span> <span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="s2">&quot;both&quot;</span><span class="p">]:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2"> extend must be one of &#39;neither&#39;, &#39;min&#39;, &#39;max&#39;, &#39;both&#39;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">=</span> <span class="n">extend</span></div>



<div class="viewcode-block" id="ndecs">
<a class="viewcode-back" href="../ndecs.html#cfplot.ndecs">[docs]</a>
<span class="k">def</span> <span class="nf">ndecs</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Finds the number of decimal places in an array.</span>
<span class="sd">    | Needed to make the colour bar match the contour line labelling.</span>

<span class="sd">    | data=data - input array of values</span>

<span class="sd">    :Returns:</span>
<span class="sd">    |  maximum number of necimal places</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">maxdecs</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">number</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">a</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">number_decs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">number_decs</span> <span class="o">&gt;</span> <span class="n">maxdecs</span><span class="p">:</span>
                <span class="n">maxdecs</span> <span class="o">=</span> <span class="n">number_decs</span>

    <span class="k">return</span> <span class="n">maxdecs</span></div>



<div class="viewcode-block" id="axes">
<a class="viewcode-back" href="../axes.html#cfplot.axes">[docs]</a>
<span class="k">def</span> <span class="nf">axes</span><span class="p">(</span>
    <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xstep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ystep</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Set axes plotting parameters. The xstep and ystep</span>
<span class="sd">    | parameters are used to label the axes starting at the left hand side and</span>
<span class="sd">    | bottom of the plot respectively. For tighter control over labelling use</span>
<span class="sd">    | xticks, yticks to specify the tick positions and xticklabels,</span>
<span class="sd">    | yticklabels to specify the associated labels.</span>

<span class="sd">    | xstep=xstep - x axis step</span>
<span class="sd">    | ystep=ystep - y axis step</span>
<span class="sd">    | xlabel=xlabel - label for the x-axis</span>
<span class="sd">    | ylabel=ylabel - label for the y-axis</span>
<span class="sd">    | xticks=xticks - values for x ticks</span>
<span class="sd">    | xticklabels=xticklabels - labels for x tick marks</span>
<span class="sd">    | yticks=yticks - values for y ticks</span>
<span class="sd">    | yticklabels=yticklabels - labels for y tick marks</span>
<span class="sd">    | title=None - set title</span>
<span class="sd">    |</span>
<span class="sd">    | Use axes() to reset all the axes plotting attributes to the default.</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span>
        <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">xticks</span><span class="p">,</span>
            <span class="n">yticks</span><span class="p">,</span>
            <span class="n">xticklabels</span><span class="p">,</span>
            <span class="n">yticklabels</span><span class="p">,</span>
            <span class="n">xstep</span><span class="p">,</span>
            <span class="n">ystep</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="p">,</span>
            <span class="n">title</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="p">):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">return</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="o">=</span> <span class="n">xticks</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="o">=</span> <span class="n">yticks</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span> <span class="o">=</span> <span class="n">xstep</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span> <span class="o">=</span> <span class="n">ystep</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span></div>



<div class="viewcode-block" id="axes_plot">
<a class="viewcode-back" href="../axes_plot.html#cfplot.axes_plot">[docs]</a>
<span class="k">def</span> <span class="nf">axes_plot</span><span class="p">(</span>
    <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | A system function to specify axes plotting parameters.</span>
<span class="sd">    | Use xticks, yticks to specify the tick positions and xticklabels,</span>
<span class="sd">    | yticklabels to specify the associated labels.</span>
<span class="sd">    |</span>
<span class="sd">    | xticks=xticks - values for x ticks</span>
<span class="sd">    | xticklabels=xticklabels - labels for x tick marks</span>
<span class="sd">    | yticks=yticks - values for y ticks</span>
<span class="sd">    | yticklabels=yticklabels - labels for y tick marks</span>
<span class="sd">    | xlabel=xlabel - label for the x-axis</span>
<span class="sd">    | ylabel=ylabel - label for the y-axis</span>
<span class="sd">    | title=None - set title</span>
<span class="sd">    |</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
    <span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>
    <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title_fontsize</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="k">if</span> <span class="n">axis_label_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span>
    <span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span>

    <span class="k">if</span> <span class="p">(</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span>
    <span class="p">)</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="n">lon_mid</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>
        <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>
        <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
            <span class="n">xlabel</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
            <span class="n">ylabel</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">xticklen</span> <span class="o">=</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.007</span>
    <span class="n">yticklen</span> <span class="o">=</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.014</span>

    <span class="c1"># set the plot</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="p">(</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;rotated&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;UKCP&quot;</span>
    <span class="p">):</span>
        <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

    <span class="c1"># get the plot bounds</span>
    <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>

    <span class="n">lonrange</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
    <span class="n">lon_mid</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">+</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span>

    <span class="c1"># Set the ticks and tick labels</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># fudge min and max longitude tick positions or the labels wrap</span>
        <span class="n">xticks_new</span> <span class="o">=</span> <span class="n">xticks</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;=</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">xticks_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xticks_new</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.01</span>
            <span class="n">xticks_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xticks_new</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.01</span>

        <span class="n">plot</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks_new</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span>
            <span class="n">xticklabels</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Plot a corresponding tick on the top of the plot - cartopy feature?</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">xval</span> <span class="ow">in</span> <span class="n">xticks_new</span><span class="p">:</span>
                <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span>
                    <span class="n">xval</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">ypt2</span> <span class="o">=</span> <span class="n">ypt</span> <span class="o">+</span> <span class="n">yticklen</span>
                <span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">xpt</span><span class="p">,</span> <span class="n">xpt</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">ypt</span><span class="p">,</span> <span class="n">ypt2</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span> <span class="o">**</span><span class="n">plotargs</span><span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span>
            <span class="n">yticklabels</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Plot a corresponding tick on the right of the plot - cartopy feature?</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">ytick</span> <span class="ow">in</span> <span class="n">yticks</span><span class="p">:</span>
                <span class="n">xpt</span><span class="p">,</span> <span class="n">ypt</span> <span class="o">=</span> <span class="n">proj</span><span class="o">.</span><span class="n">transform_point</span><span class="p">(</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="mf">0.001</span><span class="p">,</span> <span class="n">ytick</span><span class="p">,</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
                <span class="p">)</span>
                <span class="n">xpt2</span> <span class="o">=</span> <span class="n">xpt</span> <span class="o">+</span> <span class="n">xticklen</span>
                <span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">xpt</span><span class="p">,</span> <span class="n">xpt2</span><span class="p">],</span>
                    <span class="p">[</span><span class="n">ypt</span><span class="p">,</span> <span class="n">ypt</span><span class="p">],</span>
                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>

    <span class="c1"># Set font size and weight</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">():</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">axis_label_fontsize</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">axis_label_fontweight</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">plot</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">():</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">axis_label_fontsize</span><span class="p">)</span>
        <span class="n">label</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">axis_label_fontweight</span><span class="p">)</span>

    <span class="c1"># Title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="gset">
<a class="viewcode-back" href="../gset.html#cfplot.gset">[docs]</a>
<span class="k">def</span> <span class="nf">gset</span><span class="p">(</span>
    <span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ylog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">user_gset</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">twinx</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">twiny</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Set plot limits for all non-longitude-latitide plots.</span>
<span class="sd">    | xmin, xmax, ymin, ymax are all needed to set the plot limits.</span>
<span class="sd">    | Set xlog/ylog to True or 1 to get a log axis.</span>
<span class="sd">    |</span>
<span class="sd">    | xmin=None - x minimum</span>
<span class="sd">    | xmax=None - x maximum</span>
<span class="sd">    | ymin=None - y minimum</span>
<span class="sd">    | ymax=None - y maximum</span>
<span class="sd">    | xlog=False - log x</span>
<span class="sd">    | ylog=False - log y</span>
<span class="sd">    | twinx=None - set to True to make a twin y axis plot</span>
<span class="sd">    | twiny=None - set to True to make a twin x axis plot</span>
<span class="sd">    |</span>
<span class="sd">    | Once a user call is made to gset the plot limits are persistent.</span>
<span class="sd">    | i.e. the next plot will use the same set of plot limits.</span>
<span class="sd">    | Use gset() to reset to undefined plot limits i.e. the full range</span>
<span class="sd">    | of the data.</span>
<span class="sd">    |</span>
<span class="sd">    | To set date axes use date strings i.e.</span>
<span class="sd">    | cfp.gset(xmin = &#39;1970-1-1&#39;, xmax = &#39;1999-12-31&#39;, ymin = 285,</span>
<span class="sd">    |          ymax = 295)</span>
<span class="sd">    |</span>
<span class="sd">    | Note the correct date format is &#39;YYYY-MM-DD&#39; or &#39;YYYY-MM-DD HH:MM:SS&#39;</span>
<span class="sd">    | anything else will give unexpected results.</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">=</span> <span class="n">user_gset</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">twinx</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">twiny</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>

    <span class="n">bcount</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">bcount</span> <span class="o">=</span> <span class="n">bcount</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">bcount</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">bcount</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;gset error</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;xmin, xmax, ymin, ymax all need to be passed to gset</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;to set the plot limits</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="n">ymin</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="n">ymax</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span> <span class="o">=</span> <span class="n">xlog</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="o">=</span> <span class="n">ylog</span>

    <span class="c1"># Check if any axes are time strings</span>
    <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="nb">float</span><span class="p">(</span><span class="n">ymin</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Set plot limits</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">twinx</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">twiny</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">time_xstr</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">time_ystr</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span>
                <span class="p">[</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

    <span class="c1"># Set twinx or twiny if requested</span>
    <span class="k">if</span> <span class="n">twinx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">twinx</span> <span class="o">=</span> <span class="n">twinx</span>
    <span class="k">if</span> <span class="n">twiny</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">twiny</span> <span class="o">=</span> <span class="n">twiny</span></div>



<div class="viewcode-block" id="gopen">
<a class="viewcode-back" href="../gopen.html#cfplot.gopen">[docs]</a>
<span class="k">def</span> <span class="nf">gopen</span><span class="p">(</span>
    <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">user_plot</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">file</span><span class="o">=</span><span class="s2">&quot;cfplot.png&quot;</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;landscape&quot;</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mf">11.7</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">],</span>
    <span class="n">left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">wspace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">hspace</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">user_position</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Open a graphic file.</span>
<span class="sd">    |</span>
<span class="sd">    | rows=1 - number of plot rows on the page</span>
<span class="sd">    | columns=1 - number of plot columns on the page</span>
<span class="sd">    | user_plot=1 - internal plot variable - do not use.</span>
<span class="sd">    | file=&#39;cfplot.png&#39; - default file name</span>
<span class="sd">    | orientation=&#39;landscape&#39; - orientation - also takes &#39;portrait&#39;</span>
<span class="sd">    | figsize=[11.7, 8.3]  - figure size in inches</span>
<span class="sd">    | left=None - left margin in normalised coordinates - default=0.12</span>
<span class="sd">    | right=None - right margin in normalised coordinates - default=0.92</span>
<span class="sd">    | top=None - top margin in normalised coordinates - default=0.08</span>
<span class="sd">    | bottom=None - bottom margin in normalised coordinates - default=0.08</span>
<span class="sd">    | wspace=None - width reserved for blank space between</span>
<span class="sd">    |               subplots - default=0.2</span>
<span class="sd">    | hspace=None - height reserved for white space between</span>
<span class="sd">    |               subplots - default=0.2</span>
<span class="sd">    | dpi=None - resolution in dots per inch</span>
<span class="sd">    | user_position=False - set to True to supply plot position via gpos</span>
<span class="sd">    |               xmin, xmax, ymin, ymax values</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Set values in globals</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">=</span> <span class="n">rows</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
    <span class="k">if</span> <span class="n">file</span> <span class="o">!=</span> <span class="s2">&quot;cfplot.png&quot;</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">orientation</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">=</span> <span class="n">user_plot</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Set user defined plot area to None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">left</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">left</span> <span class="o">=</span> <span class="mf">0.12</span>
    <span class="k">if</span> <span class="n">right</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">right</span> <span class="o">=</span> <span class="mf">0.92</span>
    <span class="k">if</span> <span class="n">top</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">top</span> <span class="o">=</span> <span class="mf">0.95</span>
    <span class="k">if</span> <span class="n">bottom</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.08</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">bottom</span> <span class="o">=</span> <span class="mf">0.1</span>
    <span class="k">if</span> <span class="n">wspace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">wspace</span> <span class="o">=</span> <span class="mf">0.2</span>
    <span class="k">if</span> <span class="n">hspace</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.2</span>
        <span class="k">if</span> <span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">hspace</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">if</span> <span class="n">orientation</span> <span class="o">!=</span> <span class="s2">&quot;landscape&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">orientation</span> <span class="o">!=</span> <span class="s2">&quot;portrait&quot;</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;gopen error</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;orientation incorrectly set</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;input value was </span><span class="si">{</span><span class="n">orientation</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Valid options are portrait or landscape</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Set master plot size</span>
    <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;landscape&quot;</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">figsize</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">figsize</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="c1"># Set margins</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
        <span class="n">left</span><span class="o">=</span><span class="n">left</span><span class="p">,</span>
        <span class="n">right</span><span class="o">=</span><span class="n">right</span><span class="p">,</span>
        <span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">,</span>
        <span class="n">bottom</span><span class="o">=</span><span class="n">bottom</span><span class="p">,</span>
        <span class="n">wspace</span><span class="o">=</span><span class="n">wspace</span><span class="p">,</span>
        <span class="n">hspace</span><span class="o">=</span><span class="n">hspace</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Set initial subplot</span>
    <span class="k">if</span> <span class="n">user_position</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">rows</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">columns</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Change tick length for plots &gt; 2x2</span>
    <span class="k">if</span> <span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;xtick.major.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;ytick.major.size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="c1"># Set image resolution</span>
    <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span></div>



<div class="viewcode-block" id="gclose">
<a class="viewcode-back" href="../gclose.html#cfplot.gclose">[docs]</a>
<span class="k">def</span> <span class="nf">gclose</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Saves a graphics file. The default is to view the file as well</span>
<span class="sd">    | but `view=False` can be used to turn this off.</span>

<span class="sd">    | view = True - view graphics file</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Reset the user_plot variable to off</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># Test for python or ipython</span>
    <span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">__IPYTHON__</span>
        <span class="n">interactive</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
        <span class="n">interactive</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">is_interactive</span><span class="p">():</span>
        <span class="n">interactive</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Remove whitespace if requested</span>
    <span class="n">saveargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">tight</span><span class="p">:</span>
        <span class="n">saveargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;bbox_inches&quot;</span><span class="p">:</span> <span class="s2">&quot;tight&quot;</span><span class="p">}</span>

    <span class="n">file</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span>
    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Save a file</span>
        <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;.ps&quot;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;.eps&quot;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;.png&quot;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s2">&quot;.pdf&quot;</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">file</span> <span class="o">=</span> <span class="n">file</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
            <span class="n">file</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span>
            <span class="n">dpi</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span>
            <span class="o">**</span><span class="n">saveargs</span>
        <span class="p">)</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">==</span> <span class="s2">&quot;display&quot;</span> <span class="ow">and</span> <span class="n">interactive</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="c1"># Use Imagemagick display command if this exists</span>
            <span class="n">disp</span> <span class="o">=</span> <span class="n">_which</span><span class="p">(</span><span class="s2">&quot;display&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">disp</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">tfile</span> <span class="o">=</span> <span class="s2">&quot;cfplot.png&quot;</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span>
                    <span class="n">tfile</span><span class="p">,</span>
                    <span class="n">orientation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span>
                    <span class="n">dpi</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">dpi</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">saveargs</span>
                <span class="p">)</span>
                <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="n">disp</span><span class="p">,</span> <span class="n">tfile</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="s2">&quot;matplotlib&quot;</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">==</span> <span class="s2">&quot;matplotlib&quot;</span> <span class="ow">or</span> <span class="n">interactive</span><span class="p">:</span>
            <span class="c1"># Use Matplotlib viewer</span>
            <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="c1"># Reset plotting</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">twinx</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">twiny</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">titles_con_called</span> <span class="o">=</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="gpos">
<a class="viewcode-back" href="../gpos.html#cfplot.gpos">[docs]</a>
<span class="k">def</span> <span class="nf">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Set plot position. Plots start at top left and increase by one each plot</span>
<span class="sd">    | to the right. When the end of the row has been reached then the next</span>
<span class="sd">    | plot will be the leftmost plot on the next row down.</span>

<span class="sd">    | pos=pos - plot position</span>
<span class="sd">    |</span>
<span class="sd">    | The following four parameters are used to get full user control</span>
<span class="sd">    | over the plot position.  In addition to these cfp.gopen</span>
<span class="sd">    | must have the user_position=True parameter set.</span>
<span class="sd">    | xmin=None xmin in normalised coordinates</span>
<span class="sd">    | xmax=None xmax in normalised coordinates</span>
<span class="sd">    | ymin=None ymin in normalised coordinates</span>
<span class="sd">    | ymax=None ymax in normalised coordinates</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Reset mymap</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Check inputs are okay</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;pos error - pos out of range:</span><span class="se">\n</span><span class="s2"> range = 1 - &quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> input pos was </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">user_pos</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]):</span>
        <span class="n">user_pos</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span> <span class="o">=</span> <span class="n">xmin</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">=</span> <span class="n">xmax</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span> <span class="o">=</span> <span class="n">ymin</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">=</span> <span class="n">ymax</span>

    <span class="c1"># Reset any accumulated muliple graph limits</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Set gpos_called</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Reset titles_con_called</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">titles_con_called</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">if</span> <span class="n">user_pos</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">pos</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">delta_x</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span>
        <span class="n">delta_y</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span>

        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span>
            <span class="p">[</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot_xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_ymin</span><span class="p">,</span> <span class="n">delta_x</span><span class="p">,</span> <span class="n">delta_y</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span>
        <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

    <span class="c1"># Set position in global variables</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span>

    <span class="c1"># Reset contour levels if they are not defined by the user</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">levs</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">levs</span><span class="p">(</span><span class="n">step</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span><span class="p">)</span></div>



<div class="viewcode-block" id="pcon">
<a class="viewcode-back" href="../pcon.html#cfplot.pcon">[docs]</a>
<span class="k">def</span> <span class="nf">pcon</span><span class="p">(</span><span class="n">mb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">km</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Convert pressure to height in kilometers and vice-versa.</span>
<span class="sd">    | This function uses the equation P=P0exp(-z/H) to translate</span>
<span class="sd">    | between pressure and height. In pcon the surface pressure P0 is set to</span>
<span class="sd">    | 1000.0mb and the scale height H is set to 7.0. The value of H can vary</span>
<span class="sd">    | from 6.0 in the polar regions to 8.5 in the tropics as well as</span>
<span class="sd">    | seasonally. The value of P0 could also be said to be 1013.25mb rather</span>
<span class="sd">    | than 1000.0mb.</span>

<span class="sd">    | As this relationship is approximate:</span>
<span class="sd">    | (i) Only use this for making the axis labels on y axis pressure plots</span>
<span class="sd">    | (ii) Put the converted axis on the right hand side to indicate that</span>
<span class="sd">    |      this isn&#39;t the primary unit of measure</span>

<span class="sd">    | print cfp.pcon(mb=[1000, 300, 100, 30, 10, 3, 1, 0.3])</span>
<span class="sd">    | [0. 8.42780963 16.11809565 24.54590528 32.2361913</span>
<span class="sd">    |  40.66400093 48.35428695, 56.78209658]</span>

<span class="sd">    | mb=None - input pressure</span>
<span class="sd">    | km=None - input height</span>
<span class="sd">    | h=7.0 - default value for h</span>
<span class="sd">    | p0=1000 - default value for p0</span>

<span class="sd">    :Returns:</span>
<span class="sd">     | pressure(mb) if height(km) input,</span>
<span class="sd">     | height(km) if pressure(mb) input</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mb</span><span class="p">,</span> <span class="n">km</span><span class="p">])</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;pcon error - pcon must have mb or km input</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">mb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mb</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">km</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">km</span><span class="p">)</span> <span class="o">/</span> <span class="n">h</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p0</span><span class="p">)))</span></div>



<div class="viewcode-block" id="cscale">
<a class="viewcode-back" href="../cscale.html#cfplot.cscale">[docs]</a>
<span class="k">def</span> <span class="nf">cscale</span><span class="p">(</span>
    <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ncols</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">white</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">below</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">above</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">uniform</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Choose and manipulate colour maps. Around 200 colour scales are</span>
<span class="sd">    | available (see the gallery section for more details).</span>
<span class="sd">    |</span>
<span class="sd">    | scale=None - name of colour map</span>
<span class="sd">    | ncols=None - number of colours for colour map</span>
<span class="sd">    | white=None - change these colours to be white</span>
<span class="sd">    | below=None - change the number of colours below the mid point of</span>
<span class="sd">    |               the colour scale to be this</span>
<span class="sd">    | above=None - change the number of colours above the mid point of</span>
<span class="sd">    |               the colour scale to be this</span>
<span class="sd">    | reverse=False - reverse the colour scale</span>
<span class="sd">    | uniform=False - produce a uniform colour scale.</span>
<span class="sd">    |                 For example: if below=3 and above=10 are specified</span>
<span class="sd">    |                 then initially below=10 and above=10 are used.  The</span>
<span class="sd">    |                 colour scale is then cropped to use scale colours</span>
<span class="sd">    |                 6 to 19.  This produces a more uniform intensity colour</span>
<span class="sd">    |                 scale than one where all the blues are compressed into</span>
<span class="sd">    |                 3 colours.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    | Personal colour maps are available by saving the map as red green blue</span>
<span class="sd">    | to a file with a set of values on each line.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    | Use cscale() To reset to the default settings.</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If no map requested reset to default</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="s2">&quot;scale1&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_user</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span><span class="n">ncols</span><span class="p">,</span> <span class="n">white</span><span class="p">,</span> <span class="n">below</span><span class="p">,</span> <span class="n">above</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">):</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">reverse</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span> <span class="ow">or</span> <span class="n">uniform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;scale1&quot;</span> <span class="ow">or</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;scale1&quot;</span><span class="p">:</span>
            <span class="n">myscale</span> <span class="o">=</span> <span class="n">cscale1</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">==</span> <span class="s2">&quot;viridis&quot;</span><span class="p">:</span>
            <span class="n">myscale</span> <span class="o">=</span> <span class="n">viridis</span>
        <span class="c1"># convert cscale1 or viridis from hex to rgb</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">myhex</span> <span class="ow">in</span> <span class="n">myscale</span><span class="p">:</span>
            <span class="n">myhex</span> <span class="o">=</span> <span class="n">myhex</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">)</span>
            <span class="n">mylen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">myhex</span><span class="p">)</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="nb">int</span><span class="p">(</span><span class="n">myhex</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="n">mylen</span> <span class="o">//</span> <span class="mi">3</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mylen</span><span class="p">,</span> <span class="n">mylen</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">package_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="n">file</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">package_path</span><span class="p">,</span> <span class="s2">&quot;colourmaps/&quot;</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">+</span> <span class="s2">&quot;.rgb&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">cscale error - colour scale not found:</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> not found</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;Scale </span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2"> not found</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">scale</span>

        <span class="c1"># Read in rgb values and convert to hex</span>
        <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
            <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>

    <span class="c1"># Reverse the colour scale if requested</span>
    <span class="k">if</span> <span class="n">reverse</span><span class="p">:</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Interpolate to a new number of colours if requested</span>
    <span class="k">if</span> <span class="n">ncols</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num</span><span class="o">=</span><span class="n">ncols</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">f_red</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">f_green</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">f_blue</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">f_red</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">f_green</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">f_blue</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>

    <span class="c1"># Change the number of colours below and above the mid-point if requested</span>
    <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">above</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="c1"># Mid-point of colour scale</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="c1"># Below mid point x locations</span>
        <span class="n">x_below</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">below</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x_below</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">below</span>
        <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="n">npoints</span>
        <span class="k">if</span> <span class="n">below</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uniform</span><span class="p">:</span>
            <span class="n">lower</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">above</span><span class="p">,</span> <span class="n">below</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lower</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x_below</span> <span class="o">=</span> <span class="p">((</span><span class="n">npoints</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">lower</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>

        <span class="c1"># Above mid point x locations</span>
        <span class="n">x_above</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">above</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x_above</span> <span class="o">=</span> <span class="n">npoints</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">above</span>
        <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="n">npoints</span>
        <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">uniform</span><span class="p">:</span>
            <span class="n">upper</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">above</span><span class="p">,</span> <span class="n">below</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">upper</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">x_above</span> <span class="o">=</span> <span class="p">((</span><span class="n">npoints</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">upper</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span>
                <span class="n">upper</span>
            <span class="p">)</span> <span class="o">+</span> <span class="n">npoints</span>

        <span class="c1"># Append new colour positions</span>
        <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_below</span><span class="p">,</span> <span class="n">x_above</span><span class="p">)</span>

        <span class="c1"># Interpolate to new colour scale</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
        <span class="n">f_red</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">f_green</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">f_blue</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">f_red</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">f_green</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
        <span class="n">b</span> <span class="o">=</span> <span class="n">f_blue</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>

        <span class="c1"># Reset colours if uniform is set</span>
        <span class="k">if</span> <span class="n">uniform</span><span class="p">:</span>
            <span class="n">mid_pt</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">below</span><span class="p">,</span> <span class="n">above</span><span class="p">)</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">mid_pt</span> <span class="o">-</span> <span class="n">below</span><span class="p">:</span> <span class="n">mid_pt</span> <span class="o">+</span> <span class="n">above</span><span class="p">]</span>
            <span class="n">g</span> <span class="o">=</span> <span class="n">g</span><span class="p">[</span><span class="n">mid_pt</span> <span class="o">-</span> <span class="n">below</span><span class="p">:</span> <span class="n">mid_pt</span> <span class="o">+</span> <span class="n">above</span><span class="p">]</span>
            <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="n">mid_pt</span> <span class="o">-</span> <span class="n">below</span><span class="p">:</span> <span class="n">mid_pt</span> <span class="o">+</span> <span class="n">above</span><span class="p">]</span>

    <span class="c1"># Convert to hex</span>
    <span class="n">hexarr</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
        <span class="n">hexarr</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">col</span><span class="p">])</span><span class="si">:</span><span class="s2">02x</span><span class="si">}{</span><span class="nb">int</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="n">col</span><span class="p">])</span><span class="si">:</span><span class="s2">02x</span><span class="si">}{</span><span class="nb">int</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="n">col</span><span class="p">])</span><span class="si">:</span><span class="s2">02x</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># White requested colour positions</span>
    <span class="k">if</span> <span class="n">white</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">white</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">hexarr</span><span class="p">[</span><span class="n">white</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#ffffff&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">white</span><span class="p">:</span>
                <span class="n">hexarr</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#ffffff&quot;</span>

    <span class="c1"># Set colour scale</span>
    <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span> <span class="o">=</span> <span class="n">hexarr</span></div>



<div class="viewcode-block" id="regrid">
<a class="viewcode-back" href="../regrid.html#cfplot.regrid">[docs]</a>
<span class="k">def</span> <span class="nf">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Bilinear interpolation of a grid to new grid locations.</span>
<span class="sd">    |</span>
<span class="sd">    |     f=None - original field</span>
<span class="sd">    |     x=None - original field x values</span>
<span class="sd">    |     y=None - original field y values</span>
<span class="sd">    |     xnew=None - new x points</span>
<span class="sd">    |     ynew=None - new y points</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">       field values at requested locations</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO SLB: what is this method for and why named/described as such???</span>

    <span class="c1"># Copy input arrays</span>
    <span class="n">regrid_f</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">regrid_x</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">regrid_y</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">fieldout</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Reverse xpts and field if necessary</span>
    <span class="k">if</span> <span class="n">regrid_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">regrid_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">regrid_x</span> <span class="o">=</span> <span class="n">regrid_x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">regrid_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">regrid_f</span><span class="p">)</span>

    <span class="c1"># Reverse ypts and field if necessary</span>
    <span class="k">if</span> <span class="n">regrid_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">regrid_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
        <span class="n">regrid_y</span> <span class="o">=</span> <span class="n">regrid_y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">regrid_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">regrid_f</span><span class="p">)</span>

    <span class="c1"># Iterate over the new grid to get the new grid values.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xnew</span><span class="p">)):</span>

        <span class="n">xval</span> <span class="o">=</span> <span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">yval</span> <span class="o">=</span> <span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

        <span class="c1"># Find position of new grid point in the x and y arrays</span>
        <span class="n">myxpos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">regrid_x</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">xval</span><span class="p">)</span>
        <span class="n">myypos</span> <span class="o">=</span> <span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">regrid_y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">yval</span><span class="p">)</span>

        <span class="n">myxpos2</span> <span class="o">=</span> <span class="n">myxpos</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">myypos2</span> <span class="o">=</span> <span class="n">myypos</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">myxpos2</span> <span class="o">!=</span> <span class="n">myxpos</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos2</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e-30</span>

        <span class="n">newval1</span> <span class="o">=</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span> <span class="n">myxpos2</span><span class="p">]</span>
        <span class="n">newval1</span> <span class="o">=</span> <span class="n">newval1</span> <span class="o">*</span> <span class="n">alpha</span>
        <span class="n">newval1</span> <span class="o">=</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">newval1</span>

        <span class="n">newval2</span> <span class="o">=</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span> <span class="n">myxpos2</span><span class="p">]</span>
        <span class="n">newval2</span> <span class="o">=</span> <span class="n">newval2</span> <span class="o">*</span> <span class="n">alpha</span>
        <span class="n">newval2</span> <span class="o">=</span> <span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span> <span class="n">myxpos</span><span class="p">]</span> <span class="o">-</span> <span class="n">newval2</span>

        <span class="k">if</span> <span class="n">myypos2</span> <span class="o">!=</span> <span class="n">myypos</span><span class="p">:</span>
            <span class="n">alpha2</span> <span class="o">=</span> <span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">]</span>
            <span class="n">alpha2</span> <span class="o">=</span> <span class="n">alpha2</span> <span class="o">/</span> <span class="p">(</span><span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos2</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha2</span> <span class="o">=</span> <span class="p">(</span><span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">])</span> <span class="o">/</span> <span class="mf">1e-30</span>

        <span class="n">newval3</span> <span class="o">=</span> <span class="n">newval1</span> <span class="o">-</span> <span class="p">(</span><span class="n">newval1</span> <span class="o">-</span> <span class="n">newval2</span><span class="p">)</span> <span class="o">*</span> <span class="n">alpha2</span>

        <span class="n">fieldout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fieldout</span><span class="p">,</span> <span class="n">newval3</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fieldout</span></div>



<div class="viewcode-block" id="stipple">
<a class="viewcode-back" href="../stipple.html#cfplot.stipple">[docs]</a>
<span class="k">def</span> <span class="nf">stipple</span><span class="p">(</span>
    <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="nb">min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="nb">max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">pts</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;.&quot;</span><span class="p">,</span>
    <span class="n">edgecolors</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">ylog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Put markers on a plot to indicate value of interest.</span>
<span class="sd">    |</span>
<span class="sd">    | f=None - cf field or field</span>
<span class="sd">    | x=None - x points for field</span>
<span class="sd">    | y=None - y points for field</span>
<span class="sd">    | min=None - minimum threshold for stipple</span>
<span class="sd">    | max=None - maximum threshold for stipple</span>
<span class="sd">    | size=80 - default size for stipples</span>
<span class="sd">    | color=&#39;k&#39; - default colour for stipples</span>
<span class="sd">    | pts=50 - number of points in the x direction</span>
<span class="sd">    | marker=&#39;.&#39; - default marker for stipples</span>
<span class="sd">    | edegecolors=&#39;k&#39; - outline colour</span>
<span class="sd">    | alpha=1.0 - transparency setting - default is off</span>
<span class="sd">    | ylog=False - set to True if a log pressure stipple plot</span>
<span class="sd">    |              is required</span>
<span class="sd">    | zorder=2 - plotting order</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">       None</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> stipple error - only X-Y, X-Z and Y-Z </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;stipple supported at the present time</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Please raise a feature request if you see this error.</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Extract required data for contouring</span>
    <span class="c1"># If a cf-python field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="p">(</span>
            <span class="n">field</span><span class="p">,</span>
            <span class="n">xpts</span><span class="p">,</span>
            <span class="n">ypts</span><span class="p">,</span>
            <span class="n">ptype</span><span class="p">,</span>
            <span class="n">colorbar_title</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="p">,</span>
            <span class="n">xpole</span><span class="p">,</span>
            <span class="n">ypole</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">_cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t plot a field list&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">field</span> <span class="o">=</span> <span class="n">f</span>  <span class="c1"># field data passed in as f</span>
        <span class="n">_check_data</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">y</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Cylindrical projection</span>
        <span class="c1"># Add cyclic information if missing.</span>
        <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
            <span class="c1"># field, xpts = cartopy_util.add_cyclic_point(field, xpts)</span>
            <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

        <span class="c1"># if plotvars.proj == &#39;cyl&#39;:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cyl&quot;</span><span class="p">,</span> <span class="s2">&quot;robin&quot;</span><span class="p">,</span> <span class="s2">&quot;merc&quot;</span><span class="p">,</span> <span class="s2">&quot;ortho&quot;</span><span class="p">,</span> <span class="s2">&quot;moll&quot;</span><span class="p">]:</span>
            <span class="c1"># Calculate interpolation points</span>
            <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
                <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
                <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span>
                <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span>
                <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span>
                <span class="n">stype</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Calculate points in map space</span>
            <span class="n">xnew_map</span> <span class="o">=</span> <span class="n">xnew</span>
            <span class="n">ynew_map</span> <span class="o">=</span> <span class="n">ynew</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;spstere&quot;</span><span class="p">:</span>
            <span class="c1"># Calculate interpolation points</span>
            <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">xnew_map</span><span class="p">,</span> <span class="n">ynew_map</span> <span class="o">=</span> <span class="n">polar_regular_grid</span><span class="p">()</span>
            <span class="c1"># Convert longitudes to be 0 to 360</span>
            <span class="c1"># negative longitudes are incorrectly regridded in polar</span>
            <span class="c1"># stereographic projection</span>
            <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xnew</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">,</span> <span class="mf">360.0</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>

        <span class="c1"># Flip data if a lat-height plot and lats start at the north pole</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">xpts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

        <span class="c1"># Calculate interpolation points</span>
        <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>
        <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylog</span><span class="p">:</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ymin</span><span class="p">)</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ymax</span><span class="p">)</span>

        <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span>
            <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
            <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>
            <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
            <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span>
            <span class="n">stype</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">ylog</span><span class="p">:</span>
            <span class="n">ynew</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">ynew</span>

    <span class="c1"># Get values at the new points</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>

    <span class="c1"># Work out which of the points are valid</span>
    <span class="n">valid_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">&quot;int64&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nb">min</span> <span class="ow">and</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">:</span>
            <span class="n">valid_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_points</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">valid_points</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">xnew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span>
                <span class="n">ynew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span>
                <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
                <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&lt;=</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">xnew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span>
            <span class="n">ynew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span>
            <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span>
            <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
            <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
        <span class="p">)</span></div>



<div class="viewcode-block" id="stipple_points">
<a class="viewcode-back" href="../stipple_points.html#cfplot.stipple_points">[docs]</a>
<span class="k">def</span> <span class="nf">stipple_points</span><span class="p">(</span>
    <span class="n">xmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Calculate interpolation points.</span>
<span class="sd">    |</span>
<span class="sd">    | xmin=None - plot x minimum</span>
<span class="sd">    | ymax=None - plot x maximum</span>
<span class="sd">    | ymin=None - plot y minimum</span>
<span class="sd">    | ymax=None - plot x maximum</span>
<span class="sd">    | pts=None -  number of points in the x and y directions</span>
<span class="sd">    |             one number gives the same in both directions</span>
<span class="sd">    |</span>
<span class="sd">    | stype=None - type of grid.  1=regular, 2=offset</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">       stipple locations in x and y</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Work out number of points in x and y directions</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">pts_x</span> <span class="o">=</span> <span class="n">pts</span>
        <span class="n">pts_y</span> <span class="o">=</span> <span class="n">pts</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">pts_x</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">pts_y</span> <span class="o">=</span> <span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Create regularly spaced points</span>
    <span class="n">xstep</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">pts_x</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span> <span class="o">+</span> <span class="n">xstep</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xstep</span> <span class="o">/</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span>

    <span class="n">x2</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span> <span class="o">+</span> <span class="n">xstep</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span><span class="p">]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">xmax</span> <span class="o">-</span> <span class="n">xstep</span> <span class="o">/</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span> <span class="o">+</span> <span class="n">xstep</span><span class="p">)</span>

    <span class="n">ystep</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">pts_y</span><span class="p">)</span>
    <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">ymin</span> <span class="o">+</span> <span class="n">ystep</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ystep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ymax</span> <span class="o">-</span> <span class="n">ystep</span> <span class="o">/</span> <span class="mi">10</span><span class="p">:</span>
        <span class="n">y1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span> <span class="o">+</span> <span class="n">ystep</span><span class="p">)</span>

    <span class="c1"># Create interpolation points</span>
    <span class="n">xnew</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">ynew</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">iy</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">y1</span><span class="p">:</span>
        <span class="n">iy</span> <span class="o">=</span> <span class="n">iy</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>
            <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ynew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">iy</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>
                <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ynew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">iy</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
                <span class="n">y2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x2</span><span class="p">))</span>
                <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">ynew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span></div>



<div class="viewcode-block" id="find_pos_in_array">
<a class="viewcode-back" href="../find_pos_in_array.html#cfplot.find_pos_in_array">[docs]</a>
<span class="k">def</span> <span class="nf">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Find the position of a point in an array.</span>
<span class="sd">    |</span>
<span class="sd">    | vals - array values</span>
<span class="sd">    | val - value to find position of</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">      position in array</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">pos</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">myval</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">myval</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">above</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">myval</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">myval</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">&gt;</span> <span class="n">pos</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">pos</span></div>



<div class="viewcode-block" id="vect">
<a class="viewcode-back" href="../vect.html#cfplot.vect">[docs]</a>
<span class="k">def</span> <span class="nf">vect</span><span class="p">(</span>
    <span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">v</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">scale</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">stride</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">pts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">key_length</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">key_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ptype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">magmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
    <span class="n">headwidth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">headlength</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">headaxislength</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span>
    <span class="n">pivot</span><span class="o">=</span><span class="s2">&quot;middle&quot;</span><span class="p">,</span>
    <span class="n">key_location</span><span class="o">=</span><span class="p">[</span><span class="mf">0.95</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06</span><span class="p">],</span>
    <span class="n">key_show</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">titles</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Plot vectors.</span>
<span class="sd">    |</span>
<span class="sd">    | u=None - u wind</span>
<span class="sd">    | v=None - v wind</span>
<span class="sd">    | x=None - x locations of u and v</span>
<span class="sd">    | y=None - y locations of u and v</span>
<span class="sd">    | scale=None - data units per arrow length unit.  A smaller values gives</span>
<span class="sd">    |              a larger vector. Generally takes one value but in the case</span>
<span class="sd">    |              of two supplied values the second vector scaling applies to</span>
<span class="sd">    |              the v field.</span>
<span class="sd">    | stride=None - plot vector every stride points. Can take two values one</span>
<span class="sd">    |               for x and one for y.</span>
<span class="sd">    | pts=None - use bilinear interpolation to interpolate vectors onto a new</span>
<span class="sd">    |            grid - takes one or two values.</span>
<span class="sd">    |            If one value is passed then this is used for both the x and</span>
<span class="sd">    |            y axes.</span>
<span class="sd">    | magmin=None - don&#39;t plot any vects with less than this magnitude.</span>
<span class="sd">    | key_length=None - length of the key.  Generally takes one value but in</span>
<span class="sd">    |                   the case of two supplied values the second vector</span>
<span class="sd">    |                   scaling applies to the v field.</span>
<span class="sd">    | key_label=None - label for the key. Generally takes one value but in the</span>
<span class="sd">    |                  case of two supplied values the second vector scaling</span>
<span class="sd">    |                  applies to the v field.</span>
<span class="sd">    | key_location=[0.9, -0.06] - location of the vector key relative to the</span>
<span class="sd">    |                             plot in normalised coordinates.</span>
<span class="sd">    | key_show=True - draw the key.  Set to False if not required.</span>
<span class="sd">    | ptype=0 - plot type - not needed for cf fields.</span>
<span class="sd">    |                       0 = no specific plot type,</span>
<span class="sd">    |                       1 = longitude-latitude,</span>
<span class="sd">    |                       2 = latitude - height,</span>
<span class="sd">    |                       3 = longitude - height,</span>
<span class="sd">    |                       4 = latitude - time,</span>
<span class="sd">    |                       5 = longitude - time</span>
<span class="sd">    |                       6 = rotated pole</span>
<span class="sd">    |</span>
<span class="sd">    | title=None - plot title</span>
<span class="sd">    | width=0.005 - shaft width in arrow units; default is 0.005 times the</span>
<span class="sd">    |               width of the plot</span>
<span class="sd">    | headwidth=3 - head width as multiple of shaft width, default is 3</span>
<span class="sd">    | headlength=5 - head length as multiple of shaft width, default is 5</span>
<span class="sd">    | headaxislength=4.5 - head length at shaft intersection, default is 4.5</span>
<span class="sd">    | pivot=&#39;middle&#39; - the part of the arrow that is at the grid point; the</span>
<span class="sd">    |                  arrow rotates about this point</span>
<span class="sd">                       takes &#39;tail&#39;, &#39;middle&#39;, &#39;tip&#39;</span>
<span class="sd">    | axes=True - plot x and y axes</span>
<span class="sd">    | xaxis=True - plot xaxis</span>
<span class="sd">    | yaxis=True - plot y axis</span>
<span class="sd">    | xticks=None - xtick positions</span>
<span class="sd">    | xticklabels=None - xtick labels</span>
<span class="sd">    | yticks=None - y tick positions</span>
<span class="sd">    | yticklabels=None - ytick labels</span>
<span class="sd">    | xlabel=None - label for x axis</span>
<span class="sd">    | ylabel=None - label for y axis</span>
<span class="sd">    | ylog=False - log y axis</span>
<span class="sd">    | color=&#39;k&#39; - colour for the vectors - default is black.</span>
<span class="sd">    | zorder=3 - plotting order</span>
<span class="sd">    | titles=None - generate dimension and cell_methods titles for plot</span>
<span class="sd">    | alpha=1.0 - transparency setting.  The default is no transparency.</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># If the vector color is white set the quicker key colour to black</span>
    <span class="c1"># so that it can be seen</span>
    <span class="n">qkey_color</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">if</span> <span class="n">qkey_color</span> <span class="o">==</span> <span class="s2">&quot;w&quot;</span> <span class="ow">or</span> <span class="n">qkey_color</span> <span class="o">==</span> <span class="s2">&quot;white&quot;</span><span class="p">:</span>
        <span class="n">qkey_color</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>

    <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
    <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
    <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
    <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
    <span class="c1"># ylog=plotvars.ylog</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
    <span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span>
    <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title_fontsize</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">resolution_orig</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span>

    <span class="c1"># Set potential user axis labels</span>
    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>

    <span class="n">rotated_vect</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span>
            <span class="s2">&quot;grid_mapping_name:rotated_latitude_longitude&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">):</span>
            <span class="n">rotated_vect</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Extract required data</span>
    <span class="c1"># If a cf-python field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

        <span class="c1"># Check data is 2D</span>
        <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndims</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.vect error need a 2 dimensonal u field to make &quot;</span>
                <span class="s2">&quot;vectors</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;received </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ndims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimension</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="p">(</span>
            <span class="n">u_data</span><span class="p">,</span>
            <span class="n">u_x</span><span class="p">,</span>
            <span class="n">u_y</span><span class="p">,</span>
            <span class="n">ptype</span><span class="p">,</span>
            <span class="n">colorbar_title</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="p">,</span>
            <span class="n">xpole</span><span class="p">,</span>
            <span class="n">ypole</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">_cf_data_assign</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">rotated_vect</span><span class="o">=</span><span class="n">rotated_vect</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t plot a field list&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># field=f #field data passed in as f</span>
        <span class="n">_check_data</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">u_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">u_x</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">u_y</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

        <span class="c1"># Check data is 2D</span>
        <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndims</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.vect error need a 2 dimensonal v field to make &quot;</span>
                <span class="s2">&quot;vectors</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;received {np.squeeze(v.data).ndim}&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ndims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimension</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="p">(</span>
            <span class="n">v_data</span><span class="p">,</span>
            <span class="n">v_x</span><span class="p">,</span>
            <span class="n">v_y</span><span class="p">,</span>
            <span class="n">ptype</span><span class="p">,</span>
            <span class="n">colorbar_title</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="p">,</span>
            <span class="n">xpole</span><span class="p">,</span>
            <span class="n">ypole</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">_cf_data_assign</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">rotated_vect</span><span class="o">=</span><span class="n">rotated_vect</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t plot a field list&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># field=f #field data passed in as f</span>
        <span class="n">_check_data</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">v_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">v_x</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># If a minimum magnitude is specified mask these data points</span>
    <span class="k">if</span> <span class="n">magmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mag</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_data</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v_data</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">invalid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mag</span> <span class="o">&lt;=</span> <span class="n">magmin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">invalid</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">u_data</span><span class="p">[</span><span class="n">invalid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">v_data</span><span class="p">[</span><span class="n">invalid</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Reset xlabel and ylabel values with user defined labels in specified</span>
    <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
    <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>

    <span class="c1"># Retrieve any user defined axis labels</span>
    <span class="k">if</span> <span class="n">xlabel</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">xticks</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">yticks</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_data</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span>

    <span class="k">if</span> <span class="n">key_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">key_length</span> <span class="o">=</span> <span class="n">scale</span>

    <span class="c1"># Calculate a set of dimension titles if requested</span>
    <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
        <span class="n">title_dims</span> <span class="o">=</span> <span class="n">generate_titles</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">title_dims</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;u</span><span class="se">\n</span><span class="si">{</span><span class="n">title_dims</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">title_dims2</span> <span class="o">=</span> <span class="n">generate_titles</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">title_dims2</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;v</span><span class="se">\n</span><span class="si">{</span><span class="n">title_dims2</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Open a new plot if necessary</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Call gpos(1) if not already called</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Set plot type if user specified</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">ptype</span>

    <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
    <span class="n">latrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Set up mapping</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">and</span> <span class="n">latrange</span> <span class="o">&gt;</span> <span class="mi">170</span><span class="p">)</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">_set_map</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapset</span><span class="p">(</span>
                <span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">_set_map</span><span class="p">()</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>

        <span class="c1"># u_data, u_x = cartopy_util.add_cyclic_point(u_data, u_x)</span>
        <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span><span class="p">)</span>
        <span class="c1"># v_data, v_x = cartopy_util.add_cyclic_point(v_data, v_x)</span>
        <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span> <span class="o">=</span> <span class="n">add_cyclic</span><span class="p">(</span><span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span><span class="p">)</span>

    <span class="c1"># stride data points to reduce vector density</span>
    <span class="k">if</span> <span class="n">stride</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">xstride</span> <span class="o">=</span> <span class="n">stride</span>
            <span class="n">ystride</span> <span class="o">=</span> <span class="n">stride</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">xstride</span> <span class="o">=</span> <span class="n">stride</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">ystride</span> <span class="o">=</span> <span class="n">stride</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">u_x</span> <span class="o">=</span> <span class="n">u_x</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">xstride</span><span class="p">]</span>
        <span class="n">u_y</span> <span class="o">=</span> <span class="n">u_y</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">ystride</span><span class="p">]</span>
        <span class="n">u_data</span> <span class="o">=</span> <span class="n">u_data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">ystride</span><span class="p">,</span> <span class="mi">0</span><span class="p">::</span><span class="n">xstride</span><span class="p">]</span>
        <span class="n">v_data</span> <span class="o">=</span> <span class="n">v_data</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="n">ystride</span><span class="p">,</span> <span class="mi">0</span><span class="p">::</span><span class="n">xstride</span><span class="p">]</span>

    <span class="c1"># Map vectors</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lonmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

        <span class="c1"># Fix for high latitude vectors as described at</span>
        <span class="c1"># https://github.com/SciTools/cartopy/issues/1179</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
            <span class="n">u_src_crs</span> <span class="o">=</span> <span class="n">u_data</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">u_y</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span> <span class="o">/</span> <span class="mi">180</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
            <span class="n">v_src_crs</span> <span class="o">=</span> <span class="n">v_data</span>
            <span class="n">magnitude</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_data</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v_data</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">magn_src_crs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">u_src_crs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v_src_crs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">u_data</span> <span class="o">=</span> <span class="n">u_src_crs</span> <span class="o">*</span> <span class="n">magnitude</span> <span class="o">/</span> <span class="n">magn_src_crs</span>
            <span class="n">v_data</span> <span class="o">=</span> <span class="n">v_src_crs</span> <span class="o">*</span> <span class="n">magnitude</span> <span class="o">/</span> <span class="n">magn_src_crs</span>

        <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span>
                <span class="n">u_x</span><span class="p">,</span>
                <span class="n">u_y</span><span class="p">,</span>
                <span class="n">u_data</span><span class="p">,</span>
                <span class="n">v_data</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;inches&quot;</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
                <span class="c1"># **cartopy 0.16 fix for longitide points in cylindrical</span>
                <span class="c1"># projection when regridding to a number of points</span>
                <span class="c1"># Make points within the plotting region</span>
                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u_x</span><span class="p">)):</span>
                    <span class="k">if</span> <span class="n">u_x</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">lonmax</span><span class="p">:</span>
                        <span class="n">u_x</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_x</span><span class="p">[</span><span class="n">pt</span><span class="p">]</span> <span class="o">-</span> <span class="mi">360</span>

            <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span>
                <span class="n">u_x</span><span class="p">,</span>
                <span class="n">u_y</span><span class="p">,</span>
                <span class="n">u_data</span><span class="p">,</span>
                <span class="n">v_data</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">,</span>
                <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;inches&quot;</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">regrid_shape</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Make key_label if none exists</span>
        <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">key_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
            <span class="n">key_label</span> <span class="o">=</span> <span class="n">_supscr</span><span class="p">(</span><span class="n">key_label</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span>
                <span class="n">quiv</span><span class="p">,</span>
                <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                <span class="n">key_length</span><span class="p">,</span>
                <span class="n">key_label</span><span class="p">,</span>
                <span class="n">labelpos</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">qkey_color</span><span class="p">,</span>
                <span class="n">fontproperties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">)},</span>
                <span class="n">coordinates</span><span class="o">=</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># axes</span>
        <span class="n">_plot_map_axes</span><span class="p">(</span>
            <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
            <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span>
            <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
            <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span>
            <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
            <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span>
            <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Coastlines</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
        <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span>
        <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_color</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
        <span class="k">if</span> <span class="n">continent_linestyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="s2">&quot;solid&quot;</span>

        <span class="n">feature</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;land&quot;</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="s2">&quot;physical&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span>
            <span class="n">feature</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">continent_color</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">continent_linestyle</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

        <span class="c1"># Titles for dimensions</span>
        <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">titles_con_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">_dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">,</span> <span class="n">title2</span><span class="o">=</span><span class="n">title_dims2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">_dim_titles</span><span class="p">(</span><span class="n">title2</span><span class="o">=</span><span class="n">title_dims</span><span class="p">,</span> <span class="n">title3</span><span class="o">=</span><span class="n">title_dims2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">u</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s2">&quot;grid_mapping_name:rotated_latitude_longitude&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">proj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>

            <span class="c1"># Set up mapping</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">and</span> <span class="n">latrange</span> <span class="o">&gt;</span> <span class="mi">170</span>
            <span class="p">)</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">_set_map</span><span class="p">()</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">mapset</span><span class="p">(</span>
                    <span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                    <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                    <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                    <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                    <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">_set_map</span><span class="p">()</span>

            <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span>
                <span class="n">u_x</span><span class="p">,</span>
                <span class="n">u_y</span><span class="p">,</span>
                <span class="n">u_data</span><span class="p">,</span>
                <span class="n">v_data</span><span class="p">,</span>
                <span class="n">scale</span><span class="o">=</span><span class="n">scale</span> <span class="o">*</span> <span class="mi">10</span><span class="p">,</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">proj</span><span class="p">,</span>
                <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span>
                <span class="n">units</span><span class="o">=</span><span class="s2">&quot;inches&quot;</span><span class="p">,</span>
                <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Make key_label if none exists</span>
            <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">key_label</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                <span class="n">key_label</span> <span class="o">=</span> <span class="n">_supscr</span><span class="p">(</span><span class="n">key_label</span> <span class="o">+</span> <span class="n">u</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span>
                    <span class="n">quiv</span><span class="p">,</span>
                    <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">key_length</span><span class="p">,</span>
                    <span class="n">key_label</span><span class="p">,</span>
                    <span class="n">labelpos</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">qkey_color</span><span class="p">,</span>
                    <span class="n">fontproperties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">)},</span>
                    <span class="n">coordinates</span><span class="o">=</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Axes on the native grid</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">==</span> <span class="s2">&quot;rotated&quot;</span><span class="p">:</span>
                <span class="n">rgaxes</span><span class="p">(</span>
                    <span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span>
                    <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span>
                    <span class="n">xvec</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">yvec</span><span class="o">=</span><span class="n">y</span><span class="p">,</span>
                    <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span>
                    <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                    <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span>
                    <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                    <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                    <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span>
                    <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
                    <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
                <span class="n">_plot_map_axes</span><span class="p">(</span>
                    <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
                    <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span>
                    <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
                    <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span>
                    <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
                    <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span>
                    <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
                    <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span>
                    <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
                    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Title</span>
            <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

            <span class="c1"># Titles for dimensions</span>
            <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
                <span class="n">_dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">,</span> <span class="n">titles2</span><span class="o">=</span><span class="n">title_dims2</span><span class="p">)</span>

    <span class="c1">######################################</span>
    <span class="c1"># Latitude or longitude vs height plot</span>
    <span class="c1">######################################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>

        <span class="n">user_gset</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
        <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># Program selected data plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">80</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span>
                    <span class="n">xmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
                <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span>
                    <span class="n">xmax</span> <span class="o">=</span> <span class="mi">90</span>
            <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ymin</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># User specified plot limits</span>
            <span class="n">xmin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">xmax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
                <span class="n">ymax</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>

        <span class="n">ystep</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">ymax</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="k">if</span> <span class="n">ymax</span> <span class="o">==</span> <span class="mi">100000</span><span class="p">:</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">10000</span>

        <span class="n">ytype</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># pressure or similar y axis</span>
        <span class="k">if</span> <span class="s2">&quot;theta&quot;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
            <span class="n">ytype</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="s2">&quot;height&quot;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
            <span class="n">ytype</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ystep</span> <span class="o">=</span> <span class="mi">100</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span>
                <span class="n">ystep</span> <span class="o">=</span> <span class="mf">500.0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span>
                <span class="n">ystep</span> <span class="o">=</span> <span class="mf">1000.0</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50000</span><span class="p">:</span>
                <span class="n">ystep</span> <span class="o">=</span> <span class="mf">10000.0</span>

        <span class="c1"># Set plot limits and draw axes</span>
        <span class="k">if</span> <span class="n">ylog</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ytype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span>
                    <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                    <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                    <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                    <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                    <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">gset</span><span class="p">(</span>
                    <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                    <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                    <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                    <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                    <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="c1"># Set default x-axis labels</span>
            <span class="n">lltype</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">lltype</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">llticks</span><span class="p">,</span> <span class="n">lllabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">lltype</span><span class="p">)</span>

            <span class="n">heightticks</span> <span class="o">=</span> <span class="n">_gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="kc">False</span><span class="p">)[</span>
                <span class="mi">0</span>
            <span class="p">]</span>
            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">heightticks</span>

            <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">llticks</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="n">lllabels</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">lllabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">llticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">heightticks</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">llticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

            <span class="n">axes_plot</span><span class="p">(</span>
                <span class="n">xticks</span><span class="o">=</span><span class="n">llticks</span><span class="p">,</span>
                <span class="n">xticklabels</span><span class="o">=</span><span class="n">lllabels</span><span class="p">,</span>
                <span class="n">yticks</span><span class="o">=</span><span class="n">heightticks</span><span class="p">,</span>
                <span class="n">yticklabels</span><span class="o">=</span><span class="n">heightlabels</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
                <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="c1"># Log y axis</span>
        <span class="k">if</span> <span class="n">ylog</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ymin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ymin</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># reset zero mb/height input to a small value</span>
            <span class="n">gset</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span>
                <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span>
                <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span>
                <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span>
                <span class="n">ylog</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">llticks</span><span class="p">,</span> <span class="n">lllabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span>
                <span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">llticks</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="n">lllabels</span> <span class="o">=</span> <span class="n">xticks</span>
                        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">lllabels</span> <span class="o">=</span> <span class="n">xticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">llticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">heightticks</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticks</span>
                        <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="n">heightlabels</span> <span class="o">=</span> <span class="n">yticklabels</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">heightticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
                    <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">axes_plot</span><span class="p">(</span>
                        <span class="n">xticks</span><span class="o">=</span><span class="n">llticks</span><span class="p">,</span>
                        <span class="n">xticklabels</span><span class="o">=</span><span class="n">lllabels</span><span class="p">,</span>
                        <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
                        <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">axes_plot</span><span class="p">(</span>
                        <span class="n">xticks</span><span class="o">=</span><span class="n">llticks</span><span class="p">,</span>
                        <span class="n">xticklabels</span><span class="o">=</span><span class="n">lllabels</span><span class="p">,</span>
                        <span class="n">yticks</span><span class="o">=</span><span class="n">heightticks</span><span class="p">,</span>
                        <span class="n">yticklabels</span><span class="o">=</span><span class="n">heightlabels</span><span class="p">,</span>
                        <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
                        <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                    <span class="p">)</span>

        <span class="c1"># Regrid the data if requested</span>
        <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span>
                <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span>
                <span class="n">stype</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">ytype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="c1"># Make y interpolation in log space as we have a pressure</span>
                <span class="c1"># coordinate</span>
                <span class="n">u_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span>
                    <span class="n">f</span><span class="o">=</span><span class="n">u_data</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                    <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span>
                    <span class="n">ynew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ynew</span><span class="p">),</span>
                <span class="p">)</span>
                <span class="n">v_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span>
                    <span class="n">f</span><span class="o">=</span><span class="n">v_data</span><span class="p">,</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span>
                    <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                    <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span>
                    <span class="n">ynew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">ynew</span><span class="p">),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">u_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">u_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>
                <span class="n">v_vals</span> <span class="o">=</span> <span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">v_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>

            <span class="n">u_x</span> <span class="o">=</span> <span class="n">xnew</span>
            <span class="n">u_y</span> <span class="o">=</span> <span class="n">ynew</span>
            <span class="n">u_data</span> <span class="o">=</span> <span class="n">u_vals</span>
            <span class="n">v_data</span> <span class="o">=</span> <span class="n">v_vals</span>

        <span class="c1"># set scale and key lengths</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">scale_u</span> <span class="o">=</span> <span class="n">scale</span>
            <span class="n">scale_v</span> <span class="o">=</span> <span class="n">scale</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">scale_u</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">scale_v</span> <span class="o">=</span> <span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">key_length</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">key_length_u</span> <span class="o">=</span> <span class="n">key_length</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">key_length_v</span> <span class="o">=</span> <span class="n">key_length</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="c1"># scale v data</span>
            <span class="n">v_data</span> <span class="o">=</span> <span class="n">v_data</span> <span class="o">*</span> <span class="n">scale_u</span> <span class="o">/</span> <span class="n">scale_v</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">key_length_u</span> <span class="o">=</span> <span class="n">key_length</span>

        <span class="c1"># Plot the vectors</span>
        <span class="n">quiv</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span>
            <span class="n">u_x</span><span class="p">,</span>
            <span class="n">u_y</span><span class="p">,</span>
            <span class="n">u_data</span><span class="p">,</span>
            <span class="n">v_data</span><span class="p">,</span>
            <span class="n">pivot</span><span class="o">=</span><span class="n">pivot</span><span class="p">,</span>
            <span class="n">units</span><span class="o">=</span><span class="s2">&quot;inches&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">scale_u</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
            <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
            <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
            <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Plot single key</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="c1"># Single scale vector</span>
            <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length_u</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                    <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">_supscr</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key_label_u</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">units</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">key_label</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span>
                    <span class="n">quiv</span><span class="p">,</span>
                    <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">key_length_u</span><span class="p">,</span>
                    <span class="n">key_label_u</span><span class="p">,</span>
                    <span class="n">labelpos</span><span class="o">=</span><span class="s2">&quot;W&quot;</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">qkey_color</span><span class="p">,</span>
                    <span class="n">fontproperties</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">)},</span>
                <span class="p">)</span>

        <span class="c1"># Plot two keys</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="c1"># translate from normalised units to plot units</span>
            <span class="n">xpos</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">key_location</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="p">)</span>
            <span class="n">ypos</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">key_location</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>
                <span class="o">+</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="p">)</span>

            <span class="c1"># horizontal and vertical spacings for offsetting vector reference</span>
            <span class="c1"># text</span>
            <span class="n">xoffset</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span>
            <span class="n">yoffset</span> <span class="o">=</span> <span class="mf">0.01</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">)</span>

            <span class="c1"># Assign key labels if necessary</span>
            <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length_u</span><span class="p">)</span>
                <span class="n">key_label_v</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">key_length_v</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                    <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">_supscr</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key_label_u</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">u</span><span class="o">.</span><span class="n">units</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                    <span class="n">key_label_v</span> <span class="o">=</span> <span class="n">_supscr</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">key_label_v</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">v</span><span class="o">.</span><span class="n">units</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">key_label_u</span> <span class="o">=</span> <span class="n">_supscr</span><span class="p">(</span><span class="n">key_label</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                <span class="n">key_label_v</span> <span class="o">=</span> <span class="n">_supscr</span><span class="p">(</span><span class="n">key_label</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

            <span class="c1"># Plot reference vectors and keys</span>
            <span class="k">if</span> <span class="n">key_show</span><span class="p">:</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span>
                    <span class="n">xpos</span><span class="p">,</span>
                    <span class="n">ypos</span><span class="p">,</span>
                    <span class="n">key_length</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="n">pivot</span><span class="o">=</span><span class="s2">&quot;tail&quot;</span><span class="p">,</span>
                    <span class="n">units</span><span class="o">=</span><span class="s2">&quot;inches&quot;</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                    <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                    <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">qkey_color</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span>
                    <span class="n">xpos</span><span class="p">,</span>
                    <span class="n">ypos</span><span class="p">,</span>
                    <span class="mi">0</span><span class="p">,</span>
                    <span class="n">key_length</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">pivot</span><span class="o">=</span><span class="s2">&quot;tail&quot;</span><span class="p">,</span>
                    <span class="n">units</span><span class="o">=</span><span class="s2">&quot;inches&quot;</span><span class="p">,</span>
                    <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
                    <span class="n">headaxislength</span><span class="o">=</span><span class="n">headaxislength</span><span class="p">,</span>
                    <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                    <span class="n">headwidth</span><span class="o">=</span><span class="n">headwidth</span><span class="p">,</span>
                    <span class="n">headlength</span><span class="o">=</span><span class="n">headlength</span><span class="p">,</span>
                    <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">qkey_color</span><span class="p">,</span>
                <span class="p">)</span>

                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">xpos</span><span class="p">,</span>
                    <span class="n">ypos</span> <span class="o">+</span> <span class="n">yoffset</span><span class="p">,</span>
                    <span class="n">key_label_u</span><span class="p">,</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="n">xpos</span> <span class="o">-</span> <span class="n">xoffset</span><span class="p">,</span>
                    <span class="n">ypos</span><span class="p">,</span>
                    <span class="n">key_label_v</span><span class="p">,</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
                <span class="n">title</span><span class="p">,</span>
                <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="c1"># Titles for dimensions</span>
            <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
                <span class="n">_dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">,</span> <span class="n">titles2</span><span class="o">=</span><span class="n">title_dims2</span><span class="p">)</span>

    <span class="c1">##########</span>
    <span class="c1"># Save plot</span>
    <span class="c1">##########</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gset</span><span class="p">()</span>
        <span class="n">cscale</span><span class="p">()</span>
        <span class="n">gclose</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mapset</span><span class="p">()</span>
        <span class="n">mapset</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">)</span></div>



<div class="viewcode-block" id="polar_regular_grid">
<a class="viewcode-back" href="../polar_regular_grid.html#cfplot.polar_regular_grid">[docs]</a>
<span class="k">def</span> <span class="nf">polar_regular_grid</span><span class="p">(</span><span class="n">pts</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Return a regular grid over a polar stereographic area.</span>
<span class="sd">    |</span>
<span class="sd">    | pts=50 - number  of grid points in the x and y directions</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     lons, lats of grid in degrees</span>
<span class="sd">     x, y locations of lons and lats</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">boundinglat</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
    <span class="n">lon_0</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span><span class="p">:</span>
        <span class="n">thisproj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">NorthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">thisproj</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">SouthPolarStereo</span><span class="p">(</span><span class="n">central_longitude</span><span class="o">=</span><span class="n">lon_0</span><span class="p">)</span>

    <span class="c1"># Find min and max of plotting region in device coordinates</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">lon_0</span> <span class="o">-</span> <span class="mi">90</span><span class="p">,</span> <span class="n">lon_0</span><span class="p">,</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mi">90</span><span class="p">,</span> <span class="n">lon_0</span> <span class="o">+</span> <span class="mi">180</span><span class="p">])</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">boundinglat</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">])</span>
    <span class="n">extent</span> <span class="o">=</span> <span class="n">thisproj</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>

    <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">extent</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">extent</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">extent</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">ymax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">extent</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>

    <span class="c1"># Make up a stipple of points for cover the pole</span>
    <span class="n">points_device</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span>
        <span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">2</span>
    <span class="p">)</span>

    <span class="n">xnew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points_device</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
    <span class="n">ynew</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points_device</span><span class="p">)[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

    <span class="n">points_polar</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span><span class="n">thisproj</span><span class="p">,</span> <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">)</span>

    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points_polar</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points_polar</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&gt;=</span> <span class="n">boundinglat</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&lt;=</span> <span class="n">boundinglat</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">lons</span><span class="p">[</span><span class="n">valid</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">valid</span><span class="p">],</span> <span class="n">xnew</span><span class="p">[</span><span class="n">valid</span><span class="p">],</span> <span class="n">ynew</span><span class="p">[</span><span class="n">valid</span><span class="p">]</span></div>



<div class="viewcode-block" id="cf_var_name">
<a class="viewcode-back" href="../cf_var_name.html#cfplot.cf_var_name">[docs]</a>
<span class="k">def</span> <span class="nf">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Return the name from a supplied dimension in order.</span>
<span class="sd">    |</span>
<span class="sd">    | Names are returned in the following order:</span>
<span class="sd">    | * ncvar</span>
<span class="sd">    | * short_name</span>
<span class="sd">    | * long_name</span>
<span class="sd">    | * standard_name</span>
<span class="sd">    |</span>
<span class="sd">    | field=None - field</span>
<span class="sd">    | dim=None - dimension required - &#39;dim0&#39;, &#39;dim1&#39; etc.</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     name</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check for multiple Z coordinates</span>
    <span class="c1"># Adjust dim if necessary</span>
    <span class="k">if</span> <span class="n">dim</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
        <span class="n">z_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">z_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">mycoord</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">coords</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
                <span class="n">z_count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">z_names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">z_count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">dim</span> <span class="o">=</span> <span class="n">z_names</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="nb">id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">ncvar</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">short_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s2">&quot;short_name&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">long_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;No Name&quot;</span>
    <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="nb">id</span>
    <span class="k">if</span> <span class="n">ncvar</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">ncvar</span>
    <span class="k">if</span> <span class="n">short_name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">short_name</span>
    <span class="k">if</span> <span class="n">long_name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">long_name</span>
    <span class="k">if</span> <span class="n">standard_name</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">standard_name</span>

    <span class="k">return</span> <span class="n">name</span></div>



<span class="k">def</span> <span class="nf">cf_var_name_titles</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Return the name from a supplied dimension in order.</span>
<span class="sd">    |</span>
<span class="sd">    | Names are returned in the following order:</span>
<span class="sd">    | * standard_name</span>
<span class="sd">    | * long_name</span>
<span class="sd">    | * short_name</span>
<span class="sd">    | * ncvar</span>

<span class="sd">    | field=None - field</span>
<span class="sd">    | dim=None - dimension required - &#39;dim0&#39;, &#39;dim1&#39; etc.</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># TODO SLB: combine with &#39;cf_var_name&#39;, which does reverse</span>

    <span class="n">name</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">units</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="n">dim</span><span class="p">):</span>

        <span class="nb">id</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">ncvar</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">)</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">short_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s2">&quot;short_name&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">long_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">standard_name</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

        <span class="c1"># name = &#39;No Name&#39;</span>
        <span class="k">if</span> <span class="nb">id</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="nb">id</span>
        <span class="k">if</span> <span class="n">ncvar</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">ncvar</span>
        <span class="k">if</span> <span class="n">short_name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">short_name</span>
        <span class="k">if</span> <span class="n">long_name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">long_name</span>
        <span class="k">if</span> <span class="n">standard_name</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">standard_name</span>

        <span class="n">units</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s2">&quot;units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">units</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="s2">)&quot;</span>
    <span class="k">return</span> <span class="n">name</span><span class="p">,</span> <span class="n">units</span>


<div class="viewcode-block" id="reset">
<a class="viewcode-back" href="../reset.html#cfplot.reset">[docs]</a>
<span class="k">def</span> <span class="nf">reset</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Reset all plotting variables.</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">axes</span><span class="p">()</span>
    <span class="n">cscale</span><span class="p">()</span>
    <span class="n">levs</span><span class="p">()</span>
    <span class="n">gset</span><span class="p">()</span>
    <span class="n">mapset</span><span class="p">()</span>
    <span class="n">setvars</span><span class="p">()</span></div>



<div class="viewcode-block" id="setvars">
<a class="viewcode-back" href="../setvars.html#cfplot.setvars">[docs]</a>
<span class="k">def</span> <span class="nf">setvars</span><span class="p">(</span>
    <span class="n">file</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">text_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">text_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">axis_label_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">continent_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">continent_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">continent_linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">viewer</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tspace_year</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tspace_month</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tspace_day</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tspace_hour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xtick_label_rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xtick_label_align</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ytick_label_rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ytick_label_align</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_text_weight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_text_size</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">cs_uniform</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">master_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">master_title_location</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">master_title_fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">master_title_fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">dpi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">land_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ocean_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">lake_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">feature_zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rotated_grid_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rotated_deg_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rotated_continents</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rotated_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rotated_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">rotated_grid_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_frame</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_frame_edge_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_frame_face_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">degsym</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">axis_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">grid_x_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">grid_y_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">grid_zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">grid_colour</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">grid_linestyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">grid_thickness</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">tight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">level_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Set plotting variables and their defaults.</span>
<span class="sd">    |</span>
<span class="sd">    | file=None - output file name</span>
<span class="sd">    | title_fontsize=None - title fontsize, default=15</span>
<span class="sd">    | title_fontweight=&#39;normal&#39; - title fontweight</span>
<span class="sd">    | text_fontsize=&#39;normal&#39; - text font size, default=11</span>
<span class="sd">    | text_fontweight=&#39;normal&#39; - text font weight</span>
<span class="sd">    | axis_label_fontsize=None - axis label fontsize, default=11</span>
<span class="sd">    | axis_label_fontweight=&#39;normal&#39; - axis font weight</span>
<span class="sd">    | legend_text_size=&#39;11&#39; - legend text size</span>
<span class="sd">    | legend_text_weight=&#39;normal&#39; - legend text weight</span>
<span class="sd">    | colorbar_fontsize=&#39;11&#39; - colorbar text size</span>
<span class="sd">    | colorbar_fontweight=&#39;normal&#39; - colorbar font weight</span>
<span class="sd">    | legend_text_weight=&#39;normal&#39; - legend text weight</span>
<span class="sd">    | master_title_fontsize=30 - master title font size</span>
<span class="sd">    | master_title_fontweight=&#39;normal&#39; - master title font weight</span>
<span class="sd">    | continent_thickness=1.5 - default=1.5</span>
<span class="sd">    | continent_color=&#39;k&#39; - default=&#39;k&#39; (black)</span>
<span class="sd">    | continent_linestyle=&#39;solid&#39; - default=&#39;k&#39; (black)</span>
<span class="sd">    | viewer=&#39;display&#39; - use ImageMagick display program</span>
<span class="sd">    |                    &#39;matplotlib&#39; to use image widget to view the picture</span>
<span class="sd">    | tspace_year=None - time axis spacing in years</span>
<span class="sd">    | tspace_month=None - time axis spacing in months</span>
<span class="sd">    | tspace_day=None - time axis spacing in days</span>
<span class="sd">    | tspace_hour=None - time axis spacing in hours</span>
<span class="sd">    | xtick_label_rotation=0 - rotation of xtick labels</span>
<span class="sd">    | xtick_label_align=&#39;center&#39; - alignment of xtick labels</span>
<span class="sd">    | ytick_label_rotation=0 - rotation of ytick labels</span>
<span class="sd">    | ytick_label_align=&#39;right&#39; - alignment of ytick labels</span>

<span class="sd">    | cs_uniform=True - make a uniform differential colour scale</span>
<span class="sd">    | master_title=None - master title text</span>
<span class="sd">    | master_title_location=[0.5,0.95] - master title location</span>
<span class="sd">    | dpi=None - dots per inch setting</span>
<span class="sd">    | land_color=None - land colour</span>
<span class="sd">    | ocean_color=None - ocean colour</span>
<span class="sd">    | lake_color=None - lake colour</span>
<span class="sd">    | feature_zorder=None - plotting zorder for above three features</span>
<span class="sd">    | rotated_grid_spacing=10 - rotated grid spacing in degrees</span>
<span class="sd">    | rotated_deg_spacing=0.75 - rotated grid spacing between graticule dots</span>
<span class="sd">    | rotated_deg_tkickness=1.0 - rotated grid thickness for longitude and</span>
<span class="sd">    |                             latitude lines</span>
<span class="sd">    | rotated_continents=True - draw rotated continents</span>
<span class="sd">    | rotated_grid=True - draw rotated grid</span>
<span class="sd">    | rotated_labels=True - draw rotated grid labels</span>
<span class="sd">    | legend_frame=True - draw a frame around a lineplot legend</span>
<span class="sd">    | legend_frame_edge_color=&#39;k&#39; - color for the legend frame</span>
<span class="sd">    | legend_frame_face_color=None - color for the legend background</span>
<span class="sd">    | degsym=True - add degree symbol to longitude and latitude axis labels</span>
<span class="sd">    | axis_width=None - width of line for the axes</span>
<span class="sd">    | grid=True - draw grid</span>
<span class="sd">    | grid_x_spacing=60 - grid longitude spacing in degrees</span>
<span class="sd">    | grid_x_spacing=30 - grid latitude spacing in degrees</span>
<span class="sd">    | grid_colour=&#39;k&#39; - grid colour</span>
<span class="sd">    | grid_linestyle=&#39;--&#39; - grid line style</span>
<span class="sd">    | grid_zorder=100 - plotting order for the grid lines</span>
<span class="sd">    | grid_thickness=1.0 - grid thickness</span>
<span class="sd">    | tight=False - remove whitespace around the plot</span>
<span class="sd">    | level_spacing=None - default contour level spacing - takes &#39;linear&#39;,</span>
<span class="sd">    |                      &#39;log&#39;, &#39;loglike&#39;, &#39;outlier&#39; and &#39;inspect&#39;</span>
<span class="sd">    |</span>
<span class="sd">    | Use setvars() to reset to the defaults</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     name</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">vals</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">file</span><span class="p">,</span>
        <span class="n">title_fontsize</span><span class="p">,</span>
        <span class="n">text_fontsize</span><span class="p">,</span>
        <span class="n">axis_label_fontsize</span><span class="p">,</span>
        <span class="n">continent_thickness</span><span class="p">,</span>
        <span class="n">title_fontweight</span><span class="p">,</span>
        <span class="n">text_fontweight</span><span class="p">,</span>
        <span class="n">axis_label_fontweight</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="p">,</span>
        <span class="n">continent_color</span><span class="p">,</span>
        <span class="n">continent_linestyle</span><span class="p">,</span>
        <span class="n">tspace_year</span><span class="p">,</span>
        <span class="n">tspace_month</span><span class="p">,</span>
        <span class="n">tspace_day</span><span class="p">,</span>
        <span class="n">tspace_hour</span><span class="p">,</span>
        <span class="n">xtick_label_rotation</span><span class="p">,</span>
        <span class="n">xtick_label_align</span><span class="p">,</span>
        <span class="n">ytick_label_rotation</span><span class="p">,</span>
        <span class="n">ytick_label_align</span><span class="p">,</span>
        <span class="n">legend_text_size</span><span class="p">,</span>
        <span class="n">legend_text_weight</span><span class="p">,</span>
        <span class="n">cs_uniform</span><span class="p">,</span>
        <span class="n">master_title</span><span class="p">,</span>
        <span class="n">master_title_location</span><span class="p">,</span>
        <span class="n">master_title_fontsize</span><span class="p">,</span>
        <span class="n">master_title_fontweight</span><span class="p">,</span>
        <span class="n">dpi</span><span class="p">,</span>
        <span class="n">land_color</span><span class="p">,</span>
        <span class="n">ocean_color</span><span class="p">,</span>
        <span class="n">lake_color</span><span class="p">,</span>
        <span class="n">feature_zorder</span><span class="p">,</span>
        <span class="n">rotated_grid_spacing</span><span class="p">,</span>
        <span class="n">rotated_deg_spacing</span><span class="p">,</span>
        <span class="n">rotated_continents</span><span class="p">,</span>
        <span class="n">rotated_grid</span><span class="p">,</span>
        <span class="n">rotated_grid_thickness</span><span class="p">,</span>
        <span class="n">rotated_labels</span><span class="p">,</span>
        <span class="n">colorbar_fontsize</span><span class="p">,</span>
        <span class="n">colorbar_fontweight</span><span class="p">,</span>
        <span class="n">legend_frame</span><span class="p">,</span>
        <span class="n">legend_frame_edge_color</span><span class="p">,</span>
        <span class="n">legend_frame_face_color</span><span class="p">,</span>
        <span class="n">degsym</span><span class="p">,</span>
        <span class="n">axis_width</span><span class="p">,</span>
        <span class="n">grid</span><span class="p">,</span>
        <span class="n">grid_x_spacing</span><span class="p">,</span>
        <span class="n">grid_y_spacing</span><span class="p">,</span>
        <span class="n">grid_zorder</span><span class="p">,</span>
        <span class="n">grid_colour</span><span class="p">,</span>
        <span class="n">grid_linestyle</span><span class="p">,</span>
        <span class="n">grid_thickness</span><span class="p">,</span>
        <span class="n">tight</span><span class="p">,</span>
        <span class="n">level_spacing</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontweight</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">fontweight</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_month</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span> <span class="o">=</span> <span class="s2">&quot;right&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_size</span> <span class="o">=</span> <span class="mi">11</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_weight</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_uniform</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">global_viewer</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_location</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontsize</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontweight</span> <span class="o">=</span> <span class="s2">&quot;normal&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">land_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ocean_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lake_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_spacing</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_deg_spacing</span> <span class="o">=</span> <span class="mf">0.75</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_thickness</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_continents</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_labels</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_edge_color</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_face_color</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">degsym</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span> <span class="o">=</span> <span class="mi">60</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span> <span class="o">=</span> <span class="mi">30</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span> <span class="o">=</span> <span class="s2">&quot;--&quot;</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_zorder</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="n">matplotlib</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">ioff</span><span class="p">()</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">level_spacing</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file</span>
    <span class="c1"># TODO SLB consolidate this long list of conditional setting!</span>
    <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">title_fontsize</span>
    <span class="k">if</span> <span class="n">axis_label_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span> <span class="o">=</span> <span class="n">axis_label_fontsize</span>
    <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">continent_thickness</span>
    <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="o">=</span> <span class="n">continent_color</span>
    <span class="k">if</span> <span class="n">continent_linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span> <span class="o">=</span> <span class="n">continent_linestyle</span>
    <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">colorbar_fontsize</span>
    <span class="k">if</span> <span class="n">colorbar_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontsize</span> <span class="o">=</span> <span class="n">colorbar_fontsize</span>
    <span class="k">if</span> <span class="n">text_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span> <span class="o">=</span> <span class="n">text_fontweight</span>
    <span class="k">if</span> <span class="n">axis_label_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span> <span class="o">=</span> <span class="n">axis_label_fontweight</span>
    <span class="k">if</span> <span class="n">colorbar_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontweight</span> <span class="o">=</span> <span class="n">colorbar_fontweight</span>
    <span class="k">if</span> <span class="n">title_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span> <span class="o">=</span> <span class="n">title_fontweight</span>
    <span class="k">if</span> <span class="n">viewer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">viewer</span> <span class="o">=</span> <span class="n">viewer</span>
    <span class="k">if</span> <span class="n">tspace_year</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_year</span> <span class="o">=</span> <span class="n">tspace_year</span>
    <span class="k">if</span> <span class="n">tspace_month</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_month</span> <span class="o">=</span> <span class="n">tspace_month</span>
    <span class="k">if</span> <span class="n">tspace_day</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_day</span> <span class="o">=</span> <span class="n">tspace_day</span>
    <span class="k">if</span> <span class="n">tspace_hour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tspace_hour</span> <span class="o">=</span> <span class="n">tspace_hour</span>
    <span class="k">if</span> <span class="n">xtick_label_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span> <span class="o">=</span> <span class="n">xtick_label_rotation</span>
    <span class="k">if</span> <span class="n">xtick_label_align</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span> <span class="o">=</span> <span class="n">xtick_label_align</span>
    <span class="k">if</span> <span class="n">ytick_label_rotation</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span> <span class="o">=</span> <span class="n">ytick_label_rotation</span>
    <span class="k">if</span> <span class="n">ytick_label_align</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span> <span class="o">=</span> <span class="n">ytick_label_align</span>
    <span class="k">if</span> <span class="n">legend_text_size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_size</span> <span class="o">=</span> <span class="n">legend_text_size</span>
    <span class="k">if</span> <span class="n">legend_text_weight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_weight</span> <span class="o">=</span> <span class="n">legend_text_weight</span>
    <span class="k">if</span> <span class="n">cs_uniform</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">cs_uniform</span> <span class="o">=</span> <span class="n">cs_uniform</span>
    <span class="k">if</span> <span class="n">master_title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title</span> <span class="o">=</span> <span class="n">master_title</span>
    <span class="k">if</span> <span class="n">master_title_location</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_location</span> <span class="o">=</span> <span class="n">master_title_location</span>
    <span class="k">if</span> <span class="n">master_title_fontsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontsize</span> <span class="o">=</span> <span class="n">master_title_fontsize</span>
    <span class="k">if</span> <span class="n">master_title_fontweight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_title_fontweight</span> <span class="o">=</span> <span class="n">master_title_fontweight</span>
    <span class="k">if</span> <span class="n">dpi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">dpi</span> <span class="o">=</span> <span class="n">dpi</span>
    <span class="k">if</span> <span class="n">land_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">land_color</span> <span class="o">=</span> <span class="n">land_color</span>
    <span class="k">if</span> <span class="n">ocean_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">ocean_color</span> <span class="o">=</span> <span class="n">ocean_color</span>
    <span class="k">if</span> <span class="n">lake_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lake_color</span> <span class="o">=</span> <span class="n">lake_color</span>
    <span class="k">if</span> <span class="n">feature_zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span> <span class="o">=</span> <span class="mi">999</span>
    <span class="k">if</span> <span class="n">rotated_grid_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_spacing</span> <span class="o">=</span> <span class="n">rotated_grid_spacing</span>
    <span class="k">if</span> <span class="n">rotated_deg_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_deg_spacing</span> <span class="o">=</span> <span class="n">rotated_deg_spacing</span>
    <span class="k">if</span> <span class="n">rotated_grid_thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_thickness</span> <span class="o">=</span> <span class="n">rotated_grid_thickness</span>
    <span class="k">if</span> <span class="n">rotated_continents</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_continents</span> <span class="o">=</span> <span class="n">rotated_continents</span>
    <span class="k">if</span> <span class="n">rotated_grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid</span> <span class="o">=</span> <span class="n">rotated_grid</span>
    <span class="k">if</span> <span class="n">rotated_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_labels</span> <span class="o">=</span> <span class="n">rotated_labels</span>
    <span class="k">if</span> <span class="n">legend_frame</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame</span> <span class="o">=</span> <span class="n">legend_frame</span>
    <span class="k">if</span> <span class="n">legend_frame_edge_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_edge_color</span> <span class="o">=</span> <span class="n">legend_frame_edge_color</span>
    <span class="k">if</span> <span class="n">legend_frame_face_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_face_color</span> <span class="o">=</span> <span class="n">legend_frame_face_color</span>
    <span class="k">if</span> <span class="n">degsym</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">degsym</span> <span class="o">=</span> <span class="n">degsym</span>
    <span class="k">if</span> <span class="n">axis_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span> <span class="o">=</span> <span class="n">axis_width</span>
    <span class="k">if</span> <span class="n">grid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span>
    <span class="k">if</span> <span class="n">grid_x_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span> <span class="o">=</span> <span class="n">grid_x_spacing</span>
    <span class="k">if</span> <span class="n">grid_y_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span> <span class="o">=</span> <span class="n">grid_y_spacing</span>
    <span class="k">if</span> <span class="n">grid_colour</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span> <span class="o">=</span> <span class="n">grid_colour</span>
    <span class="k">if</span> <span class="n">grid_linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span> <span class="o">=</span> <span class="n">grid_linestyle</span>
    <span class="k">if</span> <span class="n">grid_thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span> <span class="o">=</span> <span class="n">grid_thickness</span>
    <span class="k">if</span> <span class="n">grid_zorder</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_zorder</span> <span class="o">=</span> <span class="n">grid_zorder</span>
    <span class="k">if</span> <span class="n">tight</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">tight</span> <span class="o">=</span> <span class="n">tight</span>
    <span class="k">if</span> <span class="n">level_spacing</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">level_spacing</span> <span class="o">=</span> <span class="n">level_spacing</span></div>



<div class="viewcode-block" id="vloc">
<a class="viewcode-back" href="../vloc.html#cfplot.vloc">[docs]</a>
<span class="k">def</span> <span class="nf">vloc</span><span class="p">(</span><span class="n">xvec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Locate the positions of a set of points in a vector.</span>
<span class="sd">    |</span>
<span class="sd">    | xvec=None - data longitudes</span>
<span class="sd">    | yvec=None - data latitudes</span>
<span class="sd">    | lons=None - required longitude positions</span>
<span class="sd">    | lats=None - required latitude positions</span>

<span class="sd">    :Returns:</span>
<span class="sd">     locations of user points in the longitude and latitude points</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check input parameters</span>
    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">]):</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">vloc error</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;xvec, yvec, lons, lats all need to be passed to vloc to</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;generate a set of location points</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span>
    <span class="n">yarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>

    <span class="c1"># Convert longitudes to -180 to 180.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)):</span>
        <span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>

    <span class="c1"># Centre around 180 degrees longitude if needed.</span>
    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)):</span>
            <span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xvec</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">xvec</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">xvec</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
            <span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span>

    <span class="c1"># Find position in array</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">xvec</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">xvec</span><span class="p">)):</span>
            <span class="n">xpt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">xvec</span><span class="p">)</span>
            <span class="n">xpt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">yvec</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">yvec</span><span class="p">)):</span>
            <span class="n">ypt</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">yvec</span><span class="p">)</span>
            <span class="n">ypt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xpt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">xarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpt</span> <span class="o">+</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">ypt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ypt</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">yarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">ypt</span> <span class="o">+</span> <span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">yarr</span><span class="p">)</span></div>



<div class="viewcode-block" id="rgaxes">
<a class="viewcode-back" href="../rgaxes.html#cfplot.rgaxes">[docs]</a>
<span class="k">def</span> <span class="nf">rgaxes</span><span class="p">(</span>
    <span class="n">xpole</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ypole</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xvec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yvec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Label rotated grid plots.</span>
<span class="sd">    |</span>
<span class="sd">    | xpole=None - location of xpole in degrees</span>
<span class="sd">    | ypole=None - location of ypole in degrees</span>
<span class="sd">    | xvec=None - location of x grid points</span>
<span class="sd">    | yvec=None - location of y grid points</span>
<span class="sd">    |</span>
<span class="sd">    | axes=True - plot x and y axes</span>
<span class="sd">    | xaxis=True - plot xaxis</span>
<span class="sd">    | yaxis=True - plot y axis</span>
<span class="sd">    | xticks=None - xtick positions</span>
<span class="sd">    | xticklabels=None - xtick labels</span>
<span class="sd">    | yticks=None - y tick positions</span>
<span class="sd">    | yticklabels=None - ytick labels</span>
<span class="sd">    | xlabel=None - label for x axis</span>
<span class="sd">    | ylabel=None - label for y axis</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     name</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">spacing</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_spacing</span>
    <span class="n">degspacing</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_deg_spacing</span>
    <span class="n">continents</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_continents</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_labels</span>
    <span class="n">grid_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rotated_grid_thickness</span>

    <span class="c1"># Invert y array if going from north to south</span>
    <span class="c1"># Otherwise this gives nans for all output</span>
    <span class="n">yvec_orig</span> <span class="o">=</span> <span class="n">yvec</span>
    <span class="k">if</span> <span class="n">yvec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yvec</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="n">yvec</span> <span class="o">=</span> <span class="n">yvec</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">gset</span><span class="p">(</span>
        <span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Set continent thickness and color if not already set</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>

    <span class="c1"># Draw continents</span>
    <span class="k">if</span> <span class="n">continents</span><span class="p">:</span>

        <span class="kn">import</span> <span class="nn">cartopy.io.shapereader</span> <span class="k">as</span> <span class="nn">shpreader</span>
        <span class="kn">import</span> <span class="nn">shapefile</span>

        <span class="n">shpfilename</span> <span class="o">=</span> <span class="n">shpreader</span><span class="o">.</span><span class="n">natural_earth</span><span class="p">(</span>
            <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="s2">&quot;physical&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;coastline&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">reader</span> <span class="o">=</span> <span class="n">shapefile</span><span class="o">.</span><span class="n">Reader</span><span class="p">(</span><span class="n">shpfilename</span><span class="p">)</span>
        <span class="n">shapes</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">points</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">reader</span><span class="o">.</span><span class="n">shapes</span><span class="p">()]</span>
        <span class="k">for</span> <span class="n">shape</span> <span class="ow">in</span> <span class="n">shapes</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span>

            <span class="n">rotated_transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">RotatedPole</span><span class="p">(</span>
                <span class="n">pole_latitude</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="o">=</span><span class="n">xpole</span>
            <span class="p">)</span>
            <span class="n">points</span> <span class="o">=</span> <span class="n">rotated_transform</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
                <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span>
            <span class="p">)</span>
            <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

            <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">xpts</span><span class="p">,</span>
                <span class="n">ypts</span><span class="p">,</span>
                <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">continent_color</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">360</span> <span class="o">/</span> <span class="n">spacing</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">xticks</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">180</span> <span class="o">/</span> <span class="n">spacing</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">spacing</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">yticks</span>

    <span class="c1"># Work out how far from plot to plot the longitude and latitude labels</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">spacing_x</span> <span class="o">=</span> <span class="p">(</span><span class="n">xlim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xlim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span>
    <span class="n">ylim</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">spacing_y</span> <span class="o">=</span> <span class="p">(</span><span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="mi">20</span>
    <span class="n">spacing</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">spacing_x</span><span class="p">,</span> <span class="n">spacing_y</span><span class="p">)</span>

    <span class="c1"># Draw lines along a longitude</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xaxis</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
                <span class="n">ipts</span> <span class="o">=</span> <span class="mf">179.0</span> <span class="o">/</span> <span class="n">degspacing</span>
                <span class="n">lona</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ipts</span><span class="p">))</span> <span class="o">+</span> <span class="n">lons</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
                <span class="n">lata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ipts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">degspacing</span>

                <span class="n">rotated_transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">RotatedPole</span><span class="p">(</span>
                    <span class="n">pole_latitude</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="o">=</span><span class="n">xpole</span>
                <span class="p">)</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">rotated_transform</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
                    <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lona</span><span class="p">,</span> <span class="n">lata</span>
                <span class="p">)</span>
                <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>

                <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_thickness</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
                    <span class="c1"># Make a label unless the axis is all Nans</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">ypts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ypts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])):</span>
                        <span class="n">ymin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ypts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
                        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">ypts</span> <span class="o">==</span> <span class="n">ymin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="n">loc</span> <span class="o">=</span> <span class="n">loc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                        <span class="k">if</span> <span class="n">loc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">]):</span>
                                <span class="n">line</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">]],</span>
                                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                                    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                                <span class="p">)</span>
                                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                                <span class="n">line</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                                <span class="n">fw</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span>
                                <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                    <span class="n">xticklabel</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span>
                                        <span class="n">lons</span><span class="p">[</span><span class="n">val</span><span class="p">],</span> <span class="n">lons</span><span class="p">[</span><span class="n">val</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span>
                                    <span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                <span class="k">else</span><span class="p">:</span>
                                    <span class="n">xticklabel</span> <span class="o">=</span> <span class="n">xticks</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>

                                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                                    <span class="n">xpts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span>
                                    <span class="o">-</span><span class="n">spacing</span><span class="p">,</span>
                                    <span class="n">xticklabel</span><span class="p">,</span>
                                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
                                    <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span><span class="p">,</span>
                                    <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">,</span>
                                <span class="p">)</span>

    <span class="c1"># Draw lines along a latitude</span>
    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">yaxis</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)):</span>
                <span class="n">ipts</span> <span class="o">=</span> <span class="mf">359.0</span> <span class="o">/</span> <span class="n">degspacing</span>
                <span class="n">lata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ipts</span><span class="p">))</span> <span class="o">+</span> <span class="n">lats</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>
                <span class="n">lona</span> <span class="o">=</span> <span class="o">-</span><span class="mf">180.0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ipts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">degspacing</span>

                <span class="n">rotated_transform</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">RotatedPole</span><span class="p">(</span>
                    <span class="n">pole_latitude</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">pole_longitude</span><span class="o">=</span><span class="n">xpole</span>
                <span class="p">)</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">rotated_transform</span><span class="o">.</span><span class="n">transform_points</span><span class="p">(</span>
                    <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="n">lona</span><span class="p">,</span> <span class="n">lata</span>
                <span class="p">)</span>
                <span class="n">xout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span>
                <span class="n">yout</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)[:,</span> <span class="mi">1</span><span class="p">]</span>
                <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">grid_thickness</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">labels</span><span class="p">:</span>
                    <span class="c1"># Make a label unless the axis is all Nans</span>
                    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])):</span>
                        <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
                        <span class="n">loc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xpts</span> <span class="o">==</span> <span class="n">xmin</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">loc</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">loc</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">]):</span>
                                    <span class="n">line</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">lines</span><span class="o">.</span><span class="n">Line2D</span><span class="p">(</span>
                                        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">spacing</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                                        <span class="p">[</span><span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span> <span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">]],</span>
                                        <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                                    <span class="p">)</span>
                                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">add_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
                                    <span class="n">line</span><span class="o">.</span><span class="n">set_clip_on</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                                    <span class="n">fw</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span>
                                    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="n">yticklabel</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span>
                                            <span class="n">lats</span><span class="p">[</span><span class="n">val</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">val</span><span class="p">],</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span>
                                        <span class="p">)[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">yticklabel</span> <span class="o">=</span> <span class="n">yticks</span><span class="p">[</span><span class="n">val</span><span class="p">]</span>

                                    <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                                        <span class="o">-</span><span class="n">spacing</span><span class="p">,</span>
                                        <span class="n">ypts</span><span class="p">[</span><span class="n">loc</span><span class="p">],</span>
                                        <span class="n">yticklabel</span><span class="p">,</span>
                                        <span class="n">horizontalalignment</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
                                        <span class="n">verticalalignment</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                                        <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span><span class="p">,</span>
                                        <span class="n">fontweight</span><span class="o">=</span><span class="n">fw</span><span class="p">,</span>
                                    <span class="p">)</span>

    <span class="c1"># Reset yvec</span>
    <span class="n">yvec</span> <span class="o">=</span> <span class="n">yvec_orig</span></div>



<div class="viewcode-block" id="lineplot">
<a class="viewcode-back" href="../lineplot.html#cfplot.lineplot">[docs]</a>
<span class="k">def</span> <span class="nf">lineplot</span><span class="p">(</span>
    <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">lines</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">line_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ptype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">ylog</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">swap_xy</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">legend_location</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span>
    <span class="n">xunits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yunits</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yname</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">titles</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | The interface to line plotting in cf-plot.</span>
<span class="sd">    |</span>
<span class="sd">    | The minimum use is lineplot(f) where f is a CF field.</span>
<span class="sd">    | If x and y are passed then an appropriate plot is made allowing</span>
<span class="sd">    | x vs data and y vs data plots.</span>

<span class="sd">    | When making a labelled line plot:</span>
<span class="sd">    | always have a label for each line</span>
<span class="sd">    | always put the legend location as an option to the last call to lineplot</span>
<span class="sd">    |</span>
<span class="sd">    | f - CF data used to make a line plot</span>
<span class="sd">    | x - x locations of data in y</span>
<span class="sd">    | y - y locations of data in x</span>
<span class="sd">    | linestyle=&#39;-&#39; - line style</span>
<span class="sd">    | color=None - line color. Defaults to Matplotlib colour scheme</span>
<span class="sd">    |              unless specified</span>
<span class="sd">    | linewidth=1.0 - line width</span>
<span class="sd">    | marker=None - marker for points along the line</span>
<span class="sd">    | markersize=5.0 - size of the marker</span>
<span class="sd">    | markeredgecolor = &#39;k&#39; - colour of edge around the marker</span>
<span class="sd">    | markeredgewidth = 0.5 - width of edge around the marker</span>
<span class="sd">    | xlog=False - log x-axis</span>
<span class="sd">    | ylog=False - log y-axis</span>
<span class="sd">    | label=None - line label - label for line</span>
<span class="sd">    | legend_location=&#39;upper right&#39; - default location of legend</span>
<span class="sd">    |                 Other options are {&#39;best&#39;: 0, &#39;center&#39;: 10,</span>
<span class="sd">    |                                    &#39;center left&#39;: 6,</span>
<span class="sd">    |                                    &#39;center right&#39;: 7, &#39;lower center&#39;: 8,</span>
<span class="sd">    |                                    &#39;lower left&#39;: 3, &#39;lower right&#39;: 4,</span>
<span class="sd">    |                                    &#39;right&#39;: 5,</span>
<span class="sd">    |                                    &#39;upper center&#39;: 9, &#39;upper left&#39;: 2,</span>
<span class="sd">    |                                    &#39;upper right&#39;: 1}</span>
<span class="sd">    | titles=False - set to True to have a dimensions title</span>
<span class="sd">    | verbose=None - change to 1 to get a verbose listing of what lineplot</span>
<span class="sd">    |                is doing</span>
<span class="sd">    | zorder=None - plotting order</span>
<span class="sd">    |</span>
<span class="sd">    | The following parameters override any CF data defaults:</span>
<span class="sd">    | title=None - plot title</span>
<span class="sd">    | xunits=None - x units</span>
<span class="sd">    | yunits=None - y units</span>
<span class="sd">    | xlabel=None - x name</span>
<span class="sd">    | ylabel=None - y name</span>
<span class="sd">    | xname=None - deprecated keyword</span>
<span class="sd">    | yname=None - deprecated keyword</span>
<span class="sd">    | xticks=None - x ticks</span>
<span class="sd">    | xticklabels=None - x tick labels</span>
<span class="sd">    | yticks=None - y ticks</span>
<span class="sd">    | yticklabels - y tick labels</span>
<span class="sd">    | axes=True - plot x and y axes</span>
<span class="sd">    | xaxis=True - plot xaxis</span>
<span class="sd">    | yaxis=True - plot y axis</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    | When making a multiple line plot:</span>
<span class="sd">    | a) set the axis limits with gset before plotting the lines</span>
<span class="sd">    | b) the last call to lineplot is the one that any of the above</span>
<span class="sd">    |    axis overrides should be placed in.</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lineplot - making a line plot&quot;</span><span class="p">)</span>

    <span class="c1"># Catch deprecated keywords</span>
    <span class="k">if</span> <span class="n">xname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">yname</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">lineplot error</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;xname and yname are now deprecated keywords</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Please use xlabel and ylabel</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">return</span>

    <span class="c1">##################</span>
    <span class="c1"># Open a new plot is necessary</span>
    <span class="c1">##################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Call gpos(1) if not already called</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1">##################</span>
    <span class="c1"># Extract required data</span>
    <span class="c1"># If a cf-python field</span>
    <span class="c1">##################</span>
    <span class="n">cf_field</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
            <span class="n">cf_field</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Check data is 1D</span>
            <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
            <span class="k">if</span> <span class="n">ndims</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.lineplot error need a 1 dimensonal field to &quot;</span>
                    <span class="s2">&quot;make a line</span><span class="se">\n</span><span class="s2">&quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;received </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2"> dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.lineplot error - two or more cf-fields &quot;</span>
                        <span class="s2">&quot;passed for plotting.</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="s2">&quot;To plot two cf-fields open a graphics plot with &quot;</span>
                        <span class="s2">&quot;cfp.gopen(), </span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="s2">&quot;plot the two fields separately with cfp.lineplot &quot;</span>
                        <span class="s2">&quot;and then close</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="s2">&quot;the graphics plot with cfp.gclose()</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.lineplot - cannot plot a field list</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">xlabel_units</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">ylabel_units</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="n">cf_field</span><span class="p">:</span>
        <span class="c1"># Extract data</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lineplot - CF field, extracting data&quot;</span><span class="p">)</span>

        <span class="n">has_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dimension_coordinates</span><span class="p">()):</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">has_count</span> <span class="o">=</span> <span class="n">has_count</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

                <span class="c1"># x label</span>
                <span class="n">xlabel_units</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s2">&quot;Units&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span>
                <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">xlabel_units</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

                <span class="c1"># y label</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">):</span>
                    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span>
                <span class="n">nc</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">nc</span><span class="p">:</span>
                    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">):</span>
                    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">short_name</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;long_name&quot;</span><span class="p">):</span>
                    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">long_name</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">):</span>
                    <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">standard_name</span>

                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;Units&quot;</span><span class="p">):</span>
                    <span class="n">ylabel_units</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ylabel_units</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="n">plot_ylabel</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; (</span><span class="si">{</span><span class="n">ylabel_units</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="k">if</span> <span class="n">has_count</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n</span><span class="s2"> lineplot error - passed field is not suitable &quot;</span>
                <span class="s2">&quot;for plotting as a line</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">dimension_coordinates</span><span class="p">()):</span>
                <span class="n">sn</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="n">ln</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s2">&quot;long_name&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">sn</span><span class="p">:</span>
                    <span class="n">errstr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mydim</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">sn</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># TODO SLB: replace simple &#39;else, if&#39; statements such as</span>
                    <span class="c1"># this one, with many other examples in codebase, w/ &#39;elif&#39;</span>
                    <span class="k">if</span> <span class="n">ln</span><span class="p">:</span>
                        <span class="n">errstr</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mydim</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">ln</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lineplot - not a CF field, using passed data&quot;</span><span class="p">)</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;lineplot error- must define both x and y&quot;</span>
        <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">+=</span> <span class="p">(</span>
                <span class="s2">&quot;lineplot error- must define just x and y to make &quot;</span>
                <span class="s2">&quot;a lineplot&quot;</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">errstr</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="n">errstr</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Z on y-axis</span>
    <span class="n">ztype</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">xlabel_units</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;mb&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mbar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;millibar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;decibar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;atmosphere&quot;</span><span class="p">,</span>
        <span class="s2">&quot;atm&quot;</span><span class="p">,</span>
        <span class="s2">&quot;pascal&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Pa&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hPa&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="n">ztype</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">xlabel_units</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;meter&quot;</span><span class="p">,</span> <span class="s2">&quot;metre&quot;</span><span class="p">,</span> <span class="s2">&quot;m&quot;</span><span class="p">,</span> <span class="s2">&quot;kilometer&quot;</span><span class="p">,</span> <span class="s2">&quot;kilometre&quot;</span><span class="p">,</span> <span class="s2">&quot;km&quot;</span><span class="p">]:</span>
        <span class="n">ztype</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="n">myz</span> <span class="o">=</span> <span class="n">find_z</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cf_field</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="n">myz</span><span class="p">):</span>
        <span class="n">z_coord</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">myz</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">z_coord</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">zlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">z_coord</span><span class="p">,</span> <span class="s2">&quot;long_name&quot;</span><span class="p">):</span>
                <span class="n">zlabel</span> <span class="o">=</span> <span class="n">z_coord</span><span class="o">.</span><span class="n">long_name</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">z_coord</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">):</span>
                <span class="n">zlabel</span> <span class="o">=</span> <span class="n">z_coord</span><span class="o">.</span><span class="n">standard_name</span>
            <span class="k">if</span> <span class="n">zlabel</span> <span class="o">==</span> <span class="s2">&quot;atmosphere_hybrid_height_coordinate&quot;</span><span class="p">:</span>
                <span class="n">ztype</span> <span class="o">=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">ztype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">,</span> <span class="n">x</span>
        <span class="n">plot_xlabel</span><span class="p">,</span> <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">plot_ylabel</span><span class="p">,</span> <span class="n">plot_xlabel</span>

    <span class="c1"># Set data values</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lineplot - setting data values&quot;</span><span class="p">)</span>
    <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">ypts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">minx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># Use accumulated plot limits if making a multiple line plot</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span> <span class="o">=</span> <span class="n">minx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">minx</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span> <span class="o">=</span> <span class="n">minx</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span> <span class="o">=</span> <span class="n">maxx</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">maxx</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span> <span class="o">=</span> <span class="n">maxx</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span> <span class="o">=</span> <span class="n">miny</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">miny</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span> <span class="o">=</span> <span class="n">miny</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span> <span class="o">=</span> <span class="n">maxy</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">maxy</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span><span class="p">:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span> <span class="o">=</span> <span class="n">maxy</span>

    <span class="c1"># Reset plot limits based on accumulated plot limits</span>
    <span class="n">minx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmin</span>
    <span class="n">maxx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_xmax</span>
    <span class="n">miny</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymin</span>
    <span class="n">maxy</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">graph_ymax</span>

    <span class="k">if</span> <span class="n">cf_field</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
        <span class="n">taxis</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ztype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ztype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">cf_field</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">positive</span> <span class="o">==</span> <span class="s2">&quot;down&quot;</span><span class="p">:</span>
                <span class="n">miny</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
                <span class="n">maxy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># Use user set values if present</span>
    <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">minx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
        <span class="n">miny</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
        <span class="n">maxx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
        <span class="n">maxy</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

        <span class="c1"># Change from date string to a number if strings are passed</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">minx</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">time_xstr</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">float</span><span class="p">(</span><span class="n">miny</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="n">time_ystr</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">if</span> <span class="n">cf_field</span> <span class="ow">and</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
            <span class="n">taxis</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time_xstr</span> <span class="ow">or</span> <span class="n">time_ystr</span><span class="p">:</span>
                <span class="n">ref_time</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
                <span class="n">ref_calendar</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
                <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">time_xstr</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">minx</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">minx</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">maxx</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">maxx</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">),</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">)],</span>
                        <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">time_ystr</span><span class="p">:</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">miny</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">miny</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">maxy</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
                    <span class="n">maxy</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">array</span>
                    <span class="n">taxis</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span> <span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">)],</span>
                        <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">,</span>
                    <span class="p">)</span>

    <span class="c1"># Set x and y labelling</span>
    <span class="c1"># Retrieve any user defined axis labels</span>
    <span class="k">if</span> <span class="n">plot_xlabel</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span>
    <span class="k">if</span> <span class="n">plot_ylabel</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">xticks</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">yticks</span><span class="p">))</span>

    <span class="n">mod</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">ymult</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plot_xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;lon&quot;</span><span class="p">:</span>
            <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot_xlabel</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;lat&quot;</span><span class="p">:</span>
            <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">_mapaxis</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">cf_field</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">has_construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="p">,</span> <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="n">_timeaxis</span><span class="p">(</span><span class="n">taxis</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xticks</span><span class="p">,</span> <span class="n">ymult</span> <span class="o">=</span> <span class="n">_gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">minx</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">maxx</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">)</span>

        <span class="c1"># Fix long floating point numbers if necessary</span>
        <span class="n">fix_floats</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
        <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">xticks</span><span class="p">:</span>
                <span class="n">xticklabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">maxy</span> <span class="o">-</span> <span class="n">miny</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">miny</span> <span class="o">&lt;</span> <span class="n">maxy</span><span class="p">:</span>
                <span class="n">yticks</span><span class="p">,</span> <span class="n">ymult</span> <span class="o">=</span> <span class="n">_gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">miny</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">maxy</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">maxy</span> <span class="o">&lt;</span> <span class="n">miny</span><span class="p">:</span>
                <span class="n">yticks</span><span class="p">,</span> <span class="n">ymult</span> <span class="o">=</span> <span class="n">_gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">maxy</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">miny</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">yticks</span><span class="p">,</span> <span class="n">ymult</span> <span class="o">=</span> <span class="n">_gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">miny</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">maxy</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="n">mod</span><span class="p">)</span>

            <span class="c1"># Fix long floating point numbers if necessary</span>
            <span class="n">fix_floats</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yticklabels</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">yticks</span><span class="p">:</span>
            <span class="n">yticklabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="mi">9</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
        <span class="k">if</span> <span class="n">xunits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_xlabel</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">xunits</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>
        <span class="k">if</span> <span class="n">yunits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">plot_ylabel</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">yunits</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">if</span> <span class="n">swap_xy</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lineplot - swapping x and y&quot;</span><span class="p">)</span>

        <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">xpts</span>
        <span class="n">minx</span><span class="p">,</span> <span class="n">miny</span> <span class="o">=</span> <span class="n">miny</span><span class="p">,</span> <span class="n">minx</span>
        <span class="n">maxx</span><span class="p">,</span> <span class="n">maxy</span> <span class="o">=</span> <span class="n">maxy</span><span class="p">,</span> <span class="n">maxx</span>
        <span class="n">plot_xlabel</span><span class="p">,</span> <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="n">plot_ylabel</span><span class="p">,</span> <span class="n">plot_xlabel</span>
        <span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span> <span class="o">=</span> <span class="n">yticks</span><span class="p">,</span> <span class="n">xticks</span>
        <span class="n">xticklabels</span><span class="p">,</span> <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">yticklabels</span><span class="p">,</span> <span class="n">xticklabels</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">time_xstr</span> <span class="ow">is</span> <span class="kc">False</span> <span class="ow">and</span> <span class="n">time_ystr</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">minx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">maxx</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
            <span class="n">miny</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">maxy</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

    <span class="k">if</span> <span class="n">axes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">xaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
            <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">if</span> <span class="n">yaxis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">yticks</span>
            <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
        <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">xticks</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100000000</span><span class="p">]</span>
        <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">yticks</span>
        <span class="n">plot_xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">plot_ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Generate titles if requested</span>
    <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
        <span class="n">title_dims</span> <span class="o">=</span> <span class="n">generate_titles</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

    <span class="c1"># Make graph</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;lineplot - making graph&quot;</span><span class="p">)</span>

    <span class="n">xlabelalignment</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_align</span>
    <span class="n">ylabelalignment</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_align</span>

    <span class="k">if</span> <span class="n">lines</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">0.0</span>

    <span class="n">colorarg</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">colorarg</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;color&quot;</span><span class="p">:</span> <span class="n">color</span><span class="p">}</span>

    <span class="n">graph</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">twinx</span><span class="p">:</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        <span class="n">ylabelalignment</span> <span class="o">=</span> <span class="s2">&quot;left&quot;</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">twiny</span><span class="p">:</span>
        <span class="n">graph</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">twiny</span><span class="p">()</span>

    <span class="c1"># Reset y limits if minx = maxy</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">miny</span> <span class="o">==</span> <span class="n">maxy</span><span class="p">:</span>
            <span class="n">miny</span> <span class="o">=</span> <span class="n">miny</span> <span class="o">-</span> <span class="mf">1.0</span>
            <span class="n">maxy</span> <span class="o">=</span> <span class="n">maxy</span> <span class="o">+</span> <span class="mf">1.0</span>

    <span class="n">graph</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="n">miny</span><span class="p">,</span> <span class="n">maxy</span><span class="p">])</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">direction</span><span class="o">=</span><span class="s2">&quot;out&quot;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
        <span class="n">plot_xlabel</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">graph</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
        <span class="n">plot_ylabel</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
        <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span> <span class="ow">or</span> <span class="n">xlog</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="ow">or</span> <span class="n">ylog</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span>
            <span class="n">xticklabels</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xtick_label_rotation</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">xlabelalignment</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span>
            <span class="n">yticklabels</span><span class="p">,</span>
            <span class="n">rotation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ytick_label_rotation</span><span class="p">,</span>
            <span class="n">horizontalalignment</span><span class="o">=</span><span class="n">ylabelalignment</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">graph</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
        <span class="n">xpts</span><span class="p">,</span>
        <span class="n">ypts</span><span class="p">,</span>
        <span class="o">**</span><span class="n">colorarg</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">,</span>
        <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
        <span class="n">markersize</span><span class="o">=</span><span class="n">markersize</span><span class="p">,</span>
        <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">markeredgecolor</span><span class="p">,</span>
        <span class="n">markeredgewidth</span><span class="o">=</span><span class="n">markeredgewidth</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span>
        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span>
    <span class="p">)</span>

    <span class="c1"># Set axis width if required</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">axis</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">,</span> <span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;right&quot;</span><span class="p">]:</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span><span class="o">.</span><span class="n">set_linewidth</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_width</span><span class="p">)</span>

    <span class="c1"># Add a legend if needed</span>
    <span class="k">if</span> <span class="n">label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">legend_properties</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;size&quot;</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_size</span><span class="p">,</span>
            <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">legend_text_weight</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
            <span class="n">loc</span><span class="o">=</span><span class="n">legend_location</span><span class="p">,</span>
            <span class="n">prop</span><span class="o">=</span><span class="n">legend_properties</span><span class="p">,</span>
            <span class="n">frameon</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_edge_color</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">legend_frame_face_color</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Set title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">graph</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span><span class="p">,</span>
            <span class="n">fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Titles for dimensions</span>
    <span class="k">if</span> <span class="n">titles</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">=</span> <span class="n">graph</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">_dim_titles</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title_dims</span><span class="p">)</span>

    <span class="c1">##################</span>
    <span class="c1"># Save or view plot</span>
    <span class="c1">##################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Saving or viewing plot&quot;</span><span class="p">)</span>
        <span class="n">gclose</span><span class="p">()</span></div>



<div class="viewcode-block" id="traj">
<a class="viewcode-back" href="../traj.html#cfplot.traj">[docs]</a>
<span class="k">def</span> <span class="nf">traj</span><span class="p">(</span>
    <span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ptype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">linecolor</span><span class="o">=</span><span class="s2">&quot;b&quot;</span><span class="p">,</span>
    <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span>
    <span class="n">markevery</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">markersize</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
    <span class="n">markerfacecolor</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
    <span class="n">markeredgecolor</span><span class="o">=</span><span class="s2">&quot;g&quot;</span><span class="p">,</span>
    <span class="n">markeredgewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">latmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">latmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">legend_lines</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span>
    <span class="n">colorbar_title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_text_up_down</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">colorbar_text_down_up</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">colorbar_drawedges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">colorbar_fraction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_thick</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_shrink</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">colorbar_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">vector</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">head_width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>
    <span class="n">head_length</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
    <span class="n">fc</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">ec</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | The interface to trajectory plotting in cf-plot.</span>
<span class="sd">    |</span>
<span class="sd">    | The minimum use is traj(f) where f is a CF field.</span>
<span class="sd">    |</span>
<span class="sd">    | f - CF data used to make a line plot</span>
<span class="sd">    | linestyle=&#39;-&#39; - line style</span>
<span class="sd">    | linecolor=&#39;b&#39; - line colour</span>
<span class="sd">    | linewidth=1.0 - line width</span>
<span class="sd">    | marker=&#39;o&#39; - marker for points along the line</span>
<span class="sd">    | markersize=30 - size of the marker</span>
<span class="sd">    | markerfacecolor=&#39;b&#39; - colour of the marker face</span>
<span class="sd">    | markeredgecolor=&#39;g&#39; - colour of the marker edge</span>
<span class="sd">    | legend=False - plot different colour markers based on a set of user</span>
<span class="sd">    |                levels</span>
<span class="sd">    | zorder=None - order for plotting</span>
<span class="sd">    | verbose=None - Set to True to get a verbose listing of what traj is doing</span>
<span class="sd">    |</span>
<span class="sd">    | The following parameters override any CF data defaults:</span>
<span class="sd">    | title=None - plot title</span>
<span class="sd">    | axes=True - plot x and y axes</span>
<span class="sd">    | xaxis=True - plot xaxis</span>
<span class="sd">    | yaxis=True - plot y axis</span>
<span class="sd">    | xlabel=None - x name</span>
<span class="sd">    | ylabel=None - y name</span>
<span class="sd">    | xticks=None - x ticks</span>
<span class="sd">    | xticklabels=None - x tick labels</span>
<span class="sd">    | yticks=None - y ticks</span>
<span class="sd">    | yticklabels=None - y tick labels</span>
<span class="sd">    | colorbar=None - plot a colorbar</span>
<span class="sd">    | colorbar_position=None - position of colorbar</span>
<span class="sd">    |                          [xmin, ymin, x_extent,y_extent] in normalised</span>
<span class="sd">    |                          coordinates. Use when a common colorbar</span>
<span class="sd">    |                          is required for a set of plots. A typical set</span>
<span class="sd">    |                          of values would be [0.1, 0.05, 0.8, 0.02]</span>
<span class="sd">    | colorbar_orientation=None - orientation of the colorbar</span>
<span class="sd">    | colorbar_title=None - title for the colorbar</span>
<span class="sd">    | colorbar_text_up_down=False - if True horizontal colour bar labels</span>
<span class="sd">    |                               alternate above (start) and below the</span>
<span class="sd">    |                               colour bar</span>
<span class="sd">    | colorbar_text_down_up=False - if True horizontal colour bar labels</span>
<span class="sd">    |                               alternate below (start) and above the</span>
<span class="sd">    |                               colour bar</span>
<span class="sd">    | colorbar_drawedges=True - draw internal divisions in the colorbar</span>
<span class="sd">    | colorbar_fraction=None - space for the colorbar - default = 0.21, in</span>
<span class="sd">    |                          normalised coordinates</span>
<span class="sd">    | colorbar_thick=None - thickness of the colorbar - default = 0.015, in</span>
<span class="sd">    |                       normalised coordinates</span>
<span class="sd">    | colorbar_anchor=None - default=0.5 - anchor point of colorbar within</span>
<span class="sd">    |                        the fraction space. 0.0 = close to plot,</span>
<span class="sd">    |                        1.0 = further away</span>
<span class="sd">    | colorbar_shrink=None - value to shrink the colorbar by.  If the colorbar</span>
<span class="sd">    |                        exceeds the plot area then values of 1.0, 0.55</span>
<span class="sd">    |                        or 0.5m ay help it better fit the plot area.</span>
<span class="sd">    | colorbar_labels=None - labels for the colorbar. Default is to use the</span>
<span class="sd">    |                        levels defined</span>
<span class="sd">    |                        using cfp.levs</span>
<span class="sd">    | Vector options</span>
<span class="sd">    | vector=False - Draw vectors</span>
<span class="sd">    | head_width=2.0 - vector head width</span>
<span class="sd">    | head_length=2.0 - vector head length</span>
<span class="sd">    | fc=&#39;k&#39; - vector face colour</span>
<span class="sd">    | ec=&#39;k&#39; - vector edge colour</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;traj - making a trajectory plot&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.traj - cannot make a trajectory plot from a field list &quot;</span>
            <span class="s2">&quot;- need to pass a field</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="c1"># Read in data</span>
    <span class="c1"># Find the auxiliary lons and lats if provided</span>
    <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">auxiliary_coordinates</span><span class="p">()):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;longitude&quot;</span><span class="p">]:</span>
            <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="n">has_lons</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;latitude&quot;</span><span class="p">]:</span>
            <span class="n">lats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="n">has_lats</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">data</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">array</span>

    <span class="c1"># Raise an error if lons and lats not found in the input data</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">has_lons</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">has_lats</span><span class="p">:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">traj error</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_lons</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;missing longitudes in the field auxiliary data</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">has_lats</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;missing latitudes in the field auxiliary data</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">message</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n\n\n</span><span class="s2">&quot;</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">latmax</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&gt;=</span> <span class="n">latmax</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="k">if</span> <span class="n">latmin</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&lt;=</span> <span class="n">latmin</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Set potential user axis labels</span>
    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>

    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Set plotting parameters</span>
    <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="n">continent_color</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
    <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="s2">&quot;-&quot;</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span>
    <span class="n">land_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">land_color</span>
    <span class="n">ocean_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ocean_color</span>
    <span class="n">lake_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lake_color</span>

    <span class="c1">##################</span>
    <span class="c1"># Open a new plot is necessary</span>
    <span class="c1">##################</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Call gpos(1) if not already called</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Set up mapping</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">180</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">=</span> <span class="mi">180</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span> <span class="o">=</span> <span class="o">-</span><span class="mi">90</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">=</span> <span class="mi">90</span>

    <span class="n">_set_map</span><span class="p">()</span>
    <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>

    <span class="c1"># Set the plot limits</span>
    <span class="n">gset</span><span class="p">(</span>
        <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span>
        <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span>
        <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span>
        <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span>
        <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Make lons and lats 2d if they are 1d</span>
    <span class="n">ndim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">lons</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">lats</span> <span class="o">=</span> <span class="n">lats</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">ntracks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lons</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">ntracks</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">legend</span> <span class="ow">or</span> <span class="n">legend_lines</span><span class="p">:</span>
        <span class="c1"># Check levels are not None</span>
        <span class="n">levs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;traj - plotting different colour markers based on a &quot;</span>
                    <span class="s2">&quot;user set of levels&quot;</span>
                <span class="p">)</span>
            <span class="n">levs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Automatic levels</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;traj - generating automatic legend levels&quot;</span><span class="p">)</span>
            <span class="n">dmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">dmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">levs</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">_gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">dmax</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Add extend options to the levels if set</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
            <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="o">-</span><span class="mf">1e-30</span><span class="p">,</span> <span class="n">levs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
            <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">levs</span><span class="p">,</span> <span class="mf">1e30</span><span class="p">)</span>

        <span class="c1"># Set the default colour scale</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># User selected colour map but no mods so fit to levels</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cscale</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs_user</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">cscale_flag</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1">##################################</span>
    <span class="c1"># Line, symbol and vector plotting</span>
    <span class="c1">##################################</span>
    <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ntracks</span><span class="p">):</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">ypts</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">data2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>

        <span class="n">xpts_orig</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
        <span class="n">xpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">xpts</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>

        <span class="c1"># Check if xpts are only within the remapped longitudes above</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">170</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">170</span><span class="p">:</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">xpts_orig</span>

            <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">diff</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">diff</span> <span class="o">&gt;=</span> <span class="mi">60</span><span class="p">:</span>
                    <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">360.0</span>
                <span class="k">if</span> <span class="n">diff</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mi">60</span><span class="p">:</span>
                    <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xpts</span><span class="p">[</span><span class="n">ix</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span>

        <span class="c1"># Plot lines and markers</span>
        <span class="n">plot_linewidth</span> <span class="o">=</span> <span class="n">linewidth</span>
        <span class="n">plot_markersize</span> <span class="o">=</span> <span class="n">markersize</span>
        <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>
            <span class="n">plot_markersize</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">if</span> <span class="n">plot_linewidth</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">or</span> <span class="n">plot_markersize</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">track</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">linewidth</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plotting lines&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">track</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">markersize</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plotting markers&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">legend_lines</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
                <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                    <span class="n">xpts</span><span class="p">,</span>
                    <span class="n">ypts</span><span class="p">,</span>
                    <span class="n">color</span><span class="o">=</span><span class="n">linecolor</span><span class="p">,</span>
                    <span class="n">linewidth</span><span class="o">=</span><span class="n">plot_linewidth</span><span class="p">,</span>
                    <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                    <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                    <span class="n">markevery</span><span class="o">=</span><span class="n">markevery</span><span class="p">,</span>
                    <span class="n">markersize</span><span class="o">=</span><span class="n">plot_markersize</span><span class="p">,</span>
                    <span class="n">markerfacecolor</span><span class="o">=</span><span class="n">markerfacecolor</span><span class="p">,</span>
                    <span class="n">markeredgecolor</span><span class="o">=</span><span class="n">markeredgecolor</span><span class="p">,</span>
                    <span class="n">markeredgewidth</span><span class="o">=</span><span class="n">markeredgewidth</span><span class="p">,</span>
                    <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                    <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                    <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">line_xpts</span> <span class="o">=</span> <span class="n">xpts</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
                <span class="n">line_ypts</span> <span class="o">=</span> <span class="n">ypts</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>
                <span class="n">line_data</span> <span class="o">=</span> <span class="n">data2</span><span class="o">.</span><span class="n">compressed</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">line_xpts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">val</span> <span class="o">=</span> <span class="p">(</span><span class="n">line_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">line_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span>

                    <span class="n">col</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">val</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">))]</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                        <span class="n">line_xpts</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">line_ypts</span><span class="p">[</span><span class="n">i</span><span class="p">:</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">],</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">col</span><span class="p">,</span>
                        <span class="n">linewidth</span><span class="o">=</span><span class="n">plot_linewidth</span><span class="p">,</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="n">linestyle</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">zorder</span><span class="p">,</span>
                        <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="p">)</span>

        <span class="c1"># Plot vectors</span>
        <span class="k">if</span> <span class="n">vector</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span> <span class="ow">and</span> <span class="n">track</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;plotting vectors&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">plot_zorder</span> <span class="o">=</span> <span class="mi">101</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">plot_zorder</span> <span class="o">=</span> <span class="n">zorder</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;cyl&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">xpts</span><span class="o">.</span><span class="n">size</span>

                <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">pts</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="n">mymap</span><span class="o">.</span><span class="n">arrow</span><span class="p">(</span>
                        <span class="n">xpts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span>
                        <span class="n">ypts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span>
                        <span class="n">xpts</span><span class="p">[</span><span class="n">pt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">xpts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span>
                        <span class="n">ypts</span><span class="p">[</span><span class="n">pt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">ypts</span><span class="p">[</span><span class="n">pt</span><span class="p">],</span>
                        <span class="n">head_width</span><span class="o">=</span><span class="n">head_width</span><span class="p">,</span>
                        <span class="n">head_length</span><span class="o">=</span><span class="n">head_length</span><span class="p">,</span>
                        <span class="n">fc</span><span class="o">=</span><span class="n">fc</span><span class="p">,</span>
                        <span class="n">ec</span><span class="o">=</span><span class="n">ec</span><span class="p">,</span>
                        <span class="n">length_includes_head</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">plot_zorder</span><span class="p">,</span>
                        <span class="n">clip_on</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                    <span class="p">)</span>

    <span class="c1"># Plot different colour markers based on a user set of levels</span>
    <span class="k">if</span> <span class="n">legend</span><span class="p">:</span>

        <span class="c1"># For polar stereographic plots mask any points outside the</span>
        <span class="c1"># plotting limb</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;npstere&quot;</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;spstere&quot;</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">lats</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">for</span> <span class="n">track</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ntracks</span><span class="p">):</span>
            <span class="n">xpts</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">ypts</span> <span class="o">=</span> <span class="n">lats</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">data2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">track</span><span class="p">,</span> <span class="p">:]</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">is_masked</span><span class="p">(</span><span class="n">data2</span><span class="p">):</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">data2</span> <span class="o">&gt;=</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data2</span> <span class="o">&lt;=</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">data2</span> <span class="o">&gt;=</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">data2</span> <span class="o">&lt;=</span> <span class="n">levs</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span>
                    <span class="p">)</span>

                <span class="k">if</span> <span class="n">zorder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">plot_zorder</span> <span class="o">=</span> <span class="mi">101</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">plot_zorder</span> <span class="o">=</span> <span class="n">zorder</span>
                <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>

                    <span class="n">mymap</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                        <span class="n">xpts</span><span class="p">[</span><span class="n">pts</span><span class="p">],</span>
                        <span class="n">ypts</span><span class="p">[</span><span class="n">pts</span><span class="p">],</span>
                        <span class="n">s</span><span class="o">=</span><span class="n">markersize</span> <span class="o">*</span> <span class="mi">15</span><span class="p">,</span>
                        <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                        <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">,</span>
                        <span class="n">edgecolors</span><span class="o">=</span><span class="n">markeredgecolor</span><span class="p">,</span>
                        <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span>
                        <span class="n">zorder</span><span class="o">=</span><span class="n">plot_zorder</span><span class="p">,</span>
                    <span class="p">)</span>

    <span class="c1"># Axes</span>
    <span class="n">_plot_map_axes</span><span class="p">(</span>
        <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
        <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
        <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span>
        <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
        <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span>
        <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
        <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span>
        <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Coastlines</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;land&quot;</span><span class="p">,</span>
        <span class="n">category</span><span class="o">=</span><span class="s2">&quot;physical&quot;</span><span class="p">,</span>
        <span class="n">scale</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
        <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span>
        <span class="n">feature</span><span class="p">,</span>
        <span class="n">edgecolor</span><span class="o">=</span><span class="n">continent_color</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="n">continent_linestyle</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">ocean_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span>
            <span class="n">cfeature</span><span class="o">.</span><span class="n">OCEAN</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;face&quot;</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="n">ocean_color</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">land_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span>
            <span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;face&quot;</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="n">land_color</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="k">if</span> <span class="n">lake_color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span>
            <span class="n">cfeature</span><span class="o">.</span><span class="n">LAKES</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;face&quot;</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="n">lake_color</span><span class="p">,</span>
            <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">feature_zorder</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1"># Title</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1"># Color bar</span>
    <span class="n">plot_colorbar</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="n">colorbar</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">legend</span><span class="p">:</span>
        <span class="n">plot_colorbar</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">colorbar</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">legend_lines</span><span class="p">:</span>
        <span class="n">plot_colorbar</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">colorbar</span><span class="p">:</span>
        <span class="n">plot_colorbar</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">plot_colorbar</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">colorbar_title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s2">&quot;No Name&quot;</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;id&quot;</span><span class="p">):</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">id</span>
            <span class="n">nc</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">nc</span><span class="p">:</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">nc_get_variable</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;short_name&quot;</span><span class="p">):</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">short_name</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;long_name&quot;</span><span class="p">):</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">long_name</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;standard_name&quot;</span><span class="p">):</span>
                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">standard_name</span>

            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s2">&quot;Units&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
                    <span class="n">colorbar_title</span> <span class="o">+=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">colorbar_title</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="n">_supscr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">))</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="n">levs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>
        <span class="k">if</span> <span class="n">colorbar_labels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">levs</span> <span class="o">=</span> <span class="n">colorbar_labels</span>
        <span class="n">cbar</span><span class="p">(</span>
            <span class="n">levs</span><span class="o">=</span><span class="n">levs</span><span class="p">,</span>
            <span class="n">labels</span><span class="o">=</span><span class="n">levs</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="n">colorbar_orientation</span><span class="p">,</span>
            <span class="n">position</span><span class="o">=</span><span class="n">colorbar_position</span><span class="p">,</span>
            <span class="n">text_up_down</span><span class="o">=</span><span class="n">colorbar_text_up_down</span><span class="p">,</span>
            <span class="n">text_down_up</span><span class="o">=</span><span class="n">colorbar_text_down_up</span><span class="p">,</span>
            <span class="n">drawedges</span><span class="o">=</span><span class="n">colorbar_drawedges</span><span class="p">,</span>
            <span class="n">fraction</span><span class="o">=</span><span class="n">colorbar_fraction</span><span class="p">,</span>
            <span class="n">thick</span><span class="o">=</span><span class="n">colorbar_thick</span><span class="p">,</span>
            <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">,</span>
            <span class="n">anchor</span><span class="o">=</span><span class="n">colorbar_anchor</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="c1">##########</span>
    <span class="c1"># Save plot</span>
    <span class="c1">##########</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gclose</span><span class="p">()</span></div>



<div class="viewcode-block" id="cbar">
<a class="viewcode-back" href="../cbar.html#cfplot.cbar">[docs]</a>
<span class="k">def</span> <span class="nf">cbar</span><span class="p">(</span>
    <span class="n">labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">orientation</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">shrink</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fraction</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fontsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">fontweight</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">text_up_down</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">text_down_up</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">drawedges</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">levs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">thick</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">anchor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">extend</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">mid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | The cf-plot interface to the Matplotlib colorbar routine.</span>
<span class="sd">    |</span>
<span class="sd">    | labels - colorbar labels</span>
<span class="sd">    | orientation - orientation &#39;horizontal&#39; or &#39;vertical&#39;</span>
<span class="sd">    | position - user specified colorbar position in normalised</span>
<span class="sd">    |            plot coordinates [left, bottom, width, height]</span>
<span class="sd">    | shrink - default=1.0 - scale colorbar along length</span>
<span class="sd">    | fraction - default = 0.21 - space for the colorbar in</span>
<span class="sd">    |            normalised plot coordinates</span>
<span class="sd">    | title - title for the colorbar</span>
<span class="sd">    | fontsize - font size for the colorbar text</span>
<span class="sd">    | fontweight - font weight for the colorbar text</span>
<span class="sd">    | text_up_down - label division text up and down starting with up</span>
<span class="sd">    | text_down_up - label division text down and up starting with down</span>
<span class="sd">    | drawedges - Draw internal delimeter lines in colorbar</span>
<span class="sd">    | levs - colorbar levels</span>
<span class="sd">    | thick - set height of colorbar - default = 0.015,</span>
<span class="sd">    |         in normalised plot coordinates</span>
<span class="sd">    | anchor - default=0.3 - anchor point of colorbar within the fraction</span>
<span class="sd">    |                        space. 0.0 = close to plot, 1.0 = further away</span>
<span class="sd">    | extend = None - extensions for colorbar. The default is for</span>
<span class="sd">    |                 extensions at both ends.</span>
<span class="sd">    | mid = False - label mid points of colours rather than the boundaries</span>
<span class="sd">    | verbose = None</span>
<span class="sd">    |</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;con - adding a colour bar&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontsize</span>
    <span class="k">if</span> <span class="n">fontweight</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fontweight</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">colorbar_fontweight</span>
    <span class="k">if</span> <span class="n">thick</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">thick</span> <span class="o">=</span> <span class="mf">0.012</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">thick</span> <span class="o">=</span> <span class="mf">0.008</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">thick</span> <span class="o">=</span> <span class="mf">0.005</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">thick</span> <span class="o">=</span> <span class="mf">0.003</span>
    <span class="k">if</span> <span class="n">drawedges</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">drawedges</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">orientation</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">orientation</span> <span class="o">=</span> <span class="s2">&quot;horizontal&quot;</span>
    <span class="k">if</span> <span class="n">fraction</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fraction</span> <span class="o">=</span> <span class="mf">0.12</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="mf">0.08</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="mf">0.06</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">fraction</span> <span class="o">=</span> <span class="mf">0.04</span>

    <span class="k">if</span> <span class="n">shrink</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">shrink</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">if</span> <span class="n">anchor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">anchor</span> <span class="o">=</span> <span class="mf">0.3</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">anchor</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="c1"># Code for when the user specifies nlevs to the contour command rather than</span>
    <span class="c1"># letting cf-plot work out some levels</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">levs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">myplot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">myplot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

        <span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="kn">import</span> <span class="n">make_axes_locatable</span>

        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">myplot</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span>
                    <span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span>
                    <span class="s2">&quot;bottom&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span>
                <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;2%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

        <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">image</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span>
        <span class="p">)</span>

        <span class="k">return</span>

    <span class="c1"># Change plot position based on colorbar location</span>
    <span class="k">if</span> <span class="n">position</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># Work out whether the plot is a map plot or normal plot</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
            <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;rotated&quot;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s2">&quot;UKCP&quot;</span>
        <span class="p">):</span>
            <span class="n">this_plot</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span>

        <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span>

        <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&gt;</span> <span class="mi">1</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="o">==</span> <span class="mi">0</span>
                <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span>
                <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;cyl&quot;</span><span class="p">,</span> <span class="s2">&quot;lcc&quot;</span><span class="p">,</span> <span class="s2">&quot;moll&quot;</span><span class="p">,</span> <span class="s2">&quot;merc&quot;</span><span class="p">,</span> <span class="s2">&quot;ortho&quot;</span><span class="p">,</span> <span class="s2">&quot;robin&quot;</span><span class="p">]</span>
            <span class="p">):</span>
                <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">+</span> <span class="n">fraction</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">fraction</span><span class="p">])</span>

            <span class="c1"># if plotvars.plot_type == 1 and plotvars.proj == &#39;cyl&#39;:</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="s2">&quot;cyl&quot;</span><span class="p">,</span>
                <span class="s2">&quot;lcc&quot;</span><span class="p">,</span>
                <span class="s2">&quot;moll&quot;</span><span class="p">,</span>
                <span class="s2">&quot;merc&quot;</span><span class="p">,</span>
                <span class="s2">&quot;ortho&quot;</span><span class="p">,</span>
                <span class="s2">&quot;robin&quot;</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="c1"># Move plot up if aspect ratio is &lt; 1.5</span>
                <span class="n">lonrange</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
                <span class="n">latrange</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">/</span> <span class="n">latrange</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">1.5</span><span class="p">:</span>
                    <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">+</span> <span class="mf">0.08</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mf">0.12</span><span class="p">])</span>
                    <span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="n">this_plot</span><span class="o">.</span><span class="n">get_position</span><span class="p">()</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>

                <span class="n">ax1</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">left</span> <span class="o">+</span> <span class="n">width</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">shrink</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                        <span class="n">bottom</span> <span class="o">-</span> <span class="n">fraction</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">anchor</span><span class="p">),</span>
                        <span class="n">width</span> <span class="o">*</span> <span class="n">shrink</span><span class="p">,</span>
                        <span class="n">thick</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span>
                    <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span> <span class="o">+</span> <span class="n">fraction</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="n">fraction</span><span class="p">])</span>

                <span class="n">ax1</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span>
                    <span class="p">[</span>
                        <span class="n">left</span> <span class="o">+</span> <span class="n">width</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">shrink</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                        <span class="c1"># b - fraction * (1.0 - anchor),</span>
                        <span class="n">bottom</span><span class="p">,</span>
                        <span class="n">width</span> <span class="o">*</span> <span class="n">shrink</span><span class="p">,</span>
                        <span class="n">thick</span><span class="p">,</span>
                    <span class="p">]</span>
                <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span>
                <span class="p">[</span>
                    <span class="n">left</span> <span class="o">+</span> <span class="n">width</span> <span class="o">+</span> <span class="n">fraction</span> <span class="o">*</span> <span class="p">(</span><span class="n">anchor</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
                    <span class="n">bottom</span> <span class="o">+</span> <span class="n">height</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">-</span> <span class="n">shrink</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span>
                    <span class="n">thick</span><span class="p">,</span>
                    <span class="n">height</span> <span class="o">*</span> <span class="n">shrink</span><span class="p">,</span>
                <span class="p">]</span>
            <span class="p">)</span>
            <span class="n">this_plot</span><span class="o">.</span><span class="n">set_position</span><span class="p">(</span>
                <span class="p">[</span><span class="n">left</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span> <span class="n">width</span> <span class="o">-</span> <span class="n">fraction</span><span class="p">,</span> <span class="n">height</span><span class="p">])</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Set axes position on coords supplied by the user</span>
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">levs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cbar error - No levels or labels supplied </span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">levs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">levs</span>

    <span class="c1"># Work out colour bar labeling</span>
    <span class="n">lbot</span> <span class="o">=</span> <span class="n">levs</span>
    <span class="k">if</span> <span class="n">text_up_down</span><span class="p">:</span>
        <span class="n">lbot</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[</span><span class="mi">1</span><span class="p">:][::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ltop</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">text_down_up</span><span class="p">:</span>
        <span class="n">lbot</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[::</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ltop</span> <span class="o">=</span> <span class="n">levs</span><span class="p">[</span><span class="mi">1</span><span class="p">:][::</span><span class="mi">2</span><span class="p">]</span>

    <span class="c1"># Get the colour map</span>
    <span class="n">colmap</span> <span class="o">=</span> <span class="n">_cscale_get_map</span><span class="p">()</span>
    <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">colmap</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">extend</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">extend</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span>

    <span class="n">ncolors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">levs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span> <span class="ow">or</span> <span class="n">extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
        <span class="n">ncolors</span> <span class="o">=</span> <span class="n">ncolors</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">levs</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span>
            <span class="n">boundaries</span><span class="o">=</span><span class="n">levs</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="n">ncolors</span>
        <span class="p">)</span>

        <span class="c1"># Change boundaries to floats</span>
        <span class="n">boundaries</span> <span class="o">=</span> <span class="n">levs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># Add colorbar extensions if definded by levs.  Using boundaries[0]-1</span>
        <span class="c1"># for the lower and boundaries[-1]+1 is just for the colorbar and</span>
        <span class="c1"># has no meaning for the plot.</span>
        <span class="k">if</span> <span class="n">extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="ow">or</span> <span class="n">extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="n">boundaries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">boundaries</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">boundaries</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="ow">or</span> <span class="n">extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
            <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">boundaries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span>
                <span class="n">boundaries</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">boundaries</span><span class="p">),</span> <span class="n">boundaries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">mid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lbot_new</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
                <span class="n">mid_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">lbot</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lbot</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">lbot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">lbot_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mid_point</span><span class="p">)</span>
            <span class="n">lbot</span> <span class="o">=</span> <span class="n">lbot_new</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">levs</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">lbot</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span>
            <span class="n">ax1</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
            <span class="n">extend</span><span class="o">=</span><span class="n">extend</span><span class="p">,</span>
            <span class="n">extendfrac</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
            <span class="n">boundaries</span><span class="o">=</span><span class="n">boundaries</span><span class="p">,</span>
            <span class="n">ticks</span><span class="o">=</span><span class="n">lbot</span><span class="p">,</span>
            <span class="n">spacing</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
            <span class="n">drawedges</span><span class="o">=</span><span class="n">drawedges</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>

        <span class="k">if</span> <span class="n">mid</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">lbot_new</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)):</span>
                <span class="n">mid_point</span> <span class="o">=</span> <span class="p">(</span><span class="n">lbot</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">lbot</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">lbot</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">lbot_new</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mid_point</span><span class="p">)</span>
            <span class="n">lbot</span> <span class="o">=</span> <span class="n">lbot_new</span>

        <span class="n">ax1</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_axes</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
        <span class="n">colorbar</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span>
            <span class="n">ax1</span><span class="p">,</span>
            <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>
            <span class="n">norm</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">norm</span><span class="p">,</span>
            <span class="n">extend</span><span class="o">=</span><span class="n">extend</span><span class="p">,</span>
            <span class="n">extendfrac</span><span class="o">=</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span>
            <span class="n">boundaries</span><span class="o">=</span><span class="n">boundaries</span><span class="p">,</span>
            <span class="n">ticks</span><span class="o">=</span><span class="n">lbot</span><span class="p">,</span>
            <span class="n">spacing</span><span class="o">=</span><span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
            <span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span><span class="p">,</span>
            <span class="n">drawedges</span><span class="o">=</span><span class="n">drawedges</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="n">colorbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">)</span>

    <span class="c1"># Bug in Matplotlib colorbar labelling</span>
    <span class="c1"># With clevs=[-1, 1, 10000, 20000, 30000, 40000, 50000, 60000]</span>
    <span class="c1"># Labels are [0, 2, 10001, 20001, 30001, 40001, 50001, 60001]</span>
    <span class="c1"># With a +1 near to the colorbar label</span>

    <span class="c1"># Check for an extraneous level compared to the levs</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">levs</span><span class="p">):</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="n">labels</span><span class="p">[:</span> <span class="nb">len</span><span class="p">(</span><span class="n">levs</span><span class="p">)]</span>

    <span class="n">colorbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s2">&quot;horizontal&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklines</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">fontweight</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">tick</span> <span class="ow">in</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklines</span><span class="p">():</span>
            <span class="n">tick</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">fontweight</span><span class="p">)</span>

    <span class="c1"># Alternate text top and bottom on a horizontal colorbar if requested</span>
    <span class="c1"># Use method described at:</span>
    <span class="c1"># https://stackoverflow.com/questions/37161022/matplotlib-colorbar-</span>
    <span class="c1"># alternating-top-bottom-labels</span>
    <span class="k">if</span> <span class="n">text_up_down</span> <span class="ow">or</span> <span class="n">text_down_up</span><span class="p">:</span>

        <span class="n">vmin</span> <span class="o">=</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">vmin</span>
        <span class="n">vmax</span> <span class="o">=</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">norm</span><span class="o">.</span><span class="n">vmax</span>

        <span class="k">if</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">extend</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span><span class="p">:</span>
            <span class="n">shift_l</span> <span class="o">=</span> <span class="mf">0.05</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="mf">0.95</span>
        <span class="k">elif</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">extend</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span><span class="p">:</span>
            <span class="n">shift_l</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="mf">0.95</span>
        <span class="k">elif</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">extend</span> <span class="o">==</span> <span class="s2">&quot;both&quot;</span><span class="p">:</span>
            <span class="n">shift_l</span> <span class="o">=</span> <span class="mf">0.05</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="mf">0.9</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shift_l</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># Print bottom tick labels</span>
        <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">lbot</span><span class="p">)</span>

        <span class="c1"># Print top tick labels</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="n">ltop</span><span class="p">:</span>
            <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="n">shift_l</span> <span class="o">+</span> <span class="n">scaling</span> <span class="o">*</span> <span class="p">(</span><span class="n">ii</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">vmax</span> <span class="o">-</span> <span class="n">vmin</span><span class="p">),</span>
                <span class="mf">1.5</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">ii</span><span class="p">),</span>
                <span class="n">transform</span><span class="o">=</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span>
                <span class="n">va</span><span class="o">=</span><span class="s2">&quot;bottom&quot;</span><span class="p">,</span>
                <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span>
                <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">,</span>
                <span class="n">fontweight</span><span class="o">=</span><span class="n">fontweight</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">colorbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">fontweight</span><span class="p">)</span></div>



<div class="viewcode-block" id="add_cyclic">
<a class="viewcode-back" href="../add_cyclic.html#cfplot.add_cyclic">[docs]</a>
<span class="k">def</span> <span class="nf">add_cyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">lons</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | A wrapper for `cartopy_util.add_cyclic_point(field, lons)`.</span>
<span class="sd">    |</span>
<span class="sd">    | This is needed for the case of when the longitudes are not evenly spaced</span>
<span class="sd">    | due to numpy rounding which causes an error from the cartopy wrapping</span>
<span class="sd">    | routine. In this case the longitudes are promoted to 64 bit and then</span>
<span class="sd">    | rounded to an appropriate number of decimal places before passing to</span>
<span class="sd">    | the cartopy add_cyclic routine.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">field</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="n">cartopy_util</span><span class="o">.</span><span class="n">add_cyclic_point</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">lons</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">ndecs_max</span> <span class="o">=</span> <span class="n">max_ndecs_data</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
        <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">ndecs_max</span><span class="p">)</span>
        <span class="n">field</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="n">cartopy_util</span><span class="o">.</span><span class="n">add_cyclic_point</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">lons</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">field</span><span class="p">,</span> <span class="n">lons</span></div>



<span class="k">def</span> <span class="nf">irregular_window</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;TODO DOCS.&quot;&quot;&quot;</span>

    <span class="n">field_irregular</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span>
    <span class="n">lats_irregular</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span>

    <span class="c1"># Fix longitudes to be -180 to 180</span>
    <span class="c1"># lons_irregular = (</span>
    <span class="c1">#     (lons_irregular + plotvars.lonmin) % 360) + plotvars.lonmin</span>

    <span class="c1"># Test data to get appropiate longitude offset to perform remapping</span>
    <span class="n">found_lon</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">ilon</span> <span class="ow">in</span> <span class="p">[</span><span class="o">-</span><span class="mi">360</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">]:</span>
        <span class="n">lons_test</span> <span class="o">=</span> <span class="n">lons_irregular</span> <span class="o">+</span> <span class="n">ilon</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lons_test</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">:</span>
            <span class="n">found_lon</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">lons_offset</span> <span class="o">=</span> <span class="n">ilon</span>

    <span class="k">if</span> <span class="n">found_lon</span><span class="p">:</span>
        <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">lons_irregular</span> <span class="o">+</span> <span class="n">lons_offset</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons_irregular</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span>
        <span class="n">lons_irregular</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">lons_irregular</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">+</span> <span class="mf">360.0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
            <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cf-plot error - cannot determine grid offset in &quot;</span>
            <span class="s2">&quot;add_cyclic_irregular</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

    <span class="n">field_wrap</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field_irregular</span><span class="p">)</span>
    <span class="n">lons_wrap</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lons_irregular</span><span class="p">)</span>
    <span class="n">lats_wrap</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">lats_irregular</span><span class="p">)</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="mf">120.0</span>

    <span class="n">pts_left</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons_wrap</span> <span class="o">&gt;=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">+</span> <span class="mi">360</span> <span class="o">-</span> <span class="n">delta</span><span class="p">)</span>
    <span class="n">lons_left</span> <span class="o">=</span> <span class="n">lons_wrap</span><span class="p">[</span><span class="n">pts_left</span><span class="p">]</span> <span class="o">-</span> <span class="mf">360.0</span>
    <span class="n">lats_left</span> <span class="o">=</span> <span class="n">lats_wrap</span><span class="p">[</span><span class="n">pts_left</span><span class="p">]</span>
    <span class="n">field_left</span> <span class="o">=</span> <span class="n">field_wrap</span><span class="p">[</span><span class="n">pts_left</span><span class="p">]</span>

    <span class="n">field_wrap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">field_wrap</span><span class="p">,</span> <span class="n">field_left</span><span class="p">])</span>
    <span class="n">lons_wrap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons_wrap</span><span class="p">,</span> <span class="n">lons_left</span><span class="p">])</span>
    <span class="n">lats_wrap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lats_wrap</span><span class="p">,</span> <span class="n">lats_left</span><span class="p">])</span>

    <span class="c1"># Make a line of interpolated data on left hand side of plot and insert</span>
    <span class="c1"># this into the data on both the left and the right before contouring</span>
    <span class="n">lons_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span> <span class="o">+</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
    <span class="n">lats_new</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span> <span class="o">-</span> <span class="mi">90</span>
    <span class="n">field_new</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span>
        <span class="p">(</span><span class="n">lons_wrap</span><span class="p">,</span> <span class="n">lats_wrap</span><span class="p">),</span>
        <span class="n">field_wrap</span><span class="p">,</span>
        <span class="p">(</span><span class="n">lons_new</span><span class="p">,</span> <span class="n">lats_new</span><span class="p">),</span>
        <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Remove any non finite points in the interpolated data</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">field_new</span><span class="p">))</span>
    <span class="n">field_new</span> <span class="o">=</span> <span class="n">field_new</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
    <span class="n">lons_new</span> <span class="o">=</span> <span class="n">lons_new</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
    <span class="n">lats_new</span> <span class="o">=</span> <span class="n">lats_new</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>

    <span class="c1"># Add the interpolated data to the left</span>
    <span class="n">field_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">field_irregular</span><span class="p">,</span> <span class="n">field_new</span><span class="p">])</span>
    <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons_irregular</span><span class="p">,</span> <span class="n">lons_new</span><span class="p">])</span>
    <span class="n">lats_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lats_irregular</span><span class="p">,</span> <span class="n">lats_new</span><span class="p">])</span>

    <span class="c1"># Add to the right if a fiull globe is being plotted</span>
    <span class="c1"># The 359.99 here is needed or Cartopy will map 360 back to 0</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span> <span class="o">-</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">==</span> <span class="mi">360</span><span class="p">:</span>
        <span class="n">field_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">field_irregular</span><span class="p">,</span> <span class="n">field_new</span><span class="p">])</span>
        <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons_irregular</span><span class="p">,</span> <span class="n">lons_new</span> <span class="o">+</span> <span class="mf">359.95</span><span class="p">])</span>
        <span class="n">lats_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lats_irregular</span><span class="p">,</span> <span class="n">lats_new</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lons_new2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span> <span class="o">+</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
        <span class="n">lats_new2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">181</span><span class="p">)</span> <span class="o">-</span> <span class="mi">90</span>
        <span class="n">field_new2</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span>
            <span class="p">(</span><span class="n">lons_wrap</span><span class="p">,</span> <span class="n">lats_wrap</span><span class="p">),</span>
            <span class="n">field_wrap</span><span class="p">,</span>
            <span class="p">(</span><span class="n">lons_new2</span><span class="p">,</span> <span class="n">lats_new2</span><span class="p">),</span>
            <span class="n">method</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Remove any non finite points in the interpolated data</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">field_new2</span><span class="p">))</span>
        <span class="n">field_new2</span> <span class="o">=</span> <span class="n">field_new2</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
        <span class="n">lons_new2</span> <span class="o">=</span> <span class="n">lons_new2</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
        <span class="n">lats_new2</span> <span class="o">=</span> <span class="n">lats_new2</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>

        <span class="c1"># Add the interpolated data to the right</span>
        <span class="n">field_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">field_irregular</span><span class="p">,</span> <span class="n">field_new2</span><span class="p">])</span>
        <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons_irregular</span><span class="p">,</span> <span class="n">lons_new2</span><span class="p">])</span>
        <span class="n">lats_irregular</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lats_irregular</span><span class="p">,</span> <span class="n">lats_new2</span><span class="p">])</span>

    <span class="c1"># Finally remove any point off to the right of plotvars.lonmax</span>
    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons_irregular</span> <span class="o">&lt;=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">field_irregular</span> <span class="o">=</span> <span class="n">field_irregular</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
        <span class="n">lons_irregular</span> <span class="o">=</span> <span class="n">lons_irregular</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>
        <span class="n">lats_irregular</span> <span class="o">=</span> <span class="n">lats_irregular</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">field_irregular</span><span class="p">,</span> <span class="n">lons_irregular</span><span class="p">,</span> <span class="n">lats_irregular</span>


<div class="viewcode-block" id="max_ndecs_data">
<a class="viewcode-back" href="../max_ndecs_data.html#cfplot.max_ndecs_data">[docs]</a>
<span class="k">def</span> <span class="nf">max_ndecs_data</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;TODO DOCS.&quot;&quot;&quot;</span>

    <span class="n">ndecs_max</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">data_ndecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">data_ndecs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">ndecs_max</span><span class="p">:</span>
        <span class="c1"># Reset large decimal vales to zero</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_ndecs</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">data_ndecs</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ndecs_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">ndecs_max</span></div>



<div class="viewcode-block" id="fix_floats">
<a class="viewcode-back" href="../fix_floats.html#cfplot.fix_floats">[docs]</a>
<span class="k">def</span> <span class="nf">fix_floats</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Fixes numpy rounding issues where 0.4 becomes 0.399999999999999999999.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Return unchecked if any values have an e in them, for example 7.85e-8</span>
    <span class="n">has_e</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">if</span> <span class="s2">&quot;e&quot;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">):</span>
            <span class="n">has_e</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">if</span> <span class="n">has_e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">data</span>

    <span class="n">data_ndecs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
        <span class="n">data_ndecs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">if</span> <span class="nb">max</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>
        <span class="c1"># Reset large decimal vales to zero</span>
        <span class="k">if</span> <span class="nb">min</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_ndecs</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">)</span>
            <span class="n">data_ndecs</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">ndecs_max</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">data_ndecs</span><span class="p">))</span>
            <span class="c1"># Reset to new ndecs_max decimal places</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
                <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ndecs_max</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># fix to two or more decimal places</span>
            <span class="n">nd</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">data_range</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="n">data_temp</span> <span class="o">=</span> <span class="n">data</span>

            <span class="k">while</span> <span class="n">data_range</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">:</span>
                <span class="n">data_temp</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_temp</span><span class="p">)):</span>
                    <span class="n">data_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">data_temp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">nd</span><span class="p">)</span>

                <span class="n">data_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data_temp</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data_temp</span><span class="p">)</span>
                <span class="n">nd</span> <span class="o">=</span> <span class="n">nd</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">data_temp</span>

    <span class="k">return</span> <span class="n">data</span></div>



<div class="viewcode-block" id="calculate_levels">
<a class="viewcode-back" href="../calculate_levels.html#cfplot.calculate_levels">[docs]</a>
<span class="k">def</span> <span class="nf">calculate_levels</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">level_spacing</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;TODO DOCS.&quot;&quot;&quot;</span>

    <span class="n">dmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
    <span class="n">dmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="n">tight</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">field2</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># User defined</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;cfp.calculate_levels - using user defined contour levels&quot;</span><span class="p">)</span>
        <span class="n">clevs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">fmult</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Automatic levels</span>
            <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">fmult</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="s2">&quot;cfp.calculate_levels - generating automatic contour &quot;</span>
                    <span class="s2">&quot;levels&quot;</span>
                <span class="p">)</span>

            <span class="k">if</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s2">&quot;outlier&quot;</span> <span class="ow">or</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s2">&quot;inspect&quot;</span><span class="p">:</span>
                <span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="mi">100</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
                <span class="n">rate</span> <span class="o">=</span> <span class="mf">0.01</span>

                <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">hist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rate</span><span class="p">:</span>
                        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">==</span> <span class="n">dmin</span><span class="p">)</span>
                        <span class="n">field2</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">dmax</span>
                        <span class="n">dmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">field2</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">hist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rate</span><span class="p">:</span>
                        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">==</span> <span class="n">dmax</span><span class="p">)</span>
                        <span class="n">field2</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span> <span class="o">=</span> <span class="n">dmin</span>
                        <span class="n">dmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">field2</span><span class="p">)</span>

                <span class="n">clevs</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">_gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">dmax</span><span class="p">)</span>
                <span class="n">fmult</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="n">mult</span>
                <span class="n">tight</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s2">&quot;linear&quot;</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedConstant</span>
                <span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">dmax</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">MaskedConstant</span><span class="p">):</span>
                    <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="s2">&quot;cf-plot calculate_levels error - data is entirely &quot;</span>
                        <span class="s2">&quot;masked</span><span class="se">\n</span><span class="s2">&quot;</span>
                        <span class="s2">&quot;setting levels to 0 and 0.1 to produce a plot&quot;</span>
                    <span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
                    <span class="n">dmin</span> <span class="o">=</span> <span class="mf">0.0</span>
                    <span class="n">dmax</span> <span class="o">=</span> <span class="mf">0.1</span>

                <span class="n">clevs</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">_gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">dmax</span><span class="p">)</span>
                <span class="n">fmult</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**-</span><span class="n">mult</span>
                <span class="n">tight</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">if</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span> <span class="ow">or</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s2">&quot;loglike&quot;</span><span class="p">:</span>

                <span class="k">if</span> <span class="n">dmin</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">dmax</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">dmin1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmax</span><span class="p">)</span>
                    <span class="n">dmax1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmin</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dmin</span> <span class="o">&gt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">dmax</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">dmin1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmin</span><span class="p">)</span>
                    <span class="n">dmax1</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmax</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">dmin</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">dmax</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">dmax1</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">dmin</span><span class="p">),</span> <span class="n">dmax</span><span class="p">)</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
                    <span class="n">close_below</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>
                    <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">field</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
                    <span class="n">close_above</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="n">pts</span><span class="p">])</span>
                    <span class="n">dmin1</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">close_below</span><span class="p">),</span> <span class="n">close_above</span><span class="p">)</span>

                <span class="c1"># Generate levels</span>
                <span class="k">if</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s2">&quot;log&quot;</span><span class="p">:</span>
                    <span class="n">clevs</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">31</span><span class="p">):</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mf">30.0</span><span class="p">)</span>
                        <span class="n">clevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.0e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>

                <span class="k">if</span> <span class="n">level_spacing</span> <span class="o">==</span> <span class="s2">&quot;loglike&quot;</span><span class="p">:</span>
                    <span class="n">clevs</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">61</span><span class="p">):</span>
                        <span class="n">val</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mf">30.0</span><span class="p">)</span>
                        <span class="n">clevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.0e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
                        <span class="n">clevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.0e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="mi">2</span><span class="p">))</span>
                        <span class="n">clevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{:.0e}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="mi">5</span><span class="p">))</span>
                    <span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>

                <span class="c1"># Remove out of range levels</span>
                <span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
                <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">clevs</span> <span class="o">&gt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmin1</span><span class="p">),</span> <span class="n">clevs</span> <span class="o">&lt;=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dmax1</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="n">clevs</span> <span class="o">=</span> <span class="n">clevs</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">dmin</span> <span class="o">&lt;</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">dmax</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">clevs</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">clevs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

                <span class="k">if</span> <span class="n">dmin</span> <span class="o">&lt;=</span> <span class="mf">0.0</span> <span class="ow">and</span> <span class="n">dmax</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">clevs</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">clevs</span><span class="p">])</span>

    <span class="c1"># Use step to generate the levels</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="s2">&quot;calculate_levels - using specified step to generate &quot;</span>
                <span class="s2">&quot;contour levels&quot;</span>
            <span class="p">)</span>

        <span class="n">step</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">dmin</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dmin</span><span class="p">)</span>
            <span class="n">dmax</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dmax</span><span class="p">)</span>

        <span class="n">fmult</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">mult</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">clevs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="n">dmin</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">clevs</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">dmin</span> <span class="o">/</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="o">-</span><span class="n">step</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">dmax</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">clevs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dmax</span> <span class="o">/</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">clevs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">dmax</span> <span class="o">/</span> <span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">step</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">clevs</span> <span class="o">=</span> <span class="n">clevs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="c1"># Remove any out of data range values</span>
    <span class="k">if</span> <span class="n">tight</span><span class="p">:</span>
        <span class="n">pts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">clevs</span> <span class="o">&gt;=</span> <span class="n">dmin</span><span class="p">,</span> <span class="n">clevs</span> <span class="o">&lt;=</span> <span class="n">dmax</span><span class="p">))</span>
        <span class="n">clevs</span> <span class="o">=</span> <span class="n">clevs</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span>

    <span class="c1"># Add an extra contour level if less than two levels are present</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">clevs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clevs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.001</span><span class="p">)</span>

    <span class="c1"># Test for large numer of decimal places and fix if necessary</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clevs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">clevs</span> <span class="o">=</span> <span class="n">fix_floats</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="n">mult</span><span class="p">,</span> <span class="n">fmult</span><span class="p">)</span></div>



<div class="viewcode-block" id="stream">
<a class="viewcode-back" href="../stream.html#cfplot.stream">[docs]</a>
<span class="k">def</span> <span class="nf">stream</span><span class="p">(</span>
    <span class="n">u</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">v</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">arrowsize</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">arrowstyle</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">minlength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">maxlength</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">axes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">xaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">yaxis</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">xticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">yticklabels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">zorder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Plot a streamplot to show fluid flow and 2D field gradients.</span>
<span class="sd">    |</span>
<span class="sd">    | u=None - u wind</span>
<span class="sd">    | v=None - v wind</span>
<span class="sd">    | x=None - x locations of u and v</span>
<span class="sd">    | y=None - y locations of u and v</span>
<span class="sd">    | density=None - controls the closeness of streamlines. When density = 1,</span>
<span class="sd">    |                the domain is divided into a 30x30 grid</span>
<span class="sd">    | linewidth=None - the width of the stream lines. With a 2D array the</span>
<span class="sd">    |                  line width can be varied across the grid. The array</span>
<span class="sd">    |                  must have the same shape as u and v</span>
<span class="sd">    | color=None - the streamline color</span>
<span class="sd">    | arrowsize=None - scaling factor for the arrow size</span>
<span class="sd">    | arrowstyle=None - arrow style specification</span>
<span class="sd">    | minlength=None - minimum length of streamline in axes coordinates</span>
<span class="sd">    | maxlength=None - maximum length of streamline in axes coordinates</span>
<span class="sd">    | axes=True - plot x and y axes</span>
<span class="sd">    | xaxis=True - plot xaxis</span>
<span class="sd">    | yaxis=True - plot y axis</span>
<span class="sd">    | xticks=None - xtick positions</span>
<span class="sd">    | xticklabels=None - xtick labels</span>
<span class="sd">    | yticks=None - y tick positions</span>
<span class="sd">    | yticklabels=None - ytick labels</span>
<span class="sd">    | xlabel=None - label for x axis</span>
<span class="sd">    | ylabel=None - label for y axis</span>
<span class="sd">    | title=None - title for plot</span>
<span class="sd">    | zorder=None - plotting order</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">text_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
    <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
    <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
    <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">text_fontsize</span> <span class="o">=</span> <span class="mi">11</span>
    <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
    <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
    <span class="n">title_fontsize</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
    <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">title_fontsize</span> <span class="o">=</span> <span class="mi">15</span>
    <span class="n">resolution_orig</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span>
    <span class="n">rotated_vect</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Set potential user axis labels</span>
    <span class="n">user_xlabel</span> <span class="o">=</span> <span class="n">xlabel</span>
    <span class="n">user_ylabel</span> <span class="o">=</span> <span class="n">ylabel</span>

    <span class="c1"># Set any additional arguments to streamplot</span>
    <span class="n">plotargs</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">density</span>
    <span class="k">if</span> <span class="n">linewidth</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s2">&quot;linewidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">linewidth</span>
    <span class="k">if</span> <span class="n">color</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s2">&quot;color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">color</span>
    <span class="k">if</span> <span class="n">arrowsize</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s2">&quot;arrowsize&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrowsize</span>
    <span class="k">if</span> <span class="n">arrowstyle</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s2">&quot;arrowstyle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">arrowstyle</span>
    <span class="k">if</span> <span class="n">minlength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s2">&quot;minlength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minlength</span>
    <span class="k">if</span> <span class="n">maxlength</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotargs</span><span class="p">[</span><span class="s2">&quot;maxlength&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxlength</span>

    <span class="c1"># Extract required data</span>
    <span class="c1"># If a cf-python field</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

        <span class="c1"># Check data is 2D</span>
        <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndims</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.vect error need a 2 dimensonal u field to make &quot;</span>
                <span class="s2">&quot;vectors</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;received </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ndims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimension</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="p">(</span>
            <span class="n">u_data</span><span class="p">,</span>
            <span class="n">u_x</span><span class="p">,</span>
            <span class="n">u_y</span><span class="p">,</span>
            <span class="n">ptype</span><span class="p">,</span>
            <span class="n">colorbar_title</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="p">,</span>
            <span class="n">xpole</span><span class="p">,</span>
            <span class="n">ypole</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">_cf_data_assign</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">rotated_vect</span><span class="o">=</span><span class="n">rotated_vect</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t plot a field list&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># field=f #field data passed in as f</span>
        <span class="n">_check_data</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">u_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">u_x</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">u_y</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>

        <span class="c1"># Check data is 2D</span>
        <span class="n">ndims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span>
        <span class="k">if</span> <span class="n">ndims</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">cfp.vect error need a 2 dimensonal v field to make &quot;</span>
                <span class="s2">&quot;vectors</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;received </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="n">ndims</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimension</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">+=</span> <span class="s2">&quot; dimensions</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

        <span class="p">(</span>
            <span class="n">v_data</span><span class="p">,</span>
            <span class="n">v_x</span><span class="p">,</span>
            <span class="n">v_y</span><span class="p">,</span>
            <span class="n">ptype</span><span class="p">,</span>
            <span class="n">colorbar_title</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="p">,</span>
            <span class="n">xpole</span><span class="p">,</span>
            <span class="n">ypole</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">=</span> <span class="n">_cf_data_assign</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">rotated_vect</span><span class="o">=</span><span class="n">rotated_vect</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">FieldList</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t plot a field list&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># field=f #field data passed in as f</span>
        <span class="n">_check_data</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">v_data</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="c1"># Reset xlabel and ylabel values with user defined labels in specified</span>
    <span class="k">if</span> <span class="n">user_xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">user_xlabel</span>
    <span class="k">if</span> <span class="n">user_ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">user_ylabel</span>

    <span class="c1"># Retrieve any user defined axis labels</span>
    <span class="k">if</span> <span class="n">xlabel</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xlabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span>
    <span class="k">if</span> <span class="n">ylabel</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ylabel</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span>
    <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">xticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">xticks</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">yticks</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yticklabels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">yticks</span><span class="p">))</span>

    <span class="c1"># Open a new plot if necessary</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Call gpos(1) if not already called</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">gpos_called</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="n">gpos</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Set plot type if user specified</span>
    <span class="k">if</span> <span class="n">ptype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">=</span> <span class="n">ptype</span>

    <span class="n">lonrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
    <span class="n">latrange</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Set up mapping</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">and</span> <span class="n">latrange</span> <span class="o">&gt;</span> <span class="mi">170</span><span class="p">)</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">_set_map</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mapset</span><span class="p">(</span>
                <span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">),</span>
                <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">),</span>
                <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">_set_map</span><span class="p">()</span>

        <span class="n">mymap</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>

    <span class="c1"># Map streamplot</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

        <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">streamplot</span><span class="p">(</span>
            <span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_data</span><span class="p">,</span> <span class="n">v_data</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">(),</span> <span class="o">**</span><span class="n">plotargs</span>
        <span class="p">)</span>

        <span class="c1"># axes</span>
        <span class="n">_plot_map_axes</span><span class="p">(</span>
            <span class="n">axes</span><span class="o">=</span><span class="n">axes</span><span class="p">,</span>
            <span class="n">xaxis</span><span class="o">=</span><span class="n">xaxis</span><span class="p">,</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="n">yaxis</span><span class="p">,</span>
            <span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span>
            <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>
            <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span>
            <span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span><span class="p">,</span>
            <span class="n">user_xlabel</span><span class="o">=</span><span class="n">user_xlabel</span><span class="p">,</span>
            <span class="n">user_ylabel</span><span class="o">=</span><span class="n">user_ylabel</span><span class="p">,</span>
            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Coastlines</span>
        <span class="n">continent_thickness</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
        <span class="n">continent_color</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
        <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_linestyle</span>
        <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_thickness</span> <span class="o">=</span> <span class="mf">1.5</span>
        <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_color</span> <span class="o">=</span> <span class="s2">&quot;k&quot;</span>
        <span class="k">if</span> <span class="n">continent_linestyle</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">continent_linestyle</span> <span class="o">=</span> <span class="s2">&quot;solid&quot;</span>

        <span class="n">feature</span> <span class="o">=</span> <span class="n">cfeature</span><span class="o">.</span><span class="n">NaturalEarthFeature</span><span class="p">(</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;land&quot;</span><span class="p">,</span>
            <span class="n">category</span><span class="o">=</span><span class="s2">&quot;physical&quot;</span><span class="p">,</span>
            <span class="n">scale</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
            <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">mymap</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span>
            <span class="n">feature</span><span class="p">,</span>
            <span class="n">edgecolor</span><span class="o">=</span><span class="n">continent_color</span><span class="p">,</span>
            <span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span>
            <span class="n">linestyle</span><span class="o">=</span><span class="n">continent_linestyle</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Title</span>
        <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_map_title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>

    <span class="c1">##########</span>
    <span class="c1"># Save plot</span>
    <span class="c1">##########</span>
    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">gset</span><span class="p">()</span>
        <span class="n">cscale</span><span class="p">()</span>
        <span class="n">gclose</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">mapset</span><span class="p">()</span>
        <span class="n">mapset</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution_orig</span><span class="p">)</span></div>



<span class="k">def</span> <span class="nf">generate_titles</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a set of title dims to put at the top of plots.&quot;&quot;&quot;</span>

    <span class="n">mycoords</span> <span class="o">=</span> <span class="n">find_dim_names</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="c1"># TODO SLB, see &#39;well_formed&#39; dead code below in case this is important.</span>
    <span class="c1"># For now, us &#39;noqa&#39; to prevent PEP8 F841 being raised due to lack of use.</span>
    <span class="n">well_formed</span> <span class="o">=</span> <span class="n">check_well_formed</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>  <span class="c1"># noqa: F841</span>

    <span class="n">title_dims</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">idim</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mycoords</span><span class="p">)):</span>
            <span class="n">mycoord</span> <span class="o">=</span> <span class="n">mycoords</span><span class="p">[</span><span class="n">idim</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">mycoord</span> <span class="o">==</span> <span class="s2">&quot;Z&quot;</span><span class="p">:</span>
                <span class="n">mycoord</span> <span class="o">=</span> <span class="n">find_z</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="n">title</span><span class="p">,</span> <span class="n">units</span> <span class="o">=</span> <span class="n">cf_var_name_titles</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">mycoord</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">array</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                <span class="n">title_dims</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mycoord</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">units</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">construct</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">dtarray</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">values</span><span class="p">)</span><span class="o">.</span><span class="n">datetime_as_string</span><span class="p">)</span>
                <span class="n">title_dims</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mycoord</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">title_dims</span> <span class="o">+=</span> <span class="s2">&quot;cell_methods: &quot;</span>
            <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">()[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">get_axes</span><span class="p">())</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">axis</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">()[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="c1"># Change domainaxis0 etc to an axis</span>
                        <span class="n">myid</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">constructs</span><span class="o">.</span><span class="n">domain_axis_identity</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                        <span class="n">myid</span> <span class="o">=</span> <span class="n">axis</span>

                    <span class="n">value</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">()[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">has_method</span><span class="p">():</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">()[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">get_method</span><span class="p">()</span>

                    <span class="n">qualifiers</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">cell_methods</span><span class="p">()[</span><span class="n">method</span><span class="p">]</span><span class="o">.</span><span class="n">qualifiers</span><span class="p">()</span>
                    <span class="n">qualifier_text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">qualifiers</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">qualifier_text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">qualifiers</span><span class="p">)</span>

                    <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">title_dims</span> <span class="o">+=</span> <span class="s2">&quot;, &quot;</span>

                    <span class="n">title_dims</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">myid</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">qualifier_text</span><span class="si">}</span><span class="s2">&quot;</span>

                    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">title_dims</span>


<span class="k">def</span> <span class="nf">check_well_formed</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Check the coordinates are all of the form X, Y, Z, T.</span>

<span class="sd">    returns boolean</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">coords</span><span class="p">())</span>
    <span class="n">mycoords</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">coords</span><span class="p">)):</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
            <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Y&quot;</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Z&quot;</span>
        <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;T&quot;</span>

    <span class="c1"># Check if the coordtinates are all of the form X, Y, Z, T</span>
    <span class="n">well_formed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">dimension_coords</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;dimensioncoordinate0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dimensioncoordinate1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dimensioncoordinate2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;dimensioncoordinate3&quot;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">dimension_coords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="ow">in</span> <span class="n">mycoords</span><span class="p">:</span>
            <span class="n">well_formed</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">well_formed</span>


<span class="k">def</span> <span class="nf">find_dim_names</span><span class="p">(</span><span class="n">field</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the field dimension coordinate names.</span>
<span class="sd">    Ignores auxiliary coordinates (for now).</span>

<span class="sd">    returns:</span>
<span class="sd">    coordinates in the order [T, X, Y, Z]</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Get the field domain axes</span>
    <span class="n">daxes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">get_data_axes</span><span class="p">())</span>

    <span class="c1"># Get the field coordinates</span>
    <span class="n">dcoords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">coords</span><span class="p">())</span>

    <span class="c1"># Calculate the number of coordinates of type X, Y, Z and T</span>
    <span class="n">nx</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ny</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nz</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">nt</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dcoords</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="n">nx</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
            <span class="n">ny</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="n">nz</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="n">nt</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="c1"># New test</span>
    <span class="n">remove_aux</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Strip out any auxiliary coordinates if the field is not a</span>
    <span class="c1"># trajectory field</span>
    <span class="k">if</span> <span class="n">remove_aux</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dcoords</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;auxiliarycoordinate&quot;</span><span class="p">:</span>
                <span class="n">dcoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;aux&quot;</span>
        <span class="n">dcoords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">((</span><span class="s2">&quot;aux&quot;</span><span class="p">)</span><span class="o">.</span><span class="fm">__ne__</span><span class="p">,</span> <span class="n">dcoords</span><span class="p">))</span>

    <span class="c1"># Convert these into corresponding dimension coordinates</span>
    <span class="k">if</span> <span class="n">remove_aux</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daxes</span><span class="p">)):</span>
            <span class="n">val</span> <span class="o">=</span> <span class="n">daxes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">coord</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dcoords</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">val</span> <span class="o">==</span> <span class="n">field</span><span class="o">.</span><span class="n">get_data_axes</span><span class="p">(</span><span class="n">dcoords</span><span class="p">[</span><span class="n">j</span><span class="p">])[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="n">coord</span> <span class="o">=</span> <span class="n">dcoords</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>

            <span class="k">if</span> <span class="n">coord</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">coords</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">errstr</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="s2">&quot;find_data_names error  - cannot find a coordinate for &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">val</span><span class="si">}</span><span class="se">\n</span><span class="s2">in the data</span><span class="se">\n</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">coords</span> <span class="o">=</span> <span class="n">dcoords</span>

    <span class="c1"># Make a copy of coords in mycoords</span>
    <span class="n">mycoords</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>

    <span class="c1"># Convert to X, Y, Z, T if coordinate is one of these</span>
    <span class="c1"># If the number of coordinates of this type is greater than 1 then don&#39;t</span>
    <span class="c1"># do this as f.coord(&#39;Z&#39;) gives an</span>
    <span class="c1"># error as there are more that one coordinates to return</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">daxes</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">X</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nx</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;X&quot;</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">Y</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ny</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Y&quot;</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nz</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Z&quot;</span>
        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nt</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">mycoords</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;T&quot;</span>

    <span class="c1"># Return the reverse of the coordinates so that they are in the</span>
    <span class="c1"># order [X, Y, Z, T]</span>
    <span class="n">mycoords</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">mycoords</span>


<span class="k">def</span> <span class="nf">find_z</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the Z coordinate if it exists.&quot;&quot;&quot;</span>

    <span class="c1"># Return if f is undefined</span>
    <span class="k">if</span> <span class="n">f</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="n">myz</span> <span class="o">=</span> <span class="s2">&quot;Z&quot;</span>
    <span class="n">mycoords</span> <span class="o">=</span> <span class="n">find_dim_names</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">myz</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">mycoord</span> <span class="ow">in</span> <span class="n">mycoords</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="n">mycoord</span><span class="p">)</span><span class="o">.</span><span class="n">Z</span><span class="p">:</span>
            <span class="n">myz</span> <span class="o">=</span> <span class="n">mycoord</span>

    <span class="k">return</span> <span class="n">myz</span>


<span class="k">def</span> <span class="nf">orca_check</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check input data to see if it is an orca ocean grid.</span>

<span class="sd">    We look for a single discontinuity in longitude where the data changes by</span>
<span class="sd">    greater that 120 degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">lons</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

    <span class="c1"># Only check for longitude range &gt; 350 degrees</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">350</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="n">nvpts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">lons</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">lons_lower</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nvpts</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span> <span class="p">:]</span>
    <span class="n">discont_lower_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lons_lower</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">)</span>

    <span class="n">lons_mid</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nvpts</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="p">:]</span>
    <span class="n">discont_mid_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lons_mid</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">)</span>

    <span class="n">lons_upper</span> <span class="o">=</span> <span class="n">lons</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">nvpts</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span><span class="p">),</span> <span class="p">:]</span>
    <span class="n">discont_upper_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">lons_upper</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">120</span><span class="p">)</span>

    <span class="c1"># Check for one discontinuity</span>
    <span class="n">retval</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">discont_lower_idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">discont_mid_idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
        <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">discont_upper_idx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;orca_check - one discontinutity&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">discont_lower_idx</span><span class="p">,</span> <span class="n">discont_mid_idx</span><span class="p">,</span> <span class="n">discont_upper_idx</span><span class="p">)</span>
        <span class="n">v1</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">discont_lower_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">v2</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">discont_mid_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">v3</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">discont_upper_idx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">spread</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">([</span><span class="n">v1</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="n">v3</span><span class="p">])))</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;orca_check spread is </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">([</span><span class="n">v1</span><span class="p">,</span><span class="w"> </span><span class="n">v2</span><span class="p">,</span><span class="w"> </span><span class="n">v3</span><span class="p">])))</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Check for discontinuity spead of less than 20 places</span>
        <span class="k">if</span> <span class="n">spread</span> <span class="o">&lt;=</span> <span class="mi">20</span><span class="p">:</span>
            <span class="n">retval</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">return</span> <span class="n">retval</span>


<span class="k">def</span> <span class="nf">map_grid</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a grid on a map.&quot;&quot;&quot;</span>

    <span class="n">lons</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="mi">360</span> <span class="o">/</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_x_spacing</span>
    <span class="p">)</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">lons</span> <span class="o">-</span> <span class="mi">360</span><span class="p">,</span> <span class="n">lons</span><span class="p">])</span>
    <span class="n">lats</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="mi">180</span> <span class="o">/</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="o">*</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">grid_y_spacing</span>
        <span class="o">-</span> <span class="mi">90</span>
    <span class="p">)</span>

    <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span>
        <span class="n">color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_colour</span><span class="p">,</span>
        <span class="n">linewidth</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_thickness</span><span class="p">,</span>
        <span class="n">linestyle</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_linestyle</span><span class="p">,</span>
        <span class="n">xlocs</span><span class="o">=</span><span class="n">lons</span><span class="p">,</span>
        <span class="n">ylocs</span><span class="o">=</span><span class="n">lats</span><span class="p">,</span>
        <span class="n">zorder</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">grid_zorder</span><span class="p">,</span>
    <span class="p">)</span>


<span class="c1"># ======================================================</span>
<span class="c1"># MISC. - TODO move these out of functional library code</span>
<span class="c1"># ======================================================</span>

<span class="k">def</span> <span class="nf">_process_color_scales</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Process colour scales to generate images of them for the web</span>
<span class="sd">    | documentation and the rst code for inclusion in the</span>
<span class="sd">    | colour_scale.rst file.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    | No inputs</span>
<span class="sd">    | This is an internal routine and not used by the user</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Define scale categories</span>
    <span class="n">uniform</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="s2">&quot;magma&quot;</span><span class="p">,</span> <span class="s2">&quot;inferno&quot;</span><span class="p">,</span> <span class="s2">&quot;plasma&quot;</span><span class="p">,</span> <span class="s2">&quot;parula&quot;</span><span class="p">,</span> <span class="s2">&quot;gray&quot;</span><span class="p">]</span>

    <span class="n">ncl_large</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;amwg256&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BkBlAqGrYeOrReViWh200&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlAqGrYeOrRe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlAqGrYeOrReVi200&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlGrYeOrReVi200&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlRe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlueRed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlueRedGray&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlueWhiteOrangeRed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlueYellowRed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlWhRe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cmp_b2r&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cmp_haxby&quot;</span><span class="p">,</span>
        <span class="s2">&quot;detail&quot;</span><span class="p">,</span>
        <span class="s2">&quot;extrema&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GrayWhiteGray&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GreenYellow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;helix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;helix1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hotres&quot;</span><span class="p">,</span>
        <span class="s2">&quot;matlab_hot&quot;</span><span class="p">,</span>
        <span class="s2">&quot;matlab_hsv&quot;</span><span class="p">,</span>
        <span class="s2">&quot;matlab_jet&quot;</span><span class="p">,</span>
        <span class="s2">&quot;matlab_lines&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ncl_default&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ncview_default&quot;</span><span class="p">,</span>
        <span class="s2">&quot;OceanLakeLandSnow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rainbow&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rainbow_white_gray&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rainbow_white&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rainbow_gray&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tbr_240_300&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tbr_stdev_0_30&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tbr_var_0_500&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tbrAvg1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tbrStd1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;tbrVar1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;thelix&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ViBlGrWhYeOrRe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;wh_bl_gr_ye_re&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WhBlGrYeRe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WhBlReWh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WhiteBlue&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WhiteBlueGreenYellowRed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WhiteGreen&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WhiteYellowOrangeRed&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WhViBlGrYeOrRe&quot;</span><span class="p">,</span>
        <span class="s2">&quot;WhViBlGrYeOrReWh&quot;</span><span class="p">,</span>
        <span class="s2">&quot;wxpEnIR&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3gauss&quot;</span><span class="p">,</span>
        <span class="s2">&quot;3saw&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BrBG&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">ncl_meteoswiss</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;hotcold_18lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hotcolr_19lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mch_default&quot;</span><span class="p">,</span>
        <span class="s2">&quot;perc2_9lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;percent_11lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip2_15lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip2_17lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip3_16lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip4_11lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip4_diff_19lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip_11lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip_diff_12lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip_diff_1lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rh_19lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;spread_15lev&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">ncl_color_blindness</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;StepSeq25&quot;</span><span class="p">,</span>
        <span class="s2">&quot;posneg_2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;posneg_1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlueDarkOrange18&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlueDarkRed18&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GreenMagenta16&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlueGreen14&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BrownBlue12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Cat12&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">ncl_small</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;amwg&quot;</span><span class="p">,</span>
        <span class="s2">&quot;amwg_blueyellowred&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlueDarkRed18&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlueDarkOrange18&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BlueGreen14&quot;</span><span class="p">,</span>
        <span class="s2">&quot;BrownBlue12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Cat12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cmp_flux&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cosam12&quot;</span><span class="p">,</span>
        <span class="s2">&quot;cosam&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GHRSST_anomaly&quot;</span><span class="p">,</span>
        <span class="s2">&quot;GreenMagenta16&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hotcold_18lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;hotcolr_19lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mch_default&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nrl_sirkes&quot;</span><span class="p">,</span>
        <span class="s2">&quot;nrl_sirkes_nowhite&quot;</span><span class="p">,</span>
        <span class="s2">&quot;perc2_9lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;percent_11lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;posneg_2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prcp_1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prcp_2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;prcp_3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip_11lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip_diff_12lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip_diff_1lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip2_15lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip2_17lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip3_16lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip4_11lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;precip4_diff_19lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;radar&quot;</span><span class="p">,</span>
        <span class="s2">&quot;radar_1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;rh_19lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;seaice_1&quot;</span><span class="p">,</span>
        <span class="s2">&quot;seaice_2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;so4_21&quot;</span><span class="p">,</span>
        <span class="s2">&quot;spread_15lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;StepSeq25&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sunshine_9lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;sunshine_diff_12lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;temp_19lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;temp_diff_18lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;temp_diff_1lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;topo_15lev&quot;</span><span class="p">,</span>
        <span class="s2">&quot;wgne15&quot;</span><span class="p">,</span>
        <span class="s2">&quot;wind_17lev&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">orography</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s2">&quot;os250kmetres&quot;</span><span class="p">,</span>
        <span class="s2">&quot;wiki_1_0_2&quot;</span><span class="p">,</span>
        <span class="s2">&quot;wiki_1_0_3&quot;</span><span class="p">,</span>
        <span class="s2">&quot;wiki_2_0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;wiki_2_0_reduced&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arctic&quot;</span><span class="p">,</span>
    <span class="p">]</span>

    <span class="n">idl_guide</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">45</span><span class="p">):</span>
        <span class="n">idl_guide</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

    <span class="c1"># TODO SLB improve string formatting below and consolidate</span>
    <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="p">[</span>
        <span class="s2">&quot;uniform&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ncl_meteoswiss&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ncl_small&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ncl_large&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ncl_color_blindness&quot;</span><span class="p">,</span>
        <span class="s2">&quot;orography&quot;</span><span class="p">,</span>
        <span class="s2">&quot;idl_guide&quot;</span><span class="p">,</span>
    <span class="p">]:</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;uniform&quot;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">uniform</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s2">&quot;================== =====&quot;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">10</span>
            <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;Perceptually uniform colour maps for use with continuous &quot;</span>
                <span class="s2">&quot;data&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Name               Scale&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;ncl_meteoswiss&quot;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_meteoswiss</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s2">&quot;================== =====&quot;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">19</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NCAR Command Language - MeteoSwiss colour maps&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Name               Scale&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;ncl_small&quot;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_small</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s2">&quot;=================== =====&quot;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">20</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NCAR Command Language - small color maps (&lt;50 colours)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;------------------------------------------------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Name                Scale&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;ncl_large&quot;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_large</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s2">&quot;======================= =====&quot;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">24</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;NCAR Command Language - large colour maps (&gt;50 colours)&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-------------------------------------------------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Name                    Scale&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;ncl_color_blindness&quot;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">ncl_color_blindness</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s2">&quot;================ =====&quot;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
            <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;NCAR Command Language - Enhanced to help with colour &quot;</span>
                <span class="s2">&quot;blindness&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">title</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;-----------------------------------------------------&quot;</span>
                <span class="s2">&quot;---------&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Name             Scale&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;orography&quot;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">orography</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s2">&quot;================ =====&quot;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Orography/bathymetry colour scales&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------------------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Name             Scale&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">17</span>
        <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s2">&quot;idl_guide&quot;</span><span class="p">:</span>
            <span class="n">scales</span> <span class="o">=</span> <span class="n">idl_guide</span>
            <span class="n">div</span> <span class="o">=</span> <span class="s2">&quot;======= =====&quot;</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;IDL guide scales&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;----------------&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Name    Scale&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
            <span class="n">chars</span> <span class="o">=</span> <span class="mi">8</span>

        <span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">scales</span><span class="p">:</span>
            <span class="c1"># Make image of scale</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">))</span>
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
            <span class="n">cscale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
            <span class="n">cb1</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span>
                <span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s2">&quot;horizontal&quot;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="kc">None</span>
            <span class="p">)</span>
            <span class="n">cb1</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
            <span class="n">cb1</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">])</span>
            <span class="c1"># TODO SLB, update path below to non-specific one</span>
            <span class="n">file</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;/home/andy/cf-docs/cfplot_sphinx/images/&quot;</span>
                <span class="sa">f</span><span class="s2">&quot;colour_scales/</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="p">)</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="n">plot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

            <span class="c1"># Use convert to trim the png file to remove white space</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">([</span><span class="s2">&quot;convert&quot;</span><span class="p">,</span> <span class="s2">&quot;-trim&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">file</span><span class="p">])</span>

            <span class="n">name_pad</span> <span class="o">=</span> <span class="n">scale</span>
            <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_pad</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">chars</span><span class="p">:</span>
                <span class="n">name_pad</span> <span class="o">=</span> <span class="n">name_pad</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>
            <span class="n">fn</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name_pad</span><span class="si">}</span><span class="s2">.. image:: images/colour_scales/</span><span class="si">{</span><span class="n">scale</span><span class="si">}</span><span class="s2">.png&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">div</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
       Copyright 2024, Sadie Bartholomew.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.4.7.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.15.4.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>